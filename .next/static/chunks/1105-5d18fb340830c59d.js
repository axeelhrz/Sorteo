(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1105],{6201:function(e,r,t){"use strict";t.d(r,{Z:function(){return w}});var a=t(7821),n=t(8078),o=t(8504),s=t(7197),i=t(6289),c=t(4542),l=t(7851),u=t(6671),d=t.n(u);function h(e){let{}=e,r=(0,o.usePathname)(),t=e=>r.includes(e),n=[{label:"Inicio",icon:l.m6D,href:"/user-panel",id:"dashboard"},{label:"Mis Participaciones",icon:l.E25,href:"/user-panel/participations",id:"participations"},{label:"Sorteos Ganados",icon:l.HR2,href:"/user-panel/won-raffles",id:"won-raffles"},{label:"Historial de Compras",icon:l.NOg,href:"/user-panel/purchase-history",id:"purchase-history"},{label:"Notificaciones",icon:l.vWP,href:"/user-panel/notifications",id:"notifications"},{label:"Centro de Soporte",icon:l.EQ9,href:"/user-panel/support",id:"support"},{label:"Mi Perfil",icon:l.fzv,href:"/user-panel/profile",id:"profile"}];return(0,a.jsxs)("aside",{className:d().sidebar,children:[(0,a.jsx)("div",{className:d().sidebarHeader,children:(0,a.jsx)("h2",{className:d().title,children:"Mi Panel"})}),(0,a.jsx)("nav",{className:d().menu,children:n.map(e=>{let r=e.icon;return(0,a.jsxs)(c.default,{href:e.href,className:"".concat(d().menuItem," ").concat(t(e.id)?d().active:""),children:[(0,a.jsx)(r,{className:d().icon}),(0,a.jsx)("span",{className:d().label,children:e.label})]},e.id)})}),(0,a.jsx)("div",{className:d().sidebarFooter,children:(0,a.jsx)("p",{className:d().footerText,children:"\xbfNecesitas ayuda? Contacta con nuestro equipo de soporte."})})]})}var p=t(1929),f=t.n(p);function m(){var e;let r=(0,o.useRouter)(),{user:t,logout:i}=(0,s.t)(),[c]=(0,n.useState)(0),[u,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{},[]);let h=async()=>{try{await i(),r.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n:",e),r.push("/")}};return(0,a.jsx)("header",{className:f().header,children:(0,a.jsxs)("div",{className:f().headerContent,children:[(0,a.jsx)("div",{className:f().leftSection,children:(0,a.jsx)("h1",{className:f().title,children:"Mi Panel"})}),(0,a.jsxs)("div",{className:f().rightSection,children:[(0,a.jsxs)("button",{className:f().notificationBtn,children:[(0,a.jsx)(l.vWP,{}),c>0&&(0,a.jsx)("span",{className:f().badge,children:c})]}),(0,a.jsxs)("div",{className:f().userMenu,children:[(0,a.jsxs)("button",{className:f().userButton,onClick:()=>d(!u),children:[(0,a.jsx)("div",{className:f().userAvatar,children:(null==t?void 0:null===(e=t.name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"U"}),(0,a.jsx)("span",{className:f().userName,children:null==t?void 0:t.name}),(0,a.jsx)(l.bTu,{className:f().chevron})]}),u&&(0,a.jsxs)("div",{className:f().dropdown,children:[(0,a.jsxs)("a",{href:"/user-panel/profile",className:f().dropdownItem,children:[(0,a.jsx)(l.fzv,{className:f().dropdownIcon}),"Mi Perfil"]}),(0,a.jsxs)("a",{href:"/user-panel/profile?tab=preferences",className:f().dropdownItem,children:[(0,a.jsx)(l.nbt,{className:f().dropdownIcon}),"Preferencias"]}),(0,a.jsxs)("a",{href:"/user-panel/profile?tab=security",className:f().dropdownItem,children:[(0,a.jsx)(l.UIZ,{className:f().dropdownIcon}),"Seguridad"]}),(0,a.jsx)("hr",{className:f().divider}),(0,a.jsxs)("button",{onClick:h,className:"".concat(f().dropdownItem," ").concat(f().logoutBtn),children:[(0,a.jsx)(l.xqh,{className:f().dropdownIcon}),"Cerrar Sesi\xf3n"]})]})]})]})]})})}var g=t(739),y=t.n(g);function w(e){let{children:r,activeSection:t}=e,c=(0,o.useRouter)(),{user:l,isAuthenticated:u}=(0,s.t)();return(n.useEffect(()=>{if(!u||!l){c.push("/login");return}if(l.role!==i.i.USER){c.push("/");return}},[u,l,c]),u&&l&&l.role===i.i.USER)?(0,a.jsxs)("div",{className:y().container,children:[(0,a.jsx)(h,{activeSection:t}),(0,a.jsxs)("div",{className:y().mainContent,children:[(0,a.jsx)(m,{}),(0,a.jsx)("div",{className:y().content,children:r})]})]}):(0,a.jsx)("div",{className:y().loading,children:"Redirigiendo..."})}},3404:function(e,r,t){"use strict";t.d(r,{x:function(){return i}});var a=t(7147),n=t(9190);let o=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(e);if(!e.endsWith("/api")){let r=e.endsWith("/")?e.slice(0,-1):e;return"".concat(r,"/api")}return e})();class s{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,r){return this.client.get(e,r)}async post(e,r,t){return this.client.post(e,r,t)}async put(e,r){return this.client.put(e,r)}async delete(e){return this.client.delete(e)}constructor(){(0,a._)(this,"client",void 0),this.client=n.Z.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let r=localStorage.getItem("token");console.log("API Request - Token from localStorage:",r),r?(e.headers.Authorization="Bearer ".concat(r),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var r;return(null===(r=e.response)||void 0===r?void 0:r.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let i=new s},6532:function(e,r,t){"use strict";let a;t.d(r,{I8:function(){return l},db:function(){return c}});var n=t(1830),o=t(6534),s=t(1069),i=t(4304);a=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,n.C6)()[0];let c=(0,o.ad)(a);(0,s.cF)(a);let l=(0,i.v0)(a)},5161:function(e,r,t){"use strict";t.d(r,{Y:function(){return c}});var a=t(4304),n=t(6534),o=t(6532),s=t(6289);let i=async e=>{var r,t,a;try{let a=await (0,n.getDoc)((0,n.doc)(o.db,"users",e.uid));if(!a.exists())return{id:e.uid,name:e.displayName||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Usuario",email:e.email||"",role:s.i.USER};let i=a.data();return{id:e.uid,name:i.name||e.displayName||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"Usuario",email:e.email||"",role:i.role||s.i.USER}}catch(r){return console.error("Error converting Firebase user:",r),{id:e.uid,name:e.displayName||(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"Usuario",email:e.email||"",role:s.i.USER}}},c={async register(e){try{let r=(await (0,a.Xb)(o.I8,e.email,e.password)).user;e.name&&await (0,a.ck)(r,{displayName:e.name});let t=await r.getIdToken(),c={name:e.name,email:e.email,role:e.role,createdAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)()};if(e.role===s.i.SHOP&&e.shopName){let t={userId:r.uid,name:e.shopName,description:"",status:"pending",createdAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)()},a=await (0,n.ET)((0,n.collection)(o.db,"shops"),t);c.shopId=a.id,await (0,n.pl)((0,n.doc)(o.db,"users",r.uid),c)}else await (0,n.pl)((0,n.doc)(o.db,"users",r.uid),c);return{user:await i(r),token:t}}catch(r){console.error("Error registering user:",r);let e="Error al registrar usuario";throw"auth/email-already-in-use"===r.code?e="Este email ya est\xe1 registrado":"auth/invalid-email"===r.code?e="Email inv\xe1lido":"auth/weak-password"===r.code?e="La contrase\xf1a debe tener al menos 6 caracteres":"auth/operation-not-allowed"===r.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===r.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":r.message&&(e=r.message),Error(e)}},async login(e){try{let r=(await (0,a.e5)(o.I8,e.email,e.password)).user,t=await r.getIdToken();return{user:await i(r),token:t}}catch(r){console.error("Error logging in:",r);let e="Error al iniciar sesi\xf3n";throw"auth/user-not-found"===r.code?e="Usuario no encontrado":"auth/wrong-password"===r.code?e="Contrase\xf1a incorrecta":"auth/invalid-email"===r.code?e="Email inv\xe1lido":"auth/user-disabled"===r.code?e="Usuario deshabilitado":"auth/too-many-requests"===r.code?e="Demasiados intentos. Intenta m\xe1s tarde":"auth/operation-not-allowed"===r.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===r.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":r.message&&(e=r.message),Error(e)}},async logout(){try{await (0,a.w7)(o.I8)}catch(e){throw console.error("Error logging out:",e),e}},async getCurrentUser(){try{let e=o.I8.currentUser;if(!e)return null;return await i(e)}catch(e){return console.error("Error getting current user:",e),null}},async getCurrentUserToken(){try{let e=o.I8.currentUser;if(!e)return null;return await e.getIdToken()}catch(e){return console.error("Error getting token:",e),null}},onAuthStateChanged:e=>(0,a.Aj)(o.I8,async r=>{r?e(await i(r)):e(null)})}},4944:function(e,r,t){"use strict";t.d(r,{m:function(){return n}});var a=t(3404);let n={async getDashboard(){try{return(await a.x.get("/user-panel/dashboard")).data}catch(e){throw console.error("Error fetching dashboard:",e),e}},async getParticipations(){try{return(await a.x.get("/user-panel/participations")).data}catch(e){throw console.error("Error fetching participations:",e),e}},async getParticipationDetail(e){try{return(await a.x.get("/user-panel/participations/".concat(e))).data}catch(e){throw console.error("Error fetching participation detail:",e),e}},async getWonRaffles(){try{return(await a.x.get("/user-panel/won-raffles")).data}catch(e){throw console.error("Error fetching won raffles:",e),e}},async getWonRaffleDetail(e){try{return(await a.x.get("/user-panel/won-raffles/".concat(e))).data}catch(e){throw console.error("Error fetching won raffle detail:",e),e}},async markWonRaffleAsReceived(e){try{return(await a.x.put("/user-panel/won-raffles/".concat(e,"/mark-received"),{})).data}catch(e){throw console.error("Error marking raffle as received:",e),e}},async getPurchaseHistory(){try{return(await a.x.get("/user-panel/purchase-history")).data}catch(e){throw console.error("Error fetching purchase history:",e),e}},async getPurchaseDetail(e){try{return(await a.x.get("/user-panel/purchase-history/".concat(e))).data}catch(e){throw console.error("Error fetching purchase detail:",e),e}},async downloadPurchaseReceipt(e){try{return(await a.x.get("/user-panel/purchase-history/".concat(e,"/receipt"),{responseType:"blob"})).data}catch(e){throw console.error("Error downloading receipt:",e),e}},async exportPurchaseHistoryCSV(){try{return(await a.x.get("/user-panel/purchase-history/export/csv",{responseType:"blob"})).data}catch(e){throw console.error("Error exporting purchase history:",e),e}},async getNotifications(e){try{return(await a.x.get("/user-panel/notifications".concat(e?"?limit=".concat(e):""))).data}catch(e){throw console.error("Error fetching notifications:",e),e}},async markNotificationAsRead(e){try{return(await a.x.put("/user-panel/notifications/".concat(e,"/read"),{})).data}catch(e){throw console.error("Error marking notification as read:",e),e}},async markAllNotificationsAsRead(){try{await a.x.put("/user-panel/notifications/mark-all-read",{})}catch(e){throw console.error("Error marking all notifications as read:",e),e}},async getProfile(){try{return(await a.x.get("/user-panel/profile")).data}catch(e){throw console.error("Error fetching profile:",e),e}},async updateProfile(e){try{return(await a.x.put("/user-panel/profile",e)).data}catch(e){throw console.error("Error updating profile:",e),e}},async changePassword(e,r){try{await a.x.post("/user-panel/security/change-password",{currentPassword:e,newPassword:r})}catch(e){throw console.error("Error changing password:",e),e}},async getPreferences(){try{return(await a.x.get("/user-panel/preferences")).data}catch(e){throw console.error("Error fetching preferences:",e),e}},async updatePreferences(e){try{return(await a.x.put("/user-panel/preferences",e)).data}catch(e){throw console.error("Error updating preferences:",e),e}},async getSecuritySettings(){try{return(await a.x.get("/user-panel/security")).data}catch(e){throw console.error("Error fetching security settings:",e),e}},async closeAllSessions(){try{await a.x.post("/user-panel/security/close-all-sessions",{})}catch(e){throw console.error("Error closing all sessions:",e),e}},async getComplaints(){try{return(await a.x.get("/user-panel/complaints")).data}catch(e){throw console.error("Error fetching complaints:",e),e}}}},7197:function(e,r,t){"use strict";t.d(r,{t:function(){return s}});var a=t(3020),n=t(4302),o=t(5161);let s=(0,a.Ue)()((0,n.tJ)((e,r)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:r=>e({user:r,isAuthenticated:!!r}),setToken:r=>{r?localStorage.setItem("token",r):localStorage.removeItem("token"),e({token:r})},setIsLoading:r=>e({isLoading:r}),setError:r=>e({error:r}),logout:async()=>{try{await o.Y.logout()}catch(e){console.error("Error logging out:",e)}finally{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}},refreshToken:async()=>{try{let e=await o.Y.getCurrentUserToken();e&&r().setToken(e)}catch(e){console.error("Error refreshing token:",e)}}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6289:function(e,r,t){"use strict";var a,n;t.d(r,{i:function(){return a}}),(n=a||(a={})).ADMIN="admin",n.SHOP="shop",n.USER="user"},1929:function(e){e.exports={header:"user-panel-header_header__YvbYt",headerContent:"user-panel-header_headerContent__Wt_R3",leftSection:"user-panel-header_leftSection__qi6d9",title:"user-panel-header_title__zvJDX",rightSection:"user-panel-header_rightSection__O5ycN",notificationBtn:"user-panel-header_notificationBtn__1mzqo",badge:"user-panel-header_badge__9b4vT",userMenu:"user-panel-header_userMenu__RvZZg",userButton:"user-panel-header_userButton__HZjuO",userAvatar:"user-panel-header_userAvatar__qcskj",userName:"user-panel-header_userName__3sU8a",chevron:"user-panel-header_chevron__tEq6H",dropdown:"user-panel-header_dropdown__PUF_1",dropdownItem:"user-panel-header_dropdownItem__y3HfC",divider:"user-panel-header_divider__CZXSh",logoutBtn:"user-panel-header_logoutBtn__rP_BX"}},739:function(e){e.exports={container:"user-panel-layout_container__UNfmn",mainContent:"user-panel-layout_mainContent__XokmT",content:"user-panel-layout_content__Faw9P",loading:"user-panel-layout_loading__ve4Fo"}},6671:function(e){e.exports={sidebar:"user-panel-sidebar_sidebar__ZXmxx",sidebarHeader:"user-panel-sidebar_sidebarHeader__z0nLM",title:"user-panel-sidebar_title__8xInR",menu:"user-panel-sidebar_menu__PEmWn",menuItem:"user-panel-sidebar_menuItem__A1IhO",active:"user-panel-sidebar_active__DIftH",icon:"user-panel-sidebar_icon__2h__E",label:"user-panel-sidebar_label__vK2wW",sidebarFooter:"user-panel-sidebar_sidebarFooter__OXSDq",footerText:"user-panel-sidebar_footerText__crP40"}},8416:function(e,r,t){"use strict";t.d(r,{w_:function(){return u}});var a=t(8078),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=a.createContext&&a.createContext(n),s=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,a)}return t}function l(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?c(Object(t),!0).forEach(function(r){var a,n;a=r,n=t[r],(a=function(e){var r=function(e,r){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,r||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==typeof r?r:r+""}(a))in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function u(e){return r=>a.createElement(d,i({attr:l({},e.attr)},r),function e(r){return r&&r.map((r,t)=>a.createElement(r.tag,l({key:t},r.attr),e(r.child)))}(e.child))}function d(e){var r=r=>{var t,{attr:n,size:o,title:c}=e,u=function(e,r){if(null==e)return{};var t,a,n=function(e,r){if(null==e)return{};var t={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(r.indexOf(a)>=0)continue;t[a]=e[a]}return t}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}(e,s),d=o||r.size||"1em";return r.className&&(t=r.className),e.className&&(t=(t?t+" ":"")+e.className),a.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,u,{className:t,style:l(l({color:e.color||r.color},r.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),c&&a.createElement("title",null,c),e.children)};return void 0!==o?a.createElement(o.Consumer,null,e=>r(e)):r(n)}}}]);