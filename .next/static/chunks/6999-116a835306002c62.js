"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6999],{6312:function(t,e,a){a.d(e,{a:function(){return s}});var r=a(8078),n=a(7197),o=a(5161);function s(){let[t,e]=(0,r.useState)(!1),a=(0,n.t)();return(0,r.useEffect)(()=>{let t=o.Y.onAuthStateChanged(async t=>{if(t){a.setUser(t);try{let t=await o.Y.getCurrentUserToken();t&&a.setToken(t)}catch(t){console.error("Error getting token:",t)}}else a.setUser(null),a.setToken(null);e(!0)});return()=>{t()}},[]),{...a,isHydrated:t}}},3404:function(t,e,a){a.d(e,{x:function(){return i}});var r=a(7147),n=a(9190);let o=(()=>{let t="http://localhost:3001/api";if(!t.startsWith("http://")&&!t.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(t);if(!t.endsWith("/api")){let e=t.endsWith("/")?t.slice(0,-1):t;return"".concat(e,"/api")}return t})();class s{async register(t){return this.client.post("/auth/register",t)}async login(t){return this.client.post("/auth/login",t)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(t,e){return this.client.get(t,e)}async post(t,e,a){return this.client.post(t,e,a)}async put(t,e){return this.client.put(t,e)}async delete(t){return this.client.delete(t)}constructor(){(0,r._)(this,"client",void 0),this.client=n.Z.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(t=>{try{let e=localStorage.getItem("token");console.log("API Request - Token from localStorage:",e),e?(t.headers.Authorization="Bearer ".concat(e),console.log("API Request - Authorization header set:",t.headers.Authorization)):console.log("API Request - No token found"),t.data instanceof FormData&&delete t.headers["Content-Type"]}catch(t){console.error("Error reading token from localStorage:",t)}return t}),this.client.interceptors.response.use(t=>t,t=>{var e;return(null===(e=t.response)||void 0===e?void 0:e.status)===401&&localStorage.removeItem("token"),Promise.reject(t)})}}let i=new s},6532:function(t,e,a){let r;a.d(e,{I8:function(){return c},db:function(){return l}});var n=a(1830),o=a(6534),s=a(1069),i=a(4304);r=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,n.C6)()[0];let l=(0,o.ad)(r);(0,s.cF)(r);let c=(0,i.v0)(r)},2265:function(t,e,a){a.d(e,{P:function(){return n}});var r=a(3404);let n={createComplaint:async t=>(await r.x.post("/complaints",t)).data,getComplaintById:async t=>(await r.x.get("/complaints/".concat(t))).data,async getUserComplaints(t){let e=new URLSearchParams;return(null==t?void 0:t.status)&&e.append("status",t.status),(null==t?void 0:t.type)&&e.append("type",t.type),(null==t?void 0:t.limit)&&e.append("limit",t.limit.toString()),(null==t?void 0:t.offset)&&e.append("offset",t.offset.toString()),(await r.x.get("/complaints/user/my-complaints?".concat(e.toString()))).data},async getShopComplaints(t,e){let a=new URLSearchParams;return(null==e?void 0:e.status)&&a.append("status",e.status),(null==e?void 0:e.limit)&&a.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&a.append("offset",e.offset.toString()),(await r.x.get("/complaints/shop/".concat(t,"?").concat(a.toString()))).data},async getAllComplaints(t){let e=new URLSearchParams;return(null==t?void 0:t.status)&&e.append("status",t.status),(null==t?void 0:t.type)&&e.append("type",t.type),(null==t?void 0:t.shopId)&&e.append("shopId",t.shopId),(null==t?void 0:t.raffleId)&&e.append("raffleId",t.raffleId),(null==t?void 0:t.startDate)&&e.append("startDate",t.startDate),(null==t?void 0:t.endDate)&&e.append("endDate",t.endDate),(null==t?void 0:t.limit)&&e.append("limit",t.limit.toString()),(null==t?void 0:t.offset)&&e.append("offset",t.offset.toString()),(await r.x.get("/complaints?".concat(e.toString()))).data},updateComplaint:async(t,e)=>(await r.x.put("/complaints/".concat(t),e)).data,addMessage:async(t,e)=>(await r.x.post("/complaints/".concat(t,"/messages"),{message:e})).data,getMessages:async t=>(await r.x.get("/complaints/".concat(t,"/messages"))).data,addAttachment:async(t,e)=>(await r.x.post("/complaints/".concat(t,"/attachments"),e)).data,getAttachments:async t=>(await r.x.get("/complaints/".concat(t,"/attachments"))).data,cancelComplaint:async t=>(await r.x.put("/complaints/".concat(t,"/cancel"),{})).data,async exportComplaints(t){let e=new URLSearchParams;return(null==t?void 0:t.startDate)&&e.append("startDate",t.startDate),(null==t?void 0:t.endDate)&&e.append("endDate",t.endDate),(null==t?void 0:t.shopId)&&e.append("shopId",t.shopId),(null==t?void 0:t.status)&&e.append("status",t.status),(await r.x.get("/complaints/export/csv?".concat(e.toString()))).data},getComplaintStats:async()=>(await r.x.get("/complaints/stats/overview")).data}},5161:function(t,e,a){a.d(e,{Y:function(){return l}});var r=a(4304),n=a(6534),o=a(6532),s=a(6289);let i=async t=>{var e,a,r;try{let r=await (0,n.getDoc)((0,n.doc)(o.db,"users",t.uid));if(!r.exists())return{id:t.uid,name:t.displayName||(null===(a=t.email)||void 0===a?void 0:a.split("@")[0])||"Usuario",email:t.email||"",role:s.i.USER};let i=r.data();return{id:t.uid,name:i.name||t.displayName||(null===(e=t.email)||void 0===e?void 0:e.split("@")[0])||"Usuario",email:t.email||"",role:i.role||s.i.USER}}catch(e){return console.error("Error converting Firebase user:",e),{id:t.uid,name:t.displayName||(null===(r=t.email)||void 0===r?void 0:r.split("@")[0])||"Usuario",email:t.email||"",role:s.i.USER}}},l={async register(t){try{let e=(await (0,r.Xb)(o.I8,t.email,t.password)).user;t.name&&await (0,r.ck)(e,{displayName:t.name});let a=await e.getIdToken(),l={name:t.name,email:t.email,role:t.role,createdAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)()};if(t.role===s.i.SHOP&&t.shopName){let a={userId:e.uid,name:t.shopName,description:"",status:"pending",createdAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)()},r=await (0,n.ET)((0,n.collection)(o.db,"shops"),a);l.shopId=r.id,await (0,n.pl)((0,n.doc)(o.db,"users",e.uid),l)}else await (0,n.pl)((0,n.doc)(o.db,"users",e.uid),l);return{user:await i(e),token:a}}catch(e){console.error("Error registering user:",e);let t="Error al registrar usuario";throw"auth/email-already-in-use"===e.code?t="Este email ya est\xe1 registrado":"auth/invalid-email"===e.code?t="Email inv\xe1lido":"auth/weak-password"===e.code?t="La contrase\xf1a debe tener al menos 6 caracteres":"auth/operation-not-allowed"===e.code?t="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===e.code?t="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":e.message&&(t=e.message),Error(t)}},async login(t){try{let e=(await (0,r.e5)(o.I8,t.email,t.password)).user,a=await e.getIdToken();return{user:await i(e),token:a}}catch(e){console.error("Error logging in:",e);let t="Error al iniciar sesi\xf3n";throw"auth/user-not-found"===e.code?t="Usuario no encontrado":"auth/wrong-password"===e.code?t="Contrase\xf1a incorrecta":"auth/invalid-email"===e.code?t="Email inv\xe1lido":"auth/user-disabled"===e.code?t="Usuario deshabilitado":"auth/too-many-requests"===e.code?t="Demasiados intentos. Intenta m\xe1s tarde":"auth/operation-not-allowed"===e.code?t="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===e.code?t="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":e.message&&(t=e.message),Error(t)}},async logout(){try{await (0,r.w7)(o.I8)}catch(t){throw console.error("Error logging out:",t),t}},async getCurrentUser(){try{let t=o.I8.currentUser;if(!t)return null;return await i(t)}catch(t){return console.error("Error getting current user:",t),null}},async getCurrentUserToken(){try{let t=o.I8.currentUser;if(!t)return null;return await t.getIdToken()}catch(t){return console.error("Error getting token:",t),null}},onAuthStateChanged:t=>(0,r.Aj)(o.I8,async e=>{e?t(await i(e)):t(null)})}},7197:function(t,e,a){a.d(e,{t:function(){return s}});var r=a(3020),n=a(4302),o=a(5161);let s=(0,r.Ue)()((0,n.tJ)((t,e)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:e=>t({user:e,isAuthenticated:!!e}),setToken:e=>{e?localStorage.setItem("token",e):localStorage.removeItem("token"),t({token:e})},setIsLoading:e=>t({isLoading:e}),setError:e=>t({error:e}),logout:async()=>{try{await o.Y.logout()}catch(t){console.error("Error logging out:",t)}finally{localStorage.removeItem("token"),t({user:null,token:null,isAuthenticated:!1})}},refreshToken:async()=>{try{let t=await o.Y.getCurrentUserToken();t&&e().setToken(t)}catch(t){console.error("Error refreshing token:",t)}}}),{name:"auth-store",partialize:t=>({user:t.user,token:t.token,isAuthenticated:t.isAuthenticated})}))},6289:function(t,e,a){var r,n;a.d(e,{i:function(){return r}}),(n=r||(r={})).ADMIN="admin",n.SHOP="shop",n.USER="user"},7511:function(t,e,a){var r,n,o,s,i,l;a.d(e,{Fq:function(){return o},P5:function(){return n},pM:function(){return r}}),(s=r||(r={})).PRIZE_NOT_DELIVERED="prize_not_delivered",s.DIFFERENT_PRODUCT="different_product",s.PURCHASE_PROBLEM="purchase_problem",s.SHOP_BEHAVIOR="shop_behavior",s.RAFFLE_FRAUD="raffle_fraud",s.TECHNICAL_ISSUE="technical_issue",s.PAYMENT_ERROR="payment_error",(i=n||(n={})).PENDING="pending",i.IN_REVIEW="in_review",i.RESOLVED="resolved",i.REJECTED="rejected",i.CANCELLED="cancelled",(l=o||(o={})).RESOLVED_USER_FAVOR="resolved_user_favor",l.RESOLVED_SHOP_FAVOR="resolved_shop_favor",l.RESOLVED_PLATFORM_FAVOR="resolved_platform_favor",l.REJECTED="rejected",l.CANCELLED="cancelled"}}]);