(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1842],{2615:function(e,n,t){Promise.resolve().then(t.bind(t,6003))},6003:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return p}});var r=t(7821),a=t(8078),i=t(4542),s=t(8149),o=t(8504),c=t(7851),l=t(5805),d=t(6312),u=t(6030),h=t(3404),_=t(6714),m=t.n(_);function p(){var e,n,t,_,p,g,x,w,f,N,v;let j=(0,o.useParams)().id,{user:k}=(0,d.a)(),[b,I]=(0,a.useState)(null),[T,C]=(0,a.useState)(!0),[S,E]=(0,a.useState)(null),[y,L]=(0,a.useState)(null),[D,B]=(0,a.useState)([]),[V,A]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=async()=>{try{C(!0);let e=await l.Z.getRaffleById(j);if(I(e),e.status===u.r.FINISHED&&e.winnerTicketId)try{let n=await h.x.get("/api/raffle-tickets/".concat(e.winnerTicketId));L(n.data)}catch(n){console.error("Error loading winner ticket:",n);try{let n=((await h.x.get("/api/raffle-tickets?raffleId=".concat(j))).data||[]).find(n=>n.id===e.winnerTicketId);n&&L(n)}catch(e){console.error("Error loading all tickets:",e)}}}catch(e){console.error("Error loading raffle:",e),E("No pudimos cargar el sorteo. Intenta nuevamente.")}finally{C(!1)}};j&&e()},[j]),(0,a.useEffect)(()=>{let e=async()=>{if(k&&j)try{let e=(await h.x.get("/api/raffle-tickets?raffleId=".concat(j))).data||[];if(B(e),null==b?void 0:b.winnerTicketId){let n=e.some(e=>e.id===b.winnerTicketId);A(n)}}catch(e){console.error("Error loading user tickets:",e)}};k&&b&&e()},[k,j,null==b?void 0:b.winnerTicketId]),T)?(0,r.jsx)("main",{className:m().container,children:(0,r.jsxs)("div",{className:m().loadingContainer,children:[(0,r.jsx)("div",{className:m().spinner}),(0,r.jsx)("p",{children:"Cargando informaci\xf3n del ganador..."})]})}):S||!b?(0,r.jsx)("main",{className:m().container,children:(0,r.jsxs)("div",{className:m().errorContainer,children:[(0,r.jsx)(c.jRj,{className:m().errorIcon}),(0,r.jsx)("h1",{className:m().errorTitle,children:"Sorteo no encontrado"}),(0,r.jsx)("p",{className:m().errorDescription,children:"El sorteo que buscas no existe o no est\xe1 disponible en este momento."}),(0,r.jsx)(i.default,{href:"/sorteos",children:(0,r.jsx)("button",{className:m().backButton,children:"Volver al listado"})})]})}):b.status!==u.r.FINISHED?(0,r.jsx)("main",{className:m().container,children:(0,r.jsxs)("div",{className:m().errorContainer,children:[(0,r.jsx)(c.TCC,{className:m().errorIcon}),(0,r.jsx)("h1",{className:m().errorTitle,children:"Sorteo a\xfan no finalizado"}),(0,r.jsx)("p",{className:m().errorDescription,children:"Este sorteo a\xfan no ha finalizado. Vuelve cuando el sorteo est\xe9 completo."}),(0,r.jsx)(i.default,{href:"/sorteos/".concat(j),children:(0,r.jsx)("button",{className:m().backButton,children:"Ver sorteo"})})]})}):b.winnerTicketId?(0,r.jsxs)("main",{className:m().container,children:[(0,r.jsx)(i.default,{href:"/sorteos/".concat(j),className:m().backLink,children:"â† Volver al sorteo"}),(0,r.jsx)("div",{className:m().heroSection,children:(0,r.jsx)("div",{className:m().heroContent,children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:m().winnerIcon,children:(0,r.jsx)(c.HR2,{})}),(0,r.jsx)("h1",{className:m().heroTitle,children:"\xa1Felicidades! Eres el ganador"}),(0,r.jsxs)("p",{className:m().heroSubtitle,children:["Has ganado el sorteo de ",(0,r.jsx)("strong",{children:null===(e=b.product)||void 0===e?void 0:e.name})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:m().winnerIcon,children:(0,r.jsx)(c._rq,{})}),(0,r.jsx)("h1",{className:m().heroTitle,children:"Sorteo finalizado"}),(0,r.jsxs)("p",{className:m().heroSubtitle,children:["El ganador del sorteo de ",(0,r.jsx)("strong",{children:null===(n=b.product)||void 0===n?void 0:n.name})," ha sido seleccionado"]})]})})}),(0,r.jsxs)("div",{className:m().content,children:[(0,r.jsxs)("div",{className:m().leftColumn,children:[(0,r.jsxs)("div",{className:m().productCard,children:[(null===(t=b.product)||void 0===t?void 0:t.mainImage)?(0,r.jsx)("div",{className:m().imageContainer,children:(0,r.jsx)(s.default,{src:b.product.mainImage,alt:b.product.name,fill:!0,className:m().image,priority:!0})}):(0,r.jsx)("div",{className:m().imagePlaceholder,children:(0,r.jsx)("span",{children:"Sin imagen disponible"})}),(0,r.jsxs)("div",{className:m().productInfo,children:[(0,r.jsx)("h2",{className:m().productName,children:null===(_=b.product)||void 0===_?void 0:_.name}),(0,r.jsx)("p",{className:m().productDescription,children:null===(p=b.product)||void 0===p?void 0:p.description}),(0,r.jsxs)("div",{className:m().valueBox,children:[(0,r.jsx)("span",{className:m().valueLabel,children:"Valor del producto"}),(0,r.jsxs)("span",{className:m().valueAmount,children:["S/ ",Number(b.productValue).toFixed(2)]})]})]})]}),(0,r.jsxs)("div",{className:m().shopCard,children:[(0,r.jsx)("h3",{className:m().shopTitle,children:"Tienda"}),(0,r.jsxs)("div",{className:m().shopInfo,children:[(null===(g=b.shop)||void 0===g?void 0:g.logo)&&(0,r.jsx)(s.default,{src:b.shop.logo,alt:b.shop.name,width:48,height:48,className:m().shopLogo}),(0,r.jsxs)("div",{className:m().shopDetails,children:[(0,r.jsx)("h4",{className:m().shopName,children:null===(x=b.shop)||void 0===x?void 0:x.name}),(null===(w=b.shop)||void 0===w?void 0:w.status)==="verified"&&(0,r.jsxs)("span",{className:m().verifiedBadge,children:[(0,r.jsx)(c._rq,{className:m().verifiedIcon}),"Tienda verificada"]})]})]}),(null===(f=b.shop)||void 0===f?void 0:f.publicEmail)&&(0,r.jsxs)("p",{className:m().shopContact,children:[(0,r.jsx)("strong",{children:"Contacto:"})," ",b.shop.publicEmail]}),(null===(N=b.shop)||void 0===N?void 0:N.phone)&&(0,r.jsxs)("p",{className:m().shopContact,children:[(0,r.jsx)("strong",{children:"Tel\xe9fono:"})," ",b.shop.phone]})]})]}),(0,r.jsxs)("div",{className:m().rightColumn,children:[(0,r.jsxs)("div",{className:"".concat(m().winnerCard," ").concat(V?m().winnerCardHighlight:""),children:[(0,r.jsx)("div",{className:m().winnerHeader,children:(0,r.jsx)("h2",{className:m().winnerTitle,children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c._rq,{className:m().titleIcon}),"Tu ticket ganador"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.HR2,{className:m().titleIcon}),"Ticket ganador"]})})}),(0,r.jsxs)("div",{className:m().winnerTicketDisplay,children:[(0,r.jsxs)("div",{className:m().ticketNumberContainer,children:[(0,r.jsx)("span",{className:m().ticketLabel,children:"N\xfamero de ticket"}),(0,r.jsxs)("span",{className:m().ticketNumber,children:["#",(null==y?void 0:y.number)||"N/A"]})]}),(null==y?void 0:y.user)&&(0,r.jsxs)("div",{className:m().winnerUserInfo,children:[(0,r.jsx)("p",{className:m().winnerUserLabel,children:"Ganador"}),(0,r.jsx)("p",{className:m().winnerUserName,children:y.user.name}),V&&(0,r.jsx)("p",{className:m().winnerUserEmail,children:y.user.email})]}),b.raffleExecutedAt&&(0,r.jsxs)("div",{className:m().executionInfo,children:[(0,r.jsx)("p",{className:m().executionLabel,children:"Fecha de ejecuci\xf3n"}),(0,r.jsx)("p",{className:m().executionDate,children:new Date(b.raffleExecutedAt).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),V&&(0,r.jsxs)("div",{className:m().winnerMessage,children:[(0,r.jsxs)("p",{className:m().winnerMessageText,children:[(0,r.jsx)("strong",{children:"\xa1Felicidades!"})," Has sido seleccionado como ganador de este sorteo. La tienda se pondr\xe1 en contacto contigo para coordinar la entrega del premio."]}),(null===(v=b.shop)||void 0===v?void 0:v.publicEmail)&&(0,r.jsxs)("p",{className:m().winnerMessageText,children:["Si tienes alguna pregunta, puedes contactar a la tienda en:"," ",(0,r.jsx)("a",{href:"mailto:".concat(b.shop.publicEmail),className:m().contactLink,children:b.shop.publicEmail})]})]})]}),(0,r.jsxs)("div",{className:m().statsCard,children:[(0,r.jsx)("h3",{className:m().statsTitle,children:"Estad\xedsticas del sorteo"}),(0,r.jsxs)("div",{className:m().statsGrid,children:[(0,r.jsxs)("div",{className:m().statItem,children:[(0,r.jsx)("span",{className:m().statLabel,children:"Total de tickets"}),(0,r.jsx)("span",{className:m().statValue,children:b.totalTickets})]}),(0,r.jsxs)("div",{className:m().statItem,children:[(0,r.jsx)("span",{className:m().statLabel,children:"Tickets vendidos"}),(0,r.jsx)("span",{className:m().statValue,children:b.soldTickets})]}),(0,r.jsxs)("div",{className:m().statItem,children:[(0,r.jsx)("span",{className:m().statLabel,children:"Valor total"}),(0,r.jsxs)("span",{className:m().statValue,children:["S/ ",(Number(b.productValue)*b.soldTickets).toFixed(2)]})]})]})]}),k&&D.length>0&&(0,r.jsxs)("div",{className:m().participationCard,children:[(0,r.jsx)("h3",{className:m().participationTitle,children:"Tus participaciones"}),(0,r.jsxs)("p",{className:m().participationText,children:["Participaste con ",(0,r.jsx)("strong",{children:D.length})," ticket",D.length>1?"s":"",":"]}),(0,r.jsx)("div",{className:m().ticketNumbers,children:D.map(e=>(0,r.jsxs)("span",{className:"".concat(m().ticketNumberBadge," ").concat(e.id===b.winnerTicketId?m().ticketNumberWinner:""),children:["#",e.number,e.id===b.winnerTicketId&&(0,r.jsx)(c.HR2,{className:m().winnerBadgeIcon})]},e.id))})]})]})]}),(0,r.jsxs)("div",{className:m().ctaSection,children:[(0,r.jsx)("h2",{className:m().ctaTitle,children:"\xbfQuieres participar en m\xe1s sorteos?"}),(0,r.jsx)("p",{className:m().ctaText,children:"Descubre otros sorteos disponibles y gana incre\xedbles premios"}),(0,r.jsx)(i.default,{href:"/sorteos",children:(0,r.jsx)("button",{className:m().ctaButton,children:"Ver todos los sorteos"})})]})]}):(0,r.jsx)("main",{className:m().container,children:(0,r.jsxs)("div",{className:m().errorContainer,children:[(0,r.jsx)(c.bax,{className:m().errorIcon}),(0,r.jsx)("h1",{className:m().errorTitle,children:"Ganador no disponible"}),(0,r.jsx)("p",{className:m().errorDescription,children:"El ganador de este sorteo a\xfan no ha sido determinado."}),(0,r.jsx)(i.default,{href:"/sorteos/".concat(j),children:(0,r.jsx)("button",{className:m().backButton,children:"Volver al sorteo"})})]})})}},6312:function(e,n,t){"use strict";t.d(n,{a:function(){return i}});var r=t(8078),a=t(7197);function i(){let[e,n]=(0,r.useState)(!1),t=(0,a.t)();return(0,r.useEffect)(()=>{let e=localStorage.getItem("token");console.log("Token from localStorage:",e),e&&(console.log("Setting token in store:",e),t.setToken(e)),n(!0)},[]),{...t,isHydrated:e}}},3404:function(e,n,t){"use strict";t.d(n,{x:function(){return s}});var r=t(7147),a=t(9190);class i{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,n){return this.client.get(e,n)}async post(e,n,t){return this.client.post(e,n,t)}async put(e,n){return this.client.put(e,n)}async delete(e){return this.client.delete(e)}constructor(){(0,r._)(this,"client",void 0),this.client=a.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let n=localStorage.getItem("token");console.log("API Request - Token from localStorage:",n),n?(e.headers.Authorization="Bearer ".concat(n),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var n;return(null===(n=e.response)||void 0===n?void 0:n.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let s=new i},5805:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(3404);let a={async getActiveRaffles(e){try{let n=new URLSearchParams;return(null==e?void 0:e.search)&&n.append("search",e.search),(null==e?void 0:e.category)&&n.append("category",e.category),(null==e?void 0:e.shopId)&&n.append("shopId",e.shopId),(null==e?void 0:e.status)&&n.append("status",e.status),(null==e?void 0:e.minValue)!==void 0&&n.append("minValue",e.minValue.toString()),(null==e?void 0:e.maxValue)!==void 0&&n.append("maxValue",e.maxValue.toString()),(null==e?void 0:e.sortBy)&&n.append("sortBy",e.sortBy),(null==e?void 0:e.page)&&n.append("page",e.page.toString()),(null==e?void 0:e.limit)&&n.append("limit",e.limit.toString()),(await r.x.get("/raffles/public/active?".concat(n.toString()))).data}catch(e){throw console.error("Error fetching active raffles:",e),e}},async getRaffleById(e){try{return(await r.x.get("/raffles/public/".concat(e))).data}catch(e){throw console.error("Error fetching raffle:",e),e}},async getRafflesByShop(e,n){try{let t=new URLSearchParams;return(null==n?void 0:n.search)&&t.append("search",n.search),(null==n?void 0:n.sortBy)&&t.append("sortBy",n.sortBy),(null==n?void 0:n.page)&&t.append("page",n.page.toString()),(null==n?void 0:n.limit)&&t.append("limit",n.limit.toString()),(await r.x.get("/raffles/public/shop/".concat(e,"?").concat(t.toString()))).data}catch(e){throw console.error("Error fetching shop raffles:",e),e}},async getCategories(){try{return(await r.x.get("/raffles/public/categories")).data}catch(e){return console.error("Error fetching categories:",e),[]}},async getShopsWithActiveRaffles(){try{return(await r.x.get("/raffles/public/shops")).data}catch(e){return console.error("Error fetching shops:",e),[]}}}},7197:function(e,n,t){"use strict";t.d(n,{t:function(){return i}});var r=t(3020),a=t(4302);let i=(0,r.Ue)()((0,a.tJ)(e=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:n=>e({user:n,isAuthenticated:!!n}),setToken:n=>{n?localStorage.setItem("token",n):localStorage.removeItem("token"),e({token:n})},setIsLoading:n=>e({isLoading:n}),setError:n=>e({error:n}),logout:()=>{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6030:function(e,n,t){"use strict";var r,a;t.d(n,{r:function(){return r}}),(a=r||(r={})).DRAFT="draft",a.PENDING_APPROVAL="pending_approval",a.ACTIVE="active",a.PAUSED="paused",a.SOLD_OUT="sold_out",a.FINISHED="finished",a.CANCELLED="cancelled",a.REJECTED="rejected"},6714:function(e){e.exports={container:"winner_container__aQaVY",backLink:"winner_backLink__abg5X",loadingContainer:"winner_loadingContainer__b1L4W",errorContainer:"winner_errorContainer__yE4D3",spinner:"winner_spinner__2nbjO",spin:"winner_spin__LVIIZ",errorIcon:"winner_errorIcon__H2oaO",errorTitle:"winner_errorTitle__8WQf3",errorDescription:"winner_errorDescription__M9IOQ",backButton:"winner_backButton__Dfln5",heroSection:"winner_heroSection__4ehVV",heroContent:"winner_heroContent___H2BO",winnerIcon:"winner_winnerIcon__s2jfR",bounce:"winner_bounce__n0vzE",heroTitle:"winner_heroTitle__G56Lx",heroSubtitle:"winner_heroSubtitle__YiXL9",content:"winner_content__X6RJL",leftColumn:"winner_leftColumn__PQPwv",productCard:"winner_productCard__B2C6C",imageContainer:"winner_imageContainer__iC6Z5",image:"winner_image__0iDAY",imagePlaceholder:"winner_imagePlaceholder__jmGzj",productInfo:"winner_productInfo__vsaLv",productName:"winner_productName__a5blh",productDescription:"winner_productDescription__hK48i",valueBox:"winner_valueBox__8BI_0",valueLabel:"winner_valueLabel__m5HLc",valueAmount:"winner_valueAmount__s_fgz",shopCard:"winner_shopCard__4Nv_o",shopTitle:"winner_shopTitle__kDQ_z",shopInfo:"winner_shopInfo__w9UHk",shopLogo:"winner_shopLogo__ckRNe",shopDetails:"winner_shopDetails__88NQQ",shopName:"winner_shopName__ptfgG",verifiedBadge:"winner_verifiedBadge__iZIME",verifiedIcon:"winner_verifiedIcon__db8uz",shopContact:"winner_shopContact___o4_6",rightColumn:"winner_rightColumn__aIQgT",winnerCard:"winner_winnerCard__Fy0II",winnerCardHighlight:"winner_winnerCardHighlight__kY1UK",winnerHeader:"winner_winnerHeader__n4gtl",winnerTitle:"winner_winnerTitle__wOVIN",titleIcon:"winner_titleIcon__nf_4X",winnerTicketDisplay:"winner_winnerTicketDisplay__xuT8_",ticketNumberContainer:"winner_ticketNumberContainer__T8Vki",ticketLabel:"winner_ticketLabel__PgDQh",ticketNumber:"winner_ticketNumber__ek8_v",winnerUserInfo:"winner_winnerUserInfo__8m7G5",winnerUserLabel:"winner_winnerUserLabel__U09CU",winnerUserName:"winner_winnerUserName__f5QnO",winnerUserEmail:"winner_winnerUserEmail__OgTqs",executionInfo:"winner_executionInfo__OFerq",executionLabel:"winner_executionLabel__dSmox",executionDate:"winner_executionDate__W27bz",winnerMessage:"winner_winnerMessage__fevgo",winnerMessageText:"winner_winnerMessageText__HYtGB",contactLink:"winner_contactLink__1ZlGS",statsCard:"winner_statsCard__ME8gc",statsTitle:"winner_statsTitle__GuEpH",statsGrid:"winner_statsGrid__1GSJd",statItem:"winner_statItem__dVTVe",statLabel:"winner_statLabel__p3fpc",statValue:"winner_statValue__Dj4I2",participationCard:"winner_participationCard__MW5Ay",participationTitle:"winner_participationTitle__2sU5p",participationText:"winner_participationText__bpMQb",ticketNumbers:"winner_ticketNumbers__m8jFH",ticketNumberBadge:"winner_ticketNumberBadge__f6RQd",ticketNumberWinner:"winner_ticketNumberWinner__meRTa",winnerBadgeIcon:"winner_winnerBadgeIcon__N9sJY",ctaSection:"winner_ctaSection__qKXlm",ctaTitle:"winner_ctaTitle__EYs36",ctaText:"winner_ctaText__xcPHk",ctaButton:"winner_ctaButton__YbsLw"}}},function(e){e.O(0,[1748,9134,2489,4755,4542,6153,7115,2364,1744],function(){return e(e.s=2615)}),_N_E=e.O()}]);