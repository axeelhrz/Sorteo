(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1842],{2615:function(e,t,r){Promise.resolve().then(r.bind(r,6003))},6003:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _}});var n=r(7821),a=r(8078),i=r(4542),s=r(8149),o=r(8504),c=r(7851),l=r(5805),d=r(6312),u=r(6030),h=r(3404),p=r(6714),m=r.n(p);function _(){var e,t,r,p,_,g,w,f,v,x,N;let I=(0,o.useParams)().id,{user:j}=(0,d.a)(),[b,T]=(0,a.useState)(null),[k,y]=(0,a.useState)(!0),[E,C]=(0,a.useState)(null),[A,D]=(0,a.useState)(null),[S,L]=(0,a.useState)([]),[V,U]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=async()=>{try{y(!0);let e=await l.Z.getRaffleById(I);if(T(e),e.status===u.r.FINISHED&&e.winnerTicketId)try{let t=await h.x.get("/api/raffle-tickets/".concat(e.winnerTicketId));D(t.data)}catch(t){console.error("Error loading winner ticket:",t);try{let t=((await h.x.get("/api/raffle-tickets?raffleId=".concat(I))).data||[]).find(t=>t.id===e.winnerTicketId);t&&D(t)}catch(e){console.error("Error loading all tickets:",e)}}}catch(e){console.error("Error loading raffle:",e),C("No pudimos cargar el sorteo. Intenta nuevamente.")}finally{y(!1)}};I&&e()},[I]),(0,a.useEffect)(()=>{let e=async()=>{if(j&&I)try{let e=(await h.x.get("/api/raffle-tickets?raffleId=".concat(I))).data||[];if(L(e),null==b?void 0:b.winnerTicketId){let t=e.some(e=>e.id===b.winnerTicketId);U(t)}}catch(e){console.error("Error loading user tickets:",e)}};j&&b&&e()},[j,I,null==b?void 0:b.winnerTicketId]),k)?(0,n.jsx)("main",{className:m().container,children:(0,n.jsxs)("div",{className:m().loadingContainer,children:[(0,n.jsx)("div",{className:m().spinner}),(0,n.jsx)("p",{children:"Cargando informaci\xf3n del ganador..."})]})}):E||!b?(0,n.jsx)("main",{className:m().container,children:(0,n.jsxs)("div",{className:m().errorContainer,children:[(0,n.jsx)(c.jRj,{className:m().errorIcon}),(0,n.jsx)("h1",{className:m().errorTitle,children:"Sorteo no encontrado"}),(0,n.jsx)("p",{className:m().errorDescription,children:"El sorteo que buscas no existe o no est\xe1 disponible en este momento."}),(0,n.jsx)(i.default,{href:"/sorteos",children:(0,n.jsx)("button",{className:m().backButton,children:"Volver al listado"})})]})}):b.status!==u.r.FINISHED?(0,n.jsx)("main",{className:m().container,children:(0,n.jsxs)("div",{className:m().errorContainer,children:[(0,n.jsx)(c.TCC,{className:m().errorIcon}),(0,n.jsx)("h1",{className:m().errorTitle,children:"Sorteo a\xfan no finalizado"}),(0,n.jsx)("p",{className:m().errorDescription,children:"Este sorteo a\xfan no ha finalizado. Vuelve cuando el sorteo est\xe9 completo."}),(0,n.jsx)(i.default,{href:"/sorteos/".concat(I),children:(0,n.jsx)("button",{className:m().backButton,children:"Ver sorteo"})})]})}):b.winnerTicketId?(0,n.jsxs)("main",{className:m().container,children:[(0,n.jsx)(i.default,{href:"/sorteos/".concat(I),className:m().backLink,children:"← Volver al sorteo"}),(0,n.jsx)("div",{className:m().heroSection,children:(0,n.jsx)("div",{className:m().heroContent,children:V?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:m().winnerIcon,children:(0,n.jsx)(c.HR2,{})}),(0,n.jsx)("h1",{className:m().heroTitle,children:"\xa1Felicidades! Eres el ganador"}),(0,n.jsxs)("p",{className:m().heroSubtitle,children:["Has ganado el sorteo de ",(0,n.jsx)("strong",{children:null===(e=b.product)||void 0===e?void 0:e.name})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:m().winnerIcon,children:(0,n.jsx)(c._rq,{})}),(0,n.jsx)("h1",{className:m().heroTitle,children:"Sorteo finalizado"}),(0,n.jsxs)("p",{className:m().heroSubtitle,children:["El ganador del sorteo de ",(0,n.jsx)("strong",{children:null===(t=b.product)||void 0===t?void 0:t.name})," ha sido seleccionado"]})]})})}),(0,n.jsxs)("div",{className:m().content,children:[(0,n.jsxs)("div",{className:m().leftColumn,children:[(0,n.jsxs)("div",{className:m().productCard,children:[(null===(r=b.product)||void 0===r?void 0:r.mainImage)?(0,n.jsx)("div",{className:m().imageContainer,children:(0,n.jsx)(s.default,{src:b.product.mainImage,alt:b.product.name,fill:!0,className:m().image,priority:!0})}):(0,n.jsx)("div",{className:m().imagePlaceholder,children:(0,n.jsx)("span",{children:"Sin imagen disponible"})}),(0,n.jsxs)("div",{className:m().productInfo,children:[(0,n.jsx)("h2",{className:m().productName,children:null===(p=b.product)||void 0===p?void 0:p.name}),(0,n.jsx)("p",{className:m().productDescription,children:null===(_=b.product)||void 0===_?void 0:_.description}),(0,n.jsxs)("div",{className:m().valueBox,children:[(0,n.jsx)("span",{className:m().valueLabel,children:"Valor del producto"}),(0,n.jsxs)("span",{className:m().valueAmount,children:["S/ ",Number(b.productValue).toFixed(2)]})]})]})]}),(0,n.jsxs)("div",{className:m().shopCard,children:[(0,n.jsx)("h3",{className:m().shopTitle,children:"Tienda"}),(0,n.jsxs)("div",{className:m().shopInfo,children:[(null===(g=b.shop)||void 0===g?void 0:g.logo)&&(0,n.jsx)(s.default,{src:b.shop.logo,alt:b.shop.name,width:48,height:48,className:m().shopLogo}),(0,n.jsxs)("div",{className:m().shopDetails,children:[(0,n.jsx)("h4",{className:m().shopName,children:null===(w=b.shop)||void 0===w?void 0:w.name}),(null===(f=b.shop)||void 0===f?void 0:f.status)==="verified"&&(0,n.jsxs)("span",{className:m().verifiedBadge,children:[(0,n.jsx)(c._rq,{className:m().verifiedIcon}),"Tienda verificada"]})]})]}),(null===(v=b.shop)||void 0===v?void 0:v.publicEmail)&&(0,n.jsxs)("p",{className:m().shopContact,children:[(0,n.jsx)("strong",{children:"Contacto:"})," ",b.shop.publicEmail]}),(null===(x=b.shop)||void 0===x?void 0:x.phone)&&(0,n.jsxs)("p",{className:m().shopContact,children:[(0,n.jsx)("strong",{children:"Tel\xe9fono:"})," ",b.shop.phone]})]})]}),(0,n.jsxs)("div",{className:m().rightColumn,children:[(0,n.jsxs)("div",{className:"".concat(m().winnerCard," ").concat(V?m().winnerCardHighlight:""),children:[(0,n.jsx)("div",{className:m().winnerHeader,children:(0,n.jsx)("h2",{className:m().winnerTitle,children:V?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c._rq,{className:m().titleIcon}),"Tu ticket ganador"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.HR2,{className:m().titleIcon}),"Ticket ganador"]})})}),(0,n.jsxs)("div",{className:m().winnerTicketDisplay,children:[(0,n.jsxs)("div",{className:m().ticketNumberContainer,children:[(0,n.jsx)("span",{className:m().ticketLabel,children:"N\xfamero de ticket"}),(0,n.jsxs)("span",{className:m().ticketNumber,children:["#",(null==A?void 0:A.number)||"N/A"]})]}),(null==A?void 0:A.user)&&(0,n.jsxs)("div",{className:m().winnerUserInfo,children:[(0,n.jsx)("p",{className:m().winnerUserLabel,children:"Ganador"}),(0,n.jsx)("p",{className:m().winnerUserName,children:A.user.name}),V&&(0,n.jsx)("p",{className:m().winnerUserEmail,children:A.user.email})]}),b.raffleExecutedAt&&(0,n.jsxs)("div",{className:m().executionInfo,children:[(0,n.jsx)("p",{className:m().executionLabel,children:"Fecha de ejecuci\xf3n"}),(0,n.jsx)("p",{className:m().executionDate,children:new Date(b.raffleExecutedAt).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),V&&(0,n.jsxs)("div",{className:m().winnerMessage,children:[(0,n.jsxs)("p",{className:m().winnerMessageText,children:[(0,n.jsx)("strong",{children:"\xa1Felicidades!"})," Has sido seleccionado como ganador de este sorteo. La tienda se pondr\xe1 en contacto contigo para coordinar la entrega del premio."]}),(null===(N=b.shop)||void 0===N?void 0:N.publicEmail)&&(0,n.jsxs)("p",{className:m().winnerMessageText,children:["Si tienes alguna pregunta, puedes contactar a la tienda en:"," ",(0,n.jsx)("a",{href:"mailto:".concat(b.shop.publicEmail),className:m().contactLink,children:b.shop.publicEmail})]})]})]}),(0,n.jsxs)("div",{className:m().statsCard,children:[(0,n.jsx)("h3",{className:m().statsTitle,children:"Estad\xedsticas del sorteo"}),(0,n.jsxs)("div",{className:m().statsGrid,children:[(0,n.jsxs)("div",{className:m().statItem,children:[(0,n.jsx)("span",{className:m().statLabel,children:"Total de tickets"}),(0,n.jsx)("span",{className:m().statValue,children:b.totalTickets})]}),(0,n.jsxs)("div",{className:m().statItem,children:[(0,n.jsx)("span",{className:m().statLabel,children:"Tickets vendidos"}),(0,n.jsx)("span",{className:m().statValue,children:b.soldTickets})]}),(0,n.jsxs)("div",{className:m().statItem,children:[(0,n.jsx)("span",{className:m().statLabel,children:"Valor total"}),(0,n.jsxs)("span",{className:m().statValue,children:["S/ ",(Number(b.productValue)*b.soldTickets).toFixed(2)]})]})]})]}),j&&S.length>0&&(0,n.jsxs)("div",{className:m().participationCard,children:[(0,n.jsx)("h3",{className:m().participationTitle,children:"Tus participaciones"}),(0,n.jsxs)("p",{className:m().participationText,children:["Participaste con ",(0,n.jsx)("strong",{children:S.length})," ticket",S.length>1?"s":"",":"]}),(0,n.jsx)("div",{className:m().ticketNumbers,children:S.map(e=>(0,n.jsxs)("span",{className:"".concat(m().ticketNumberBadge," ").concat(e.id===b.winnerTicketId?m().ticketNumberWinner:""),children:["#",e.number,e.id===b.winnerTicketId&&(0,n.jsx)(c.HR2,{className:m().winnerBadgeIcon})]},e.id))})]})]})]}),(0,n.jsxs)("div",{className:m().ctaSection,children:[(0,n.jsx)("h2",{className:m().ctaTitle,children:"\xbfQuieres participar en m\xe1s sorteos?"}),(0,n.jsx)("p",{className:m().ctaText,children:"Descubre otros sorteos disponibles y gana incre\xedbles premios"}),(0,n.jsx)(i.default,{href:"/sorteos",children:(0,n.jsx)("button",{className:m().ctaButton,children:"Ver todos los sorteos"})})]})]}):(0,n.jsx)("main",{className:m().container,children:(0,n.jsxs)("div",{className:m().errorContainer,children:[(0,n.jsx)(c.bax,{className:m().errorIcon}),(0,n.jsx)("h1",{className:m().errorTitle,children:"Ganador no disponible"}),(0,n.jsx)("p",{className:m().errorDescription,children:"El ganador de este sorteo a\xfan no ha sido determinado."}),(0,n.jsx)(i.default,{href:"/sorteos/".concat(I),children:(0,n.jsx)("button",{className:m().backButton,children:"Volver al sorteo"})})]})})}},6312:function(e,t,r){"use strict";r.d(t,{a:function(){return s}});var n=r(8078),a=r(7197),i=r(5161);function s(){let[e,t]=(0,n.useState)(!1),r=(0,a.t)();return(0,n.useEffect)(()=>{let e=i.Y.onAuthStateChanged(async e=>{if(e){r.setUser(e);try{let e=await i.Y.getCurrentUserToken();e&&r.setToken(e)}catch(e){console.error("Error getting token:",e)}}else r.setUser(null),r.setToken(null);t(!0)});return()=>{e()}},[]),{...r,isHydrated:e}}},3404:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});var n=r(7147),a=r(9190);let i=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(e);if(!e.endsWith("/api")){let t=e.endsWith("/")?e.slice(0,-1):e;return"".concat(t,"/api")}return e})();class s{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,r){return this.client.post(e,t,r)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}constructor(){(0,n._)(this,"client",void 0),this.client=a.Z.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let o=new s},6532:function(e,t,r){"use strict";let n;r.d(t,{I8:function(){return l},db:function(){return c}});var a=r(1830),i=r(6534),s=r(1069),o=r(4304);n=0===(0,a.C6)().length?(0,a.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,a.C6)()[0];let c=(0,i.ad)(n);(0,s.cF)(n);let l=(0,o.v0)(n)},5161:function(e,t,r){"use strict";r.d(t,{Y:function(){return c}});var n=r(4304),a=r(6534),i=r(6532),s=r(6289);let o=async e=>{var t,r,n;try{let n=await (0,a.getDoc)((0,a.doc)(i.db,"users",e.uid));if(!n.exists())return{id:e.uid,name:e.displayName||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"Usuario",email:e.email||"",role:s.i.USER};let o=n.data();return{id:e.uid,name:o.name||e.displayName||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Usuario",email:e.email||"",role:o.role||s.i.USER}}catch(t){return console.error("Error converting Firebase user:",t),{id:e.uid,name:e.displayName||(null===(n=e.email)||void 0===n?void 0:n.split("@")[0])||"Usuario",email:e.email||"",role:s.i.USER}}},c={async register(e){try{let t=(await (0,n.Xb)(i.I8,e.email,e.password)).user;e.name&&await (0,n.ck)(t,{displayName:e.name});let r=await t.getIdToken(),c={name:e.name,email:e.email,role:e.role,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()};if(e.role===s.i.SHOP&&e.shopName){let r={userId:t.uid,name:e.shopName,description:"",status:"pending",createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()},n=await (0,a.ET)((0,a.collection)(i.db,"shops"),r);c.shopId=n.id,await (0,a.pl)((0,a.doc)(i.db,"users",t.uid),c)}else await (0,a.pl)((0,a.doc)(i.db,"users",t.uid),c);return{user:await o(t),token:r}}catch(t){console.error("Error registering user:",t);let e="Error al registrar usuario";throw"auth/email-already-in-use"===t.code?e="Este email ya est\xe1 registrado":"auth/invalid-email"===t.code?e="Email inv\xe1lido":"auth/weak-password"===t.code?e="La contrase\xf1a debe tener al menos 6 caracteres":"auth/operation-not-allowed"===t.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===t.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":t.message&&(e=t.message),Error(e)}},async login(e){try{let t=(await (0,n.e5)(i.I8,e.email,e.password)).user,r=await t.getIdToken();return{user:await o(t),token:r}}catch(t){console.error("Error logging in:",t);let e="Error al iniciar sesi\xf3n";throw"auth/user-not-found"===t.code?e="Usuario no encontrado":"auth/wrong-password"===t.code?e="Contrase\xf1a incorrecta":"auth/invalid-email"===t.code?e="Email inv\xe1lido":"auth/user-disabled"===t.code?e="Usuario deshabilitado":"auth/too-many-requests"===t.code?e="Demasiados intentos. Intenta m\xe1s tarde":"auth/operation-not-allowed"===t.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===t.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":t.message&&(e=t.message),Error(e)}},async logout(){try{await (0,n.w7)(i.I8)}catch(e){throw console.error("Error logging out:",e),e}},async getCurrentUser(){try{let e=i.I8.currentUser;if(!e)return null;return await o(e)}catch(e){return console.error("Error getting current user:",e),null}},async getCurrentUserToken(){try{let e=i.I8.currentUser;if(!e)return null;return await e.getIdToken()}catch(e){return console.error("Error getting token:",e),null}},onAuthStateChanged:e=>(0,n.Aj)(i.I8,async t=>{t?e(await o(t)):e(null)})}},9273:function(e,t,r){"use strict";r.d(t,{U:function(){return c}});var n=r(6534),a=r(6532),i=r(6030);let s=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,o=async e=>{let t=e.data(),r={id:e.id,shopId:t.shopId||"",productId:t.productId||"",productValue:t.productValue||0,totalTickets:t.totalTickets||0,soldTickets:t.soldTickets||0,status:t.status||i.r.DRAFT,requiresDeposit:t.requiresDeposit||!1,winnerTicketId:t.winnerTicketId,specialConditions:t.specialConditions,createdAt:s(t.createdAt),updatedAt:s(t.updatedAt),activatedAt:t.activatedAt?s(t.activatedAt):void 0,raffleExecutedAt:t.raffleExecutedAt?s(t.raffleExecutedAt):void 0};if(t.shopId)try{let e=await (0,n.getDoc)((0,n.doc)(a.db,"shops",t.shopId));if(e.exists()){let t=e.data();r.shop={id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||"pending",createdAt:s(t.createdAt),updatedAt:s(t.updatedAt)}}}catch(e){console.error("Error loading shop:",e)}if(t.productId)try{let e=await (0,n.getDoc)((0,n.doc)(a.db,"products",t.productId));if(e.exists()){let t=e.data();r.product={id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||"inactive",createdAt:s(t.createdAt),updatedAt:s(t.updatedAt)}}}catch(e){console.error("Error loading product:",e)}return r},c={async getActiveRaffles(e){try{let t;let r=(0,n.collection)(a.db,"raffles");try{let a=(0,n.query)(r,(0,n.where)("status","==",i.r.ACTIVE));if((null==e?void 0:e.shopId)&&(a=(0,n.query)(a,(0,n.where)("shopId","==",e.shopId))),null==e?void 0:e.shopId)t=await (0,n.getDocs)(a);else try{a=(null==e?void 0:e.sortBy)==="newest"?(0,n.query)(a,(0,n.Xo)("createdAt","desc")):(null==e?void 0:e.sortBy)==="closest"?(0,n.query)(a,(0,n.Xo)("soldTickets","desc")):(null==e?void 0:e.sortBy)==="price-asc"?(0,n.query)(a,(0,n.Xo)("productValue","asc")):(null==e?void 0:e.sortBy)==="price-desc"?(0,n.query)(a,(0,n.Xo)("productValue","desc")):(0,n.query)(a,(0,n.Xo)("createdAt","desc")),t=await (0,n.getDocs)(a)}catch(s){console.warn("Error con orderBy, obteniendo sin ordenar:",s),a=(null==e?void 0:e.shopId)?(0,n.query)(r,(0,n.where)("status","==",i.r.ACTIVE),(0,n.where)("shopId","==",e.shopId)):(0,n.query)(r,(0,n.where)("status","==",i.r.ACTIVE)),t=await (0,n.getDocs)(a)}}catch(s){console.warn("Error en consulta con where, obteniendo todos los sorteos:",s);let e=(0,n.query)(r),a=await (0,n.getDocs)(e);t={docs:a.docs.filter(e=>{let t=e.data().status;return t===i.r.ACTIVE||"active"===t})},console.log("\uD83D\uDCCA Sorteos activos encontrados despu\xe9s de filtrar: ".concat(t.docs.length," de ").concat(a.docs.length," totales"))}let s=[];for(let e of t.docs)try{let t=await o(e);s.push(t)}catch(e){console.error("Error converting raffle doc:",e)}if(console.log("✅ Sorteos activos cargados: ".concat(s.length)),(null==e?void 0:e.category)&&(s=s.filter(t=>{var r;return(null===(r=t.product)||void 0===r?void 0:r.category)===e.category})),(null==e?void 0:e.minValue)!==void 0&&(s=s.filter(t=>t.productValue>=e.minValue)),(null==e?void 0:e.maxValue)!==void 0&&(s=s.filter(t=>t.productValue<=e.maxValue)),null==e?void 0:e.search){let t=e.search.toLowerCase();s=s.filter(e=>{var r,n,a;return(null===(r=e.product)||void 0===r?void 0:r.name.toLowerCase().includes(t))||(null===(n=e.product)||void 0===n?void 0:n.description.toLowerCase().includes(t))||(null===(a=e.shop)||void 0===a?void 0:a.name.toLowerCase().includes(t))})}((null==e?void 0:e.shopId)||(null==e?void 0:e.sortBy))&&((null==e?void 0:e.sortBy)==="newest"?s.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()):(null==e?void 0:e.sortBy)==="closest"?s.sort((e,t)=>t.soldTickets-e.soldTickets):(null==e?void 0:e.sortBy)==="price-asc"?s.sort((e,t)=>e.productValue-t.productValue):(null==e?void 0:e.sortBy)==="price-desc"&&s.sort((e,t)=>t.productValue-e.productValue));let c=(null==e?void 0:e.limit)||12,l=(null==e?void 0:e.page)||1,d=(l-1)*c,u=s.length;return{data:s.slice(d,d+c),total:u,page:l,limit:c,totalPages:Math.ceil(u/c)}}catch(e){throw console.error("Error fetching active raffles:",e),e}},async getRaffleById(e){try{let t=await (0,n.getDoc)((0,n.doc)(a.db,"raffles",e));if(!t.exists())throw Error("Raffle not found");return await o(t)}catch(e){throw console.error("Error fetching raffle:",e),e}},async getRafflesByShop(e,t){try{let r=(0,n.collection)(a.db,"raffles"),s=(0,n.query)(r,(0,n.where)("shopId","==",e),(0,n.where)("status","==",i.r.ACTIVE)),c=await (0,n.getDocs)(s),l=[];for(let e of c.docs){let t=await o(e);l.push(t)}if(null==t?void 0:t.search){let e=t.search.toLowerCase();l=l.filter(t=>{var r,n;return(null===(r=t.product)||void 0===r?void 0:r.name.toLowerCase().includes(e))||(null===(n=t.product)||void 0===n?void 0:n.description.toLowerCase().includes(e))})}(null==t?void 0:t.sortBy)==="newest"?l.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()):(null==t?void 0:t.sortBy)==="closest"?l.sort((e,t)=>t.soldTickets-e.soldTickets):l.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime());let d=(null==t?void 0:t.limit)||12,u=(null==t?void 0:t.page)||1,h=(u-1)*d,p=l.length;return{data:l.slice(h,h+d),total:p,page:u,limit:d,totalPages:Math.ceil(p/d)}}catch(e){throw console.error("Error fetching shop raffles:",e),e}},async getCategories(){try{let e=(0,n.collection)(a.db,"products"),t=(0,n.query)(e,(0,n.where)("status","==","active")),r=await (0,n.getDocs)(t),i=new Set;return r.docs.forEach(e=>{let t=e.data();t.category&&i.add(t.category)}),Array.from(i).sort()}catch(e){return console.error("Error fetching categories:",e),[]}},async getShopsWithActiveRaffles(){try{let e=(0,n.collection)(a.db,"raffles"),t=(0,n.query)(e,(0,n.where)("status","==",i.r.ACTIVE)),r=await (0,n.getDocs)(t),s=new Set;r.docs.forEach(e=>{let t=e.data();t.shopId&&s.add(t.shopId)});let o=[];for(let e of s)try{let t=await (0,n.getDoc)((0,n.doc)(a.db,"shops",e));if(t.exists()){let e=t.data();o.push({id:t.id,name:e.name||"Tienda sin nombre"})}}catch(t){console.error("Error loading shop ".concat(e,":"),t)}return o.sort((e,t)=>e.name.localeCompare(t.name))}catch(e){return console.error("Error fetching shops:",e),[]}}}},5805:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=r(9273).U},7197:function(e,t,r){"use strict";r.d(t,{t:function(){return s}});var n=r(3020),a=r(4302),i=r(5161);let s=(0,n.Ue)()((0,a.tJ)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:t=>e({user:t,isAuthenticated:!!t}),setToken:t=>{t?localStorage.setItem("token",t):localStorage.removeItem("token"),e({token:t})},setIsLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),logout:async()=>{try{await i.Y.logout()}catch(e){console.error("Error logging out:",e)}finally{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}},refreshToken:async()=>{try{let e=await i.Y.getCurrentUserToken();e&&t().setToken(e)}catch(e){console.error("Error refreshing token:",e)}}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6289:function(e,t,r){"use strict";var n,a;r.d(t,{i:function(){return n}}),(a=n||(n={})).ADMIN="admin",a.SHOP="shop",a.USER="user"},6030:function(e,t,r){"use strict";var n,a;r.d(t,{r:function(){return n}}),(a=n||(n={})).DRAFT="draft",a.PENDING_APPROVAL="pending_approval",a.ACTIVE="active",a.PAUSED="paused",a.SOLD_OUT="sold_out",a.FINISHED="finished",a.CANCELLED="cancelled",a.REJECTED="rejected"},6714:function(e){e.exports={container:"winner_container__aQaVY",backLink:"winner_backLink__abg5X",loadingContainer:"winner_loadingContainer__b1L4W",errorContainer:"winner_errorContainer__yE4D3",spinner:"winner_spinner__2nbjO",spin:"winner_spin__LVIIZ",errorIcon:"winner_errorIcon__H2oaO",errorTitle:"winner_errorTitle__8WQf3",errorDescription:"winner_errorDescription__M9IOQ",backButton:"winner_backButton__Dfln5",heroSection:"winner_heroSection__4ehVV",heroContent:"winner_heroContent___H2BO",winnerIcon:"winner_winnerIcon__s2jfR",bounce:"winner_bounce__n0vzE",heroTitle:"winner_heroTitle__G56Lx",heroSubtitle:"winner_heroSubtitle__YiXL9",content:"winner_content__X6RJL",leftColumn:"winner_leftColumn__PQPwv",productCard:"winner_productCard__B2C6C",imageContainer:"winner_imageContainer__iC6Z5",image:"winner_image__0iDAY",imagePlaceholder:"winner_imagePlaceholder__jmGzj",productInfo:"winner_productInfo__vsaLv",productName:"winner_productName__a5blh",productDescription:"winner_productDescription__hK48i",valueBox:"winner_valueBox__8BI_0",valueLabel:"winner_valueLabel__m5HLc",valueAmount:"winner_valueAmount__s_fgz",shopCard:"winner_shopCard__4Nv_o",shopTitle:"winner_shopTitle__kDQ_z",shopInfo:"winner_shopInfo__w9UHk",shopLogo:"winner_shopLogo__ckRNe",shopDetails:"winner_shopDetails__88NQQ",shopName:"winner_shopName__ptfgG",verifiedBadge:"winner_verifiedBadge__iZIME",verifiedIcon:"winner_verifiedIcon__db8uz",shopContact:"winner_shopContact___o4_6",rightColumn:"winner_rightColumn__aIQgT",winnerCard:"winner_winnerCard__Fy0II",winnerCardHighlight:"winner_winnerCardHighlight__kY1UK",winnerHeader:"winner_winnerHeader__n4gtl",winnerTitle:"winner_winnerTitle__wOVIN",titleIcon:"winner_titleIcon__nf_4X",winnerTicketDisplay:"winner_winnerTicketDisplay__xuT8_",ticketNumberContainer:"winner_ticketNumberContainer__T8Vki",ticketLabel:"winner_ticketLabel__PgDQh",ticketNumber:"winner_ticketNumber__ek8_v",winnerUserInfo:"winner_winnerUserInfo__8m7G5",winnerUserLabel:"winner_winnerUserLabel__U09CU",winnerUserName:"winner_winnerUserName__f5QnO",winnerUserEmail:"winner_winnerUserEmail__OgTqs",executionInfo:"winner_executionInfo__OFerq",executionLabel:"winner_executionLabel__dSmox",executionDate:"winner_executionDate__W27bz",winnerMessage:"winner_winnerMessage__fevgo",winnerMessageText:"winner_winnerMessageText__HYtGB",contactLink:"winner_contactLink__1ZlGS",statsCard:"winner_statsCard__ME8gc",statsTitle:"winner_statsTitle__GuEpH",statsGrid:"winner_statsGrid__1GSJd",statItem:"winner_statItem__dVTVe",statLabel:"winner_statLabel__p3fpc",statValue:"winner_statValue__Dj4I2",participationCard:"winner_participationCard__MW5Ay",participationTitle:"winner_participationTitle__2sU5p",participationText:"winner_participationText__bpMQb",ticketNumbers:"winner_ticketNumbers__m8jFH",ticketNumberBadge:"winner_ticketNumberBadge__f6RQd",ticketNumberWinner:"winner_ticketNumberWinner__meRTa",winnerBadgeIcon:"winner_winnerBadgeIcon__N9sJY",ctaSection:"winner_ctaSection__qKXlm",ctaTitle:"winner_ctaTitle__EYs36",ctaText:"winner_ctaText__xcPHk",ctaButton:"winner_ctaButton__YbsLw"}}},function(e){e.O(0,[1748,2907,4183,9134,1044,2489,8641,4755,4542,6153,7115,2364,1744],function(){return e(e.s=2615)}),_N_E=e.O()}]);