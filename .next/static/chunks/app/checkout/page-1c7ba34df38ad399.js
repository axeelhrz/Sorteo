(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{4149:function(e,t,a){Promise.resolve().then(a.bind(a,9259))},9259:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d},dynamic:function(){return l}});var r=a(7821),n=a(8078),o=a(8504),c=a(6943),s=a(6091),i=a.n(s);let l="force-dynamic";function u(){let e=(0,o.useSearchParams)(),t=(0,o.useRouter)(),a=e.get("paymentId"),[s,l]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0),[h,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!a){m("ID de pago no encontrado"),d(!1);return}(async()=>{try{let e=await c.Z.getPaymentById(a);l(e)}catch(e){m("Error al cargar el pago"),console.error(e)}finally{d(!1)}})()},[a]);let p=async()=>{if(s)try{console.log("Iniciando pago con Stripe..."),setTimeout(async()=>{try{await c.Z.confirmPayment({paymentId:s.id,externalTransactionId:"stripe_".concat(Date.now()),paymentMethod:"stripe"}),t.push("/payment-success?paymentId=".concat(s.id))}catch(e){console.error("Error confirming payment:",e),m("Error al confirmar el pago")}},2e3)}catch(e){m("Error al procesar el pago"),console.error(e)}},y=async()=>{if(s)try{console.log("Iniciando pago con Mercado Pago..."),setTimeout(async()=>{try{await c.Z.confirmPayment({paymentId:s.id,externalTransactionId:"mp_".concat(Date.now()),paymentMethod:"mercado_pago"}),t.push("/payment-success?paymentId=".concat(s.id))}catch(e){console.error("Error confirming payment:",e),m("Error al confirmar el pago")}},2e3)}catch(e){m("Error al procesar el pago"),console.error(e)}},g=async()=>{if(s)try{await c.Z.failPayment(s.id,"Pago rechazado por el usuario"),t.push("/payment-failed?paymentId=".concat(s.id))}catch(e){console.error("Error failing payment:",e),m("Error al procesar el rechazo del pago")}};return u?(0,r.jsx)("div",{className:i().container,children:(0,r.jsx)("div",{className:i().loadingSpinner,children:"Cargando..."})}):h||!s?(0,r.jsx)("div",{className:i().container,children:(0,r.jsxs)("div",{className:i().errorBox,children:[(0,r.jsx)("h1",{children:"Error"}),(0,r.jsx)("p",{children:h||"No se pudo cargar el pago"}),(0,r.jsx)("button",{onClick:()=>t.back(),children:"Volver"})]})}):(0,r.jsx)("div",{className:i().container,children:(0,r.jsxs)("div",{className:i().checkoutCard,children:[(0,r.jsx)("h1",{className:i().title,children:"Checkout"}),(0,r.jsxs)("div",{className:i().summarySection,children:[(0,r.jsx)("h2",{children:"Resumen de tu compra"}),(0,r.jsxs)("div",{className:i().summaryItem,children:[(0,r.jsx)("span",{children:"Cantidad de tickets:"}),(0,r.jsx)("span",{className:i().value,children:s.ticketQuantity})]}),(0,r.jsxs)("div",{className:i().summaryItem,children:[(0,r.jsx)("span",{children:"Monto total:"}),(0,r.jsxs)("span",{className:i().value,children:["S/. ",Number(s.amount).toFixed(2)]})]}),(0,r.jsxs)("div",{className:i().summaryItem,children:[(0,r.jsx)("span",{children:"Moneda:"}),(0,r.jsx)("span",{className:i().value,children:s.currency})]})]}),(0,r.jsxs)("div",{className:i().paymentMethods,children:[(0,r.jsx)("h2",{children:"Selecciona un m\xe9todo de pago"}),(0,r.jsxs)("div",{className:i().methodCard,children:[(0,r.jsxs)("div",{className:i().methodHeader,children:[(0,r.jsx)("h3",{children:"Tarjeta de Cr\xe9dito / D\xe9bito"}),(0,r.jsx)("p",{className:i().methodDescription,children:"Paga de forma segura con Stripe"})]}),(0,r.jsx)("button",{className:i().payButton,onClick:p,children:"Pagar con Stripe"})]}),(0,r.jsxs)("div",{className:i().methodCard,children:[(0,r.jsxs)("div",{className:i().methodHeader,children:[(0,r.jsx)("h3",{children:"Mercado Pago"}),(0,r.jsx)("p",{className:i().methodDescription,children:"Paga con tu cuenta de Mercado Pago"})]}),(0,r.jsx)("button",{className:i().payButton,onClick:y,children:"Pagar con Mercado Pago"})]})]}),(0,r.jsx)("div",{className:i().actions,children:(0,r.jsx)("button",{className:i().cancelButton,onClick:g,children:"Cancelar compra"})}),h&&(0,r.jsx)("div",{className:i().errorMessage,children:h})]})})}function d(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:i().container,children:(0,r.jsx)("div",{className:i().loadingSpinner,children:"Cargando..."})}),children:(0,r.jsx)(u,{})})}},3404:function(e,t,a){"use strict";a.d(t,{x:function(){return s}});var r=a(7147),n=a(9190);let o=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(e);if(!e.endsWith("/api")){let t=e.endsWith("/")?e.slice(0,-1):e;return"".concat(t,"/api")}return e})();class c{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,a){return this.client.post(e,t,a)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}constructor(){(0,r._)(this,"client",void 0),this.client=n.Z.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let s=new c},6943:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(3404);let n={async createPayment(e){try{return(await r.x.post("/payments",e)).data}catch(e){throw console.error("Error creating payment:",e),e}},async confirmPayment(e){try{return(await r.x.post("/payments/confirm",e)).data}catch(e){throw console.error("Error confirming payment:",e),e}},async failPayment(e,t){try{return(await r.x.post("/payments/".concat(e,"/fail"),{failureReason:t})).data}catch(e){throw console.error("Error failing payment:",e),e}},async getPaymentById(e){try{return(await r.x.get("/payments/".concat(e))).data}catch(e){throw console.error("Error fetching payment:",e),e}},async getMyPayments(){try{return(await r.x.get("/payments/user/me")).data}catch(e){throw console.error("Error fetching user payments:",e),e}},async getCompletedPaymentsByRaffleId(e){try{return(await r.x.get("/payments/raffle/".concat(e))).data}catch(e){throw console.error("Error fetching raffle payments:",e),e}},async refundPayment(e){try{return(await r.x.post("/payments/".concat(e,"/refund"),{})).data}catch(e){throw console.error("Error refunding payment:",e),e}}}},8504:function(e,t,a){"use strict";var r=a(3226);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},6091:function(e){e.exports={container:"checkout_container__GDzOa",checkoutCard:"checkout_checkoutCard__iuXeq",title:"checkout_title___IbnB",summarySection:"checkout_summarySection__P4iQG",summaryItem:"checkout_summaryItem__MnGnX",value:"checkout_value__bCB5l",paymentMethods:"checkout_paymentMethods__zaLSU",methodCard:"checkout_methodCard___LQqq",methodHeader:"checkout_methodHeader__rS04T",methodDescription:"checkout_methodDescription__V3XCm",payButton:"checkout_payButton__AP8qQ",actions:"checkout_actions__ZoHqw",cancelButton:"checkout_cancelButton__V4VVG",errorMessage:"checkout_errorMessage__WSOsj",loadingSpinner:"checkout_loadingSpinner__hzzjX",errorBox:"checkout_errorBox__MYp_o"}}},function(e){e.O(0,[8512,1044,2489,7115,2364,1744],function(){return e(e.s=4149)}),_N_E=e.O()}]);