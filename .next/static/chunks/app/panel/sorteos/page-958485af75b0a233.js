(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{7435:function(e,a,t){Promise.resolve().then(t.bind(t,9274))},9274:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return x}});var n=t(7821),l=t(8078),r=t(7197),s=t(6289),o=t(4767),i=t(692),c=t(1850),d=t(4542),_=t(6030),p=t(2129),u=t(192),f=t.n(u),h=t(5975),m=t(5959);function g(e){let{shopId:a}=e,[t,r]=(0,l.useState)([]),[s,o]=(0,l.useState)(!0),[i,c]=(0,l.useState)(null),[u,g]=(0,l.useState)("all");(0,l.useEffect)(()=>{v()},[a]);let v=async()=>{o(!0),c(null);try{let e=await p.W.getRafflesByShop(a);r(e)}catch(a){var e,t;c((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar los sorteos")}finally{o(!1)}},x="all"===u?t:t.filter(e=>e.status===u),y=async e=>{if(confirm("\xbfEst\xe1s seguro de que deseas cancelar este sorteo?"))try{await p.W.cancelRaffle(e),r(t.map(a=>a.id===e?{...a,status:_.r.CANCELLED}:a))}catch(e){var a,n;alert((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Error al cancelar el sorteo")}};return s?(0,n.jsx)("div",{className:f().alert,children:"Cargando sorteos..."}):i?(0,n.jsxs)("div",{className:f().alert+" "+f().alertError,children:[i,(0,n.jsx)("button",{onClick:v,className:f().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}):0===t.length?(0,n.jsx)(m.u,{title:"No tienes sorteos a\xfan",description:"Crea tu primer sorteo para comenzar a vender tickets",icon:"\uD83C\uDFB2",action:{label:"Crear sorteo",onClick:()=>window.location.href="/panel/sorteos/crear"}}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:f().raffleDetailSection,children:[(0,n.jsx)("label",{className:f().raffleDetailSectionTitle,children:"Filtrar por estado"}),(0,n.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:f().formSelect,style:{maxWidth:"300px"},children:[(0,n.jsx)("option",{value:"all",children:"Todos los estados"}),(0,n.jsx)("option",{value:_.r.DRAFT,children:"Borrador"}),(0,n.jsx)("option",{value:_.r.PENDING_APPROVAL,children:"Pendiente de aprobaci\xf3n"}),(0,n.jsx)("option",{value:_.r.ACTIVE,children:"Activo"}),(0,n.jsx)("option",{value:_.r.SOLD_OUT,children:"Agotado"}),(0,n.jsx)("option",{value:_.r.FINISHED,children:"Finalizado"}),(0,n.jsx)("option",{value:_.r.CANCELLED,children:"Cancelado"})]})]}),(0,n.jsxs)("table",{className:f().table,children:[(0,n.jsx)("thead",{className:f().tableHeader,children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:f().tableHeaderCell,children:"Producto"}),(0,n.jsx)("th",{className:f().tableHeaderCell,children:"Estado"}),(0,n.jsx)("th",{className:f().tableHeaderCell,children:"Tickets"}),(0,n.jsx)("th",{className:f().tableHeaderCell,children:"Creado"}),(0,n.jsx)("th",{className:f().tableHeaderCell,children:"Acciones"})]})}),(0,n.jsx)("tbody",{children:x.map(e=>{var a;return(0,n.jsxs)("tr",{className:f().tableRow,children:[(0,n.jsx)("td",{className:f().tableCell,children:(null===(a=e.product)||void 0===a?void 0:a.name)||"Producto desconocido"}),(0,n.jsx)("td",{className:f().tableCell,children:(0,n.jsx)(h.O,{status:e.status})}),(0,n.jsxs)("td",{className:f().tableCell,children:[e.soldTickets," / ",e.totalTickets]}),(0,n.jsx)("td",{className:f().tableCell,children:new Date(e.createdAt).toLocaleDateString()}),(0,n.jsx)("td",{className:f().tableCell,children:(0,n.jsxs)("div",{className:f().cardActions,children:[(0,n.jsx)(d.default,{href:"/panel/sorteos/".concat(e.id),className:f().cardActionPrimary,children:"Ver"}),(e.status===_.r.DRAFT||e.status===_.r.PENDING_APPROVAL)&&(0,n.jsx)("button",{onClick:()=>y(e.id),className:f().cardActionSecondary,children:"Cancelar"})]})})]},e.id)})})]})]})}var v=t(6066);function x(){let{user:e,isAuthenticated:a}=(0,r.t)(),[t,d]=(0,l.useState)(null),[_,p]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{a&&e&&m()},[a,e]);let m=async()=>{p(!0),h(null);try{let e=await o.m.getMyShop();d(e)}catch(t){var e,a;h((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar la tienda")}finally{p(!1)}};return(0,n.jsx)(v.i,{requiredRole:s.i.SHOP,children:(0,n.jsxs)("div",{className:f().panelContainer,children:[(0,n.jsx)(c.G,{isBlocked:(null==t?void 0:t.status)==="blocked"}),(0,n.jsxs)("main",{className:f().mainContent,children:[_&&(0,n.jsx)("div",{className:f().alert,children:"Cargando tienda..."}),u&&(0,n.jsxs)("div",{className:"".concat(f().alert," ").concat(f().alertError),children:[u,(0,n.jsx)("button",{onClick:m,className:f().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.N,{shop:t}),(0,n.jsxs)("div",{className:f().raffleDetail,children:[(0,n.jsx)("h1",{className:f().raffleDetailTitle,children:"Mis sorteos"}),(0,n.jsx)(g,{shopId:t.id})]})]})]})]})})}},6066:function(e,a,t){"use strict";t.d(a,{i:function(){return o}});var n=t(7821),l=t(8078),r=t(8504),s=t(7197);function o(e){let{children:a,requiredRole:t}=e,o=(0,r.useRouter)(),{user:i,isAuthenticated:c}=(0,s.t)();return((0,l.useEffect)(()=>{if(!c||!i){o.push("/login");return}if(t&&i.role!==t){o.push("/");return}},[c,i,t,o]),c&&i)?t&&i.role!==t?(0,n.jsx)("div",{children:"No tienes permiso para acceder a esta p\xe1gina"}):(0,n.jsx)(n.Fragment,{children:a}):(0,n.jsx)("div",{children:"Cargando..."})}},5959:function(e,a,t){"use strict";t.d(a,{u:function(){return s}});var n=t(7821),l=t(192),r=t.n(l);function s(e){let{title:a,description:t,icon:l,action:s}=e;return(0,n.jsxs)("div",{className:r().emptyState,children:[l&&(0,n.jsx)("div",{className:r().emptyStateIcon,children:l}),(0,n.jsx)("h3",{className:r().emptyStateTitle,children:a}),(0,n.jsx)("p",{className:r().emptyStateDescription,children:t}),s&&(0,n.jsx)("button",{className:r().primaryButton,onClick:s.onClick,children:s.label})]})}},692:function(e,a,t){"use strict";t.d(a,{N:function(){return s}});var n=t(7821),l=t(192),r=t.n(l);function s(e){let{shop:a}=e;return(0,n.jsx)("div",{className:r().shopHeader,children:(0,n.jsxs)("div",{className:r().shopHeaderContent,children:[a.logo&&(0,n.jsx)("img",{src:a.logo,alt:a.name,className:r().shopLogo}),(0,n.jsxs)("div",{className:r().shopHeaderInfo,children:[(0,n.jsx)("h1",{className:r().shopName,children:a.name}),(0,n.jsx)("p",{className:r().shopDescription,children:a.description})]})]})})}},1850:function(e,a,t){"use strict";t.d(a,{G:function(){return i}});var n=t(7821),l=t(4542),r=t(8504),s=t(192),o=t.n(s);function i(e){let{isBlocked:a=!1}=e,t=(0,r.usePathname)();return(0,n.jsx)("aside",{className:o().sidebar,children:(0,n.jsxs)("nav",{className:o().sidebarNav,children:[(0,n.jsx)(l.default,{href:"/panel/tienda",className:"".concat(o().navLink," ").concat("/panel/tienda"===t?o().active:""),children:"\uD83D\uDCCB Mi tienda"}),(0,n.jsx)(l.default,{href:"/panel/productos",className:"".concat(o().navLink," ").concat("/panel/productos"===t?o().active:""),children:"\uD83D\uDCE6 Mis productos"}),(0,n.jsx)(l.default,{href:"/panel/sorteos",className:"".concat(o().navLink," ").concat("/panel/sorteos"===t?o().active:""),children:"\uD83C\uDFB2 Mis sorteos"}),!a&&(0,n.jsx)(l.default,{href:"/panel/sorteos/crear",className:"".concat(o().navLink," ").concat("/panel/sorteos/crear"===t?o().active:""),children:"âž• Crear sorteo"})]})})}},5975:function(e,a,t){"use strict";t.d(a,{O:function(){return s}});var n=t(7821),l=t(192),r=t.n(l);function s(e){let{status:a}=e;return(0,n.jsx)("span",{className:r().statusBadge,style:{backgroundColor:(e=>{switch(e){case"pending":case"pending_approval":return"#FFA500";case"verified":case"active":return"#4CAF50";case"blocked":case"rejected":case"cancelled":return"#F44336";case"draft":return"#9E9E9E";case"sold_out":return"#2196F3";case"finished":return"#673AB7";default:return"#757575"}})(a)},children:{pending:"Pendiente",pending_approval:"Pendiente de aprobaci\xf3n",verified:"Verificada",blocked:"Bloqueada",active:"Activo",draft:"Borrador",sold_out:"Agotado",finished:"Finalizado",cancelled:"Cancelado",rejected:"Rechazado"}[a]||a})}},3404:function(e,a,t){"use strict";t.d(a,{x:function(){return s}});var n=t(7147),l=t(9190);class r{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,a){return this.client.get(e,a)}async post(e,a,t){return this.client.post(e,a,t)}async put(e,a){return this.client.put(e,a)}async delete(e){return this.client.delete(e)}constructor(){(0,n._)(this,"client",void 0),this.client=l.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let a=localStorage.getItem("token");console.log("API Request - Token from localStorage:",a),a?(e.headers.Authorization="Bearer ".concat(a),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let s=new r},2129:function(e,a,t){"use strict";t.d(a,{W:function(){return l}});var n=t(3404);let l={getRafflesByShop:async e=>(await n.x.get("/raffles?shopId=".concat(e))).data,getRaffleById:async e=>(await n.x.get("/raffles/".concat(e))).data,createRaffle:async e=>(await n.x.post("/raffles",e)).data,updateRaffle:async(e,a)=>(await n.x.put("/raffles/".concat(e),a)).data,submitForApproval:async e=>(await n.x.put("/raffles/".concat(e,"/submit-approval"),{})).data,cancelRaffle:async e=>(await n.x.put("/raffles/".concat(e,"/cancel"),{})).data,getActiveRaffles:async()=>(await n.x.get("/raffles/active")).data,getAllRaffles:async()=>(await n.x.get("/raffles")).data}},4767:function(e,a,t){"use strict";t.d(a,{m:function(){return l}});var n=t(3404);let l={getMyShop:async()=>(await n.x.get("/shops/my-shop/current")).data,getShopById:async e=>(await n.x.get("/shops/".concat(e))).data,updateShop:async(e,a)=>(await n.x.put("/shops/".concat(e),a)).data,getAllShops:async()=>(await n.x.get("/shops")).data,getVerifiedShops:async()=>(await n.x.get("/shops/verified")).data,getShopStatistics:async e=>(await n.x.get("/shops/".concat(e,"/statistics"))).data}},7197:function(e,a,t){"use strict";t.d(a,{t:function(){return r}});var n=t(3020),l=t(4302);let r=(0,n.Ue)()((0,l.tJ)(e=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:a=>e({user:a,isAuthenticated:!!a}),setToken:a=>{a?localStorage.setItem("token",a):localStorage.removeItem("token"),e({token:a})},setIsLoading:a=>e({isLoading:a}),setError:a=>e({error:a}),logout:()=>{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6289:function(e,a,t){"use strict";var n,l;t.d(a,{i:function(){return n}}),(l=n||(n={})).ADMIN="admin",l.SHOP="shop",l.USER="user"},6030:function(e,a,t){"use strict";var n,l;t.d(a,{r:function(){return n}}),(l=n||(n={})).DRAFT="draft",l.PENDING_APPROVAL="pending_approval",l.ACTIVE="active",l.PAUSED="paused",l.SOLD_OUT="sold_out",l.FINISHED="finished",l.CANCELLED="cancelled",l.REJECTED="rejected"},192:function(e){e.exports={panelContainer:"panel_panelContainer__Kt8Ty",sidebar:"panel_sidebar__KeScH",sidebarNav:"panel_sidebarNav__KjeNV",navLink:"panel_navLink__sQoV6",active:"panel_active___ehGn",mainContent:"panel_mainContent__7V2fv",shopHeader:"panel_shopHeader__iRrDp",shopHeaderContent:"panel_shopHeaderContent__wsZnH",shopLogo:"panel_shopLogo__gTusz",shopHeaderInfo:"panel_shopHeaderInfo__IKOo3",shopName:"panel_shopName__lr5MU",shopDescription:"panel_shopDescription__zNvIE",statusBadge:"panel_statusBadge__37f3q",formGroup:"panel_formGroup__0UyVN",formLabel:"panel_formLabel___zOHD",formInput:"panel_formInput__bLzwR",formTextarea:"panel_formTextarea__B2MkI",formSelect:"panel_formSelect__thum_",primaryButton:"panel_primaryButton__ArDHW",secondaryButton:"panel_secondaryButton__KSKVI",dangerButton:"panel_dangerButton__2WLFi",buttonGroup:"panel_buttonGroup__pcyfD",card:"panel_card__ttDyJ",cardHeader:"panel_cardHeader__scyyA",cardTitle:"panel_cardTitle__K6V__",cardActions:"panel_cardActions___eqre",cardAction:"panel_cardAction__xpZWN",cardActionPrimary:"panel_cardActionPrimary__t_VOi",cardActionSecondary:"panel_cardActionSecondary__gcgLm",table:"panel_table__GBWH_",tableHeader:"panel_tableHeader__TN7va",tableHeaderCell:"panel_tableHeaderCell__WZypp",tableRow:"panel_tableRow__oR22e",tableCell:"panel_tableCell__GdQvd",tableCellCenter:"panel_tableCellCenter__Gc4za",tableCellRight:"panel_tableCellRight__jl067",emptyState:"panel_emptyState__1c4lK",emptyStateIcon:"panel_emptyStateIcon__znkGr",emptyStateTitle:"panel_emptyStateTitle__OpZSI",emptyStateDescription:"panel_emptyStateDescription__P3sK_",alert:"panel_alert__dbKCy",alertSuccess:"panel_alertSuccess__T39ZR",alertError:"panel_alertError__9DFT4",alertWarning:"panel_alertWarning__sOPwe",alertInfo:"panel_alertInfo__PLXx9",progressBar:"panel_progressBar__Ik7pm",progressBarFill:"panel_progressBarFill__NCwij",profileForm:"panel_profileForm__VbWs3",profileFormSection:"panel_profileFormSection__t80bQ",profileFormSectionTitle:"panel_profileFormSectionTitle__o8RW2",readOnlyField:"panel_readOnlyField___M4rQ",raffleForm:"panel_raffleForm__s3ll7",raffleFormSection:"panel_raffleFormSection__PUcJc",raffleFormSectionTitle:"panel_raffleFormSectionTitle__1DglO",dimensionsGrid:"panel_dimensionsGrid__7jafN",dimensionInfo:"panel_dimensionInfo__bjc2e",dimensionLabel:"panel_dimensionLabel__FAjKe",dimensionValue:"panel_dimensionValue__Jm7tM",depositWarning:"panel_depositWarning__mU2qE",ticketCalculation:"panel_ticketCalculation___d694",ticketCalculationValue:"panel_ticketCalculationValue__KOcl_",raffleDetail:"panel_raffleDetail__nigCY",raffleDetailHeader:"panel_raffleDetailHeader__xcVaX",raffleDetailTitle:"panel_raffleDetailTitle___LWvI",raffleDetailStatus:"panel_raffleDetailStatus__GBSlq",raffleDetailSection:"panel_raffleDetailSection__Y6dGR",raffleDetailSectionTitle:"panel_raffleDetailSectionTitle__6HXue",raffleDetailGrid:"panel_raffleDetailGrid__U8h9R",raffleDetailItem:"panel_raffleDetailItem__frOK2",raffleDetailItemLabel:"panel_raffleDetailItemLabel__PLUUN",raffleDetailItemValue:"panel_raffleDetailItemValue__mVKfw",ticketProgress:"panel_ticketProgress__9PZKW",ticketProgressLabel:"panel_ticketProgressLabel__fBS77",ticketProgressPercentage:"panel_ticketProgressPercentage__nBOhy",statCard:"panel_statCard__Dx3Sz",statCardIcon:"panel_statCardIcon__zp227",statCardValue:"panel_statCardValue__RWvG6",statCardLabel:"panel_statCardLabel__wRjrF",formHelpText:"panel_formHelpText__IpKar",formInputError:"panel_formInputError__oPd_O"}}},function(e){e.O(0,[6438,2489,4755,4542,7115,2364,1744],function(){return e(e.s=7435)}),_N_E=e.O()}]);