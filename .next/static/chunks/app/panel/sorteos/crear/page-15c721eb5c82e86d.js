(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9394],{2310:function(e,t,a){Promise.resolve().then(a.bind(a,7278))},7278:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var r=a(7821),s=a(8078),o=a(7197),i=a(6289),c=a(9422),d=a(692),n=a(1850),l=a(8504),u=a(9283),h=a(6204),p=a(2379),m=a(192),v=a.n(m);function g(e){let{shop:t}=e,a=(0,l.useRouter)(),[o,i]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[n,m]=(0,s.useState)(""),[g,f]=(0,s.useState)(!1),[y,x]=(0,s.useState)(!0),[N,j]=(0,s.useState)(null),[w,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{S()},[t.id]);let S=async()=>{x(!0);try{let e=await p._.getActiveProductsByShop(t.id);i(e)}catch(t){var e,a;j((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar productos")}finally{x(!1)}},I=e=>{d(o.find(t=>t.id===e)||null)},b=async e=>{if(e.preventDefault(),j(null),!c){j("Debes seleccionar un producto");return}if(t.status===u.R.BLOCKED){j("Tu tienda est\xe1 bloqueada y no puede crear sorteos");return}f(!0);try{let e=await h.raffleService.createRaffle({shopId:t.id,productId:c.id,specialConditions:n||void 0});E(!0),setTimeout(()=>{a.push("/panel/sorteos/".concat(e.id))},1500)}catch(e){j(e.message||"Error al crear el sorteo")}finally{f(!1)}};if(t.status===u.R.BLOCKED)return(0,r.jsx)("div",{className:v().raffleDetail,children:(0,r.jsx)("div",{className:v().alert+" "+v().alertError,children:"Tu tienda est\xe1 bloqueada y no puede crear nuevos sorteos. Contacta con soporte para m\xe1s informaci\xf3n."})});if(y)return(0,r.jsx)("div",{className:v().alert,children:"Cargando productos..."});if(0===o.length)return(0,r.jsx)("div",{className:v().raffleDetail,children:(0,r.jsx)("div",{className:v().alert+" "+v().alertWarning,children:"No tienes productos activos. Crea un producto antes de crear un sorteo."})});let D=c?Math.floor(2*Number(c.value)):0;return(0,r.jsxs)("form",{onSubmit:b,className:v().raffleForm,children:[N&&(0,r.jsx)("div",{className:"".concat(v().alert," ").concat(v().alertError),children:N}),w&&(0,r.jsx)("div",{className:"".concat(v().alert," ").concat(v().alertSuccess),children:"✓ Sorteo creado exitosamente. Redirigiendo..."}),(0,r.jsxs)("div",{className:v().raffleFormSection,children:[(0,r.jsx)("h2",{className:v().raffleFormSectionTitle,children:"1. Selecciona un producto"}),(0,r.jsxs)("div",{className:v().formGroup,children:[(0,r.jsx)("label",{className:v().formLabel,children:"Producto"}),(0,r.jsxs)("select",{value:(null==c?void 0:c.id)||"",onChange:e=>I(e.target.value),className:v().formSelect,required:!0,children:[(0,r.jsx)("option",{value:"",children:"-- Selecciona un producto --"}),o.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - S/. ",Number(e.value).toFixed(2)]},e.id))]})]})]}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:v().raffleFormSection,children:[(0,r.jsx)("h2",{className:v().raffleFormSectionTitle,children:"2. Informaci\xf3n del producto"}),(0,r.jsxs)("div",{className:v().dimensionsGrid,children:[(0,r.jsxs)("div",{className:v().dimensionInfo,children:[(0,r.jsx)("div",{className:v().dimensionLabel,children:"Altura"}),(0,r.jsxs)("div",{className:v().dimensionValue,children:[Number(c.height).toFixed(1)," cm"]})]}),(0,r.jsxs)("div",{className:v().dimensionInfo,children:[(0,r.jsx)("div",{className:v().dimensionLabel,children:"Ancho"}),(0,r.jsxs)("div",{className:v().dimensionValue,children:[Number(c.width).toFixed(1)," cm"]})]}),(0,r.jsxs)("div",{className:v().dimensionInfo,children:[(0,r.jsx)("div",{className:v().dimensionLabel,children:"Profundidad"}),(0,r.jsxs)("div",{className:v().dimensionValue,children:[Number(c.depth).toFixed(1)," cm"]})]})]}),c.requiresDeposit&&(0,r.jsx)("div",{className:v().depositWarning,children:"⚠️ Este producto requiere un dep\xf3sito de garant\xeda. El dep\xf3sito ser\xe1 retenido hasta que se complete el sorteo."}),!c.requiresDeposit&&(0,r.jsx)("div",{className:v().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,r.jsxs)("div",{className:v().raffleFormSection,children:[(0,r.jsx)("h2",{className:v().raffleFormSectionTitle,children:"3. C\xe1lculo de tickets"}),(0,r.jsxs)("div",{className:v().ticketCalculation,children:[(0,r.jsxs)("div",{children:["Valor del producto: S/. ",Number(c.value).toFixed(2)]}),(0,r.jsx)("div",{children:"F\xf3rmula: Valor \xd7 2 = Total de tickets"}),(0,r.jsxs)("div",{className:v().ticketCalculationValue,children:[D," tickets"]})]})]}),(0,r.jsxs)("div",{className:v().raffleFormSection,children:[(0,r.jsx)("h2",{className:v().raffleFormSectionTitle,children:"4. Condiciones especiales (opcional)"}),(0,r.jsxs)("div",{className:v().formGroup,children:[(0,r.jsx)("label",{className:v().formLabel,children:"Condiciones especiales del sorteo"}),(0,r.jsx)("textarea",{value:n,onChange:e=>m(e.target.value),className:v().formTextarea,placeholder:"Ej: Env\xedo incluido, garant\xeda de 1 a\xf1o, etc."})]})]}),(0,r.jsxs)("div",{className:v().buttonGroup,children:[(0,r.jsx)("button",{type:"submit",className:v().primaryButton,disabled:g,children:g?"Creando sorteo...":"Crear sorteo"}),(0,r.jsx)("button",{type:"button",className:v().secondaryButton,onClick:()=>a.back(),children:"Cancelar"})]})]})]})}var f=a(6066);function y(){let{user:e,isAuthenticated:t}=(0,o.t)(),[a,l]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),[p,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{t&&e&&y()},[t,e]);let y=async()=>{h(!0),m(null);try{let e=await c.m.getMyShop();l(e)}catch(a){var e,t;m((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar la tienda")}finally{h(!1)}};return(0,r.jsx)(f.i,{requiredRole:i.i.SHOP,children:(0,r.jsxs)("div",{className:v().panelContainer,children:[(0,r.jsx)(n.G,{isBlocked:(null==a?void 0:a.status)==="blocked"}),(0,r.jsxs)("main",{className:v().mainContent,children:[u&&(0,r.jsx)("div",{className:v().alert,children:"Cargando tienda..."}),p&&(0,r.jsxs)("div",{className:"".concat(v().alert," ").concat(v().alertError),children:[p,(0,r.jsx)("button",{onClick:y,className:v().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.N,{shop:a}),(0,r.jsxs)("div",{className:v().raffleDetail,children:[(0,r.jsx)("h1",{className:v().raffleDetailTitle,children:"Crear nuevo sorteo"}),(0,r.jsx)(g,{shop:a})]})]})]})]})})}},2379:function(e,t,a){"use strict";a.d(t,{_:function(){return l}});var r,s,o=a(6534),i=a(6532);(r=s||(s={})).ACTIVE="active",r.INACTIVE="inactive",r.ARCHIVED="archived";let c=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,d=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||s.INACTIVE,createdAt:c(t.createdAt),updatedAt:c(t.updatedAt)}},n={async getProductsByShop(e){try{let t=(0,o.collection)(i.db,"products"),a=(0,o.query)(t,(0,o.where)("shopId","==",e),(0,o.where)("status","==",s.ACTIVE));return(await (0,o.getDocs)(a)).docs.map(e=>d(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,o.getDoc)((0,o.doc)(i.db,"products",e));if(!t.exists())throw Error("Product not found");return d(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,o.collection)(i.db,"products"),t=(0,o.query)(e,(0,o.where)("status","==",s.ACTIVE));return(await (0,o.getDocs)(t)).docs.map(e=>d(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,o.collection)(i.db,"products"),a={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:s.ACTIVE,createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()},r=await (0,o.ET)(t,a),c=await (0,o.getDoc)(r);if(!c.exists())throw Error("Error al crear el producto");return d(c)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let a=(0,o.doc)(i.db,"products",e),r={updatedAt:(0,o.serverTimestamp)()};if(void 0!==t.name&&(r.name=t.name),void 0!==t.description&&(r.description=t.description),void 0!==t.value&&(r.value=t.value),void 0!==t.height&&(r.height=t.height),void 0!==t.width&&(r.width=t.width),void 0!==t.depth&&(r.depth=t.depth),void 0!==t.category&&(r.category=t.category),void 0!==t.mainImage&&(r.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,o.getDoc)(a);if(e.exists()){let a=e.data(),s=void 0!==t.height?t.height:a.height,o=void 0!==t.width?t.width:a.width,i=void 0!==t.depth?t.depth:a.depth;r.requiresDeposit=s>15||o>15||i>15}}await (0,o.updateDoc)(a,r);let s=await (0,o.getDoc)(a);if(!s.exists())throw Error("Producto no encontrado");return d(s)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,o.doc)(i.db,"products",e);await (0,o.updateDoc)(t,{status:s.INACTIVE,updatedAt:(0,o.serverTimestamp)()});let a=await (0,o.getDoc)(t);if(!a.exists())throw Error("Producto no encontrado");return d(a)}catch(e){throw console.error("Error deactivating product:",e),e}}},l={getProductsByShop:async e=>n.getProductsByShop(e),getActiveProductsByShop:async e=>n.getActiveProductsByShop(e),getProductById:async e=>n.getProductById(e),getAllProducts:async()=>n.getAllProducts(),createProduct:async e=>n.createProduct(e),updateProduct:async(e,t)=>n.updateProduct(e,t),deactivateProduct:async e=>n.deactivateProduct(e)}},9422:function(e,t,a){"use strict";a.d(t,{m:function(){return l}});var r=a(3404),s=a(6534),o=a(6532),i=a(9283);let c=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,d=e=>{let t=e.data();return{id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||i.R.PENDING,createdAt:c(t.createdAt),updatedAt:c(t.updatedAt)}},n={async getShopById(e){try{let t=await (0,s.getDoc)((0,s.doc)(o.db,"shops",e));if(!t.exists())throw Error("Shop not found");return d(t)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,s.collection)(o.db,"shops"),t=(0,s.query)(e,(0,s.where)("status","==",i.R.VERIFIED));return(await (0,s.getDocs)(t)).docs.map(e=>d(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,s.collection)(o.db,"shops");return(await (0,s.getDocs)(e)).docs.map(e=>d(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},l={getShopById:async e=>n.getShopById(e),getAllShops:async()=>n.getAllShops(),getVerifiedShops:async()=>n.getVerifiedShops(),getMyShop:async()=>(await r.x.get("/shops/my-shop/current")).data,updateShop:async(e,t)=>(await r.x.put("/shops/".concat(e),t)).data,getShopStatistics:async e=>(await r.x.get("/shops/".concat(e,"/statistics"))).data}},9283:function(e,t,a){"use strict";var r,s;a.d(t,{R:function(){return r}}),(s=r||(r={})).PENDING="pending",s.VERIFIED="verified",s.BLOCKED="blocked"}},function(e){e.O(0,[6438,2907,4183,1044,2489,8641,4755,4542,4446,6204,7115,2364,1744],function(){return e(e.s=2310)}),_N_E=e.O()}]);