(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{7435:function(e,a,t){Promise.resolve().then(t.bind(t,9274))},9274:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return N}});var s=t(7821),r=t(8078),l=t(7197),n=t(6289),c=t(9422),o=t(692),i=t(1850),d=t(4542),u=t(6030),h=t(6204),p=t(192),m=t.n(p),f=t(5975),v=t(5959);function x(e){let{shopId:a}=e,[t,l]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0),[o,i]=(0,r.useState)(null),[p,x]=(0,r.useState)("all");(0,r.useEffect)(()=>{j()},[a]);let j=async()=>{c(!0),i(null);try{let e=await h.raffleService.getRafflesByShop(a);l(e)}catch(a){var e,t;i((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar los sorteos")}finally{c(!1)}},N="all"===p?t:t.filter(e=>e.status===p),g=async e=>{if(confirm("\xbfEst\xe1s seguro de que deseas cancelar este sorteo?"))try{await h.raffleService.cancelRaffle(e),l(t.map(a=>a.id===e?{...a,status:u.r.CANCELLED}:a))}catch(e){var a,s;alert((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"Error al cancelar el sorteo")}};return n?(0,s.jsx)("div",{className:m().alert,children:"Cargando sorteos..."}):o?(0,s.jsxs)("div",{className:m().alert+" "+m().alertError,children:[o,(0,s.jsx)("button",{onClick:j,className:m().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}):0===t.length?(0,s.jsx)(v.u,{title:"No tienes sorteos a\xfan",description:"Crea tu primer sorteo para comenzar a vender tickets",icon:"\uD83C\uDFB2",action:{label:"Crear sorteo",onClick:()=>window.location.href="/panel/sorteos/crear"}}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:m().raffleDetailSection,children:[(0,s.jsx)("label",{className:m().raffleDetailSectionTitle,children:"Filtrar por estado"}),(0,s.jsxs)("select",{value:p,onChange:e=>x(e.target.value),className:m().formSelect,style:{maxWidth:"300px"},children:[(0,s.jsx)("option",{value:"all",children:"Todos los estados"}),(0,s.jsx)("option",{value:u.r.DRAFT,children:"Borrador"}),(0,s.jsx)("option",{value:u.r.PENDING_APPROVAL,children:"Pendiente de aprobaci\xf3n"}),(0,s.jsx)("option",{value:u.r.ACTIVE,children:"Activo"}),(0,s.jsx)("option",{value:u.r.SOLD_OUT,children:"Agotado"}),(0,s.jsx)("option",{value:u.r.FINISHED,children:"Finalizado"}),(0,s.jsx)("option",{value:u.r.CANCELLED,children:"Cancelado"})]})]}),(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{className:m().tableHeader,children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:m().tableHeaderCell,children:"Producto"}),(0,s.jsx)("th",{className:m().tableHeaderCell,children:"Estado"}),(0,s.jsx)("th",{className:m().tableHeaderCell,children:"Tickets"}),(0,s.jsx)("th",{className:m().tableHeaderCell,children:"Creado"}),(0,s.jsx)("th",{className:m().tableHeaderCell,children:"Acciones"})]})}),(0,s.jsx)("tbody",{children:N.map(e=>{var a;return(0,s.jsxs)("tr",{className:m().tableRow,children:[(0,s.jsx)("td",{className:m().tableCell,children:(null===(a=e.product)||void 0===a?void 0:a.name)||"Producto desconocido"}),(0,s.jsx)("td",{className:m().tableCell,children:(0,s.jsx)(f.O,{status:e.status})}),(0,s.jsxs)("td",{className:m().tableCell,children:[e.soldTickets," / ",e.totalTickets]}),(0,s.jsx)("td",{className:m().tableCell,children:new Date(e.createdAt).toLocaleDateString()}),(0,s.jsx)("td",{className:m().tableCell,children:(0,s.jsxs)("div",{className:m().cardActions,children:[(0,s.jsx)(d.default,{href:"/panel/sorteos/".concat(e.id),className:m().cardActionPrimary,children:"Ver"}),(e.status===u.r.DRAFT||e.status===u.r.PENDING_APPROVAL)&&(0,s.jsx)("button",{onClick:()=>g(e.id),className:m().cardActionSecondary,children:"Cancelar"})]})})]},e.id)})})]})]})}var j=t(6066);function N(){let{user:e,isAuthenticated:a}=(0,l.t)(),[t,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{a&&e&&v()},[a,e]);let v=async()=>{h(!0),f(null);try{let e=await c.m.getMyShop();d(e)}catch(t){var e,a;f((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar la tienda")}finally{h(!1)}};return(0,s.jsx)(j.i,{requiredRole:n.i.SHOP,children:(0,s.jsxs)("div",{className:m().panelContainer,children:[(0,s.jsx)(i.G,{isBlocked:(null==t?void 0:t.status)==="blocked"}),(0,s.jsxs)("main",{className:m().mainContent,children:[u&&(0,s.jsx)("div",{className:m().alert,children:"Cargando tienda..."}),p&&(0,s.jsxs)("div",{className:"".concat(m().alert," ").concat(m().alertError),children:[p,(0,s.jsx)("button",{onClick:v,className:m().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.N,{shop:t}),(0,s.jsxs)("div",{className:m().raffleDetail,children:[(0,s.jsx)("h1",{className:m().raffleDetailTitle,children:"Mis sorteos"}),(0,s.jsx)(x,{shopId:t.id})]})]})]})]})})}},5959:function(e,a,t){"use strict";t.d(a,{u:function(){return n}});var s=t(7821),r=t(192),l=t.n(r);function n(e){let{title:a,description:t,icon:r,action:n}=e;return(0,s.jsxs)("div",{className:l().emptyState,children:[r&&(0,s.jsx)("div",{className:l().emptyStateIcon,children:r}),(0,s.jsx)("h3",{className:l().emptyStateTitle,children:a}),(0,s.jsx)("p",{className:l().emptyStateDescription,children:t}),n&&(0,s.jsx)("button",{className:l().primaryButton,onClick:n.onClick,children:n.label})]})}},5975:function(e,a,t){"use strict";t.d(a,{O:function(){return n}});var s=t(7821),r=t(192),l=t.n(r);function n(e){let{status:a}=e;return(0,s.jsx)("span",{className:l().statusBadge,style:{backgroundColor:(e=>{switch(e){case"pending":case"pending_approval":return"#FFA500";case"verified":case"active":return"#4CAF50";case"blocked":case"rejected":case"cancelled":return"#F44336";case"draft":return"#9E9E9E";case"sold_out":return"#2196F3";case"finished":return"#673AB7";default:return"#757575"}})(a)},children:{pending:"Pendiente",pending_approval:"Pendiente de aprobaci\xf3n",verified:"Verificada",blocked:"Bloqueada",active:"Activo",draft:"Borrador",sold_out:"Agotado",finished:"Finalizado",cancelled:"Cancelado",rejected:"Rechazado"}[a]||a})}},9422:function(e,a,t){"use strict";t.d(a,{m:function(){return d}});var s=t(3404),r=t(6534),l=t(6532),n=t(9283);let c=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,o=e=>{let a=e.data();return{id:e.id,userId:a.userId||"",name:a.name||"",description:a.description,logo:a.logo,publicEmail:a.publicEmail,phone:a.phone,socialMedia:a.socialMedia,status:a.status||n.R.PENDING,createdAt:c(a.createdAt),updatedAt:c(a.updatedAt)}},i={async getShopById(e){try{let a=await (0,r.getDoc)((0,r.doc)(l.db,"shops",e));if(!a.exists())throw Error("Shop not found");return o(a)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,r.collection)(l.db,"shops"),a=(0,r.query)(e,(0,r.where)("status","==",n.R.VERIFIED));return(await (0,r.getDocs)(a)).docs.map(e=>o(e)).sort((e,a)=>e.name.localeCompare(a.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,r.collection)(l.db,"shops");return(await (0,r.getDocs)(e)).docs.map(e=>o(e)).sort((e,a)=>e.name.localeCompare(a.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},d={getShopById:async e=>i.getShopById(e),getAllShops:async()=>i.getAllShops(),getVerifiedShops:async()=>i.getVerifiedShops(),getMyShop:async()=>(await s.x.get("/shops/my-shop/current")).data,updateShop:async(e,a)=>(await s.x.put("/shops/".concat(e),a)).data,getShopStatistics:async e=>(await s.x.get("/shops/".concat(e,"/statistics"))).data}},9283:function(e,a,t){"use strict";var s,r;t.d(a,{R:function(){return s}}),(r=s||(s={})).PENDING="pending",r.VERIFIED="verified",r.BLOCKED="blocked"}},function(e){e.O(0,[6438,2907,4183,1044,2489,8641,4755,4542,4446,6204,7115,2364,1744],function(){return e(e.s=7435)}),_N_E=e.O()}]);