(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1005],{5036:function(e,a,s){Promise.resolve().then(s.bind(s,3877))},3877:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return N}});var t=s(7821),l=s(8078),i=s(7197),r=s(6289),c=s(9422),n=s(692),d=s(1850),o=s(8504),f=s(6030),u=s(6204),m=s(192),h=s.n(m),v=s(5975);function p(e){var a,s,i,r,c;let{raffleId:n}=e,d=(0,o.useRouter)(),[m,p]=(0,l.useState)(null),[x,N]=(0,l.useState)(!0),[j,D]=(0,l.useState)(null),[g,I]=(0,l.useState)(!1);(0,l.useEffect)(()=>{S()},[n]);let S=async()=>{N(!0),D(null);try{let e=await u.raffleService.getRaffleById(n);p(e)}catch(s){var e,a;D((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar el sorteo")}finally{N(!1)}},b=async()=>{if(m){I(!0);try{let e=await u.raffleService.submitForApproval(m.id);p(e)}catch(s){var e,a;alert((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al enviar para aprobaci\xf3n")}finally{I(!1)}}},y=async()=>{if(m&&confirm("\xbfEst\xe1s seguro de que deseas cancelar este sorteo?")){I(!0);try{let e=await u.raffleService.cancelRaffle(m.id);p(e)}catch(s){var e,a;alert((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cancelar el sorteo")}finally{I(!1)}}};if(x)return(0,t.jsx)("div",{className:h().alert,children:"Cargando sorteo..."});if(j)return(0,t.jsxs)("div",{className:h().alert+" "+h().alertError,children:[j,(0,t.jsx)("button",{onClick:S,className:h().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]});if(!m)return(0,t.jsx)("div",{className:h().alert+" "+h().alertError,children:"Sorteo no encontrado"});let E=m.soldTickets/m.totalTickets*100;return(0,t.jsxs)("div",{className:h().raffleDetail,children:[(0,t.jsxs)("div",{className:h().raffleDetailHeader,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:h().raffleDetailTitle,children:(null===(a=m.product)||void 0===a?void 0:a.name)||"Sorteo"}),(0,t.jsxs)("p",{style:{margin:"5px 0 0 0",color:"#7f8c8d"},children:["ID: ",m.id]})]}),(0,t.jsx)(v.O,{status:m.status})]}),(0,t.jsxs)("div",{className:h().raffleDetailSection,children:[(0,t.jsx)("div",{className:h().raffleDetailSectionTitle,children:"Informaci\xf3n del producto"}),(0,t.jsxs)("div",{className:h().raffleDetailGrid,children:[(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Nombre"}),(0,t.jsx)("div",{className:h().raffleDetailItemValue,children:null===(s=m.product)||void 0===s?void 0:s.name})]}),(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Valor"}),(0,t.jsxs)("div",{className:h().raffleDetailItemValue,children:["S/. ",Number(m.productValue).toFixed(2)]})]}),(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Altura"}),(0,t.jsxs)("div",{className:h().raffleDetailItemValue,children:[Number(null===(i=m.product)||void 0===i?void 0:i.height).toFixed(1)," cm"]})]}),(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Ancho"}),(0,t.jsxs)("div",{className:h().raffleDetailItemValue,children:[Number(null===(r=m.product)||void 0===r?void 0:r.width).toFixed(1)," cm"]})]}),(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Profundidad"}),(0,t.jsxs)("div",{className:h().raffleDetailItemValue,children:[Number(null===(c=m.product)||void 0===c?void 0:c.depth).toFixed(1)," cm"]})]}),(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Requiere dep\xf3sito"}),(0,t.jsx)("div",{className:h().raffleDetailItemValue,children:m.requiresDeposit?"S\xed":"No"})]})]})]}),(0,t.jsxs)("div",{className:h().raffleDetailSection,children:[(0,t.jsx)("div",{className:h().raffleDetailSectionTitle,children:"Progreso de tickets"}),(0,t.jsxs)("div",{className:h().ticketProgress,children:[(0,t.jsxs)("div",{className:h().ticketProgressLabel,children:[(0,t.jsxs)("span",{children:[m.soldTickets," / ",m.totalTickets," tickets vendidos"]}),(0,t.jsxs)("span",{className:h().ticketProgressPercentage,children:[Math.round(E),"%"]})]}),(0,t.jsx)("div",{className:h().progressBar,children:(0,t.jsx)("div",{className:h().progressBarFill,style:{width:"".concat(E,"%")}})})]})]}),(0,t.jsxs)("div",{className:h().raffleDetailSection,children:[(0,t.jsx)("div",{className:h().raffleDetailSectionTitle,children:"Informaci\xf3n del sorteo"}),(0,t.jsxs)("div",{className:h().raffleDetailGrid,children:[(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Estado"}),(0,t.jsx)("div",{className:h().raffleDetailItemValue,children:(0,t.jsx)(v.O,{status:m.status})})]}),(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Creado"}),(0,t.jsx)("div",{className:h().raffleDetailItemValue,children:new Date(m.createdAt).toLocaleDateString()})]}),m.activatedAt&&(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Activado"}),(0,t.jsx)("div",{className:h().raffleDetailItemValue,children:new Date(m.activatedAt).toLocaleDateString()})]}),m.raffleExecutedAt&&(0,t.jsxs)("div",{className:h().raffleDetailItem,children:[(0,t.jsx)("div",{className:h().raffleDetailItemLabel,children:"Finalizado"}),(0,t.jsx)("div",{className:h().raffleDetailItemValue,children:new Date(m.raffleExecutedAt).toLocaleDateString()})]})]})]}),m.specialConditions&&(0,t.jsxs)("div",{className:h().raffleDetailSection,children:[(0,t.jsx)("div",{className:h().raffleDetailSectionTitle,children:"Condiciones especiales"}),(0,t.jsx)("p",{children:m.specialConditions})]}),m.status===f.r.FINISHED&&m.winnerTicketId&&(0,t.jsx)("div",{className:h().raffleDetailSection,children:(0,t.jsxs)("div",{className:h().alert+" "+h().alertSuccess,children:["âœ“ Sorteo finalizado. Ticket ganador: ",m.winnerTicketId]})}),(0,t.jsxs)("div",{className:h().buttonGroup,children:[m.status===f.r.DRAFT&&(0,t.jsx)("button",{onClick:b,className:h().primaryButton,disabled:g,children:g?"Enviando...":"Enviar para aprobaci\xf3n"}),(m.status===f.r.DRAFT||m.status===f.r.PENDING_APPROVAL)&&(0,t.jsx)("button",{onClick:y,className:h().dangerButton,disabled:g,children:g?"Cancelando...":"Cancelar sorteo"}),(0,t.jsx)("button",{onClick:()=>d.back(),className:h().secondaryButton,children:"Volver"})]})]})}var x=s(6066);function N(e){let{params:a}=e,{user:s,isAuthenticated:o}=(0,i.t)(),[f,u]=(0,l.useState)(null),[m,v]=(0,l.useState)(!0),[N,j]=(0,l.useState)(null);(0,l.useEffect)(()=>{o&&s&&D()},[o,s]);let D=async()=>{v(!0),j(null);try{let e=await c.m.getMyShop();u(e)}catch(s){var e,a;j((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar la tienda")}finally{v(!1)}};return(0,t.jsx)(x.i,{requiredRole:r.i.SHOP,children:(0,t.jsxs)("div",{className:h().panelContainer,children:[(0,t.jsx)(d.G,{isBlocked:(null==f?void 0:f.status)==="blocked"}),(0,t.jsxs)("main",{className:h().mainContent,children:[m&&(0,t.jsx)("div",{className:h().alert,children:"Cargando tienda..."}),N&&(0,t.jsxs)("div",{className:"".concat(h().alert," ").concat(h().alertError),children:[N,(0,t.jsx)("button",{onClick:D,className:h().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.N,{shop:f}),(0,t.jsx)(p,{raffleId:a.id})]})]})]})})}},5975:function(e,a,s){"use strict";s.d(a,{O:function(){return r}});var t=s(7821),l=s(192),i=s.n(l);function r(e){let{status:a}=e;return(0,t.jsx)("span",{className:i().statusBadge,style:{backgroundColor:(e=>{switch(e){case"pending":case"pending_approval":return"#FFA500";case"verified":case"active":return"#4CAF50";case"blocked":case"rejected":case"cancelled":return"#F44336";case"draft":return"#9E9E9E";case"sold_out":return"#2196F3";case"finished":return"#673AB7";default:return"#757575"}})(a)},children:{pending:"Pendiente",pending_approval:"Pendiente de aprobaci\xf3n",verified:"Verificada",blocked:"Bloqueada",active:"Activo",draft:"Borrador",sold_out:"Agotado",finished:"Finalizado",cancelled:"Cancelado",rejected:"Rechazado"}[a]||a})}},9422:function(e,a,s){"use strict";s.d(a,{m:function(){return o}});var t=s(3404),l=s(6534),i=s(6532),r=s(9283);let c=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,n=e=>{let a=e.data();return{id:e.id,userId:a.userId||"",name:a.name||"",description:a.description,logo:a.logo,publicEmail:a.publicEmail,phone:a.phone,socialMedia:a.socialMedia,status:a.status||r.R.PENDING,createdAt:c(a.createdAt),updatedAt:c(a.updatedAt)}},d={async getShopById(e){try{let a=await (0,l.getDoc)((0,l.doc)(i.db,"shops",e));if(!a.exists())throw Error("Shop not found");return n(a)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,l.collection)(i.db,"shops"),a=(0,l.query)(e,(0,l.where)("status","==",r.R.VERIFIED));return(await (0,l.getDocs)(a)).docs.map(e=>n(e)).sort((e,a)=>e.name.localeCompare(a.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,l.collection)(i.db,"shops");return(await (0,l.getDocs)(e)).docs.map(e=>n(e)).sort((e,a)=>e.name.localeCompare(a.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},o={getShopById:async e=>d.getShopById(e),getAllShops:async()=>d.getAllShops(),getVerifiedShops:async()=>d.getVerifiedShops(),getMyShop:async()=>(await t.x.get("/shops/my-shop/current")).data,updateShop:async(e,a)=>(await t.x.put("/shops/".concat(e),a)).data,getShopStatistics:async e=>(await t.x.get("/shops/".concat(e,"/statistics"))).data}},9283:function(e,a,s){"use strict";var t,l;s.d(a,{R:function(){return t}}),(l=t||(t={})).PENDING="pending",l.VERIFIED="verified",l.BLOCKED="blocked"}},function(e){e.O(0,[6438,2907,4183,1044,2489,8641,4755,4542,4446,6204,7115,2364,1744],function(){return e(e.s=5036)}),_N_E=e.O()}]);