(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2128],{4880:function(e,t,a){Promise.resolve().then(a.bind(a,9086))},9086:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(7821),o=a(8078),i=a(8504),s=a(7197),d=a(6289),n=a(2379),c=a(9298),l=a(692),u=a(1850),p=a(6066),m=a(192),h=a.n(m);function g(){let e=(0,i.useRouter)(),{user:t,isAuthenticated:m}=(0,s.t)(),[g,v]=(0,o.useState)(null),[x,f]=(0,o.useState)(!1),[y,j]=(0,o.useState)(!0),[w,b]=(0,o.useState)(null),[I,N]=(0,o.useState)({shopId:"",name:"",description:"",value:0,height:0,width:0,depth:0,category:"",mainImage:""}),[E,P]=(0,o.useState)([]),[A,C]=(0,o.useState)(!1);(0,o.useEffect)(()=>{m&&t&&D()},[m,t]);let D=async()=>{j(!0);try{if(!(null==t?void 0:t.id)){b("Usuario no autenticado");return}let{collection:o,query:i,where:s,getDocs:d}=await Promise.resolve().then(a.bind(a,6534)),{db:n}=await Promise.resolve().then(a.bind(a,6532)),c=o(n,"shops"),l=i(c,s("userId","==",t.id)),u=await d(l);if(u.empty)b("No se encontr\xf3 tu tienda");else{var e,r;let a=u.docs[0],o=a.data(),i={id:a.id,userId:o.userId||t.id,name:o.name||"",description:o.description,logo:o.logo,publicEmail:o.publicEmail,phone:o.phone,socialMedia:o.socialMedia,status:o.status||"pending",createdAt:(null===(e=o.createdAt)||void 0===e?void 0:e.toDate())||new Date,updatedAt:(null===(r=o.updatedAt)||void 0===r?void 0:r.toDate())||new Date};v(i),N(e=>({...e,shopId:i.id}))}}catch(e){b(e.message||"Error al cargar la tienda")}finally{j(!1)}},T=(e,t,a)=>{let r=[];return e<=0&&r.push("La altura debe ser mayor a 0"),t<=0&&r.push("El ancho debe ser mayor a 0"),a<=0&&r.push("La profundidad debe ser mayor a 0"),e>15&&r.push("La altura no puede exceder ".concat(15,"cm")),t>15&&r.push("El ancho no puede exceder ".concat(15,"cm")),a>15&&r.push("La profundidad no puede exceder ".concat(15,"cm")),r},S=(e,t)=>{let a=parseFloat(t)||0;N(t=>({...t,[e]:a})),P(T("height"===e?a:I.height,"width"===e?a:I.width,"depth"===e?a:I.depth))},q=async t=>{t.preventDefault(),b(null);let a=T(I.height,I.width,I.depth);if(a.length>0){P(a),b("Por favor corrige los errores en las dimensiones");return}if(!I.name||!I.description||I.value<=0){b("Por favor completa todos los campos requeridos");return}f(!0);try{await n._.createProduct(I),e.push("/panel/productos")}catch(e){var r,o;b((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error al crear el producto")}finally{f(!1)}},B=I.height>15||I.width>15||I.depth>15;return(0,r.jsx)(p.i,{requiredRole:d.i.SHOP,children:(0,r.jsxs)("div",{className:h().panelContainer,children:[(0,r.jsx)(u.G,{isBlocked:(null==g?void 0:g.status)==="blocked"}),(0,r.jsxs)("main",{className:h().mainContent,children:[y&&(0,r.jsx)("div",{className:h().alert,children:"Cargando tienda..."}),w&&!y&&(0,r.jsxs)("div",{className:"".concat(h().alert," ").concat(h().alertError),children:[w,(0,r.jsx)("button",{onClick:D,className:h().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.N,{shop:g}),(0,r.jsxs)("div",{className:h().raffleDetail,children:[(0,r.jsx)("h1",{className:h().raffleDetailTitle,children:"Crear nuevo producto"}),(0,r.jsxs)("form",{onSubmit:q,className:h().raffleForm,children:[(0,r.jsxs)("div",{className:h().raffleFormSection,children:[(0,r.jsx)("h2",{className:h().raffleFormSectionTitle,children:"Informaci\xf3n b\xe1sica"}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsxs)("label",{className:h().formLabel,children:["Nombre del producto ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("input",{type:"text",value:I.name,onChange:e=>N(t=>({...t,name:e.target.value})),className:h().formInput,required:!0,placeholder:"Ej: iPhone 15 Pro Max"})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsxs)("label",{className:h().formLabel,children:["Descripci\xf3n ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("textarea",{value:I.description,onChange:e=>N(t=>({...t,description:e.target.value})),className:h().formTextarea,required:!0,rows:4,placeholder:"Describe el producto en detalle..."})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsxs)("label",{className:h().formLabel,children:["Valor del producto (S/.) ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:I.value||"",onChange:e=>N(t=>({...t,value:parseFloat(e.target.value)||0})),className:h().formInput,required:!0,placeholder:"0.00"})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{className:h().formLabel,children:"Categor\xeda (opcional)"}),(0,r.jsx)("input",{type:"text",value:I.category||"",onChange:e=>N(t=>({...t,category:e.target.value})),className:h().formInput,placeholder:"Ej: Electr\xf3nica, Ropa, Hogar..."})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{className:h().formLabel,children:"Imagen Principal (opcional)"}),(0,r.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,r.jsx)("input",{type:"file",id:"productImageFile",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:async e=>{var t,a,r,o;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(i){if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(i.type)){b("Tipo de archivo no permitido. Solo se permiten im\xe1genes (JPEG, PNG, WEBP, GIF)");return}if(i.size>5242880){b("El archivo es demasiado grande. M\xe1ximo permitido: 5MB");return}b(null),C(!0);try{let e=await c.T.uploadProductImage(i),t=e.startsWith("http")?e:"".concat(((a="http://localhost:3001/api",void 0===a)?void 0:a.replace("/api",""))||"http://localhost:3001").concat(e);N(e=>({...e,mainImage:t}))}catch(e){b((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error al subir la imagen")}finally{C(!1)}}},className:h().formInput,style:{marginBottom:"10px"},disabled:A}),A&&(0,r.jsx)("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:"Subiendo imagen..."}),I.mainImage&&!A&&(0,r.jsx)("div",{style:{marginTop:"10px"},children:(0,r.jsx)("img",{src:I.mainImage,alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",borderRadius:"4px",border:"1px solid #ddd"}})})]}),(0,r.jsx)("small",{style:{display:"block",marginTop:"5px",color:"#666",fontSize:"12px"},children:"O ingresa una URL de imagen:"}),(0,r.jsx)("input",{type:"url",value:I.mainImage||"",onChange:e=>N(t=>({...t,mainImage:e.target.value})),className:h().formInput,placeholder:"https://ejemplo.com/imagen.jpg",style:{marginTop:"5px"}})]})]}),(0,r.jsxs)("div",{className:h().raffleFormSection,children:[(0,r.jsxs)("h2",{className:h().raffleFormSectionTitle,children:["Dimensiones (en cent\xedmetros) ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("p",{className:h().formHelpText,children:"M\xe1ximo permitido: 15cm por cada dimensi\xf3n. Si alguna dimensi\xf3n excede este l\xedmite, se requerir\xe1 un dep\xf3sito de garant\xeda."}),(0,r.jsxs)("div",{className:h().dimensionsGrid,children:[(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{className:h().formLabel,children:"Altura (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:I.height||"",onChange:e=>S("height",e.target.value),className:E.some(e=>e.includes("altura")||e.includes("Alto"))?"".concat(h().formInput," ").concat(h().formInputError):h().formInput,required:!0})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{className:h().formLabel,children:"Ancho (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:I.width||"",onChange:e=>S("width",e.target.value),className:E.some(e=>e.includes("ancho")||e.includes("Ancho"))?"".concat(h().formInput," ").concat(h().formInputError):h().formInput,required:!0})]}),(0,r.jsxs)("div",{className:h().formGroup,children:[(0,r.jsx)("label",{className:h().formLabel,children:"Profundidad (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:I.depth||"",onChange:e=>S("depth",e.target.value),className:E.some(e=>e.includes("profundidad")||e.includes("Profundidad"))?"".concat(h().formInput," ").concat(h().formInputError):h().formInput,required:!0})]})]}),E.length>0&&(0,r.jsxs)("div",{className:h().alert+" "+h().alertError,children:[(0,r.jsx)("strong",{children:"Errores en las dimensiones:"}),(0,r.jsx)("ul",{style:{margin:"10px 0 0 20px"},children:E.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),B&&0===E.length&&(0,r.jsxs)("div",{className:h().depositWarning,children:["⚠️ Este producto requiere un dep\xf3sito de garant\xeda porque excede las dimensiones m\xe1ximas permitidas (15\xd715\xd715 cm).",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"Dep\xf3sito requerido:"})," S/. ",I.value.toFixed(2)]}),!B&&I.height>0&&I.width>0&&I.depth>0&&(0,r.jsx)("div",{className:h().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,r.jsxs)("div",{className:h().buttonGroup,children:[(0,r.jsx)("button",{type:"submit",className:h().primaryButton,disabled:x,children:x?"Creando producto...":"Crear producto"}),(0,r.jsx)("button",{type:"button",className:h().secondaryButton,onClick:()=>e.push("/panel/productos"),children:"Cancelar"})]})]})]})]})]})]})})}},2379:function(e,t,a){"use strict";a.d(t,{_:function(){return l}});var r,o,i=a(6534),s=a(6532);(r=o||(o={})).ACTIVE="active",r.INACTIVE="inactive",r.ARCHIVED="archived";let d=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,n=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||o.INACTIVE,createdAt:d(t.createdAt),updatedAt:d(t.updatedAt)}},c={async getProductsByShop(e){try{let t=(0,i.collection)(s.db,"products"),a=(0,i.query)(t,(0,i.where)("shopId","==",e),(0,i.where)("status","==",o.ACTIVE));return(await (0,i.getDocs)(a)).docs.map(e=>n(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,i.getDoc)((0,i.doc)(s.db,"products",e));if(!t.exists())throw Error("Product not found");return n(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,i.collection)(s.db,"products"),t=(0,i.query)(e,(0,i.where)("status","==",o.ACTIVE));return(await (0,i.getDocs)(t)).docs.map(e=>n(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,i.collection)(s.db,"products"),a={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:o.ACTIVE,createdAt:(0,i.serverTimestamp)(),updatedAt:(0,i.serverTimestamp)()},r=await (0,i.ET)(t,a),d=await (0,i.getDoc)(r);if(!d.exists())throw Error("Error al crear el producto");return n(d)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let a=(0,i.doc)(s.db,"products",e),r={updatedAt:(0,i.serverTimestamp)()};if(void 0!==t.name&&(r.name=t.name),void 0!==t.description&&(r.description=t.description),void 0!==t.value&&(r.value=t.value),void 0!==t.height&&(r.height=t.height),void 0!==t.width&&(r.width=t.width),void 0!==t.depth&&(r.depth=t.depth),void 0!==t.category&&(r.category=t.category),void 0!==t.mainImage&&(r.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,i.getDoc)(a);if(e.exists()){let a=e.data(),o=void 0!==t.height?t.height:a.height,i=void 0!==t.width?t.width:a.width,s=void 0!==t.depth?t.depth:a.depth;r.requiresDeposit=o>15||i>15||s>15}}await (0,i.updateDoc)(a,r);let o=await (0,i.getDoc)(a);if(!o.exists())throw Error("Producto no encontrado");return n(o)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,i.doc)(s.db,"products",e);await (0,i.updateDoc)(t,{status:o.INACTIVE,updatedAt:(0,i.serverTimestamp)()});let a=await (0,i.getDoc)(t);if(!a.exists())throw Error("Producto no encontrado");return n(a)}catch(e){throw console.error("Error deactivating product:",e),e}}},l={getProductsByShop:async e=>c.getProductsByShop(e),getActiveProductsByShop:async e=>c.getActiveProductsByShop(e),getProductById:async e=>c.getProductById(e),getAllProducts:async()=>c.getAllProducts(),createProduct:async e=>c.createProduct(e),updateProduct:async(e,t)=>c.updateProduct(e,t),deactivateProduct:async e=>c.deactivateProduct(e)}},9298:function(e,t,a){"use strict";a.d(t,{T:function(){return o}});var r=a(3404);let o={async uploadProductImage(e){let t=new FormData;return t.append("image",e),(await r.x.post("/uploads/products/image",t,{headers:{"Content-Type":"multipart/form-data"}})).data.fileUrl},async deleteImage(e){await r.x.delete("/uploads/products/image/".concat(e))}}}},function(e){e.O(0,[6438,2907,4183,1044,2489,8641,4755,4542,4446,7115,2364,1744],function(){return e(e.s=4880)}),_N_E=e.O()}]);