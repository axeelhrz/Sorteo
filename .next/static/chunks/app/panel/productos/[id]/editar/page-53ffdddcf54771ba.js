(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5026],{4958:function(e,a,t){Promise.resolve().then(t.bind(t,861))},861:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return h}});var r=t(7821),n=t(8078),l=t(8504),s=t(7197),o=t(6289),i=t(4767),c=t(6042),d=t(692),u=t(1850),p=t(6066),m=t(192),_=t.n(m);function h(){let e=(0,l.useRouter)(),a=(0,l.useParams)().id,{user:t,isAuthenticated:m}=(0,s.t)(),[h,f]=(0,n.useState)(null),[g,v]=(0,n.useState)(null),[x,y]=(0,n.useState)(!1),[j,N]=(0,n.useState)(!0),[b,S]=(0,n.useState)(null),[I,C]=(0,n.useState)({}),[D,L]=(0,n.useState)([]);(0,n.useEffect)(()=>{m&&t&&a&&P()},[m,t,a]);let P=async()=>{N(!0);try{let[e,t]=await Promise.all([i.m.getMyShop(),c._.getProductById(a)]);if(f(e),v(t),t.shopId!==e.id){S("Este producto no pertenece a tu tienda");return}C({name:t.name,description:t.description,value:t.value,height:t.height,width:t.width,depth:t.depth,category:t.category,mainImage:t.mainImage})}catch(a){var e,t;S((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar los datos")}finally{N(!1)}},k=(e,a,t)=>{let r=[];return e<=0&&r.push("La altura debe ser mayor a 0"),a<=0&&r.push("El ancho debe ser mayor a 0"),t<=0&&r.push("La profundidad debe ser mayor a 0"),e>15&&r.push("La altura no puede exceder ".concat(15,"cm")),a>15&&r.push("El ancho no puede exceder ".concat(15,"cm")),t>15&&r.push("La profundidad no puede exceder ".concat(15,"cm")),r},w=(e,a)=>{let t=parseFloat(a)||0;C(a=>({...a,[e]:t})),L(k("height"===e?t:I.height||(null==g?void 0:g.height)||0,"width"===e?t:I.width||(null==g?void 0:g.width)||0,"depth"===e?t:I.depth||(null==g?void 0:g.depth)||0))},E=async t=>{t.preventDefault(),S(null);let r=k(I.height||(null==g?void 0:g.height)||0,I.width||(null==g?void 0:g.width)||0,I.depth||(null==g?void 0:g.depth)||0);if(r.length>0){L(r),S("Por favor corrige los errores en las dimensiones");return}y(!0);try{await c._.updateProduct(a,I),e.push("/panel/productos")}catch(e){var n,l;S((null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||"Error al actualizar el producto")}finally{y(!1)}},G=async()=>{if(confirm("\xbfEst\xe1s seguro de que deseas eliminar este producto? Esta acci\xf3n no se puede deshacer.")){y(!0);try{await c._.deactivateProduct(a),e.push("/panel/productos")}catch(e){var t,r;S((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"Error al eliminar el producto"),y(!1)}}},F=void 0!==I.height?I.height:(null==g?void 0:g.height)||0,T=void 0!==I.width?I.width:(null==g?void 0:g.width)||0,B=void 0!==I.depth?I.depth:(null==g?void 0:g.depth)||0,A=void 0!==I.value?I.value:(null==g?void 0:g.value)||0,H=F>15||T>15||B>15;return j?(0,r.jsx)(p.i,{requiredRole:o.i.SHOP,children:(0,r.jsxs)("div",{className:_().panelContainer,children:[(0,r.jsx)(u.G,{}),(0,r.jsx)("main",{className:_().mainContent,children:(0,r.jsx)("div",{className:_().alert,children:"Cargando datos..."})})]})}):g&&h?(0,r.jsx)(p.i,{requiredRole:o.i.SHOP,children:(0,r.jsxs)("div",{className:_().panelContainer,children:[(0,r.jsx)(u.G,{isBlocked:(null==h?void 0:h.status)==="blocked"}),(0,r.jsxs)("main",{className:_().mainContent,children:[b&&(0,r.jsxs)("div",{className:"".concat(_().alert," ").concat(_().alertError),children:[b,(0,r.jsx)("button",{onClick:P,className:_().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),(0,r.jsx)(d.N,{shop:h}),(0,r.jsxs)("div",{className:_().raffleDetail,children:[(0,r.jsx)("h1",{className:_().raffleDetailTitle,children:"Editar producto"}),(0,r.jsxs)("form",{onSubmit:E,className:_().raffleForm,children:[(0,r.jsxs)("div",{className:_().raffleFormSection,children:[(0,r.jsx)("h2",{className:_().raffleFormSectionTitle,children:"Informaci\xf3n b\xe1sica"}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsxs)("label",{className:_().formLabel,children:["Nombre del producto ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("input",{type:"text",value:I.name||g.name,onChange:e=>C(a=>({...a,name:e.target.value})),className:_().formInput,required:!0})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsxs)("label",{className:_().formLabel,children:["Descripci\xf3n ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("textarea",{value:I.description||g.description,onChange:e=>C(a=>({...a,description:e.target.value})),className:_().formTextarea,required:!0,rows:4})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsxs)("label",{className:_().formLabel,children:["Valor del producto (S/.) ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:void 0!==I.value?I.value:g.value,onChange:e=>C(a=>({...a,value:parseFloat(e.target.value)||0})),className:_().formInput,required:!0})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"Categor\xeda (opcional)"}),(0,r.jsx)("input",{type:"text",value:void 0!==I.category?I.category:g.category||"",onChange:e=>C(a=>({...a,category:e.target.value})),className:_().formInput})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"URL de imagen principal (opcional)"}),(0,r.jsx)("input",{type:"url",value:void 0!==I.mainImage?I.mainImage:g.mainImage||"",onChange:e=>C(a=>({...a,mainImage:e.target.value})),className:_().formInput})]})]}),(0,r.jsxs)("div",{className:_().raffleFormSection,children:[(0,r.jsxs)("h2",{className:_().raffleFormSectionTitle,children:["Dimensiones (en cent\xedmetros) ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("p",{className:_().formHelpText,children:"M\xe1ximo permitido: 15cm por cada dimensi\xf3n. Si alguna dimensi\xf3n excede este l\xedmite, se requerir\xe1 un dep\xf3sito de garant\xeda."}),(0,r.jsxs)("div",{className:_().dimensionsGrid,children:[(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"Altura (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:F,onChange:e=>w("height",e.target.value),className:D.some(e=>e.includes("altura")||e.includes("Alto"))?"".concat(_().formInput," ").concat(_().formInputError):_().formInput,required:!0})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"Ancho (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:T,onChange:e=>w("width",e.target.value),className:D.some(e=>e.includes("ancho")||e.includes("Ancho"))?"".concat(_().formInput," ").concat(_().formInputError):_().formInput,required:!0})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"Profundidad (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:B,onChange:e=>w("depth",e.target.value),className:D.some(e=>e.includes("profundidad")||e.includes("Profundidad"))?"".concat(_().formInput," ").concat(_().formInputError):_().formInput,required:!0})]})]}),D.length>0&&(0,r.jsxs)("div",{className:_().alert+" "+_().alertError,children:[(0,r.jsx)("strong",{children:"Errores en las dimensiones:"}),(0,r.jsx)("ul",{style:{margin:"10px 0 0 20px"},children:D.map((e,a)=>(0,r.jsx)("li",{children:e},a))})]}),H&&0===D.length&&(0,r.jsxs)("div",{className:_().depositWarning,children:["⚠️ Este producto requiere un dep\xf3sito de garant\xeda porque excede las dimensiones m\xe1ximas permitidas (15\xd715\xd715 cm).",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"Dep\xf3sito requerido:"})," S/. ",A.toFixed(2)]}),!H&&F>0&&T>0&&B>0&&(0,r.jsx)("div",{className:_().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,r.jsxs)("div",{className:_().raffleFormSection,children:[(0,r.jsx)("h2",{className:_().raffleFormSectionTitle,children:"Estado actual"}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"Estado"}),(0,r.jsx)("div",{className:_().statusBadge,style:{display:"inline-block",marginTop:"10px"},children:g.status})]}),(0,r.jsxs)("div",{className:_().formGroup,children:[(0,r.jsx)("label",{className:_().formLabel,children:"Requiere dep\xf3sito"}),(0,r.jsx)("div",{style:{marginTop:"10px"},children:g.requiresDeposit?"✓ S\xed":"✗ No"})]})]}),(0,r.jsxs)("div",{className:_().buttonGroup,children:[(0,r.jsx)("button",{type:"submit",className:_().primaryButton,disabled:x,children:x?"Guardando cambios...":"Guardar cambios"}),(0,r.jsx)("button",{type:"button",className:_().secondaryButton,onClick:()=>e.push("/panel/productos"),children:"Cancelar"}),(0,r.jsx)("button",{type:"button",className:_().dangerButton,onClick:G,disabled:x,style:{marginLeft:"auto"},children:"Eliminar producto"})]})]})]})]})]})}):(0,r.jsx)(p.i,{requiredRole:o.i.SHOP,children:(0,r.jsxs)("div",{className:_().panelContainer,children:[(0,r.jsx)(u.G,{}),(0,r.jsx)("main",{className:_().mainContent,children:(0,r.jsx)("div",{className:"".concat(_().alert," ").concat(_().alertError),children:b||"Producto no encontrado"})})]})})}},6066:function(e,a,t){"use strict";t.d(a,{i:function(){return o}});var r=t(7821),n=t(8078),l=t(8504),s=t(7197);function o(e){let{children:a,requiredRole:t}=e,o=(0,l.useRouter)(),{user:i,isAuthenticated:c}=(0,s.t)();return((0,n.useEffect)(()=>{if(!c||!i){o.push("/login");return}if(t&&i.role!==t){o.push("/");return}},[c,i,t,o]),c&&i)?t&&i.role!==t?(0,r.jsx)("div",{children:"No tienes permiso para acceder a esta p\xe1gina"}):(0,r.jsx)(r.Fragment,{children:a}):(0,r.jsx)("div",{children:"Cargando..."})}},692:function(e,a,t){"use strict";t.d(a,{N:function(){return s}});var r=t(7821),n=t(192),l=t.n(n);function s(e){let{shop:a}=e;return(0,r.jsx)("div",{className:l().shopHeader,children:(0,r.jsxs)("div",{className:l().shopHeaderContent,children:[a.logo&&(0,r.jsx)("img",{src:a.logo,alt:a.name,className:l().shopLogo}),(0,r.jsxs)("div",{className:l().shopHeaderInfo,children:[(0,r.jsx)("h1",{className:l().shopName,children:a.name}),(0,r.jsx)("p",{className:l().shopDescription,children:a.description})]})]})})}},1850:function(e,a,t){"use strict";t.d(a,{G:function(){return i}});var r=t(7821),n=t(4542),l=t(8504),s=t(192),o=t.n(s);function i(e){let{isBlocked:a=!1}=e,t=(0,l.usePathname)();return(0,r.jsx)("aside",{className:o().sidebar,children:(0,r.jsxs)("nav",{className:o().sidebarNav,children:[(0,r.jsx)(n.default,{href:"/panel/tienda",className:"".concat(o().navLink," ").concat("/panel/tienda"===t?o().active:""),children:"\uD83D\uDCCB Mi tienda"}),(0,r.jsx)(n.default,{href:"/panel/productos",className:"".concat(o().navLink," ").concat("/panel/productos"===t?o().active:""),children:"\uD83D\uDCE6 Mis productos"}),(0,r.jsx)(n.default,{href:"/panel/sorteos",className:"".concat(o().navLink," ").concat("/panel/sorteos"===t?o().active:""),children:"\uD83C\uDFB2 Mis sorteos"}),!a&&(0,r.jsx)(n.default,{href:"/panel/sorteos/crear",className:"".concat(o().navLink," ").concat("/panel/sorteos/crear"===t?o().active:""),children:"➕ Crear sorteo"})]})})}},3404:function(e,a,t){"use strict";t.d(a,{x:function(){return s}});var r=t(7147),n=t(9190);class l{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,a){return this.client.get(e,a)}async post(e,a,t){return this.client.post(e,a,t)}async put(e,a){return this.client.put(e,a)}async delete(e){return this.client.delete(e)}constructor(){(0,r._)(this,"client",void 0),this.client=n.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let a=localStorage.getItem("token");console.log("API Request - Token from localStorage:",a),a?(e.headers.Authorization="Bearer ".concat(a),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let s=new l},6042:function(e,a,t){"use strict";t.d(a,{_:function(){return n}});var r=t(3404);let n={getProductsByShop:async e=>(await r.x.get("/products?shopId=".concat(e))).data,getActiveProductsByShop:async e=>(await r.x.get("/products/shop/".concat(e,"/active"))).data,getProductById:async e=>(await r.x.get("/products/".concat(e))).data,createProduct:async e=>(await r.x.post("/products",e)).data,updateProduct:async(e,a)=>(await r.x.put("/products/".concat(e),a)).data,deactivateProduct:async e=>(await r.x.put("/products/".concat(e,"/deactivate"),{})).data,getAllProducts:async()=>(await r.x.get("/products")).data}},4767:function(e,a,t){"use strict";t.d(a,{m:function(){return n}});var r=t(3404);let n={getMyShop:async()=>(await r.x.get("/shops/my-shop/current")).data,getShopById:async e=>(await r.x.get("/shops/".concat(e))).data,updateShop:async(e,a)=>(await r.x.put("/shops/".concat(e),a)).data,getAllShops:async()=>(await r.x.get("/shops")).data,getVerifiedShops:async()=>(await r.x.get("/shops/verified")).data,getShopStatistics:async e=>(await r.x.get("/shops/".concat(e,"/statistics"))).data}},7197:function(e,a,t){"use strict";t.d(a,{t:function(){return l}});var r=t(3020),n=t(4302);let l=(0,r.Ue)()((0,n.tJ)(e=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:a=>e({user:a,isAuthenticated:!!a}),setToken:a=>{a?localStorage.setItem("token",a):localStorage.removeItem("token"),e({token:a})},setIsLoading:a=>e({isLoading:a}),setError:a=>e({error:a}),logout:()=>{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6289:function(e,a,t){"use strict";var r,n;t.d(a,{i:function(){return r}}),(n=r||(r={})).ADMIN="admin",n.SHOP="shop",n.USER="user"},192:function(e){e.exports={panelContainer:"panel_panelContainer__Kt8Ty",sidebar:"panel_sidebar__KeScH",sidebarNav:"panel_sidebarNav__KjeNV",navLink:"panel_navLink__sQoV6",active:"panel_active___ehGn",mainContent:"panel_mainContent__7V2fv",shopHeader:"panel_shopHeader__iRrDp",shopHeaderContent:"panel_shopHeaderContent__wsZnH",shopLogo:"panel_shopLogo__gTusz",shopHeaderInfo:"panel_shopHeaderInfo__IKOo3",shopName:"panel_shopName__lr5MU",shopDescription:"panel_shopDescription__zNvIE",statusBadge:"panel_statusBadge__37f3q",formGroup:"panel_formGroup__0UyVN",formLabel:"panel_formLabel___zOHD",formInput:"panel_formInput__bLzwR",formTextarea:"panel_formTextarea__B2MkI",formSelect:"panel_formSelect__thum_",primaryButton:"panel_primaryButton__ArDHW",secondaryButton:"panel_secondaryButton__KSKVI",dangerButton:"panel_dangerButton__2WLFi",buttonGroup:"panel_buttonGroup__pcyfD",card:"panel_card__ttDyJ",cardHeader:"panel_cardHeader__scyyA",cardTitle:"panel_cardTitle__K6V__",cardActions:"panel_cardActions___eqre",cardAction:"panel_cardAction__xpZWN",cardActionPrimary:"panel_cardActionPrimary__t_VOi",cardActionSecondary:"panel_cardActionSecondary__gcgLm",table:"panel_table__GBWH_",tableHeader:"panel_tableHeader__TN7va",tableHeaderCell:"panel_tableHeaderCell__WZypp",tableRow:"panel_tableRow__oR22e",tableCell:"panel_tableCell__GdQvd",tableCellCenter:"panel_tableCellCenter__Gc4za",tableCellRight:"panel_tableCellRight__jl067",emptyState:"panel_emptyState__1c4lK",emptyStateIcon:"panel_emptyStateIcon__znkGr",emptyStateTitle:"panel_emptyStateTitle__OpZSI",emptyStateDescription:"panel_emptyStateDescription__P3sK_",alert:"panel_alert__dbKCy",alertSuccess:"panel_alertSuccess__T39ZR",alertError:"panel_alertError__9DFT4",alertWarning:"panel_alertWarning__sOPwe",alertInfo:"panel_alertInfo__PLXx9",progressBar:"panel_progressBar__Ik7pm",progressBarFill:"panel_progressBarFill__NCwij",profileForm:"panel_profileForm__VbWs3",profileFormSection:"panel_profileFormSection__t80bQ",profileFormSectionTitle:"panel_profileFormSectionTitle__o8RW2",readOnlyField:"panel_readOnlyField___M4rQ",raffleForm:"panel_raffleForm__s3ll7",raffleFormSection:"panel_raffleFormSection__PUcJc",raffleFormSectionTitle:"panel_raffleFormSectionTitle__1DglO",dimensionsGrid:"panel_dimensionsGrid__7jafN",dimensionInfo:"panel_dimensionInfo__bjc2e",dimensionLabel:"panel_dimensionLabel__FAjKe",dimensionValue:"panel_dimensionValue__Jm7tM",depositWarning:"panel_depositWarning__mU2qE",ticketCalculation:"panel_ticketCalculation___d694",ticketCalculationValue:"panel_ticketCalculationValue__KOcl_",raffleDetail:"panel_raffleDetail__nigCY",raffleDetailHeader:"panel_raffleDetailHeader__xcVaX",raffleDetailTitle:"panel_raffleDetailTitle___LWvI",raffleDetailStatus:"panel_raffleDetailStatus__GBSlq",raffleDetailSection:"panel_raffleDetailSection__Y6dGR",raffleDetailSectionTitle:"panel_raffleDetailSectionTitle__6HXue",raffleDetailGrid:"panel_raffleDetailGrid__U8h9R",raffleDetailItem:"panel_raffleDetailItem__frOK2",raffleDetailItemLabel:"panel_raffleDetailItemLabel__PLUUN",raffleDetailItemValue:"panel_raffleDetailItemValue__mVKfw",ticketProgress:"panel_ticketProgress__9PZKW",ticketProgressLabel:"panel_ticketProgressLabel__fBS77",ticketProgressPercentage:"panel_ticketProgressPercentage__nBOhy",statCard:"panel_statCard__Dx3Sz",statCardIcon:"panel_statCardIcon__zp227",statCardValue:"panel_statCardValue__RWvG6",statCardLabel:"panel_statCardLabel__wRjrF",formHelpText:"panel_formHelpText__IpKar",formInputError:"panel_formInputError__oPd_O"}}},function(e){e.O(0,[6438,2489,4755,4542,7115,2364,1744],function(){return e(e.s=4958)}),_N_E=e.O()}]);