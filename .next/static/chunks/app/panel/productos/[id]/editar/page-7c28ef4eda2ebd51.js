(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5026],{4958:function(e,t,a){Promise.resolve().then(a.bind(a,861))},861:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(7821),o=a(8078),s=a(8504),i=a(7197),n=a(6289),c=a(9422),d=a(2379),l=a(692),u=a(1850),h=a(6066),p=a(192),m=a.n(p);function g(){let e=(0,s.useRouter)(),t=(0,s.useParams)().id,{user:a,isAuthenticated:p}=(0,i.t)(),[g,v]=(0,o.useState)(null),[f,x]=(0,o.useState)(null),[y,j]=(0,o.useState)(!1),[N,w]=(0,o.useState)(!0),[b,I]=(0,o.useState)(null),[E,S]=(0,o.useState)({}),[P,D]=(0,o.useState)([]);(0,o.useEffect)(()=>{p&&a&&t&&A()},[p,a,t]);let A=async()=>{w(!0);try{let[e,a]=await Promise.all([c.m.getMyShop(),d._.getProductById(t)]);if(v(e),x(a),a.shopId!==e.id){I("Este producto no pertenece a tu tienda");return}S({name:a.name,description:a.description,value:a.value,height:a.height,width:a.width,depth:a.depth,category:a.category,mainImage:a.mainImage})}catch(t){var e,a;I((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar los datos")}finally{w(!1)}},C=(e,t,a)=>{let r=[];return e<=0&&r.push("La altura debe ser mayor a 0"),t<=0&&r.push("El ancho debe ser mayor a 0"),a<=0&&r.push("La profundidad debe ser mayor a 0"),e>15&&r.push("La altura no puede exceder ".concat(15,"cm")),t>15&&r.push("El ancho no puede exceder ".concat(15,"cm")),a>15&&r.push("La profundidad no puede exceder ".concat(15,"cm")),r},q=(e,t)=>{let a=parseFloat(t)||0;S(t=>({...t,[e]:a})),D(C("height"===e?a:E.height||(null==f?void 0:f.height)||0,"width"===e?a:E.width||(null==f?void 0:f.width)||0,"depth"===e?a:E.depth||(null==f?void 0:f.depth)||0))},T=async a=>{a.preventDefault(),I(null);let r=C(E.height||(null==f?void 0:f.height)||0,E.width||(null==f?void 0:f.width)||0,E.depth||(null==f?void 0:f.depth)||0);if(r.length>0){D(r),I("Por favor corrige los errores en las dimensiones");return}j(!0);try{await d._.updateProduct(t,E),e.push("/panel/productos")}catch(e){var o,s;I((null===(s=e.response)||void 0===s?void 0:null===(o=s.data)||void 0===o?void 0:o.message)||"Error al actualizar el producto")}finally{j(!1)}},B=async()=>{if(confirm("\xbfEst\xe1s seguro de que deseas eliminar este producto? Esta acci\xf3n no se puede deshacer.")){j(!0);try{await d._.deactivateProduct(t),e.push("/panel/productos")}catch(e){var a,r;I((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Error al eliminar el producto"),j(!1)}}},G=void 0!==E.height?E.height:(null==f?void 0:f.height)||0,L=void 0!==E.width?E.width:(null==f?void 0:f.width)||0,V=void 0!==E.depth?E.depth:(null==f?void 0:f.depth)||0,R=void 0!==E.value?E.value:(null==f?void 0:f.value)||0,k=G>15||L>15||V>15;return N?(0,r.jsx)(h.i,{requiredRole:n.i.SHOP,children:(0,r.jsxs)("div",{className:m().panelContainer,children:[(0,r.jsx)(u.G,{}),(0,r.jsx)("main",{className:m().mainContent,children:(0,r.jsx)("div",{className:m().alert,children:"Cargando datos..."})})]})}):f&&g?(0,r.jsx)(h.i,{requiredRole:n.i.SHOP,children:(0,r.jsxs)("div",{className:m().panelContainer,children:[(0,r.jsx)(u.G,{isBlocked:(null==g?void 0:g.status)==="blocked"}),(0,r.jsxs)("main",{className:m().mainContent,children:[b&&(0,r.jsxs)("div",{className:"".concat(m().alert," ").concat(m().alertError),children:[b,(0,r.jsx)("button",{onClick:A,className:m().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),(0,r.jsx)(l.N,{shop:g}),(0,r.jsxs)("div",{className:m().raffleDetail,children:[(0,r.jsx)("h1",{className:m().raffleDetailTitle,children:"Editar producto"}),(0,r.jsxs)("form",{onSubmit:T,className:m().raffleForm,children:[(0,r.jsxs)("div",{className:m().raffleFormSection,children:[(0,r.jsx)("h2",{className:m().raffleFormSectionTitle,children:"Informaci\xf3n b\xe1sica"}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsxs)("label",{className:m().formLabel,children:["Nombre del producto ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("input",{type:"text",value:E.name||f.name,onChange:e=>S(t=>({...t,name:e.target.value})),className:m().formInput,required:!0})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsxs)("label",{className:m().formLabel,children:["Descripci\xf3n ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("textarea",{value:E.description||f.description,onChange:e=>S(t=>({...t,description:e.target.value})),className:m().formTextarea,required:!0,rows:4})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsxs)("label",{className:m().formLabel,children:["Valor del producto (S/.) ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:void 0!==E.value?E.value:f.value,onChange:e=>S(t=>({...t,value:parseFloat(e.target.value)||0})),className:m().formInput,required:!0})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"Categor\xeda (opcional)"}),(0,r.jsx)("input",{type:"text",value:void 0!==E.category?E.category:f.category||"",onChange:e=>S(t=>({...t,category:e.target.value})),className:m().formInput})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"URL de imagen principal (opcional)"}),(0,r.jsx)("input",{type:"url",value:void 0!==E.mainImage?E.mainImage:f.mainImage||"",onChange:e=>S(t=>({...t,mainImage:e.target.value})),className:m().formInput})]})]}),(0,r.jsxs)("div",{className:m().raffleFormSection,children:[(0,r.jsxs)("h2",{className:m().raffleFormSectionTitle,children:["Dimensiones (en cent\xedmetros) ",(0,r.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,r.jsx)("p",{className:m().formHelpText,children:"M\xe1ximo permitido: 15cm por cada dimensi\xf3n. Si alguna dimensi\xf3n excede este l\xedmite, se requerir\xe1 un dep\xf3sito de garant\xeda."}),(0,r.jsxs)("div",{className:m().dimensionsGrid,children:[(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"Altura (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:G,onChange:e=>q("height",e.target.value),className:P.some(e=>e.includes("altura")||e.includes("Alto"))?"".concat(m().formInput," ").concat(m().formInputError):m().formInput,required:!0})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"Ancho (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:L,onChange:e=>q("width",e.target.value),className:P.some(e=>e.includes("ancho")||e.includes("Ancho"))?"".concat(m().formInput," ").concat(m().formInputError):m().formInput,required:!0})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"Profundidad (cm)"}),(0,r.jsx)("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:V,onChange:e=>q("depth",e.target.value),className:P.some(e=>e.includes("profundidad")||e.includes("Profundidad"))?"".concat(m().formInput," ").concat(m().formInputError):m().formInput,required:!0})]})]}),P.length>0&&(0,r.jsxs)("div",{className:m().alert+" "+m().alertError,children:[(0,r.jsx)("strong",{children:"Errores en las dimensiones:"}),(0,r.jsx)("ul",{style:{margin:"10px 0 0 20px"},children:P.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),k&&0===P.length&&(0,r.jsxs)("div",{className:m().depositWarning,children:["⚠️ Este producto requiere un dep\xf3sito de garant\xeda porque excede las dimensiones m\xe1ximas permitidas (15\xd715\xd715 cm).",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"Dep\xf3sito requerido:"})," S/. ",R.toFixed(2)]}),!k&&G>0&&L>0&&V>0&&(0,r.jsx)("div",{className:m().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,r.jsxs)("div",{className:m().raffleFormSection,children:[(0,r.jsx)("h2",{className:m().raffleFormSectionTitle,children:"Estado actual"}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"Estado"}),(0,r.jsx)("div",{className:m().statusBadge,style:{display:"inline-block",marginTop:"10px"},children:f.status})]}),(0,r.jsxs)("div",{className:m().formGroup,children:[(0,r.jsx)("label",{className:m().formLabel,children:"Requiere dep\xf3sito"}),(0,r.jsx)("div",{style:{marginTop:"10px"},children:f.requiresDeposit?"✓ S\xed":"✗ No"})]})]}),(0,r.jsxs)("div",{className:m().buttonGroup,children:[(0,r.jsx)("button",{type:"submit",className:m().primaryButton,disabled:y,children:y?"Guardando cambios...":"Guardar cambios"}),(0,r.jsx)("button",{type:"button",className:m().secondaryButton,onClick:()=>e.push("/panel/productos"),children:"Cancelar"}),(0,r.jsx)("button",{type:"button",className:m().dangerButton,onClick:B,disabled:y,style:{marginLeft:"auto"},children:"Eliminar producto"})]})]})]})]})]})}):(0,r.jsx)(h.i,{requiredRole:n.i.SHOP,children:(0,r.jsxs)("div",{className:m().panelContainer,children:[(0,r.jsx)(u.G,{}),(0,r.jsx)("main",{className:m().mainContent,children:(0,r.jsx)("div",{className:"".concat(m().alert," ").concat(m().alertError),children:b||"Producto no encontrado"})})]})})}},2379:function(e,t,a){"use strict";a.d(t,{_:function(){return l}});var r,o,s=a(6534),i=a(6532);(r=o||(o={})).ACTIVE="active",r.INACTIVE="inactive",r.ARCHIVED="archived";let n=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,c=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||o.INACTIVE,createdAt:n(t.createdAt),updatedAt:n(t.updatedAt)}},d={async getProductsByShop(e){try{let t=(0,s.collection)(i.db,"products"),a=(0,s.query)(t,(0,s.where)("shopId","==",e),(0,s.where)("status","==",o.ACTIVE));return(await (0,s.getDocs)(a)).docs.map(e=>c(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,s.getDoc)((0,s.doc)(i.db,"products",e));if(!t.exists())throw Error("Product not found");return c(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,s.collection)(i.db,"products"),t=(0,s.query)(e,(0,s.where)("status","==",o.ACTIVE));return(await (0,s.getDocs)(t)).docs.map(e=>c(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,s.collection)(i.db,"products"),a={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:o.ACTIVE,createdAt:(0,s.serverTimestamp)(),updatedAt:(0,s.serverTimestamp)()},r=await (0,s.ET)(t,a),n=await (0,s.getDoc)(r);if(!n.exists())throw Error("Error al crear el producto");return c(n)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let a=(0,s.doc)(i.db,"products",e),r={updatedAt:(0,s.serverTimestamp)()};if(void 0!==t.name&&(r.name=t.name),void 0!==t.description&&(r.description=t.description),void 0!==t.value&&(r.value=t.value),void 0!==t.height&&(r.height=t.height),void 0!==t.width&&(r.width=t.width),void 0!==t.depth&&(r.depth=t.depth),void 0!==t.category&&(r.category=t.category),void 0!==t.mainImage&&(r.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,s.getDoc)(a);if(e.exists()){let a=e.data(),o=void 0!==t.height?t.height:a.height,s=void 0!==t.width?t.width:a.width,i=void 0!==t.depth?t.depth:a.depth;r.requiresDeposit=o>15||s>15||i>15}}await (0,s.updateDoc)(a,r);let o=await (0,s.getDoc)(a);if(!o.exists())throw Error("Producto no encontrado");return c(o)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,s.doc)(i.db,"products",e);await (0,s.updateDoc)(t,{status:o.INACTIVE,updatedAt:(0,s.serverTimestamp)()});let a=await (0,s.getDoc)(t);if(!a.exists())throw Error("Producto no encontrado");return c(a)}catch(e){throw console.error("Error deactivating product:",e),e}}},l={getProductsByShop:async e=>d.getProductsByShop(e),getActiveProductsByShop:async e=>d.getActiveProductsByShop(e),getProductById:async e=>d.getProductById(e),getAllProducts:async()=>d.getAllProducts(),createProduct:async e=>d.createProduct(e),updateProduct:async(e,t)=>d.updateProduct(e,t),deactivateProduct:async e=>d.deactivateProduct(e)}},9422:function(e,t,a){"use strict";a.d(t,{m:function(){return l}});var r=a(3404),o=a(6534),s=a(6532),i=a(9283);let n=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,c=e=>{let t=e.data();return{id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||i.R.PENDING,createdAt:n(t.createdAt),updatedAt:n(t.updatedAt)}},d={async getShopById(e){try{let t=await (0,o.getDoc)((0,o.doc)(s.db,"shops",e));if(!t.exists())throw Error("Shop not found");return c(t)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,o.collection)(s.db,"shops"),t=(0,o.query)(e,(0,o.where)("status","==",i.R.VERIFIED));return(await (0,o.getDocs)(t)).docs.map(e=>c(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,o.collection)(s.db,"shops");return(await (0,o.getDocs)(e)).docs.map(e=>c(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},l={getShopById:async e=>d.getShopById(e),getAllShops:async()=>d.getAllShops(),getVerifiedShops:async()=>d.getVerifiedShops(),getMyShop:async()=>(await r.x.get("/shops/my-shop/current")).data,updateShop:async(e,t)=>(await r.x.put("/shops/".concat(e),t)).data,getShopStatistics:async e=>(await r.x.get("/shops/".concat(e,"/statistics"))).data}},9283:function(e,t,a){"use strict";var r,o;a.d(t,{R:function(){return r}}),(o=r||(r={})).PENDING="pending",o.VERIFIED="verified",o.BLOCKED="blocked"}},function(e){e.O(0,[6438,2907,4183,1044,2489,8641,4755,4542,4446,7115,2364,1744],function(){return e(e.s=4958)}),_N_E=e.O()}]);