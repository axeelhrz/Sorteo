(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7408],{289:function(e,a,s){Promise.resolve().then(s.bind(s,1401))},1401:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return m}});var t=s(7821),l=s(8078),d=s(7197),i=s(6289),r=s(9422),n=s(3404),o=s(692),c=s(1850),h=s(6066),u=s(192),x=s.n(u);function m(){let{user:e,isAuthenticated:a}=(0,d.t)(),[s,u]=(0,l.useState)(null),[m,p]=(0,l.useState)(!0),[j,v]=(0,l.useState)([]),[g,N]=(0,l.useState)(null),[y,f]=(0,l.useState)(null),[C,b]=(0,l.useState)("all");(0,l.useEffect)(()=>{a&&e&&S()},[a,e]),(0,l.useEffect)(()=>{s&&D()},[s,C]);let S=async()=>{try{let e=await r.m.getMyShop();u(e)}catch(s){var e,a;f((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar la tienda"),p(!1)}},D=async()=>{try{let e;p(!0),e="all"===C?await n.x.get("/deposits"):await n.x.get("/deposits/by-status/".concat(C)),v(e.data||[]);let a=await n.x.get("/deposits/stats/overview");N(a.data),f(null)}catch(s){var e,a;f((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar dep\xf3sitos")}finally{p(!1)}},E=e=>({pending:"#FFA500",held:"#F44336",released:"#4CAF50",executed:"#2196F3"})[e]||"#757575",w=e=>({pending:"Pendiente",held:"Retenido",released:"Liberado",executed:"Ejecutado"})[e]||e;return(0,t.jsx)(h.i,{requiredRole:i.i.SHOP,children:(0,t.jsxs)("div",{className:x().panelContainer,children:[(0,t.jsx)(c.G,{isBlocked:(null==s?void 0:s.status)==="blocked"}),(0,t.jsxs)("main",{className:x().mainContent,children:[m&&(0,t.jsx)("div",{className:x().alert,children:"Cargando..."}),y&&(0,t.jsxs)("div",{className:"".concat(x().alert," ").concat(x().alertError),children:[y,(0,t.jsx)("button",{onClick:D,className:x().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.N,{shop:s}),(0,t.jsxs)("div",{className:x().raffleDetail,children:[(0,t.jsx)("h1",{className:x().raffleDetailTitle,children:"Gesti\xf3n de Dep\xf3sitos de Garant\xeda"}),(0,t.jsx)("p",{style:{color:"#7f8c8d",marginBottom:"30px"},children:"Visualiza y gestiona todos tus dep\xf3sitos de garant\xeda"}),g&&(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"30px"},children:[(0,t.jsxs)("div",{className:x().statCard,children:[(0,t.jsx)("div",{className:x().statCardIcon,children:"\uD83D\uDCCA"}),(0,t.jsx)("div",{className:x().statCardValue,children:g.totalDeposits}),(0,t.jsx)("div",{className:x().statCardLabel,children:"Total de Dep\xf3sitos"})]}),(0,t.jsxs)("div",{className:x().statCard,children:[(0,t.jsx)("div",{className:x().statCardIcon,children:"\uD83D\uDCB0"}),(0,t.jsxs)("div",{className:x().statCardValue,children:["S/. ",g.totalAmount.toFixed(2)]}),(0,t.jsx)("div",{className:x().statCardLabel,children:"Monto Total"})]}),(0,t.jsxs)("div",{className:x().statCard,children:[(0,t.jsx)("div",{className:x().statCardIcon,children:"⏳"}),(0,t.jsx)("div",{className:x().statCardValue,children:g.byStatus.pending}),(0,t.jsx)("div",{className:x().statCardLabel,children:"Pendientes"}),(0,t.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d",marginTop:"5px"},children:["S/. ",g.amountByStatus.pending.toFixed(2)]})]}),(0,t.jsxs)("div",{className:x().statCard,children:[(0,t.jsx)("div",{className:x().statCardIcon,children:"\uD83D\uDD12"}),(0,t.jsx)("div",{className:x().statCardValue,children:g.byStatus.held}),(0,t.jsx)("div",{className:x().statCardLabel,children:"Retenidos"}),(0,t.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d",marginTop:"5px"},children:["S/. ",g.amountByStatus.held.toFixed(2)]})]}),(0,t.jsxs)("div",{className:x().statCard,children:[(0,t.jsx)("div",{className:x().statCardIcon,children:"✅"}),(0,t.jsx)("div",{className:x().statCardValue,children:g.byStatus.released}),(0,t.jsx)("div",{className:x().statCardLabel,children:"Liberados"}),(0,t.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d",marginTop:"5px"},children:["S/. ",g.amountByStatus.released.toFixed(2)]})]}),(0,t.jsxs)("div",{className:x().statCard,children:[(0,t.jsx)("div",{className:x().statCardIcon,children:"✓"}),(0,t.jsx)("div",{className:x().statCardValue,children:g.byStatus.executed}),(0,t.jsx)("div",{className:x().statCardLabel,children:"Ejecutados"}),(0,t.jsxs)("div",{style:{fontSize:"12px",color:"#7f8c8d",marginTop:"5px"},children:["S/. ",g.amountByStatus.executed.toFixed(2)]})]})]}),(0,t.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,t.jsx)("label",{htmlFor:"statusFilter",className:x().formLabel,style:{marginRight:"10px"},children:"Filtrar por estado:"}),(0,t.jsxs)("select",{id:"statusFilter",value:C,onChange:e=>b(e.target.value),className:x().formSelect,style:{width:"auto",display:"inline-block"},children:[(0,t.jsx)("option",{value:"all",children:"Todos"}),(0,t.jsx)("option",{value:"pending",children:"Pendiente"}),(0,t.jsx)("option",{value:"held",children:"Retenido"}),(0,t.jsx)("option",{value:"released",children:"Liberado"}),(0,t.jsx)("option",{value:"executed",children:"Ejecutado"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{style:{marginBottom:"15px",fontSize:"18px",color:"#2c3e50"},children:"Historial de Dep\xf3sitos"}),0===j.length?(0,t.jsx)("div",{className:x().alert,style:{textAlign:"center"},children:"No hay dep\xf3sitos registrados"}):(0,t.jsxs)("table",{className:x().table,children:[(0,t.jsx)("thead",{className:x().tableHeader,children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:x().tableHeaderCell,children:"ID Dep\xf3sito"}),(0,t.jsx)("th",{className:x().tableHeaderCell,children:"Producto"}),(0,t.jsx)("th",{className:x().tableHeaderCell,children:"Monto"}),(0,t.jsx)("th",{className:x().tableHeaderCell,children:"Estado"}),(0,t.jsx)("th",{className:x().tableHeaderCell,children:"Fecha Creaci\xf3n"}),(0,t.jsx)("th",{className:x().tableHeaderCell,children:"Notas"})]})}),(0,t.jsx)("tbody",{children:j.map(e=>{var a,s;return(0,t.jsxs)("tr",{className:x().tableRow,children:[(0,t.jsx)("td",{className:x().tableCell,children:(0,t.jsxs)("strong",{children:[e.id.substring(0,8),"..."]})}),(0,t.jsx)("td",{className:x().tableCell,children:(null===(s=e.raffle)||void 0===s?void 0:null===(a=s.product)||void 0===a?void 0:a.name)||"N/A"}),(0,t.jsx)("td",{className:x().tableCell,children:(0,t.jsxs)("strong",{children:["S/. ",Number(e.amount).toFixed(2)]})}),(0,t.jsx)("td",{className:x().tableCell,children:(0,t.jsx)("span",{className:x().statusBadge,style:{backgroundColor:E(e.status)},children:w(e.status)})}),(0,t.jsx)("td",{className:x().tableCell,children:new Date(e.createdAt).toLocaleDateString("es-ES")}),(0,t.jsx)("td",{className:x().tableCell,style:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:e.notes?e.notes.substring(0,50)+"...":"-"})]},e.id)})})]})]})]})]})]})]})})}},9422:function(e,a,s){"use strict";s.d(a,{m:function(){return c}});var t=s(3404),l=s(6534),d=s(6532),i=s(9283);let r=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,n=e=>{let a=e.data();return{id:e.id,userId:a.userId||"",name:a.name||"",description:a.description,logo:a.logo,publicEmail:a.publicEmail,phone:a.phone,socialMedia:a.socialMedia,status:a.status||i.R.PENDING,createdAt:r(a.createdAt),updatedAt:r(a.updatedAt)}},o={async getShopById(e){try{let a=await (0,l.getDoc)((0,l.doc)(d.db,"shops",e));if(!a.exists())throw Error("Shop not found");return n(a)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,l.collection)(d.db,"shops"),a=(0,l.query)(e,(0,l.where)("status","==",i.R.VERIFIED));return(await (0,l.getDocs)(a)).docs.map(e=>n(e)).sort((e,a)=>e.name.localeCompare(a.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,l.collection)(d.db,"shops");return(await (0,l.getDocs)(e)).docs.map(e=>n(e)).sort((e,a)=>e.name.localeCompare(a.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},c={getShopById:async e=>o.getShopById(e),getAllShops:async()=>o.getAllShops(),getVerifiedShops:async()=>o.getVerifiedShops(),getMyShop:async()=>(await t.x.get("/shops/my-shop/current")).data,updateShop:async(e,a)=>(await t.x.put("/shops/".concat(e),a)).data,getShopStatistics:async e=>(await t.x.get("/shops/".concat(e,"/statistics"))).data}},9283:function(e,a,s){"use strict";var t,l;s.d(a,{R:function(){return t}}),(l=t||(t={})).PENDING="pending",l.VERIFIED="verified",l.BLOCKED="blocked"}},function(e){e.O(0,[6438,2907,4183,1044,2489,8641,4755,4542,4446,7115,2364,1744],function(){return e(e.s=289)}),_N_E=e.O()}]);