(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3790],{2975:function(e,r,t){Promise.resolve().then(t.bind(t,1344))},1344:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var a=t(7821),o=t(8078),n=t(8504),i=t(7197),s=t(6289);function u(){let e=(0,n.useRouter)(),{user:r,isAuthenticated:t}=(0,i.t)();return(0,o.useEffect)(()=>{if(!t||!r){e.push("/login");return}if(r.role!==s.i.SHOP){e.push("/");return}e.push("/panel/tienda")},[t,r,e]),(0,a.jsx)("div",{children:"Redirigiendo..."})}},6532:function(e,r,t){"use strict";let a;t.d(r,{I8:function(){return l},db:function(){return u}});var o=t(1830),n=t(6534),i=t(1069),s=t(4304);a=0===(0,o.C6)().length?(0,o.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,o.C6)()[0];let u=(0,n.ad)(a);(0,i.cF)(a);let l=(0,s.v0)(a)},5161:function(e,r,t){"use strict";t.d(r,{Y:function(){return u}});var a=t(4304),o=t(6534),n=t(6532),i=t(6289);let s=async e=>{var r,t,a;try{let a=await (0,o.getDoc)((0,o.doc)(n.db,"users",e.uid));if(!a.exists())return{id:e.uid,name:e.displayName||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Usuario",email:e.email||"",role:i.i.USER};let s=a.data();return{id:e.uid,name:s.name||e.displayName||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"Usuario",email:e.email||"",role:s.role||i.i.USER}}catch(r){return console.error("Error converting Firebase user:",r),{id:e.uid,name:e.displayName||(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"Usuario",email:e.email||"",role:i.i.USER}}},u={async register(e){try{let r=(await (0,a.Xb)(n.I8,e.email,e.password)).user;e.name&&await (0,a.ck)(r,{displayName:e.name});let t=await r.getIdToken(),u={name:e.name,email:e.email,role:e.role,createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()};if(e.role===i.i.SHOP&&e.shopName){let t={userId:r.uid,name:e.shopName,description:"",status:"pending",createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()},a=await (0,o.ET)((0,o.collection)(n.db,"shops"),t);u.shopId=a.id,await (0,o.pl)((0,o.doc)(n.db,"users",r.uid),u)}else await (0,o.pl)((0,o.doc)(n.db,"users",r.uid),u);return{user:await s(r),token:t}}catch(r){console.error("Error registering user:",r);let e="Error al registrar usuario";throw"auth/email-already-in-use"===r.code?e="Este email ya est\xe1 registrado":"auth/invalid-email"===r.code?e="Email inv\xe1lido":"auth/weak-password"===r.code?e="La contrase\xf1a debe tener al menos 6 caracteres":"auth/operation-not-allowed"===r.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===r.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":r.message&&(e=r.message),Error(e)}},async login(e){try{let r=(await (0,a.e5)(n.I8,e.email,e.password)).user,t=await r.getIdToken();return{user:await s(r),token:t}}catch(r){console.error("Error logging in:",r);let e="Error al iniciar sesi\xf3n";throw"auth/user-not-found"===r.code?e="Usuario no encontrado":"auth/wrong-password"===r.code?e="Contrase\xf1a incorrecta":"auth/invalid-email"===r.code?e="Email inv\xe1lido":"auth/user-disabled"===r.code?e="Usuario deshabilitado":"auth/too-many-requests"===r.code?e="Demasiados intentos. Intenta m\xe1s tarde":"auth/operation-not-allowed"===r.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===r.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":r.message&&(e=r.message),Error(e)}},async logout(){try{await (0,a.w7)(n.I8)}catch(e){throw console.error("Error logging out:",e),e}},async getCurrentUser(){try{let e=n.I8.currentUser;if(!e)return null;return await s(e)}catch(e){return console.error("Error getting current user:",e),null}},async getCurrentUserToken(){try{let e=n.I8.currentUser;if(!e)return null;return await e.getIdToken()}catch(e){return console.error("Error getting token:",e),null}},onAuthStateChanged:e=>(0,a.Aj)(n.I8,async r=>{r?e(await s(r)):e(null)})}},7197:function(e,r,t){"use strict";t.d(r,{t:function(){return i}});var a=t(3020),o=t(4302),n=t(5161);let i=(0,a.Ue)()((0,o.tJ)((e,r)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:r=>e({user:r,isAuthenticated:!!r}),setToken:r=>{r?localStorage.setItem("token",r):localStorage.removeItem("token"),e({token:r})},setIsLoading:r=>e({isLoading:r}),setError:r=>e({error:r}),logout:async()=>{try{await n.Y.logout()}catch(e){console.error("Error logging out:",e)}finally{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}},refreshToken:async()=>{try{let e=await n.Y.getCurrentUserToken();e&&r().setToken(e)}catch(e){console.error("Error refreshing token:",e)}}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6289:function(e,r,t){"use strict";var a,o;t.d(r,{i:function(){return a}}),(o=a||(a={})).ADMIN="admin",o.SHOP="shop",o.USER="user"}},function(e){e.O(0,[2907,4183,1044,8641,4755,7115,2364,1744],function(){return e(e.s=2975)}),_N_E=e.O()}]);