(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4822],{3141:function(e,t,a){Promise.resolve().then(a.bind(a,7698))},7698:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var s=a(7821),n=a(8078),i=a(8504),l=a(6312),r=a(7511),o=a(2265),c=a(1455),d=a.n(c);function m(e){let{raffleId:t,shopId:a,paymentId:i,onSuccess:l}=e,[c,m]=(0,n.useState)({type:r.pM.PRIZE_NOT_DELIVERED,description:""}),[u,p]=(0,n.useState)(!1),[h,_]=(0,n.useState)(null),[g,v]=(0,n.useState)(!1),x={[r.pM.PRIZE_NOT_DELIVERED]:"No entrega del premio",[r.pM.DIFFERENT_PRODUCT]:"Producto diferente al ofertado",[r.pM.PURCHASE_PROBLEM]:"Problema en la compra",[r.pM.SHOP_BEHAVIOR]:"Problema con la tienda",[r.pM.RAFFLE_FRAUD]:"Fraude o irregularidad",[r.pM.TECHNICAL_ISSUE]:"Problema t\xe9cnico",[r.pM.PAYMENT_ERROR]:"Error de pago"},E=e=>{let{name:t,value:a}=e.target;m(e=>({...e,[t]:a}))},f=async e=>{e.preventDefault(),p(!0),_(null);try{await o.P.createComplaint({type:c.type,description:c.description,raffleId:t,shopId:a,paymentId:i}),v(!0),m({type:r.pM.PRIZE_NOT_DELIVERED,description:""}),l&&l(),setTimeout(()=>v(!1),5e3)}catch(e){var s,n;_((null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||"Error al crear el reclamo")}finally{p(!1)}};return(0,s.jsxs)("form",{onSubmit:f,className:d().form,children:[(0,s.jsx)("h2",{children:"Crear Reclamo"}),h&&(0,s.jsx)("div",{className:d().error,children:h}),g&&(0,s.jsx)("div",{className:d().success,children:"Reclamo creado exitosamente"}),(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{htmlFor:"type",children:"Tipo de Reclamo *"}),(0,s.jsx)("select",{id:"type",name:"type",value:c.type,onChange:E,required:!0,children:Object.entries(x).map(e=>{let[t,a]=e;return(0,s.jsx)("option",{value:t,children:a},t)})})]}),(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{htmlFor:"description",children:"Descripci\xf3n del Problema *"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:c.description,onChange:E,placeholder:"Describe detalladamente el problema que experimentaste...",minLength:10,maxLength:5e3,required:!0,rows:6}),(0,s.jsxs)("small",{children:[c.description.length,"/5000 caracteres"]})]}),(0,s.jsx)("button",{type:"submit",disabled:u,className:d().submitBtn,children:u?"Creando reclamo...":"Crear Reclamo"})]})}function u(e){var t,a,i;let{complaintId:l}=e,[c,m]=(0,n.useState)(null),[u,p]=(0,n.useState)(!0),[h,_]=(0,n.useState)(null),g={[r.P5.PENDING]:"Pendiente",[r.P5.IN_REVIEW]:"En Revisi\xf3n",[r.P5.RESOLVED]:"Resuelto",[r.P5.REJECTED]:"Rechazado",[r.P5.CANCELLED]:"Cancelado"},v={[r.Fq.RESOLVED_USER_FAVOR]:"A favor del usuario",[r.Fq.RESOLVED_SHOP_FAVOR]:"A favor de la tienda",[r.Fq.RESOLVED_PLATFORM_FAVOR]:"Resoluci\xf3n parcial",[r.Fq.REJECTED]:"Rechazado",[r.Fq.CANCELLED]:"Cancelado"};if((0,n.useEffect)(()=>{(async()=>{try{p(!0);let e=await o.P.getComplaintById(l);m(e)}catch(a){var e,t;_((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar el reclamo")}finally{p(!1)}})()},[l]),u)return(0,s.jsx)("div",{className:d().loading,children:"Cargando..."});if(h)return(0,s.jsx)("div",{className:d().error,children:h});if(!c)return(0,s.jsx)("div",{className:d().error,children:"Reclamo no encontrado"});let x=new Date(c.maxResponseDate),E=Math.ceil((x.getTime()-new Date().getTime())/864e5);return(0,s.jsxs)("div",{className:d().detailContainer,children:[(0,s.jsxs)("div",{className:d().header,children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{children:["Reclamo #",c.complaintNumber]}),(0,s.jsxs)("p",{className:d().createdDate,children:["Creado: ",new Date(c.createdAt).toLocaleDateString("es-ES")]})]}),(0,s.jsx)("div",{className:d().statusBadge,style:{backgroundColor:(e=>{switch(e){case r.P5.PENDING:return"#FFA500";case r.P5.IN_REVIEW:return"#4169E1";case r.P5.RESOLVED:return"#228B22";case r.P5.REJECTED:return"#DC143C";case r.P5.CANCELLED:return"#808080";default:return"#000"}})(c.status)},children:g[c.status]})]}),(0,s.jsxs)("div",{className:d().infoGrid,children:[(0,s.jsxs)("div",{className:d().infoItem,children:[(0,s.jsx)("label",{children:"Tipo de Reclamo:"}),(0,s.jsx)("span",{children:c.type})]}),(0,s.jsxs)("div",{className:d().infoItem,children:[(0,s.jsx)("label",{children:"Tienda:"}),(0,s.jsx)("span",{children:(null===(t=c.shop)||void 0===t?void 0:t.name)||"N/A"})]}),(0,s.jsxs)("div",{className:d().infoItem,children:[(0,s.jsx)("label",{children:"Sorteo:"}),(0,s.jsx)("span",{children:(null===(a=c.raffle)||void 0===a?void 0:a.id)||"N/A"})]}),(0,s.jsxs)("div",{className:d().infoItem,children:[(0,s.jsx)("label",{children:"Admin Asignado:"}),(0,s.jsx)("span",{children:(null===(i=c.assignedAdmin)||void 0===i?void 0:i.name)||"Sin asignar"})]})]}),(0,s.jsxs)("div",{className:d().descriptionSection,children:[(0,s.jsx)("h3",{children:"Descripci\xf3n del Problema"}),(0,s.jsx)("p",{children:c.description})]}),c.resolution&&(0,s.jsxs)("div",{className:d().resolutionSection,children:[(0,s.jsx)("h3",{children:"Resoluci\xf3n"}),(0,s.jsxs)("div",{className:d().resolutionInfo,children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Resultado:"})," ",v[c.resolution]]}),c.resolutionNotes&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Notas:"})," ",c.resolutionNotes]}),c.resolvedAt&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Resuelto:"})," ",new Date(c.resolvedAt).toLocaleDateString("es-ES")]})]})]}),(0,s.jsx)("div",{className:d().deadlineSection,children:(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Fecha M\xe1xima de Respuesta:"})," ",x.toLocaleDateString("es-ES"),E>0?(0,s.jsxs)("span",{style:{color:"#228B22"},children:[" (",E," d\xedas restantes)"]}):(0,s.jsx)("span",{style:{color:"#DC143C"},children:" (Vencido)"})]})}),c.attachments&&c.attachments.length>0&&(0,s.jsxs)("div",{className:d().attachmentsSection,children:[(0,s.jsxs)("h3",{children:["Adjuntos (",c.attachments.length,")"]}),(0,s.jsx)("div",{className:d().attachmentsList,children:c.attachments.map(e=>(0,s.jsxs)("div",{className:d().attachmentItem,children:[(0,s.jsx)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",children:e.fileName}),(0,s.jsxs)("small",{children:[(e.fileSize/1024).toFixed(2)," KB - ",e.fileType]})]},e.id))})]})]})}function p(e){let{complaintId:t,currentUserId:a}=e,[i,l]=(0,n.useState)([]),[r,c]=(0,n.useState)(""),[m,u]=(0,n.useState)(!0),[p,h]=(0,n.useState)(!1),[_,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{u(!0);let e=await o.P.getMessages(t);l(e)}catch(t){var e,a;g((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar mensajes")}finally{u(!1)}})()},[t]);let v=async e=>{if(e.preventDefault(),r.trim()){h(!0),g(null);try{let e=await o.P.addMessage(t,r);l(t=>[...t,e]),c("")}catch(e){var a,s;g((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"Error al enviar mensaje")}finally{h(!1)}}};return m?(0,s.jsx)("div",{className:d().loading,children:"Cargando mensajes..."}):(0,s.jsxs)("div",{className:d().messagesContainer,children:[(0,s.jsx)("h3",{children:"Conversaci\xf3n"}),_&&(0,s.jsx)("div",{className:d().error,children:_}),(0,s.jsx)("div",{className:d().messagesList,children:0===i.length?(0,s.jsx)("p",{className:d().noMessages,children:"No hay mensajes a\xfan"}):i.map(e=>{var t;return(0,s.jsxs)("div",{className:"".concat(d().message," ").concat(e.senderId===a?d().messageSent:d().messageReceived),children:[(0,s.jsxs)("div",{className:d().messageHeader,children:[(0,s.jsx)("strong",{children:(null===(t=e.sender)||void 0===t?void 0:t.name)||"Usuario"}),(0,s.jsx)("small",{children:new Date(e.createdAt).toLocaleString("es-ES")})]}),(0,s.jsx)("p",{children:e.message})]},e.id)})}),(0,s.jsxs)("form",{onSubmit:v,className:d().messageForm,children:[(0,s.jsx)("textarea",{value:r,onChange:e=>c(e.target.value),placeholder:"Escribe tu mensaje...",maxLength:5e3,rows:3,disabled:p}),(0,s.jsxs)("div",{className:d().messageFormFooter,children:[(0,s.jsxs)("small",{children:[r.length,"/5000"]}),(0,s.jsx)("button",{type:"submit",disabled:p||!r.trim(),children:p?"Enviando...":"Enviar"})]})]})]})}var h=a(7006),_=a.n(h);function g(){let e=(0,i.useRouter)(),{user:t,isLoading:a}=(0,l.a)(),[c,d]=(0,n.useState)([]),[h,g]=(0,n.useState)(null),[v,x]=(0,n.useState)(!0),[E,f]=(0,n.useState)(null),[j,S]=(0,n.useState)("list"),[N,R]=(0,n.useState)("");(0,n.useEffect)(()=>{a||t||e.push("/login")},[a,t,e]),(0,n.useEffect)(()=>{t&&C()},[t,N]);let C=async()=>{try{x(!0);let{complaints:e}=await o.P.getUserComplaints({status:N,limit:20});d(e)}catch(a){var e,t;f((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar reclamos")}finally{x(!1)}},D=e=>{g(e),S("detail")};return a||!t?(0,s.jsx)("div",{className:_().loading,children:"Cargando..."}):(0,s.jsxs)("div",{className:_().container,children:[(0,s.jsxs)("div",{className:_().header,children:[(0,s.jsx)("h1",{children:"Mis Reclamos"}),(0,s.jsx)("p",{children:"Gestiona tus reclamos y seguimiento"})]}),(0,s.jsxs)("div",{className:_().tabs,children:[(0,s.jsxs)("button",{className:"".concat(_().tab," ").concat("list"===j?_().active:""),onClick:()=>S("list"),children:["Mis Reclamos (",c.length,")"]}),(0,s.jsx)("button",{className:"".concat(_().tab," ").concat("create"===j?_().active:""),onClick:()=>S("create"),children:"Crear Reclamo"})]}),E&&(0,s.jsx)("div",{className:_().error,children:E}),"list"===j&&(0,s.jsxs)("div",{className:_().listSection,children:[(0,s.jsx)("div",{className:_().filterBar,children:(0,s.jsxs)("select",{value:N,onChange:e=>R(e.target.value),className:_().filterSelect,children:[(0,s.jsx)("option",{value:"",children:"Todos los estados"}),(0,s.jsx)("option",{value:r.P5.PENDING,children:"Pendiente"}),(0,s.jsx)("option",{value:r.P5.IN_REVIEW,children:"En Revisi\xf3n"}),(0,s.jsx)("option",{value:r.P5.RESOLVED,children:"Resuelto"}),(0,s.jsx)("option",{value:r.P5.REJECTED,children:"Rechazado"}),(0,s.jsx)("option",{value:r.P5.CANCELLED,children:"Cancelado"})]})}),v?(0,s.jsx)("div",{className:_().loading,children:"Cargando reclamos..."}):0===c.length?(0,s.jsxs)("div",{className:_().emptyState,children:[(0,s.jsx)("p",{children:"No tienes reclamos a\xfan"}),(0,s.jsx)("button",{className:_().createBtn,onClick:()=>S("create"),children:"Crear tu primer reclamo"})]}):(0,s.jsx)("div",{className:_().complaintsList,children:c.map(e=>{var t;return(0,s.jsxs)("div",{className:_().complaintCard,onClick:()=>D(e),children:[(0,s.jsxs)("div",{className:_().cardHeader,children:[(0,s.jsxs)("h3",{children:["#",e.complaintNumber]}),(0,s.jsx)("span",{className:_().statusBadge,style:{backgroundColor:e.status===r.P5.PENDING?"#FFA500":e.status===r.P5.IN_REVIEW?"#4169E1":e.status===r.P5.RESOLVED?"#228B22":e.status===r.P5.REJECTED?"#DC143C":"#808080"},children:e.status})]}),(0,s.jsx)("p",{className:_().cardType,children:e.type}),(0,s.jsxs)("p",{className:_().cardDescription,children:[e.description.substring(0,100),"..."]}),(0,s.jsxs)("div",{className:_().cardFooter,children:[(0,s.jsx)("small",{children:new Date(e.createdAt).toLocaleDateString("es-ES")}),(0,s.jsxs)("small",{children:[(null===(t=e.messages)||void 0===t?void 0:t.length)||0," mensajes"]})]})]},e.id)})})]}),"create"===j&&(0,s.jsx)("div",{className:_().createSection,children:(0,s.jsx)(m,{onSuccess:()=>{S("list"),C()}})}),"detail"===j&&h&&(0,s.jsxs)("div",{className:_().detailSection,children:[(0,s.jsx)("button",{className:_().backBtn,onClick:()=>S("list"),children:"â† Volver a la lista"}),(0,s.jsx)(u,{complaintId:h.id}),(0,s.jsx)(p,{complaintId:h.id,currentUserId:t.id})]})]})}},6312:function(e,t,a){"use strict";a.d(t,{a:function(){return i}});var s=a(8078),n=a(7197);function i(){let[e,t]=(0,s.useState)(!1),a=(0,n.t)();return(0,s.useEffect)(()=>{let e=localStorage.getItem("token");console.log("Token from localStorage:",e),e&&(console.log("Setting token in store:",e),a.setToken(e)),t(!0)},[]),{...a,isHydrated:e}}},3404:function(e,t,a){"use strict";a.d(t,{x:function(){return l}});var s=a(7147),n=a(9190);class i{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,a){return this.client.post(e,t,a)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}constructor(){(0,s._)(this,"client",void 0),this.client=n.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let l=new i},2265:function(e,t,a){"use strict";a.d(t,{P:function(){return n}});var s=a(3404);let n={createComplaint:async e=>(await s.x.post("/complaints",e)).data,getComplaintById:async e=>(await s.x.get("/complaints/".concat(e))).data,async getUserComplaints(e){let t=new URLSearchParams;return(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.type)&&t.append("type",e.type),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString()),(await s.x.get("/complaints/user/my-complaints?".concat(t.toString()))).data},async getShopComplaints(e,t){let a=new URLSearchParams;return(null==t?void 0:t.status)&&a.append("status",t.status),(null==t?void 0:t.limit)&&a.append("limit",t.limit.toString()),(null==t?void 0:t.offset)&&a.append("offset",t.offset.toString()),(await s.x.get("/complaints/shop/".concat(e,"?").concat(a.toString()))).data},async getAllComplaints(e){let t=new URLSearchParams;return(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.type)&&t.append("type",e.type),(null==e?void 0:e.shopId)&&t.append("shopId",e.shopId),(null==e?void 0:e.raffleId)&&t.append("raffleId",e.raffleId),(null==e?void 0:e.startDate)&&t.append("startDate",e.startDate),(null==e?void 0:e.endDate)&&t.append("endDate",e.endDate),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString()),(await s.x.get("/complaints?".concat(t.toString()))).data},updateComplaint:async(e,t)=>(await s.x.put("/complaints/".concat(e),t)).data,addMessage:async(e,t)=>(await s.x.post("/complaints/".concat(e,"/messages"),{message:t})).data,getMessages:async e=>(await s.x.get("/complaints/".concat(e,"/messages"))).data,addAttachment:async(e,t)=>(await s.x.post("/complaints/".concat(e,"/attachments"),t)).data,getAttachments:async e=>(await s.x.get("/complaints/".concat(e,"/attachments"))).data,cancelComplaint:async e=>(await s.x.put("/complaints/".concat(e,"/cancel"),{})).data,async exportComplaints(e){let t=new URLSearchParams;return(null==e?void 0:e.startDate)&&t.append("startDate",e.startDate),(null==e?void 0:e.endDate)&&t.append("endDate",e.endDate),(null==e?void 0:e.shopId)&&t.append("shopId",e.shopId),(null==e?void 0:e.status)&&t.append("status",e.status),(await s.x.get("/complaints/export/csv?".concat(t.toString()))).data},getComplaintStats:async()=>(await s.x.get("/complaints/stats/overview")).data}},7197:function(e,t,a){"use strict";a.d(t,{t:function(){return i}});var s=a(3020),n=a(4302);let i=(0,s.Ue)()((0,n.tJ)(e=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:t=>e({user:t,isAuthenticated:!!t}),setToken:t=>{t?localStorage.setItem("token",t):localStorage.removeItem("token"),e({token:t})},setIsLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),logout:()=>{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},7511:function(e,t,a){"use strict";var s,n,i,l,r,o;a.d(t,{Fq:function(){return i},P5:function(){return n},pM:function(){return s}}),(l=s||(s={})).PRIZE_NOT_DELIVERED="prize_not_delivered",l.DIFFERENT_PRODUCT="different_product",l.PURCHASE_PROBLEM="purchase_problem",l.SHOP_BEHAVIOR="shop_behavior",l.RAFFLE_FRAUD="raffle_fraud",l.TECHNICAL_ISSUE="technical_issue",l.PAYMENT_ERROR="payment_error",(r=n||(n={})).PENDING="pending",r.IN_REVIEW="in_review",r.RESOLVED="resolved",r.REJECTED="rejected",r.CANCELLED="cancelled",(o=i||(i={})).RESOLVED_USER_FAVOR="resolved_user_favor",o.RESOLVED_SHOP_FAVOR="resolved_shop_favor",o.RESOLVED_PLATFORM_FAVOR="resolved_platform_favor",o.REJECTED="rejected",o.CANCELLED="cancelled"},7006:function(e){e.exports={container:"complaints_container__XGlvY",header:"complaints_header__w_Ma2",tabs:"complaints_tabs__zx_C3",tab:"complaints_tab__XGRmJ",active:"complaints_active__usmsS",error:"complaints_error__BHryM",loading:"complaints_loading__qSldU",listSection:"complaints_listSection__8rMnE",filterBar:"complaints_filterBar__Pk4VR",filterSelect:"complaints_filterSelect__6baDy",emptyState:"complaints_emptyState__9AInC",createBtn:"complaints_createBtn___ZOrA",complaintsList:"complaints_complaintsList__hhrfB",complaintCard:"complaints_complaintCard__HqwbU",cardHeader:"complaints_cardHeader__FQS8g",statusBadge:"complaints_statusBadge__QzbxZ",cardType:"complaints_cardType__j2KeB",cardDescription:"complaints_cardDescription___pCvc",cardFooter:"complaints_cardFooter__EMA7A",createSection:"complaints_createSection__NBA8N",detailSection:"complaints_detailSection__uiVmV",backBtn:"complaints_backBtn__sXAH0"}},1455:function(e){e.exports={form:"complaints_form__rTrch",formGroup:"complaints_formGroup__UYWMx",submitBtn:"complaints_submitBtn__VaKWi",error:"complaints_error__gMEPQ",success:"complaints_success__oCN4_",loading:"complaints_loading__tLahV",detailContainer:"complaints_detailContainer__RSjw5",header:"complaints_header__ckDC_",createdDate:"complaints_createdDate__TEuQb",statusBadge:"complaints_statusBadge__kv8hP",infoGrid:"complaints_infoGrid__Oc7mc",infoItem:"complaints_infoItem__2he1C",descriptionSection:"complaints_descriptionSection__Wf6No",resolutionSection:"complaints_resolutionSection__7mwjt",attachmentsSection:"complaints_attachmentsSection__QiOLs",resolutionInfo:"complaints_resolutionInfo__TUJhr",deadlineSection:"complaints_deadlineSection___CkOa",attachmentsList:"complaints_attachmentsList__L7Ogx",attachmentItem:"complaints_attachmentItem__UnGGM",messagesContainer:"complaints_messagesContainer__ICLTG",messagesList:"complaints_messagesList__zBFTp",noMessages:"complaints_noMessages__xB9wp",message:"complaints_message__7hfDw",messageSent:"complaints_messageSent__oB14r",messageReceived:"complaints_messageReceived__L2eGS",messageHeader:"complaints_messageHeader__wpFC_",messageForm:"complaints_messageForm__mwM7K",messageFormFooter:"complaints_messageFormFooter__qIT9E"}}},function(e){e.O(0,[1490,2489,4755,7115,2364,1744],function(){return e(e.s=3141)}),_N_E=e.O()}]);