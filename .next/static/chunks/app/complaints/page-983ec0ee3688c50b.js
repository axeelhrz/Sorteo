(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4822],{3141:function(e,s,a){Promise.resolve().then(a.bind(a,7698))},7698:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return x}});var t=a(7821),n=a(8078),i=a(8504),l=a(6312),r=a(7511),c=a(2265),o=a(1455),d=a.n(o);function m(e){let{raffleId:s,shopId:a,paymentId:i,onSuccess:l}=e,[o,m]=(0,n.useState)({type:r.pM.PRIZE_NOT_DELIVERED,description:""}),[_,h]=(0,n.useState)(!1),[p,u]=(0,n.useState)(null),[x,j]=(0,n.useState)(!1),v={[r.pM.PRIZE_NOT_DELIVERED]:"No entrega del premio",[r.pM.DIFFERENT_PRODUCT]:"Producto diferente al ofertado",[r.pM.PURCHASE_PROBLEM]:"Problema en la compra",[r.pM.SHOP_BEHAVIOR]:"Problema con la tienda",[r.pM.RAFFLE_FRAUD]:"Fraude o irregularidad",[r.pM.TECHNICAL_ISSUE]:"Problema t\xe9cnico",[r.pM.PAYMENT_ERROR]:"Error de pago"},g=e=>{let{name:s,value:a}=e.target;m(e=>({...e,[s]:a}))},E=async e=>{e.preventDefault(),h(!0),u(null);try{await c.P.createComplaint({type:o.type,description:o.description,raffleId:s,shopId:a,paymentId:i}),j(!0),m({type:r.pM.PRIZE_NOT_DELIVERED,description:""}),l&&l(),setTimeout(()=>j(!1),5e3)}catch(e){var t,n;u((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Error al crear el reclamo")}finally{h(!1)}};return(0,t.jsxs)("form",{onSubmit:E,className:d().form,children:[(0,t.jsx)("h2",{children:"Crear Reclamo"}),p&&(0,t.jsx)("div",{className:d().error,children:p}),x&&(0,t.jsx)("div",{className:d().success,children:"Reclamo creado exitosamente"}),(0,t.jsxs)("div",{className:d().formGroup,children:[(0,t.jsx)("label",{htmlFor:"type",children:"Tipo de Reclamo *"}),(0,t.jsx)("select",{id:"type",name:"type",value:o.type,onChange:g,required:!0,children:Object.entries(v).map(e=>{let[s,a]=e;return(0,t.jsx)("option",{value:s,children:a},s)})})]}),(0,t.jsxs)("div",{className:d().formGroup,children:[(0,t.jsx)("label",{htmlFor:"description",children:"Descripci\xf3n del Problema *"}),(0,t.jsx)("textarea",{id:"description",name:"description",value:o.description,onChange:g,placeholder:"Describe detalladamente el problema que experimentaste...",minLength:10,maxLength:5e3,required:!0,rows:6}),(0,t.jsxs)("small",{children:[o.description.length,"/5000 caracteres"]})]}),(0,t.jsx)("button",{type:"submit",disabled:_,className:d().submitBtn,children:_?"Creando reclamo...":"Crear Reclamo"})]})}function _(e){var s,a,i;let{complaintId:l}=e,[o,m]=(0,n.useState)(null),[_,h]=(0,n.useState)(!0),[p,u]=(0,n.useState)(null),x={[r.P5.PENDING]:"Pendiente",[r.P5.IN_REVIEW]:"En Revisi\xf3n",[r.P5.RESOLVED]:"Resuelto",[r.P5.REJECTED]:"Rechazado",[r.P5.CANCELLED]:"Cancelado"},j={[r.Fq.RESOLVED_USER_FAVOR]:"A favor del usuario",[r.Fq.RESOLVED_SHOP_FAVOR]:"A favor de la tienda",[r.Fq.RESOLVED_PLATFORM_FAVOR]:"Resoluci\xf3n parcial",[r.Fq.REJECTED]:"Rechazado",[r.Fq.CANCELLED]:"Cancelado"};if((0,n.useEffect)(()=>{(async()=>{try{h(!0);let e=await c.P.getComplaintById(l);m(e)}catch(a){var e,s;u((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Error al cargar el reclamo")}finally{h(!1)}})()},[l]),_)return(0,t.jsx)("div",{className:d().loading,children:"Cargando..."});if(p)return(0,t.jsx)("div",{className:d().error,children:p});if(!o)return(0,t.jsx)("div",{className:d().error,children:"Reclamo no encontrado"});let v=new Date(o.maxResponseDate),g=Math.ceil((v.getTime()-new Date().getTime())/864e5);return(0,t.jsxs)("div",{className:d().detailContainer,children:[(0,t.jsxs)("div",{className:d().header,children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{children:["Reclamo #",o.complaintNumber]}),(0,t.jsxs)("p",{className:d().createdDate,children:["Creado: ",new Date(o.createdAt).toLocaleDateString("es-ES")]})]}),(0,t.jsx)("div",{className:d().statusBadge,style:{backgroundColor:(e=>{switch(e){case r.P5.PENDING:return"#FFA500";case r.P5.IN_REVIEW:return"#4169E1";case r.P5.RESOLVED:return"#228B22";case r.P5.REJECTED:return"#DC143C";case r.P5.CANCELLED:return"#808080";default:return"#000"}})(o.status)},children:x[o.status]})]}),(0,t.jsxs)("div",{className:d().infoGrid,children:[(0,t.jsxs)("div",{className:d().infoItem,children:[(0,t.jsx)("label",{children:"Tipo de Reclamo:"}),(0,t.jsx)("span",{children:o.type})]}),(0,t.jsxs)("div",{className:d().infoItem,children:[(0,t.jsx)("label",{children:"Tienda:"}),(0,t.jsx)("span",{children:(null===(s=o.shop)||void 0===s?void 0:s.name)||"N/A"})]}),(0,t.jsxs)("div",{className:d().infoItem,children:[(0,t.jsx)("label",{children:"Sorteo:"}),(0,t.jsx)("span",{children:(null===(a=o.raffle)||void 0===a?void 0:a.id)||"N/A"})]}),(0,t.jsxs)("div",{className:d().infoItem,children:[(0,t.jsx)("label",{children:"Admin Asignado:"}),(0,t.jsx)("span",{children:(null===(i=o.assignedAdmin)||void 0===i?void 0:i.name)||"Sin asignar"})]})]}),(0,t.jsxs)("div",{className:d().descriptionSection,children:[(0,t.jsx)("h3",{children:"Descripci\xf3n del Problema"}),(0,t.jsx)("p",{children:o.description})]}),o.resolution&&(0,t.jsxs)("div",{className:d().resolutionSection,children:[(0,t.jsx)("h3",{children:"Resoluci\xf3n"}),(0,t.jsxs)("div",{className:d().resolutionInfo,children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Resultado:"})," ",j[o.resolution]]}),o.resolutionNotes&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Notas:"})," ",o.resolutionNotes]}),o.resolvedAt&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Resuelto:"})," ",new Date(o.resolvedAt).toLocaleDateString("es-ES")]})]})]}),(0,t.jsx)("div",{className:d().deadlineSection,children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Fecha M\xe1xima de Respuesta:"})," ",v.toLocaleDateString("es-ES"),g>0?(0,t.jsxs)("span",{style:{color:"#228B22"},children:[" (",g," d\xedas restantes)"]}):(0,t.jsx)("span",{style:{color:"#DC143C"},children:" (Vencido)"})]})}),o.attachments&&o.attachments.length>0&&(0,t.jsxs)("div",{className:d().attachmentsSection,children:[(0,t.jsxs)("h3",{children:["Adjuntos (",o.attachments.length,")"]}),(0,t.jsx)("div",{className:d().attachmentsList,children:o.attachments.map(e=>(0,t.jsxs)("div",{className:d().attachmentItem,children:[(0,t.jsx)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",children:e.fileName}),(0,t.jsxs)("small",{children:[(e.fileSize/1024).toFixed(2)," KB - ",e.fileType]})]},e.id))})]})]})}function h(e){let{complaintId:s,currentUserId:a}=e,[i,l]=(0,n.useState)([]),[r,o]=(0,n.useState)(""),[m,_]=(0,n.useState)(!0),[h,p]=(0,n.useState)(!1),[u,x]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{_(!0);let e=await c.P.getMessages(s);l(e)}catch(s){var e,a;x((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar mensajes")}finally{_(!1)}})()},[s]);let j=async e=>{if(e.preventDefault(),r.trim()){p(!0),x(null);try{let e=await c.P.addMessage(s,r);l(s=>[...s,e]),o("")}catch(e){var a,t;x((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Error al enviar mensaje")}finally{p(!1)}}};return m?(0,t.jsx)("div",{className:d().loading,children:"Cargando mensajes..."}):(0,t.jsxs)("div",{className:d().messagesContainer,children:[(0,t.jsx)("h3",{children:"Conversaci\xf3n"}),u&&(0,t.jsx)("div",{className:d().error,children:u}),(0,t.jsx)("div",{className:d().messagesList,children:0===i.length?(0,t.jsx)("p",{className:d().noMessages,children:"No hay mensajes a\xfan"}):i.map(e=>{var s;return(0,t.jsxs)("div",{className:"".concat(d().message," ").concat(e.senderId===a?d().messageSent:d().messageReceived),children:[(0,t.jsxs)("div",{className:d().messageHeader,children:[(0,t.jsx)("strong",{children:(null===(s=e.sender)||void 0===s?void 0:s.name)||"Usuario"}),(0,t.jsx)("small",{children:new Date(e.createdAt).toLocaleString("es-ES")})]}),(0,t.jsx)("p",{children:e.message})]},e.id)})}),(0,t.jsxs)("form",{onSubmit:j,className:d().messageForm,children:[(0,t.jsx)("textarea",{value:r,onChange:e=>o(e.target.value),placeholder:"Escribe tu mensaje...",maxLength:5e3,rows:3,disabled:h}),(0,t.jsxs)("div",{className:d().messageFormFooter,children:[(0,t.jsxs)("small",{children:[r.length,"/5000"]}),(0,t.jsx)("button",{type:"submit",disabled:h||!r.trim(),children:h?"Enviando...":"Enviar"})]})]})]})}var p=a(7006),u=a.n(p);function x(){let e=(0,i.useRouter)(),{user:s,isLoading:a}=(0,l.a)(),[o,d]=(0,n.useState)([]),[p,x]=(0,n.useState)(null),[j,v]=(0,n.useState)(!0),[g,E]=(0,n.useState)(null),[N,S]=(0,n.useState)("list"),[f,C]=(0,n.useState)("");(0,n.useEffect)(()=>{a||s||e.push("/login")},[a,s,e]),(0,n.useEffect)(()=>{s&&R()},[s,f]);let R=async()=>{try{v(!0);let{complaints:e}=await c.P.getUserComplaints({status:f,limit:20});d(e)}catch(a){var e,s;E((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Error al cargar reclamos")}finally{v(!1)}},D=e=>{x(e),S("detail")};return a||!s?(0,t.jsx)("div",{className:u().loading,children:"Cargando..."}):(0,t.jsxs)("div",{className:u().container,children:[(0,t.jsxs)("div",{className:u().header,children:[(0,t.jsx)("h1",{children:"Mis Reclamos"}),(0,t.jsx)("p",{children:"Gestiona tus reclamos y seguimiento"})]}),(0,t.jsxs)("div",{className:u().tabs,children:[(0,t.jsxs)("button",{className:"".concat(u().tab," ").concat("list"===N?u().active:""),onClick:()=>S("list"),children:["Mis Reclamos (",o.length,")"]}),(0,t.jsx)("button",{className:"".concat(u().tab," ").concat("create"===N?u().active:""),onClick:()=>S("create"),children:"Crear Reclamo"})]}),g&&(0,t.jsx)("div",{className:u().error,children:g}),"list"===N&&(0,t.jsxs)("div",{className:u().listSection,children:[(0,t.jsx)("div",{className:u().filterBar,children:(0,t.jsxs)("select",{value:f,onChange:e=>C(e.target.value),className:u().filterSelect,children:[(0,t.jsx)("option",{value:"",children:"Todos los estados"}),(0,t.jsx)("option",{value:r.P5.PENDING,children:"Pendiente"}),(0,t.jsx)("option",{value:r.P5.IN_REVIEW,children:"En Revisi\xf3n"}),(0,t.jsx)("option",{value:r.P5.RESOLVED,children:"Resuelto"}),(0,t.jsx)("option",{value:r.P5.REJECTED,children:"Rechazado"}),(0,t.jsx)("option",{value:r.P5.CANCELLED,children:"Cancelado"})]})}),j?(0,t.jsx)("div",{className:u().loading,children:"Cargando reclamos..."}):0===o.length?(0,t.jsxs)("div",{className:u().emptyState,children:[(0,t.jsx)("p",{children:"No tienes reclamos a\xfan"}),(0,t.jsx)("button",{className:u().createBtn,onClick:()=>S("create"),children:"Crear tu primer reclamo"})]}):(0,t.jsx)("div",{className:u().complaintsList,children:o.map(e=>{var s;return(0,t.jsxs)("div",{className:u().complaintCard,onClick:()=>D(e),children:[(0,t.jsxs)("div",{className:u().cardHeader,children:[(0,t.jsxs)("h3",{children:["#",e.complaintNumber]}),(0,t.jsx)("span",{className:u().statusBadge,style:{backgroundColor:e.status===r.P5.PENDING?"#FFA500":e.status===r.P5.IN_REVIEW?"#4169E1":e.status===r.P5.RESOLVED?"#228B22":e.status===r.P5.REJECTED?"#DC143C":"#808080"},children:e.status})]}),(0,t.jsx)("p",{className:u().cardType,children:e.type}),(0,t.jsxs)("p",{className:u().cardDescription,children:[e.description.substring(0,100),"..."]}),(0,t.jsxs)("div",{className:u().cardFooter,children:[(0,t.jsx)("small",{children:new Date(e.createdAt).toLocaleDateString("es-ES")}),(0,t.jsxs)("small",{children:[(null===(s=e.messages)||void 0===s?void 0:s.length)||0," mensajes"]})]})]},e.id)})})]}),"create"===N&&(0,t.jsx)("div",{className:u().createSection,children:(0,t.jsx)(m,{onSuccess:()=>{S("list"),R()}})}),"detail"===N&&p&&(0,t.jsxs)("div",{className:u().detailSection,children:[(0,t.jsx)("button",{className:u().backBtn,onClick:()=>S("list"),children:"‚Üê Volver a la lista"}),(0,t.jsx)(_,{complaintId:p.id}),(0,t.jsx)(h,{complaintId:p.id,currentUserId:s.id})]})]})}},7006:function(e){e.exports={container:"complaints_container__XGlvY",header:"complaints_header__w_Ma2",tabs:"complaints_tabs__zx_C3",tab:"complaints_tab__XGRmJ",active:"complaints_active__usmsS",error:"complaints_error__BHryM",loading:"complaints_loading__qSldU",listSection:"complaints_listSection__8rMnE",filterBar:"complaints_filterBar__Pk4VR",filterSelect:"complaints_filterSelect__6baDy",emptyState:"complaints_emptyState__9AInC",createBtn:"complaints_createBtn___ZOrA",complaintsList:"complaints_complaintsList__hhrfB",complaintCard:"complaints_complaintCard__HqwbU",cardHeader:"complaints_cardHeader__FQS8g",statusBadge:"complaints_statusBadge__QzbxZ",cardType:"complaints_cardType__j2KeB",cardDescription:"complaints_cardDescription___pCvc",cardFooter:"complaints_cardFooter__EMA7A",createSection:"complaints_createSection__NBA8N",detailSection:"complaints_detailSection__uiVmV",backBtn:"complaints_backBtn__sXAH0"}},1455:function(e){e.exports={form:"complaints_form__rTrch",formGroup:"complaints_formGroup__UYWMx",submitBtn:"complaints_submitBtn__VaKWi",error:"complaints_error__gMEPQ",success:"complaints_success__oCN4_",loading:"complaints_loading__tLahV",detailContainer:"complaints_detailContainer__RSjw5",header:"complaints_header__ckDC_",createdDate:"complaints_createdDate__TEuQb",statusBadge:"complaints_statusBadge__kv8hP",infoGrid:"complaints_infoGrid__Oc7mc",infoItem:"complaints_infoItem__2he1C",descriptionSection:"complaints_descriptionSection__Wf6No",resolutionSection:"complaints_resolutionSection__7mwjt",attachmentsSection:"complaints_attachmentsSection__QiOLs",resolutionInfo:"complaints_resolutionInfo__TUJhr",deadlineSection:"complaints_deadlineSection___CkOa",attachmentsList:"complaints_attachmentsList__L7Ogx",attachmentItem:"complaints_attachmentItem__UnGGM",messagesContainer:"complaints_messagesContainer__ICLTG",messagesList:"complaints_messagesList__zBFTp",noMessages:"complaints_noMessages__xB9wp",message:"complaints_message__7hfDw",messageSent:"complaints_messageSent__oB14r",messageReceived:"complaints_messageReceived__L2eGS",messageHeader:"complaints_messageHeader__wpFC_",messageForm:"complaints_messageForm__mwM7K",messageFormFooter:"complaints_messageFormFooter__qIT9E"}}},function(e){e.O(0,[1490,2907,4183,1044,2489,8641,4755,6999,7115,2364,1744],function(){return e(e.s=3141)}),_N_E=e.O()}]);