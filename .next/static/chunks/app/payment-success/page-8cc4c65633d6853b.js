(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6685],{8187:function(e,a,t){Promise.resolve().then(t.bind(t,3969))},3969:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return m},dynamic:function(){return u}});var s=t(7821),n=t(8078),r=t(8504),c=t(6943),o=t(2129),i=t(9012),l=t.n(i);let u="force-dynamic";function d(){var e;let a=(0,r.useSearchParams)(),t=(0,r.useRouter)(),i=a.get("paymentId"),[u,d]=(0,n.useState)(null),[m,p]=(0,n.useState)(null),[h,y]=(0,n.useState)(!0),[f,x]=(0,n.useState)(null);return((0,n.useEffect)(()=>{if(!i){x("ID de pago no encontrado"),y(!1);return}(async()=>{try{let e=await c.Z.getPaymentById(i);if(d(e),e.raffleId){let a=await o.W.getRaffleById(e.raffleId);p(a)}}catch(e){x("Error al cargar los datos de la compra"),console.error(e)}finally{y(!1)}})()},[i]),h)?(0,s.jsx)("div",{className:l().container,children:(0,s.jsx)("div",{className:l().loadingSpinner,children:"Cargando..."})}):f||!u?(0,s.jsx)("div",{className:l().container,children:(0,s.jsxs)("div",{className:l().errorBox,children:[(0,s.jsx)("h1",{children:"Error"}),(0,s.jsx)("p",{children:f||"No se pudo cargar la compra"}),(0,s.jsx)("button",{onClick:()=>t.push("/sorteos"),children:"Volver a TIKETEA ONLINE"})]})}):(0,s.jsx)("div",{className:l().container,children:(0,s.jsxs)("div",{className:l().successCard,children:[(0,s.jsx)("div",{className:l().successIcon,children:"âœ“"}),(0,s.jsx)("h1",{className:l().title,children:"\xa1Compra completada!"}),(0,s.jsx)("p",{className:l().subtitle,children:"Tu pago ha sido procesado exitosamente"}),(0,s.jsxs)("div",{className:l().summarySection,children:[(0,s.jsx)("h2",{children:"Resumen de tu compra"}),m&&(0,s.jsxs)("div",{className:l().summaryItem,children:[(0,s.jsx)("span",{children:"Sorteo:"}),(0,s.jsx)("span",{className:l().value,children:(null===(e=m.product)||void 0===e?void 0:e.name)||"Producto"})]}),(0,s.jsxs)("div",{className:l().summaryItem,children:[(0,s.jsx)("span",{children:"Cantidad de tickets:"}),(0,s.jsx)("span",{className:l().value,children:u.ticketQuantity})]}),(0,s.jsxs)("div",{className:l().summaryItem,children:[(0,s.jsx)("span",{children:"Monto pagado:"}),(0,s.jsxs)("span",{className:l().value,children:["S/. ",Number(u.amount).toFixed(2)]})]}),(0,s.jsxs)("div",{className:l().summaryItem,children:[(0,s.jsx)("span",{children:"Fecha de compra:"}),(0,s.jsx)("span",{className:l().value,children:new Date(u.createdAt).toLocaleDateString("es-PE")})]}),(0,s.jsxs)("div",{className:l().summaryItem,children:[(0,s.jsx)("span",{children:"ID de transacci\xf3n:"}),(0,s.jsx)("span",{className:l().value,children:u.externalTransactionId})]})]}),(0,s.jsx)("div",{className:l().infoBox,children:(0,s.jsx)("p",{children:"Se ha enviado un email de confirmaci\xf3n a tu correo electr\xf3nico con los detalles de tu compra y tus n\xfameros de tickets."})}),(0,s.jsxs)("div",{className:l().actions,children:[(0,s.jsx)("button",{className:l().primaryButton,onClick:()=>t.push("/panel/sorteos"),children:"Ver mis sorteos"}),(0,s.jsx)("button",{className:l().secondaryButton,onClick:()=>t.push("/sorteos"),children:"Volver a TIKETEA ONLINE"})]})]})})}function m(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:l().container,children:(0,s.jsx)("div",{className:l().loadingSpinner,children:"Cargando..."})}),children:(0,s.jsx)(d,{})})}},3404:function(e,a,t){"use strict";t.d(a,{x:function(){return c}});var s=t(7147),n=t(9190);class r{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,a){return this.client.get(e,a)}async post(e,a,t){return this.client.post(e,a,t)}async put(e,a){return this.client.put(e,a)}async delete(e){return this.client.delete(e)}constructor(){(0,s._)(this,"client",void 0),this.client=n.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let a=localStorage.getItem("token");console.log("API Request - Token from localStorage:",a),a?(e.headers.Authorization="Bearer ".concat(a),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let c=new r},6943:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var s=t(3404);let n={async createPayment(e){try{return(await s.x.post("/payments",e)).data}catch(e){throw console.error("Error creating payment:",e),e}},async confirmPayment(e){try{return(await s.x.post("/payments/confirm",e)).data}catch(e){throw console.error("Error confirming payment:",e),e}},async failPayment(e,a){try{return(await s.x.post("/payments/".concat(e,"/fail"),{failureReason:a})).data}catch(e){throw console.error("Error failing payment:",e),e}},async getPaymentById(e){try{return(await s.x.get("/payments/".concat(e))).data}catch(e){throw console.error("Error fetching payment:",e),e}},async getMyPayments(){try{return(await s.x.get("/payments/user/me")).data}catch(e){throw console.error("Error fetching user payments:",e),e}},async getCompletedPaymentsByRaffleId(e){try{return(await s.x.get("/payments/raffle/".concat(e))).data}catch(e){throw console.error("Error fetching raffle payments:",e),e}},async refundPayment(e){try{return(await s.x.post("/payments/".concat(e,"/refund"),{})).data}catch(e){throw console.error("Error refunding payment:",e),e}}}},2129:function(e,a,t){"use strict";t.d(a,{W:function(){return n}});var s=t(3404);let n={getRafflesByShop:async e=>(await s.x.get("/raffles?shopId=".concat(e))).data,getRaffleById:async e=>(await s.x.get("/raffles/".concat(e))).data,createRaffle:async e=>(await s.x.post("/raffles",e)).data,updateRaffle:async(e,a)=>(await s.x.put("/raffles/".concat(e),a)).data,submitForApproval:async e=>(await s.x.put("/raffles/".concat(e,"/submit-approval"),{})).data,cancelRaffle:async e=>(await s.x.put("/raffles/".concat(e,"/cancel"),{})).data,getActiveRaffles:async()=>(await s.x.get("/raffles/active")).data,getAllRaffles:async()=>(await s.x.get("/raffles")).data}},8504:function(e,a,t){"use strict";var s=t(3226);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})},9012:function(e){e.exports={container:"payment-success_container__OSwLz",successCard:"payment-success_successCard__CL_Tn",successIcon:"payment-success_successIcon__r9SPW",title:"payment-success_title__0iUm8",subtitle:"payment-success_subtitle__X3iBy",summarySection:"payment-success_summarySection__EcQA5",summaryItem:"payment-success_summaryItem__WsdYW",value:"payment-success_value__71Gv1",infoBox:"payment-success_infoBox__9OI8C",actions:"payment-success_actions__XomMe",primaryButton:"payment-success_primaryButton__gQYS2",secondaryButton:"payment-success_secondaryButton__SO6PL",loadingSpinner:"payment-success_loadingSpinner__I1uO1",errorBox:"payment-success_errorBox__caUDo"}}},function(e){e.O(0,[8582,2489,7115,2364,1744],function(){return e(e.s=8187)}),_N_E=e.O()}]);