(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6685],{8187:function(e,t,s){Promise.resolve().then(s.bind(s,3969))},3969:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m},dynamic:function(){return u}});var a=s(7821),n=s(8078),r=s(8504),c=s(6943),o=s(6204),i=s(9012),l=s.n(i);let u="force-dynamic";function d(){var e;let t=(0,r.useSearchParams)(),s=(0,r.useRouter)(),i=t.get("paymentId"),[u,d]=(0,n.useState)(null),[m,h]=(0,n.useState)(null),[p,y]=(0,n.useState)(!0),[f,x]=(0,n.useState)(null);return((0,n.useEffect)(()=>{if(!i){x("ID de pago no encontrado"),y(!1);return}(async()=>{try{let e=await c.Z.getPaymentById(i);if(d(e),e.raffleId){let t=await o.raffleService.getRaffleById(e.raffleId);h(t)}}catch(e){x("Error al cargar los datos de la compra"),console.error(e)}finally{y(!1)}})()},[i]),p)?(0,a.jsx)("div",{className:l().container,children:(0,a.jsx)("div",{className:l().loadingSpinner,children:"Cargando..."})}):f||!u?(0,a.jsx)("div",{className:l().container,children:(0,a.jsxs)("div",{className:l().errorBox,children:[(0,a.jsx)("h1",{children:"Error"}),(0,a.jsx)("p",{children:f||"No se pudo cargar la compra"}),(0,a.jsx)("button",{onClick:()=>s.push("/sorteos"),children:"Volver a TIKETEA ONLINE"})]})}):(0,a.jsx)("div",{className:l().container,children:(0,a.jsxs)("div",{className:l().successCard,children:[(0,a.jsx)("div",{className:l().successIcon,children:"✓"}),(0,a.jsx)("h1",{className:l().title,children:"\xa1Compra completada!"}),(0,a.jsx)("p",{className:l().subtitle,children:"Tu pago ha sido procesado exitosamente"}),(0,a.jsxs)("div",{className:l().summarySection,children:[(0,a.jsx)("h2",{children:"Resumen de tu compra"}),m&&(0,a.jsxs)("div",{className:l().summaryItem,children:[(0,a.jsx)("span",{children:"Sorteo:"}),(0,a.jsx)("span",{className:l().value,children:(null===(e=m.product)||void 0===e?void 0:e.name)||"Producto"})]}),(0,a.jsxs)("div",{className:l().summaryItem,children:[(0,a.jsx)("span",{children:"Cantidad de tickets:"}),(0,a.jsx)("span",{className:l().value,children:u.ticketQuantity})]}),(0,a.jsxs)("div",{className:l().summaryItem,children:[(0,a.jsx)("span",{children:"Monto pagado:"}),(0,a.jsxs)("span",{className:l().value,children:["S/. ",Number(u.amount).toFixed(2)]})]}),(0,a.jsxs)("div",{className:l().summaryItem,children:[(0,a.jsx)("span",{children:"Fecha de compra:"}),(0,a.jsx)("span",{className:l().value,children:new Date(u.createdAt).toLocaleDateString("es-PE")})]}),(0,a.jsxs)("div",{className:l().summaryItem,children:[(0,a.jsx)("span",{children:"ID de transacci\xf3n:"}),(0,a.jsx)("span",{className:l().value,children:u.externalTransactionId})]})]}),(0,a.jsx)("div",{className:l().infoBox,children:(0,a.jsx)("p",{children:"Se ha enviado un email de confirmaci\xf3n a tu correo electr\xf3nico con los detalles de tu compra y tus n\xfameros de tickets."})}),(0,a.jsxs)("div",{className:l().actions,children:[(0,a.jsx)("button",{className:l().primaryButton,onClick:()=>s.push("/panel/sorteos"),children:"Ver mis sorteos"}),(0,a.jsx)("button",{className:l().secondaryButton,onClick:()=>s.push("/sorteos"),children:"Volver a TIKETEA ONLINE"})]})]})})}function m(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{className:l().container,children:(0,a.jsx)("div",{className:l().loadingSpinner,children:"Cargando..."})}),children:(0,a.jsx)(d,{})})}},3404:function(e,t,s){"use strict";s.d(t,{x:function(){return o}});var a=s(7147),n=s(9190);let r=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(e);if(!e.endsWith("/api")){let t=e.endsWith("/")?e.slice(0,-1):e;return"".concat(t,"/api")}return e})();class c{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,s){return this.client.post(e,t,s)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}constructor(){(0,a._)(this,"client",void 0),this.client=n.Z.create({baseURL:r,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let o=new c},6532:function(e,t,s){"use strict";let a;s.d(t,{I8:function(){return l},db:function(){return i}});var n=s(1830),r=s(6534),c=s(1069),o=s(4304);a=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,n.C6)()[0];let i=(0,r.ad)(a);(0,c.cF)(a);let l=(0,o.v0)(a)},6943:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(3404);let n={async createPayment(e){try{return(await a.x.post("/payments",e)).data}catch(e){throw console.error("Error creating payment:",e),e}},async confirmPayment(e){try{return(await a.x.post("/payments/confirm",e)).data}catch(e){throw console.error("Error confirming payment:",e),e}},async failPayment(e,t){try{return(await a.x.post("/payments/".concat(e,"/fail"),{failureReason:t})).data}catch(e){throw console.error("Error failing payment:",e),e}},async getPaymentById(e){try{return(await a.x.get("/payments/".concat(e))).data}catch(e){throw console.error("Error fetching payment:",e),e}},async getMyPayments(){try{return(await a.x.get("/payments/user/me")).data}catch(e){throw console.error("Error fetching user payments:",e),e}},async getCompletedPaymentsByRaffleId(e){try{return(await a.x.get("/payments/raffle/".concat(e))).data}catch(e){throw console.error("Error fetching raffle payments:",e),e}},async refundPayment(e){try{return(await a.x.post("/payments/".concat(e,"/refund"),{})).data}catch(e){throw console.error("Error refunding payment:",e),e}}}},8504:function(e,t,s){"use strict";var a=s(3226);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},9012:function(e){e.exports={container:"payment-success_container__OSwLz",successCard:"payment-success_successCard__CL_Tn",successIcon:"payment-success_successIcon__r9SPW",title:"payment-success_title__0iUm8",subtitle:"payment-success_subtitle__X3iBy",summarySection:"payment-success_summarySection__EcQA5",summaryItem:"payment-success_summaryItem__WsdYW",value:"payment-success_value__71Gv1",infoBox:"payment-success_infoBox__9OI8C",actions:"payment-success_actions__XomMe",primaryButton:"payment-success_primaryButton__gQYS2",secondaryButton:"payment-success_secondaryButton__SO6PL",loadingSpinner:"payment-success_loadingSpinner__I1uO1",errorBox:"payment-success_errorBox__caUDo"}}},function(e){e.O(0,[8582,2907,4183,1044,2489,8641,6204,7115,2364,1744],function(){return e(e.s=8187)}),_N_E=e.O()}]);