(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[170],{2448:function(e,a,t){Promise.resolve().then(t.bind(t,1105))},1105:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var n=t(7821),i=t(8078),s=t(8075),l=t(865),r=t.n(l);function d(){let[e,a]=(0,i.useState)([]),[t,l]=(0,i.useState)(!0),[d,o]=(0,i.useState)(null),[c,m]=(0,i.useState)(0),[h,u]=(0,i.useState)(0),[_,p]=(0,i.useState)(""),[x,g]=(0,i.useState)(null),[f,j]=(0,i.useState)(!1);(0,i.useEffect)(()=>{v()},[c,_]);let v=async()=>{try{l(!0);let e=await s.d.getAllPayments(15,15*c,_?{status:_}:void 0);a(e.data),u(e.total),o(null)}catch(a){var e,t;o((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar transacciones"),console.error("Error:",a)}finally{l(!1)}},y=e=>({pending:"Pendiente",completed:"Completado",failed:"Fallido",refunded:"Reembolsado",cancelled:"Cancelado"})[e]||e,b=e=>{switch(e){case"completed":return r().success;case"pending":return r().warning;case"failed":case"cancelled":return r().danger;case"refunded":return r().info;default:return""}},N=e=>e?({stripe:"Stripe",mercado_pago:"Mercado Pago",paypal:"PayPal"})[e]||e:"N/A";return t&&0===e.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:(0,n.jsx)("p",{children:"Cargando transacciones..."})}):(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{style:{marginBottom:"20px",color:"#2c3e50"},children:"Gesti\xf3n de Transacciones"}),d&&(0,n.jsx)("div",{style:{padding:"15px",backgroundColor:"#f8d7da",color:"#721c24",borderRadius:"4px",marginBottom:"20px"},children:d}),(0,n.jsx)("div",{className:r().tableHeader,style:{marginBottom:"20px"},children:(0,n.jsx)("div",{className:r().filterContainer,children:(0,n.jsxs)("select",{className:r().filterSelect,value:_,onChange:e=>{p(e.target.value),m(0)},children:[(0,n.jsx)("option",{value:"",children:"Todos los estados"}),(0,n.jsx)("option",{value:"pending",children:"Pendiente"}),(0,n.jsx)("option",{value:"completed",children:"Completado"}),(0,n.jsx)("option",{value:"failed",children:"Fallido"}),(0,n.jsx)("option",{value:"refunded",children:"Reembolsado"}),(0,n.jsx)("option",{value:"cancelled",children:"Cancelado"})]})})}),0===e.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px",backgroundColor:"white",borderRadius:"8px"},children:(0,n.jsx)("p",{style:{color:"#7f8c8d"},children:"No hay transacciones registradas"})}):(0,n.jsxs)("div",{className:r().tableContainer,children:[(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Usuario"}),(0,n.jsx)("th",{children:"Sorteo"}),(0,n.jsx)("th",{children:"Tienda"}),(0,n.jsx)("th",{children:"Monto"}),(0,n.jsx)("th",{children:"Tickets"}),(0,n.jsx)("th",{children:"M\xe9todo"}),(0,n.jsx)("th",{children:"Estado"}),(0,n.jsx)("th",{children:"Fecha"}),(0,n.jsx)("th",{children:"Acciones"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{style:{margin:"0",fontWeight:"600",color:"#2c3e50"},children:e.user.name}),(0,n.jsx)("small",{style:{color:"#7f8c8d"},children:e.user.email})]})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{style:{margin:"0",color:"#2c3e50"},children:e.raffle.product.name}),(0,n.jsxs)("small",{style:{color:"#7f8c8d"},children:["ID: ",e.raffle.id.substring(0,8),"..."]})]})}),(0,n.jsx)("td",{children:e.raffle.shop.name}),(0,n.jsx)("td",{children:(0,n.jsxs)("strong",{style:{color:"#27ae60"},children:["S/. ",Number(e.amount).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),(0,n.jsx)("td",{children:e.ticketQuantity}),(0,n.jsx)("td",{children:N(e.paymentMethod)}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"".concat(r().statusBadge," ").concat(b(e.status)),children:y(e.status)})}),(0,n.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:r().actionButtons,children:(0,n.jsx)("button",{className:"".concat(r().btn," ").concat(r().btnPrimary),onClick:()=>{g(e),j(!0)},children:"Ver"})})})]},e.id))})]}),(0,n.jsxs)("div",{className:r().pagination,children:[(0,n.jsx)("button",{className:r().paginationBtn,disabled:0===c,onClick:()=>m(c-1),children:"← Anterior"}),(0,n.jsxs)("span",{style:{padding:"8px 12px"},children:["P\xe1gina ",c+1," de ",Math.ceil(h/15)]}),(0,n.jsx)("button",{className:r().paginationBtn,disabled:c>=Math.ceil(h/15)-1,onClick:()=>m(c+1),children:"Siguiente →"})]})]}),f&&x&&(0,n.jsx)("div",{className:"".concat(r().modal," ").concat(f?r().open:""),children:(0,n.jsxs)("div",{className:r().modalContent,children:[(0,n.jsx)("div",{className:r().modalHeader,children:(0,n.jsx)("h2",{children:"Detalles de la Transacci\xf3n"})}),(0,n.jsxs)("div",{className:r().modalBody,children:[(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"ID de Transacci\xf3n"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50",wordBreak:"break-all"},children:x.id})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Usuario"}),(0,n.jsxs)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:[x.user.name," (",x.user.email,")"]})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Sorteo"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:x.raffle.product.name}),(0,n.jsxs)("small",{style:{color:"#7f8c8d"},children:["ID: ",x.raffle.id]})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Tienda"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:x.raffle.shop.name})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Monto"}),(0,n.jsxs)("p",{style:{margin:"5px 0",color:"#27ae60",fontSize:"20px",fontWeight:"bold"},children:["S/. ",Number(x.amount).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Cantidad de Tickets"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:x.ticketQuantity})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"M\xe9todo de Pago"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:N(x.paymentMethod)})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Estado"}),(0,n.jsx)("p",{style:{margin:"5px 0"},children:(0,n.jsx)("span",{className:"".concat(r().statusBadge," ").concat(b(x.status)),children:y(x.status)})})]}),x.externalTransactionId&&(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"ID de Transacci\xf3n Externa"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50",wordBreak:"break-all"},children:x.externalTransactionId})]}),x.failureReason&&(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Motivo de Fallo"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#e74c3c"},children:x.failureReason})]}),(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Fecha de Creaci\xf3n"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:new Date(x.createdAt).toLocaleString("es-PE")})]}),x.completedAt&&(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Fecha de Completado"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#2c3e50"},children:new Date(x.completedAt).toLocaleString("es-PE")})]}),x.failedAt&&(0,n.jsxs)("div",{className:r().formGroup,children:[(0,n.jsx)("label",{children:"Fecha de Fallo"}),(0,n.jsx)("p",{style:{margin:"5px 0",color:"#e74c3c"},children:new Date(x.failedAt).toLocaleString("es-PE")})]})]}),(0,n.jsx)("div",{className:r().modalFooter,children:(0,n.jsx)("button",{className:"".concat(r().btn," ").concat(r().btnSecondary),onClick:()=>j(!1),children:"Cerrar"})})]})})]})}},3404:function(e,a,t){"use strict";t.d(a,{x:function(){return r}});var n=t(7147),i=t(9190);let s=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(e);if(!e.endsWith("/api")){let a=e.endsWith("/")?e.slice(0,-1):e;return"".concat(a,"/api")}return e})();class l{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,a){return this.client.get(e,a)}async post(e,a,t){return this.client.post(e,a,t)}async put(e,a){return this.client.put(e,a)}async delete(e){return this.client.delete(e)}constructor(){(0,n._)(this,"client",void 0),this.client=i.Z.create({baseURL:s,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let a=localStorage.getItem("token");console.log("API Request - Token from localStorage:",a),a?(e.headers.Authorization="Bearer ".concat(a),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let r=new l},8075:function(e,a,t){"use strict";t.d(a,{d:function(){return i}});var n=t(3404);let i={getDashboardStats:async()=>(await n.x.get("/admin/dashboard/stats")).data,getPendingRaffles:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(await n.x.get("/admin/raffles/pending",{params:{limit:e,offset:a}})).data},getActiveRaffles:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;return(await n.x.get("/admin/raffles/active",{params:{limit:e,offset:a,...t&&{shopId:t}}})).data},getFinishedRaffles:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;return(await n.x.get("/admin/raffles/finished",{params:{limit:e,offset:a,...t&&{shopId:t}}})).data},getRaffleDetail:async e=>(await n.x.get("/admin/raffles/".concat(e))).data,approveRaffle:async e=>(await n.x.put("/admin/raffles/".concat(e,"/approve"),{})).data,rejectRaffle:async(e,a)=>(await n.x.put("/admin/raffles/".concat(e,"/reject"),{reason:a})).data,cancelRaffle:async(e,a)=>(await n.x.put("/admin/raffles/".concat(e,"/cancel"),{reason:a})).data,executeRaffle:async e=>(await n.x.put("/admin/raffles/".concat(e,"/execute"),{})).data,getAllShops:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;return(await n.x.get("/admin/shops",{params:{limit:e,offset:a,...t&&{status:t}}})).data},getShopDetail:async e=>(await n.x.get("/admin/shops/".concat(e))).data,changeShopStatus:async(e,a,t)=>(await n.x.put("/admin/shops/".concat(e,"/status"),{status:a,...t&&{reason:t}})).data,getAllUsers:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;return(await n.x.get("/admin/users",{params:{limit:e,offset:a,...t&&{role:t}}})).data},getUserDetail:async e=>(await n.x.get("/admin/users/".concat(e))).data,getAuditLogs:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;return(await n.x.get("/admin/audit/logs",{params:{limit:e,offset:a,...t}})).data},getEntityAuditLogs:async(e,a)=>(await n.x.get("/admin/audit/entity/".concat(e,"/").concat(a))).data,getAllPayments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;return(await n.x.get("/admin/payments",{params:{limit:e,offset:a,...(null==t?void 0:t.status)&&{status:t.status},...(null==t?void 0:t.userId)&&{userId:t.userId},...(null==t?void 0:t.raffleId)&&{raffleId:t.raffleId}}})).data},getPaymentDetail:async e=>(await n.x.get("/admin/payments/".concat(e))).data}},865:function(e){e.exports={adminContainer:"admin_adminContainer__Eh90a",sidebar:"admin_sidebar__mXGAh",closed:"admin_closed__0toWD",sidebarHeader:"admin_sidebarHeader__R_jJT",toggleBtn:"admin_toggleBtn__xfw93",sidebarNav:"admin_sidebarNav__WZtZQ",navItem:"admin_navItem__DShOG",navIcon:"admin_navIcon__3O_Ni",sidebarFooter:"admin_sidebarFooter__3hkih",userInfo:"admin_userInfo__LVYmW",logoutBtn:"admin_logoutBtn__XlQ6d",mainContent:"admin_mainContent__LKiLk",topBar:"admin_topBar__NC1F1",content:"admin_content__q9bCm",unauthorized:"admin_unauthorized__IQ2li",unauthorizedContent:"admin_unauthorizedContent__WVcyS",dashboardGrid:"admin_dashboardGrid__eoxej",statCard:"admin_statCard__x3Xg1",warning:"admin_warning__AVQfv",danger:"admin_danger__sptcS",success:"admin_success__1eje9",info:"admin_info__tS_KQ",statHeader:"admin_statHeader__eYJkD",statIcon:"admin_statIcon__S4aUI",value:"admin_value__TMFsT",tableContainer:"admin_tableContainer__GVxxO",tableHeader:"admin_tableHeader___8L4K",filterContainer:"admin_filterContainer__6WkIk",filterSelect:"admin_filterSelect__OG5aD",filterInput:"admin_filterInput__qeIwH",table:"admin_table__Wi_BD",tableHead:"admin_tableHead__HUGym",tableHeadCell:"admin_tableHeadCell__aGufP",tableCell:"admin_tableCell__sFHBM",tableBodyRow:"admin_tableBodyRow__arYS1",statusBadge:"admin_statusBadge__6Bfmv",pending:"admin_pending__ESWta",active:"admin_active__3D2D6",finished:"admin_finished__w5SWW",rejected:"admin_rejected__lb5oK",cancelled:"admin_cancelled__Qaxdn",verified:"admin_verified__eRcoj",blocked:"admin_blocked__bylJi",actionButtons:"admin_actionButtons__n1G3j",btn:"admin_btn__lDLne",btnPrimary:"admin_btnPrimary__uvegQ",btnSuccess:"admin_btnSuccess__IODau",btnDanger:"admin_btnDanger__76sY_",btnWarning:"admin_btnWarning__5Fqhx",btnSecondary:"admin_btnSecondary__assgO",modal:"admin_modal__DNvY3",open:"admin_open__bBxNv",modalContent:"admin_modalContent__tBgZX",modalHeader:"admin_modalHeader__frRax",modalBody:"admin_modalBody__6pNmP",modalFooter:"admin_modalFooter__jGFWx",formGroup:"admin_formGroup__W0nf_",pagination:"admin_pagination__0kMUt",paginationBtn:"admin_paginationBtn__oojru"}}},function(e){e.O(0,[9286,1044,2489,7115,2364,1744],function(){return e(e.s=2448)}),_N_E=e.O()}]);