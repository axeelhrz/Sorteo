(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7634],{8469:function(e,t,a){Promise.resolve().then(a.bind(a,6917))},6917:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(7821),n=a(8078),i=a(8504),l=a(6312),o=a(7511),r=a(2265),c=a(8674),d=a.n(c);function u(){let e=(0,i.useRouter)(),{user:t,isLoading:a}=(0,l.a)(),[c,u]=(0,n.useState)([]),[m,h]=(0,n.useState)(null),[v,_]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null),[g,E]=(0,n.useState)(null),[j,N]=(0,n.useState)({status:"",type:"",shopId:""});(0,n.useEffect)(()=>{a||t&&"admin"===t.role||e.push("/login")},[a,t,e]),(0,n.useEffect)(()=>{(null==t?void 0:t.role)==="admin"&&(R(),C())},[t,j]);let R=async()=>{try{_(!0);let{complaints:e}=await r.P.getAllComplaints({status:j.status||void 0,type:j.type||void 0,shopId:j.shopId||void 0,limit:50});u(e)}catch(a){var e,t;f((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar reclamos")}finally{_(!1)}},C=async()=>{try{let e=await r.P.getComplaintStats();E(e)}catch(e){console.error("Error al cargar estad\xedsticas:",e)}},S=e=>{h(e)},y=async()=>{try{let{data:e,filename:t}=await r.P.exportComplaints({status:j.status||void 0,shopId:j.shopId||void 0}),a=document.createElement("a");a.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(e){f("Error al exportar reclamos")}};return a||!t||"admin"!==t.role?(0,s.jsx)("div",{className:d().loading,children:"Cargando..."}):(0,s.jsxs)("div",{className:d().container,children:[(0,s.jsxs)("div",{className:d().header,children:[(0,s.jsx)("h1",{children:"Gesti\xf3n de Reclamos"}),(0,s.jsx)("p",{children:"Administra y resuelve reclamos de usuarios"})]}),g&&(0,s.jsxs)("div",{className:d().statsGrid,children:[(0,s.jsxs)("div",{className:d().statCard,children:[(0,s.jsx)("div",{className:d().statValue,children:g.total}),(0,s.jsx)("div",{className:d().statLabel,children:"Total"})]}),(0,s.jsxs)("div",{className:d().statCard,children:[(0,s.jsx)("div",{className:d().statValue,style:{color:"#FFA500"},children:g.pending}),(0,s.jsx)("div",{className:d().statLabel,children:"Pendientes"})]}),(0,s.jsxs)("div",{className:d().statCard,children:[(0,s.jsx)("div",{className:d().statValue,style:{color:"#4169E1"},children:g.inReview}),(0,s.jsx)("div",{className:d().statLabel,children:"En Revisi\xf3n"})]}),(0,s.jsxs)("div",{className:d().statCard,children:[(0,s.jsx)("div",{className:d().statValue,style:{color:"#228B22"},children:g.resolved}),(0,s.jsx)("div",{className:d().statLabel,children:"Resueltos"})]}),(0,s.jsxs)("div",{className:d().statCard,children:[(0,s.jsx)("div",{className:d().statValue,style:{color:"#DC143C"},children:g.rejected}),(0,s.jsx)("div",{className:d().statLabel,children:"Rechazados"})]})]}),x&&(0,s.jsx)("div",{className:d().error,children:x}),(0,s.jsxs)("div",{className:d().mainContent,children:[(0,s.jsxs)("div",{className:d().listPanel,children:[(0,s.jsxs)("div",{className:d().filterBar,children:[(0,s.jsxs)("select",{value:j.status,onChange:e=>N({...j,status:e.target.value}),className:d().filterSelect,children:[(0,s.jsx)("option",{value:"",children:"Todos los estados"}),(0,s.jsx)("option",{value:o.P5.PENDING,children:"Pendiente"}),(0,s.jsx)("option",{value:o.P5.IN_REVIEW,children:"En Revisi\xf3n"}),(0,s.jsx)("option",{value:o.P5.RESOLVED,children:"Resuelto"}),(0,s.jsx)("option",{value:o.P5.REJECTED,children:"Rechazado"})]}),(0,s.jsxs)("select",{value:j.type,onChange:e=>N({...j,type:e.target.value}),className:d().filterSelect,children:[(0,s.jsx)("option",{value:"",children:"Todos los tipos"}),(0,s.jsx)("option",{value:o.pM.PRIZE_NOT_DELIVERED,children:"No entrega del premio"}),(0,s.jsx)("option",{value:o.pM.DIFFERENT_PRODUCT,children:"Producto diferente"}),(0,s.jsx)("option",{value:o.pM.PURCHASE_PROBLEM,children:"Problema en compra"}),(0,s.jsx)("option",{value:o.pM.SHOP_BEHAVIOR,children:"Problema con tienda"}),(0,s.jsx)("option",{value:o.pM.RAFFLE_FRAUD,children:"Fraude"}),(0,s.jsx)("option",{value:o.pM.TECHNICAL_ISSUE,children:"Problema t\xe9cnico"}),(0,s.jsx)("option",{value:o.pM.PAYMENT_ERROR,children:"Error de pago"})]}),(0,s.jsx)("button",{onClick:y,className:d().exportBtn,children:"\uD83D\uDCE5 Exportar CSV"})]}),v?(0,s.jsx)("div",{className:d().loading,children:"Cargando reclamos..."}):(0,s.jsx)("div",{className:d().complaintsList,children:c.map(e=>{var t;return(0,s.jsxs)("div",{className:"".concat(d().complaintItem," ").concat((null==m?void 0:m.id)===e.id?d().selected:""),onClick:()=>S(e),children:[(0,s.jsxs)("div",{className:d().itemHeader,children:[(0,s.jsxs)("strong",{children:["#",e.complaintNumber]}),(0,s.jsx)("span",{className:d().statusBadge,style:{backgroundColor:e.status===o.P5.PENDING?"#FFA500":e.status===o.P5.IN_REVIEW?"#4169E1":e.status===o.P5.RESOLVED?"#228B22":"#DC143C"},children:e.status})]}),(0,s.jsx)("p",{className:d().itemType,children:e.type}),(0,s.jsx)("p",{className:d().itemUser,children:null===(t=e.user)||void 0===t?void 0:t.email}),(0,s.jsx)("small",{children:new Date(e.createdAt).toLocaleDateString("es-ES")})]},e.id)})})]}),m&&(0,s.jsx)("div",{className:d().detailPanel,children:(0,s.jsx)(p,{complaint:m,onUpdate:R})})]})]})}function p(e){var t,a;let{complaint:i,onUpdate:l}=e,[c,u]=(0,n.useState)(!1),[p,m]=(0,n.useState)({status:i.status,resolution:i.resolution||"",resolutionNotes:i.resolutionNotes||""}),h=async e=>{e.preventDefault(),u(!0);try{await r.P.updateComplaint(i.id,{status:p.status,resolution:p.resolution,resolutionNotes:p.resolutionNotes}),l()}catch(e){console.error("Error al actualizar:",e)}finally{u(!1)}};return(0,s.jsxs)("div",{className:d().detailContent,children:[(0,s.jsxs)("h2",{children:["#",i.complaintNumber]}),(0,s.jsxs)("div",{className:d().detailInfo,children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Usuario:"})," ",null===(t=i.user)||void 0===t?void 0:t.email]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Tipo:"})," ",i.type]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Tienda:"})," ",(null===(a=i.shop)||void 0===a?void 0:a.name)||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Creado:"})," ",new Date(i.createdAt).toLocaleDateString("es-ES")]})]}),(0,s.jsxs)("div",{className:d().descriptionBox,children:[(0,s.jsx)("h3",{children:"Descripci\xf3n"}),(0,s.jsx)("p",{children:i.description})]}),(0,s.jsxs)("form",{onSubmit:h,className:d().updateForm,children:[(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{children:"Estado"}),(0,s.jsxs)("select",{value:p.status,onChange:e=>m({...p,status:e.target.value}),children:[(0,s.jsx)("option",{value:o.P5.PENDING,children:"Pendiente"}),(0,s.jsx)("option",{value:o.P5.IN_REVIEW,children:"En Revisi\xf3n"}),(0,s.jsx)("option",{value:o.P5.RESOLVED,children:"Resuelto"}),(0,s.jsx)("option",{value:o.P5.REJECTED,children:"Rechazado"})]})]}),(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{children:"Resoluci\xf3n"}),(0,s.jsxs)("select",{value:p.resolution,onChange:e=>m({...p,resolution:e.target.value}),children:[(0,s.jsx)("option",{value:"",children:"Seleccionar..."}),(0,s.jsx)("option",{value:"resolved_user_favor",children:"A favor del usuario"}),(0,s.jsx)("option",{value:"resolved_shop_favor",children:"A favor de la tienda"}),(0,s.jsx)("option",{value:"resolved_platform_favor",children:"Resoluci\xf3n parcial"}),(0,s.jsx)("option",{value:"rejected",children:"Rechazado"})]})]}),(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{children:"Notas de Resoluci\xf3n"}),(0,s.jsx)("textarea",{value:p.resolutionNotes,onChange:e=>m({...p,resolutionNotes:e.target.value}),rows:4,placeholder:"Escribe las notas de resoluci\xf3n..."})]}),(0,s.jsx)("button",{type:"submit",disabled:c,className:d().submitBtn,children:c?"Actualizando...":"Actualizar Reclamo"})]})]})}},6312:function(e,t,a){"use strict";a.d(t,{a:function(){return i}});var s=a(8078),n=a(7197);function i(){let[e,t]=(0,s.useState)(!1),a=(0,n.t)();return(0,s.useEffect)(()=>{let e=localStorage.getItem("token");console.log("Token from localStorage:",e),e&&(console.log("Setting token in store:",e),a.setToken(e)),t(!0)},[]),{...a,isHydrated:e}}},3404:function(e,t,a){"use strict";a.d(t,{x:function(){return l}});var s=a(7147),n=a(9190);class i{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,a){return this.client.post(e,t,a)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}constructor(){(0,s._)(this,"client",void 0),this.client=n.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let l=new i},2265:function(e,t,a){"use strict";a.d(t,{P:function(){return n}});var s=a(3404);let n={createComplaint:async e=>(await s.x.post("/complaints",e)).data,getComplaintById:async e=>(await s.x.get("/complaints/".concat(e))).data,async getUserComplaints(e){let t=new URLSearchParams;return(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.type)&&t.append("type",e.type),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString()),(await s.x.get("/complaints/user/my-complaints?".concat(t.toString()))).data},async getShopComplaints(e,t){let a=new URLSearchParams;return(null==t?void 0:t.status)&&a.append("status",t.status),(null==t?void 0:t.limit)&&a.append("limit",t.limit.toString()),(null==t?void 0:t.offset)&&a.append("offset",t.offset.toString()),(await s.x.get("/complaints/shop/".concat(e,"?").concat(a.toString()))).data},async getAllComplaints(e){let t=new URLSearchParams;return(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.type)&&t.append("type",e.type),(null==e?void 0:e.shopId)&&t.append("shopId",e.shopId),(null==e?void 0:e.raffleId)&&t.append("raffleId",e.raffleId),(null==e?void 0:e.startDate)&&t.append("startDate",e.startDate),(null==e?void 0:e.endDate)&&t.append("endDate",e.endDate),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString()),(await s.x.get("/complaints?".concat(t.toString()))).data},updateComplaint:async(e,t)=>(await s.x.put("/complaints/".concat(e),t)).data,addMessage:async(e,t)=>(await s.x.post("/complaints/".concat(e,"/messages"),{message:t})).data,getMessages:async e=>(await s.x.get("/complaints/".concat(e,"/messages"))).data,addAttachment:async(e,t)=>(await s.x.post("/complaints/".concat(e,"/attachments"),t)).data,getAttachments:async e=>(await s.x.get("/complaints/".concat(e,"/attachments"))).data,cancelComplaint:async e=>(await s.x.put("/complaints/".concat(e,"/cancel"),{})).data,async exportComplaints(e){let t=new URLSearchParams;return(null==e?void 0:e.startDate)&&t.append("startDate",e.startDate),(null==e?void 0:e.endDate)&&t.append("endDate",e.endDate),(null==e?void 0:e.shopId)&&t.append("shopId",e.shopId),(null==e?void 0:e.status)&&t.append("status",e.status),(await s.x.get("/complaints/export/csv?".concat(t.toString()))).data},getComplaintStats:async()=>(await s.x.get("/complaints/stats/overview")).data}},7197:function(e,t,a){"use strict";a.d(t,{t:function(){return i}});var s=a(3020),n=a(4302);let i=(0,s.Ue)()((0,n.tJ)(e=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:t=>e({user:t,isAuthenticated:!!t}),setToken:t=>{t?localStorage.setItem("token",t):localStorage.removeItem("token"),e({token:t})},setIsLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),logout:()=>{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},7511:function(e,t,a){"use strict";var s,n,i,l,o,r;a.d(t,{Fq:function(){return i},P5:function(){return n},pM:function(){return s}}),(l=s||(s={})).PRIZE_NOT_DELIVERED="prize_not_delivered",l.DIFFERENT_PRODUCT="different_product",l.PURCHASE_PROBLEM="purchase_problem",l.SHOP_BEHAVIOR="shop_behavior",l.RAFFLE_FRAUD="raffle_fraud",l.TECHNICAL_ISSUE="technical_issue",l.PAYMENT_ERROR="payment_error",(o=n||(n={})).PENDING="pending",o.IN_REVIEW="in_review",o.RESOLVED="resolved",o.REJECTED="rejected",o.CANCELLED="cancelled",(r=i||(i={})).RESOLVED_USER_FAVOR="resolved_user_favor",r.RESOLVED_SHOP_FAVOR="resolved_shop_favor",r.RESOLVED_PLATFORM_FAVOR="resolved_platform_favor",r.REJECTED="rejected",r.CANCELLED="cancelled"},8674:function(e){e.exports={container:"admin-complaints_container__8QfLW",header:"admin-complaints_header__Fz5C0",statsGrid:"admin-complaints_statsGrid__DXBoc",statCard:"admin-complaints_statCard__V7bxL",statValue:"admin-complaints_statValue__OdamP",statLabel:"admin-complaints_statLabel__ACZHF",error:"admin-complaints_error__uaSfR",loading:"admin-complaints_loading__D4kEr",mainContent:"admin-complaints_mainContent__TAuB8",listPanel:"admin-complaints_listPanel__LqnrU",filterBar:"admin-complaints_filterBar__EmdVI",filterSelect:"admin-complaints_filterSelect__D6GTv",exportBtn:"admin-complaints_exportBtn__grQpC",complaintsList:"admin-complaints_complaintsList__oiNhV",complaintItem:"admin-complaints_complaintItem__U_Mts",selected:"admin-complaints_selected__gGio3",itemHeader:"admin-complaints_itemHeader__05p6Q",statusBadge:"admin-complaints_statusBadge__UAr51",itemType:"admin-complaints_itemType__Z3nsz",itemUser:"admin-complaints_itemUser__pR1qj",detailPanel:"admin-complaints_detailPanel___1LoM",detailContent:"admin-complaints_detailContent__qIM0f",detailInfo:"admin-complaints_detailInfo__MSMtf",descriptionBox:"admin-complaints_descriptionBox__jnd2i",updateForm:"admin-complaints_updateForm__5vaHv",formGroup:"admin-complaints_formGroup__VDOVk",submitBtn:"admin-complaints_submitBtn__i4iCO"}}},function(e){e.O(0,[6249,2489,4755,7115,2364,1744],function(){return e(e.s=8469)}),_N_E=e.O()}]);