(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7634],{8469:function(e,s,a){Promise.resolve().then(a.bind(a,6917))},6917:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return m}});var t=a(7821),l=a(8078),i=a(8504),n=a(6312),o=a(7511),r=a(2265),d=a(8674),c=a.n(d);function m(){let e=(0,i.useRouter)(),{user:s,isLoading:a}=(0,n.a)(),[d,m]=(0,l.useState)([]),[p,h]=(0,l.useState)(null),[v,_]=(0,l.useState)(!0),[x,j]=(0,l.useState)(null),[N,E]=(0,l.useState)(null),[C,f]=(0,l.useState)({status:"",type:"",shopId:""});(0,l.useEffect)(()=>{a||s&&"admin"===s.role||e.push("/login")},[a,s,e]),(0,l.useEffect)(()=>{(null==s?void 0:s.role)==="admin"&&(R(),g())},[s,C]);let R=async()=>{try{_(!0);let{complaints:e}=await r.P.getAllComplaints({status:C.status||void 0,type:C.type||void 0,shopId:C.shopId||void 0,limit:50});m(e)}catch(a){var e,s;j((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Error al cargar reclamos")}finally{_(!1)}},g=async()=>{try{let e=await r.P.getComplaintStats();E(e)}catch(e){console.error("Error al cargar estad\xedsticas:",e)}},P=e=>{h(e)},b=async()=>{try{let{data:e,filename:s}=await r.P.exportComplaints({status:C.status||void 0,shopId:C.shopId||void 0}),a=document.createElement("a");a.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",s),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(e){j("Error al exportar reclamos")}};return a||!s||"admin"!==s.role?(0,t.jsx)("div",{className:c().loading,children:"Cargando..."}):(0,t.jsxs)("div",{className:c().container,children:[(0,t.jsxs)("div",{className:c().header,children:[(0,t.jsx)("h1",{children:"Gesti\xf3n de Reclamos"}),(0,t.jsx)("p",{children:"Administra y resuelve reclamos de usuarios"})]}),N&&(0,t.jsxs)("div",{className:c().statsGrid,children:[(0,t.jsxs)("div",{className:c().statCard,children:[(0,t.jsx)("div",{className:c().statValue,children:N.total}),(0,t.jsx)("div",{className:c().statLabel,children:"Total"})]}),(0,t.jsxs)("div",{className:c().statCard,children:[(0,t.jsx)("div",{className:c().statValue,style:{color:"#FFA500"},children:N.pending}),(0,t.jsx)("div",{className:c().statLabel,children:"Pendientes"})]}),(0,t.jsxs)("div",{className:c().statCard,children:[(0,t.jsx)("div",{className:c().statValue,style:{color:"#4169E1"},children:N.inReview}),(0,t.jsx)("div",{className:c().statLabel,children:"En Revisi\xf3n"})]}),(0,t.jsxs)("div",{className:c().statCard,children:[(0,t.jsx)("div",{className:c().statValue,style:{color:"#228B22"},children:N.resolved}),(0,t.jsx)("div",{className:c().statLabel,children:"Resueltos"})]}),(0,t.jsxs)("div",{className:c().statCard,children:[(0,t.jsx)("div",{className:c().statValue,style:{color:"#DC143C"},children:N.rejected}),(0,t.jsx)("div",{className:c().statLabel,children:"Rechazados"})]})]}),x&&(0,t.jsx)("div",{className:c().error,children:x}),(0,t.jsxs)("div",{className:c().mainContent,children:[(0,t.jsxs)("div",{className:c().listPanel,children:[(0,t.jsxs)("div",{className:c().filterBar,children:[(0,t.jsxs)("select",{value:C.status,onChange:e=>f({...C,status:e.target.value}),className:c().filterSelect,children:[(0,t.jsx)("option",{value:"",children:"Todos los estados"}),(0,t.jsx)("option",{value:o.P5.PENDING,children:"Pendiente"}),(0,t.jsx)("option",{value:o.P5.IN_REVIEW,children:"En Revisi\xf3n"}),(0,t.jsx)("option",{value:o.P5.RESOLVED,children:"Resuelto"}),(0,t.jsx)("option",{value:o.P5.REJECTED,children:"Rechazado"})]}),(0,t.jsxs)("select",{value:C.type,onChange:e=>f({...C,type:e.target.value}),className:c().filterSelect,children:[(0,t.jsx)("option",{value:"",children:"Todos los tipos"}),(0,t.jsx)("option",{value:o.pM.PRIZE_NOT_DELIVERED,children:"No entrega del premio"}),(0,t.jsx)("option",{value:o.pM.DIFFERENT_PRODUCT,children:"Producto diferente"}),(0,t.jsx)("option",{value:o.pM.PURCHASE_PROBLEM,children:"Problema en compra"}),(0,t.jsx)("option",{value:o.pM.SHOP_BEHAVIOR,children:"Problema con tienda"}),(0,t.jsx)("option",{value:o.pM.RAFFLE_FRAUD,children:"Fraude"}),(0,t.jsx)("option",{value:o.pM.TECHNICAL_ISSUE,children:"Problema t\xe9cnico"}),(0,t.jsx)("option",{value:o.pM.PAYMENT_ERROR,children:"Error de pago"})]}),(0,t.jsx)("button",{onClick:b,className:c().exportBtn,children:"\uD83D\uDCE5 Exportar CSV"})]}),v?(0,t.jsx)("div",{className:c().loading,children:"Cargando reclamos..."}):(0,t.jsx)("div",{className:c().complaintsList,children:d.map(e=>{var s;return(0,t.jsxs)("div",{className:"".concat(c().complaintItem," ").concat((null==p?void 0:p.id)===e.id?c().selected:""),onClick:()=>P(e),children:[(0,t.jsxs)("div",{className:c().itemHeader,children:[(0,t.jsxs)("strong",{children:["#",e.complaintNumber]}),(0,t.jsx)("span",{className:c().statusBadge,style:{backgroundColor:e.status===o.P5.PENDING?"#FFA500":e.status===o.P5.IN_REVIEW?"#4169E1":e.status===o.P5.RESOLVED?"#228B22":"#DC143C"},children:e.status})]}),(0,t.jsx)("p",{className:c().itemType,children:e.type}),(0,t.jsx)("p",{className:c().itemUser,children:null===(s=e.user)||void 0===s?void 0:s.email}),(0,t.jsx)("small",{children:new Date(e.createdAt).toLocaleDateString("es-ES")})]},e.id)})})]}),p&&(0,t.jsx)("div",{className:c().detailPanel,children:(0,t.jsx)(u,{complaint:p,onUpdate:R})})]})]})}function u(e){var s,a;let{complaint:i,onUpdate:n}=e,[d,m]=(0,l.useState)(!1),[u,p]=(0,l.useState)({status:i.status,resolution:i.resolution||"",resolutionNotes:i.resolutionNotes||""}),h=async e=>{e.preventDefault(),m(!0);try{await r.P.updateComplaint(i.id,{status:u.status,resolution:u.resolution,resolutionNotes:u.resolutionNotes}),n()}catch(e){console.error("Error al actualizar:",e)}finally{m(!1)}};return(0,t.jsxs)("div",{className:c().detailContent,children:[(0,t.jsxs)("h2",{children:["#",i.complaintNumber]}),(0,t.jsxs)("div",{className:c().detailInfo,children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Usuario:"})," ",null===(s=i.user)||void 0===s?void 0:s.email]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Tipo:"})," ",i.type]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Tienda:"})," ",(null===(a=i.shop)||void 0===a?void 0:a.name)||"N/A"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Creado:"})," ",new Date(i.createdAt).toLocaleDateString("es-ES")]})]}),(0,t.jsxs)("div",{className:c().descriptionBox,children:[(0,t.jsx)("h3",{children:"Descripci\xf3n"}),(0,t.jsx)("p",{children:i.description})]}),(0,t.jsxs)("form",{onSubmit:h,className:c().updateForm,children:[(0,t.jsxs)("div",{className:c().formGroup,children:[(0,t.jsx)("label",{children:"Estado"}),(0,t.jsxs)("select",{value:u.status,onChange:e=>p({...u,status:e.target.value}),children:[(0,t.jsx)("option",{value:o.P5.PENDING,children:"Pendiente"}),(0,t.jsx)("option",{value:o.P5.IN_REVIEW,children:"En Revisi\xf3n"}),(0,t.jsx)("option",{value:o.P5.RESOLVED,children:"Resuelto"}),(0,t.jsx)("option",{value:o.P5.REJECTED,children:"Rechazado"})]})]}),(0,t.jsxs)("div",{className:c().formGroup,children:[(0,t.jsx)("label",{children:"Resoluci\xf3n"}),(0,t.jsxs)("select",{value:u.resolution,onChange:e=>p({...u,resolution:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar..."}),(0,t.jsx)("option",{value:"resolved_user_favor",children:"A favor del usuario"}),(0,t.jsx)("option",{value:"resolved_shop_favor",children:"A favor de la tienda"}),(0,t.jsx)("option",{value:"resolved_platform_favor",children:"Resoluci\xf3n parcial"}),(0,t.jsx)("option",{value:"rejected",children:"Rechazado"})]})]}),(0,t.jsxs)("div",{className:c().formGroup,children:[(0,t.jsx)("label",{children:"Notas de Resoluci\xf3n"}),(0,t.jsx)("textarea",{value:u.resolutionNotes,onChange:e=>p({...u,resolutionNotes:e.target.value}),rows:4,placeholder:"Escribe las notas de resoluci\xf3n..."})]}),(0,t.jsx)("button",{type:"submit",disabled:d,className:c().submitBtn,children:d?"Actualizando...":"Actualizar Reclamo"})]})]})}},8674:function(e){e.exports={container:"admin-complaints_container__8QfLW",header:"admin-complaints_header__Fz5C0",statsGrid:"admin-complaints_statsGrid__DXBoc",statCard:"admin-complaints_statCard__V7bxL",statValue:"admin-complaints_statValue__OdamP",statLabel:"admin-complaints_statLabel__ACZHF",error:"admin-complaints_error__uaSfR",loading:"admin-complaints_loading__D4kEr",mainContent:"admin-complaints_mainContent__TAuB8",listPanel:"admin-complaints_listPanel__LqnrU",filterBar:"admin-complaints_filterBar__EmdVI",filterSelect:"admin-complaints_filterSelect__D6GTv",exportBtn:"admin-complaints_exportBtn__grQpC",complaintsList:"admin-complaints_complaintsList__oiNhV",complaintItem:"admin-complaints_complaintItem__U_Mts",selected:"admin-complaints_selected__gGio3",itemHeader:"admin-complaints_itemHeader__05p6Q",statusBadge:"admin-complaints_statusBadge__UAr51",itemType:"admin-complaints_itemType__Z3nsz",itemUser:"admin-complaints_itemUser__pR1qj",detailPanel:"admin-complaints_detailPanel___1LoM",detailContent:"admin-complaints_detailContent__qIM0f",detailInfo:"admin-complaints_detailInfo__MSMtf",descriptionBox:"admin-complaints_descriptionBox__jnd2i",updateForm:"admin-complaints_updateForm__5vaHv",formGroup:"admin-complaints_formGroup__VDOVk",submitBtn:"admin-complaints_submitBtn__i4iCO"}}},function(e){e.O(0,[6249,2907,4183,1044,2489,8641,4755,6999,7115,2364,1744],function(){return e(e.s=8469)}),_N_E=e.O()}]);