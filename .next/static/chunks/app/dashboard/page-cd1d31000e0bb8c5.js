(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{2449:function(e,t,a){Promise.resolve().then(a.bind(a,3532))},3532:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var s=a(7821),r=a(8078),o=a(8504),i=a(7851),n=a(6312),d=a(9422),l=a(2379),c=a(6943),u=a(9298),h=a(9730),p=a(2962),m=a.n(p);function g(){var e,t,p,g;let x=(0,o.useRouter)(),{user:f,token:v,logout:j,isHydrated:b}=(0,n.a)(),[y,N]=(0,r.useState)(!0),[w,I]=(0,r.useState)([]),[A,S]=(0,r.useState)(null),[C,_]=(0,r.useState)([]),[E,k]=(0,r.useState)([]),[D,T]=(0,r.useState)([]),[P,F]=(0,r.useState)([]),[B,R]=(0,r.useState)("overview"),[z,L]=(0,r.useState)([]),[q,O]=(0,r.useState)(null),[V,G]=(0,r.useState)(!1),[M,U]=(0,r.useState)(!1),[W,H]=(0,r.useState)(""),[X,Y]=(0,r.useState)(null),[J,K]=(0,r.useState)(null),[Z,Q]=(0,r.useState)([]),[$,ee]=(0,r.useState)([]),[et,ea]=(0,r.useState)(null),[es,er]=(0,r.useState)({}),[eo,ei]=(0,r.useState)(null),[en,ed]=(0,r.useState)(!1),[el,ec]=(0,r.useState)(!1),[eu,eh]=(0,r.useState)(!1),[ep,em]=(0,r.useState)(!1),[eg,ex]=(0,r.useState)({shopId:"",productId:"",specialConditions:""}),[ef,ev]=(0,r.useState)({shopId:"",name:"",description:"",value:0,height:0,width:0,depth:0,category:"",mainImage:""}),[ej,eb]=(0,r.useState)([]),[,ey]=(0,r.useState)(null),[eN,ew]=(0,r.useState)(!1),[eI,eA]=(0,r.useState)(null),[eS,eC]=(0,r.useState)(null),[e_,eE]=(0,r.useState)(null),ek=async()=>{var e,t,s,r,o,i,n;try{let{collection:r,query:o,getDocs:i,doc:n,getDoc:d}=await Promise.resolve().then(a.bind(a,6534)),{db:l}=await Promise.resolve().then(a.bind(a,6532)),c=r(l,"raffles"),u=await i(o(c));console.log("\uD83D\uDCCA Total sorteos en la base de datos:",u.docs.length);let h={};u.docs.forEach(e=>{let t=e.data().status||"sin-status";h[t]=(h[t]||0)+1}),console.log("\uD83D\uDCCA Status encontrados en todos los sorteos:",h);let p=["pending_approval","Pendiente de Aprobaci\xf3n","pending","Pendiente"],m=u.docs.filter(e=>{let t=(e.data().status||"").toLowerCase();return p.some(e=>{let a=e.toLowerCase();return t===a||t.includes("pending")||t.includes("pendiente")})});console.log("\uD83D\uDCCA Sorteos pendientes encontrados despu\xe9s de filtrar:",m.length),0===m.length&&console.warn('⚠️ No se encontraron sorteos pendientes. Verifica que los sorteos tengan status "pending_approval" en Firestore.');let g=[];for(let a of m){let r=a.data();console.log("\uD83D\uDD0D Sorteo encontrado:",{id:a.id,status:r.status,productId:r.productId,createdAt:r.createdAt});let o=null;if(r.productId)try{let e=await d(n(l,"products",r.productId));if(e.exists()){let t=e.data();o={id:e.id,name:t.name||"",value:t.value||0}}}catch(e){console.log("Error loading product:",e)}let i=(null===(e=r.createdAt)||void 0===e?void 0:e.toDate())||new Date;g.push({id:a.id,productId:r.productId||"",product:o||void 0,totalTickets:r.totalTickets||0,soldTickets:r.soldTickets||0,status:r.status||"draft",createdAt:i.toISOString(),productValue:r.productValue||0,winnerTicketId:r.winnerTicketId,raffleExecutedAt:null===(s=r.raffleExecutedAt)||void 0===s?void 0:null===(t=s.toDate())||void 0===t?void 0:t.toISOString()})}return g.sort((e,t)=>{let a=new Date(e.createdAt).getTime();return new Date(t.createdAt).getTime()-a}),console.log("✅ Sorteos pendientes cargados:",g.length),console.log("\uD83D\uDCCB IDs de sorteos pendientes:",g.map(e=>e.id)),g}catch(e){if(console.error("Error loading pending raffles:",e),"failed-precondition"===e.code||(null===(r=e.message)||void 0===r?void 0:r.includes("index"))){console.log("⚠️ \xcdndice faltante, intentando sin orderBy...");try{let{collection:e,query:t,where:s,getDocs:r,doc:d,getDoc:l}=await Promise.resolve().then(a.bind(a,6534)),{db:c}=await Promise.resolve().then(a.bind(a,6532)),u=e(c,"raffles"),h=t(u,s("status","==","pending_approval")),p=await r(h),m=[];for(let e of p.docs){let t=e.data(),a=null;if(t.productId)try{let e=await l(d(c,"products",t.productId));if(e.exists()){let t=e.data();a={id:e.id,name:t.name||"",value:t.value||0}}}catch(e){console.log("Error loading product:",e)}let s=(null===(o=t.createdAt)||void 0===o?void 0:o.toDate())||new Date;m.push({id:e.id,productId:t.productId||"",product:a||void 0,totalTickets:t.totalTickets||0,soldTickets:t.soldTickets||0,status:t.status||"draft",createdAt:s.toISOString(),productValue:t.productValue||0,winnerTicketId:t.winnerTicketId,raffleExecutedAt:null===(n=t.raffleExecutedAt)||void 0===n?void 0:null===(i=n.toDate())||void 0===i?void 0:i.toISOString()})}return m.sort((e,t)=>{let a=new Date(e.createdAt).getTime();return new Date(t.createdAt).getTime()-a}),m}catch(e){console.error("Error en reintento:",e)}}return[]}};(0,r.useEffect)(()=>{(async()=>{if(b){if(!v){x.push("/login");return}try{if(!f){x.push("/login");return}let s=[],r=null;if("shop"===f.role)try{console.log("\uD83D\uDED2 Obteniendo tienda para usuario con rol shop...");let{collection:o,query:i,where:n,getDocs:d}=await Promise.resolve().then(a.bind(a,6534)),{db:l}=await Promise.resolve().then(a.bind(a,6532)),c=o(l,"shops"),u=i(c,n("userId","==",f.id)),h=await d(u);if(h.empty)console.log("⚠️ No se encontr\xf3 tienda para este usuario");else{var e,t;let a=h.docs[0],o=a.data();r={id:a.id,userId:o.userId||f.id,name:o.name||"",description:o.description,logo:o.logo,publicEmail:o.publicEmail,phone:o.phone,socialMedia:o.socialMedia,status:o.status||"pending",createdAt:(null===(e=o.createdAt)||void 0===e?void 0:e.toDate())||new Date,updatedAt:(null===(t=o.updatedAt)||void 0===t?void 0:t.toDate())||new Date},console.log("✅ Tienda obtenida:",r),S(r),s=[r],I(s),ex(e=>({...e,shopId:r.id})),ev(e=>({...e,shopId:r.id}))}}catch(e){console.error("❌ Error obteniendo tienda del usuario:",e),ei("Error al obtener tu tienda. Por favor, recarga la p\xe1gina.")}else try{s=await d.m.getAllShops(),I(s)}catch(e){console.log("No shops found")}try{if(s.length>0){let e=[];for(let t of s)try{let a=await l._.getProductsByShop(t.id);e.push(...a)}catch(e){console.log("No products found for shop ".concat(t.id))}_(e)}else try{let e=await l._.getAllProducts();_(e)}catch(e){console.log("No products found")}}catch(e){console.log("No products found")}try{if("admin"===f.role){let e=await ek();L(e);let{raffleService:t}=await a.e(6204).then(a.bind(a,6204)),s=await t.getAllRaffles();k(s.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,raffleExecutedAt:e.raffleExecutedAt instanceof Date?e.raffleExecutedAt.toISOString():e.raffleExecutedAt})))}else{let{raffleService:e}=await a.e(6204).then(a.bind(a,6204)),t=await e.getAllRaffles();if(k(t.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,raffleExecutedAt:e.raffleExecutedAt instanceof Date?e.raffleExecutedAt.toISOString():e.raffleExecutedAt}))),"user"===f.role){let e=t.filter(e=>"draft"!==e.status&&"rejected"!==e.status);Q(e.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,raffleExecutedAt:e.raffleExecutedAt instanceof Date?e.raffleExecutedAt.toISOString():e.raffleExecutedAt})))}}}catch(e){console.log("No raffles found:",e)}try{"user"===f.role?ee([]):T([])}catch(e){console.log("No tickets found")}try{F([])}catch(e){console.log("No deposits found")}r?(ex(e=>({...e,shopId:r.id})),ev(e=>({...e,shopId:r.id}))):s.length>0&&(ex(e=>({...e,shopId:s[0].id})),ev(e=>({...e,shopId:s[0].id})))}catch(e){console.error("Error fetching data:",e),ei("Error al cargar los datos"),j(),x.push("/login")}finally{N(!1)}}})()},[b,v]);let eD=async()=>{try{await j(),x.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n:",e),x.push("/")}},eT=()=>{ed(!1),ex({shopId:"",productId:"",specialConditions:""})},eP=async e=>{if(e.preventDefault(),!eg.shopId||!eg.productId){ei("Por favor completa todos los campos requeridos");return}eh(!0);try{let{raffleService:e}=await a.e(6204).then(a.bind(a,6204)),t=await e.createRaffle({shopId:eg.shopId,productId:eg.productId,specialConditions:eg.specialConditions||void 0}),s={...t,createdAt:t.createdAt instanceof Date?t.createdAt.toISOString():t.createdAt,raffleExecutedAt:t.raffleExecutedAt instanceof Date?t.raffleExecutedAt.toISOString():t.raffleExecutedAt};k([...E,s]),eT(),ei(null)}catch(e){ei(e.message||"Error al crear el sorteo")}finally{eh(!1)}},eF=(e,t,a)=>{let s=[];return e<=0&&s.push("La altura debe ser mayor a 0"),t<=0&&s.push("El ancho debe ser mayor a 0"),a<=0&&s.push("La profundidad debe ser mayor a 0"),e>15&&s.push("La altura no puede exceder ".concat(15,"cm")),t>15&&s.push("El ancho no puede exceder ".concat(15,"cm")),a>15&&s.push("La profundidad no puede exceder ".concat(15,"cm")),s},eB=(e,t)=>{let a=parseFloat(t)||0;ev(t=>({...t,[e]:a})),eb(eF("height"===e?a:ef.height,"width"===e?a:ef.width,"depth"===e?a:ef.depth))},eR=async()=>{if((null==f?void 0:f.role)!=="shop"||A)A?ev(e=>({...e,shopId:A.id})):w.length>0&&ev(e=>({...e,shopId:w[0].id}));else try{let{collection:s,query:r,where:o,getDocs:i}=await Promise.resolve().then(a.bind(a,6534)),{db:n}=await Promise.resolve().then(a.bind(a,6532)),d=s(n,"shops"),l=r(d,o("userId","==",f.id)),c=await i(l);if(!c.empty){var e,t;let a=c.docs[0],s=a.data(),r={id:a.id,userId:s.userId||f.id,name:s.name||"",description:s.description,logo:s.logo,publicEmail:s.publicEmail,phone:s.phone,socialMedia:s.socialMedia,status:s.status||"pending",createdAt:(null===(e=s.createdAt)||void 0===e?void 0:e.toDate())||new Date,updatedAt:(null===(t=s.updatedAt)||void 0===t?void 0:t.toDate())||new Date};S(r),I([r]),ev(e=>({...e,shopId:r.id}))}}catch(e){console.error("Error obteniendo tienda al abrir modal:",e),ei("No se pudo obtener la informaci\xf3n de tu tienda. Por favor, recarga la p\xe1gina.");return}ec(!0)},ez=()=>{ec(!1),ev({shopId:w.length>0?w[0].id:"",name:"",description:"",value:0,height:0,width:0,depth:0,category:"",mainImage:""}),eb([]),ey(null)},eL=async e=>{eA(e),ei(null);try{ei("Funci\xf3n de pausar sorteo a\xfan no implementada en Firebase")}catch(e){ei(e.message||"Error al pausar el sorteo")}finally{eA(null)}},eq=async e=>{eC(e),ei(null);try{ei("Funci\xf3n de reanudar sorteo a\xfan no implementada en Firebase")}catch(e){ei(e.message||"Error al reanudar el sorteo")}finally{eC(null)}},eO=async e=>{if(window.confirm("\xbfEst\xe1s seguro de que deseas enviar este sorteo a aprobaci\xf3n? Una vez enviado, no podr\xe1s editarlo hasta que sea aprobado o rechazado.")){eE(e),ei(null);try{let{raffleService:t}=await a.e(6204).then(a.bind(a,6204)),s=await t.submitForApproval(e),r={...s,createdAt:s.createdAt instanceof Date?s.createdAt.toISOString():s.createdAt,raffleExecutedAt:s.raffleExecutedAt instanceof Date?s.raffleExecutedAt.toISOString():s.raffleExecutedAt};if(k(E.map(t=>t.id===e?r:t)),(null==f?void 0:f.role)==="admin"){let e=await ek();L(e)}}catch(e){ei(e.message||"Error al enviar el sorteo a aprobaci\xf3n")}finally{eE(null)}}},eV=async e=>{try{var t,s,r,o;let{doc:i,getDoc:n}=await Promise.resolve().then(a.bind(a,6534)),{db:d}=await Promise.resolve().then(a.bind(a,6532)),l=await n(i(d,"raffles",e));if(!l.exists()){ei("Sorteo no encontrado");return}let c=l.data(),u=null;if(c.productId)try{let e=await n(i(d,"products",c.productId));if(e.exists()){let t=e.data();u={id:e.id,name:t.name||"",value:t.value||0}}}catch(e){console.log("Error loading product:",e)}let h={id:l.id,productId:c.productId||"",product:u||void 0,totalTickets:c.totalTickets||0,soldTickets:c.soldTickets||0,status:c.status||"draft",createdAt:(null===(s=c.createdAt)||void 0===s?void 0:null===(t=s.toDate())||void 0===t?void 0:t.toISOString())||new Date().toISOString(),productValue:c.productValue||0,winnerTicketId:c.winnerTicketId,raffleExecutedAt:null===(o=c.raffleExecutedAt)||void 0===o?void 0:null===(r=o.toDate())||void 0===r?void 0:r.toISOString()};O(h),G(!0)}catch(e){ei(e.message||"Error al cargar detalles del sorteo")}},eG=async e=>{if(window.confirm("\xbfEst\xe1s seguro de que deseas aprobar este sorteo?")){Y(e),ei(null);try{let{doc:t,updateDoc:s,serverTimestamp:r}=await Promise.resolve().then(a.bind(a,6534)),{db:o}=await Promise.resolve().then(a.bind(a,6532)),i=t(o,"raffles",e);await s(i,{status:"active",updatedAt:r(),activatedAt:r()}),L(z.filter(t=>t.id!==e)),G(!1),O(null);let n=await ek();L(n);let{raffleService:d}=await a.e(6204).then(a.bind(a,6204)),l=await d.getAllRaffles();k(l.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,raffleExecutedAt:e.raffleExecutedAt instanceof Date?e.raffleExecutedAt.toISOString():e.raffleExecutedAt})))}catch(e){ei(e.message||"Error al aprobar el sorteo")}finally{Y(null)}}},eM=async e=>{if(!W.trim()){ei("Por favor ingresa un motivo de rechazo");return}K(e),ei(null);try{let{doc:t,updateDoc:s,serverTimestamp:r}=await Promise.resolve().then(a.bind(a,6534)),{db:o}=await Promise.resolve().then(a.bind(a,6532)),i=t(o,"raffles",e);await s(i,{status:"rejected",updatedAt:r(),rejectReason:W.trim()}),L(z.filter(t=>t.id!==e)),U(!1),G(!1),H(""),O(null);let n=await ek();L(n);let{raffleService:d}=await a.e(6204).then(a.bind(a,6204)),l=await d.getAllRaffles();k(l.map(e=>({...e,createdAt:e.createdAt instanceof Date?e.createdAt.toISOString():e.createdAt,raffleExecutedAt:e.raffleExecutedAt instanceof Date?e.raffleExecutedAt.toISOString():e.raffleExecutedAt})))}catch(e){ei(e.message||"Error al rechazar el sorteo")}finally{K(null)}},eU=async e=>{var t,a,s;let r=es[e]||1,o=Z.find(t=>t.id===e);if(!o){ei("Sorteo no encontrado");return}let i=o.totalTickets-o.soldTickets;if(r>i){ei("Solo hay ".concat(i," tickets disponibles"));return}if(r<1){ei("Debes comprar al menos 1 ticket");return}ea(e),ei(null);try{let e=o.productValue||(null===(t=o.product)||void 0===t?void 0:t.value)||0,a=await c.Z.createPayment({raffleId:o.id,amount:r*e,ticketQuantity:r});x.push("/checkout?paymentId=".concat(a.id))}catch(e){ei((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"Error al procesar la compra. Intenta de nuevo."),ea(null)}},eW=async e=>{var t,a,s,r;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];if(o){if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(o.type)){ei("Tipo de archivo no permitido. Solo se permiten im\xe1genes (JPEG, PNG, WEBP, GIF)");return}if(o.size>5242880){ei("El archivo es demasiado grande. M\xe1ximo permitido: 5MB");return}ey(o),ei(null),ew(!0);try{let e=await u.T.uploadProductImage(o);ev(t=>({...t,mainImage:e}));let t=e.startsWith("http")?e:"".concat(((a="http://localhost:3001/api",void 0===a)?void 0:a.replace("/api",""))||"http://localhost:3001").concat(e);ev(e=>({...e,mainImage:t}))}catch(e){ei((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)||"Error al subir la imagen"),ey(null)}finally{ew(!1)}}},eH=async e=>{if(e.preventDefault(),ei(null),!ef.shopId&&(null==f?void 0:f.role)==="shop")try{let{collection:e,query:r,where:o,getDocs:i}=await Promise.resolve().then(a.bind(a,6534)),{db:n}=await Promise.resolve().then(a.bind(a,6532)),d=e(n,"shops"),l=r(d,o("userId","==",f.id)),c=await i(l);if(c.empty){ei("No se encontr\xf3 tu tienda. Por favor, recarga la p\xe1gina.");return}{var t,s;let e=c.docs[0],a=e.data(),r={id:e.id,userId:a.userId||f.id,name:a.name||"",description:a.description,logo:a.logo,publicEmail:a.publicEmail,phone:a.phone,socialMedia:a.socialMedia,status:a.status||"pending",createdAt:(null===(t=a.createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(s=a.updatedAt)||void 0===s?void 0:s.toDate())||new Date};S(r),I([r]),ev(e=>({...e,shopId:r.id}))}}catch(e){console.error("Error obteniendo tienda:",e),ei("No se pudo obtener la informaci\xf3n de tu tienda. Por favor, recarga la p\xe1gina e intenta nuevamente.");return}if(!ef.shopId){(null==f?void 0:f.role)==="shop"?ei("No se pudo asociar tu tienda. Por favor, recarga la p\xe1gina e intenta nuevamente."):ei("Por favor selecciona una tienda para crear el producto.");return}let r=eF(ef.height,ef.width,ef.depth);if(r.length>0){eb(r),ei("Por favor corrige los errores en las dimensiones");return}if(!ef.name||!ef.description||ef.value<=0){ei("Por favor completa todos los campos requeridos");return}em(!0);try{let e=await l._.createProduct(ef);_([...C,e]),ez(),ei(null),ey(null)}catch(e){ei(e.message||"Error al crear el producto")}finally{em(!1)}},eX=e=>({pending:"#FFA500",verified:"#4CAF50",blocked:"#F44336",active:"#2196F3",paused:"#FF9800",inactive:"#9E9E9E",archived:"#757575",draft:"#FF9800",pending_approval:"#FFC107",sold_out:"#9C27B0",finished:"#4CAF50",cancelled:"#F44336",rejected:"#F44336",sold:"#2196F3",winner:"#FFD700",refunded:"#9E9E9E",held:"#FF9800",released:"#4CAF50",executed:"#F44336"})[e]||"#757575";return!b||y?(0,s.jsx)("div",{className:m().dashboard,children:(0,s.jsx)("div",{className:m().loadingContainer,children:(0,s.jsx)("p",{children:"Cargando..."})})}):f?(0,s.jsxs)("div",{className:m().dashboard,children:[(0,s.jsx)("div",{className:m().header,children:(0,s.jsxs)("div",{className:m().headerContent,children:[(0,s.jsxs)("div",{className:m().headerTitle,children:[(0,s.jsx)(h.Z,{size:"small",showText:!1}),(0,s.jsx)("h1",{children:"Dashboard"})]}),(0,s.jsxs)("div",{className:m().userSection,children:[(0,s.jsxs)("div",{className:m().userInfo,children:[(0,s.jsx)("div",{className:m().userAvatar,children:(0,s.jsx)(i.fzv,{})}),(0,s.jsxs)("div",{className:m().userDetails,children:[(0,s.jsx)("p",{className:m().userName,children:f.name}),(0,s.jsx)("p",{className:m().email,children:f.email}),(0,s.jsx)("span",{className:m().role,children:f.role})]})]}),(0,s.jsxs)("button",{onClick:eD,className:m().logoutBtn,children:[(0,s.jsx)(i.xqh,{className:m().logoutIcon}),"Cerrar Sesi\xf3n"]})]})]})}),eo&&(0,s.jsx)("div",{className:m().errorBanner,children:eo}),(0,s.jsx)("div",{className:m().tabsContainer,children:"user"===f.role?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"".concat(m().tab," ").concat("overview"===B?m().activeTab:""),onClick:()=>R("overview"),children:"Resumen"}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("raffles"===B?m().activeTab:""),onClick:()=>R("raffles"),children:["Sorteos Disponibles (",Z.length,")"]}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("tickets"===B?m().activeTab:""),onClick:()=>R("tickets"),children:["Mis Tickets (",$.length,")"]})]}):"admin"===f.role?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("pending"===B?m().activeTab:""),onClick:()=>R("pending"),children:[(0,s.jsx)(i.TCC,{className:m().tabIcon}),"Sorteos Pendientes (",z.length,")"]}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("overview"===B?m().activeTab:""),onClick:()=>R("overview"),children:[(0,s.jsx)(i.orK,{className:m().tabIcon}),"Resumen"]}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("raffles"===B?m().activeTab:""),onClick:()=>R("raffles"),children:[(0,s.jsx)(i.KCr,{className:m().tabIcon}),"Todos los Sorteos (",E.length,")"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"".concat(m().tab," ").concat("overview"===B?m().activeTab:""),onClick:()=>R("overview"),children:"Resumen"}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("products"===B?m().activeTab:""),onClick:()=>R("products"),children:["Productos (",C.length,")"]}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("raffles"===B?m().activeTab:""),onClick:()=>R("raffles"),children:["Sorteos (",E.length,")"]}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("tickets"===B?m().activeTab:""),onClick:()=>R("tickets"),children:["Tickets (",D.length,")"]}),(0,s.jsxs)("button",{className:"".concat(m().tab," ").concat("deposits"===B?m().activeTab:""),onClick:()=>R("deposits"),children:["Dep\xf3sitos (",P.length,")"]})]})}),(0,s.jsxs)("div",{className:m().content,children:["pending"===B&&"admin"===f.role&&(0,s.jsxs)("div",{className:m().tableContainer,children:[(0,s.jsx)("div",{className:m().tableHeader,children:(0,s.jsx)("h2",{children:"Sorteos Pendientes de Aprobaci\xf3n"})}),0===z.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No hay sorteos pendientes de aprobaci\xf3n"}):(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Tienda"}),(0,s.jsx)("th",{children:"Producto"}),(0,s.jsx)("th",{children:"Valor"}),(0,s.jsx)("th",{children:"Total Tickets"}),(0,s.jsx)("th",{children:"Requiere Dep\xf3sito"}),(0,s.jsx)("th",{children:"Fecha Creaci\xf3n"}),(0,s.jsx)("th",{children:"Acciones"})]})}),(0,s.jsx)("tbody",{children:z.map(e=>{var t,a,r;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(null===(t=e.shop)||void 0===t?void 0:t.name)||"N/A"}),(0,s.jsx)("td",{children:(0,s.jsx)("strong",{children:(null===(a=e.product)||void 0===a?void 0:a.name)||"Producto desconocido"})}),(0,s.jsxs)("td",{children:["S/. ",(e.productValue||(null===(r=e.product)||void 0===r?void 0:r.value)||0).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsx)("td",{children:e.totalTickets.toLocaleString()}),(0,s.jsx)("td",{children:e.requiresDeposit?(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#FF9800"},children:"S\xed"}):(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#4CAF50"},children:"No"})}),(0,s.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"})}),(0,s.jsx)("td",{children:(0,s.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,s.jsx)("button",{className:m().createBtn,onClick:()=>eV(e.id),style:{padding:"6px 12px",fontSize:"12px"},children:"Ver Detalles"})})})]},e.id)})})]})]}),"products"===B&&"shop"===f.role&&(0,s.jsxs)("div",{className:m().tableContainer,children:[(0,s.jsxs)("div",{className:m().tableHeader,children:[(0,s.jsx)("h2",{children:"Productos"}),(0,s.jsx)("button",{className:m().createBtn,onClick:eR,children:"Crear Producto"})]}),0===C.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No hay productos creados"}):(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Nombre"}),(0,s.jsx)("th",{children:"Valor"}),(0,s.jsx)("th",{children:"Dimensiones"}),(0,s.jsx)("th",{children:"Requiere Dep\xf3sito"}),(0,s.jsx)("th",{children:"Estado"})]})}),(0,s.jsx)("tbody",{children:C.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)("strong",{children:e.name})}),(0,s.jsxs)("td",{children:["S/. ",e.value.toLocaleString()]}),(0,s.jsxs)("td",{children:[e.height,"\xd7",e.width,"\xd7",e.depth," cm"]}),(0,s.jsx)("td",{children:e.requiresDeposit?(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#FF9800"},children:"S\xed"}):(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#4CAF50"},children:"No"})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:eX(e.status)},children:e.status})})]},e.id))})]})]}),"overview"===B&&(0,s.jsx)("div",{className:m().overviewGrid,children:"user"===f.role?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.KCr,{})}),(0,s.jsx)("h3",{children:"Sorteos Disponibles"}),(0,s.jsx)("p",{className:m().bigNumber,children:Z.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Sorteos activos para participar"})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.E25,{})}),(0,s.jsx)("h3",{children:"Mis Tickets"}),(0,s.jsx)("p",{className:m().bigNumber,children:$.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Tickets comprados"}),(0,s.jsx)("div",{className:m().statusBreakdown,children:$.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["Vendidos: ",$.filter(e=>"sold"===e.status).length]}),(0,s.jsxs)("span",{children:["Ganadores: ",$.filter(e=>"winner"===e.status).length]})]})})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.HR2,{})}),(0,s.jsx)("h3",{children:"Sorteos Participados"}),(0,s.jsx)("p",{className:m().bigNumber,children:new Set($.map(e=>e.raffleId)).size}),(0,s.jsx)("p",{className:m().subtitle,children:"Diferentes sorteos"})]})]}):"admin"===f.role?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.TCC,{})}),(0,s.jsx)("h3",{children:"Sorteos Pendientes"}),(0,s.jsx)("p",{className:m().bigNumber,children:z.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Esperando aprobaci\xf3n"})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.KCr,{})}),(0,s.jsx)("h3",{children:"Sorteos Activos"}),(0,s.jsx)("p",{className:m().bigNumber,children:E.filter(e=>"active"===e.status).length}),(0,s.jsx)("p",{className:m().subtitle,children:"Sorteos en curso"})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i._rq,{})}),(0,s.jsx)("h3",{children:"Sorteos Finalizados"}),(0,s.jsx)("p",{className:m().bigNumber,children:E.filter(e=>"finished"===e.status).length}),(0,s.jsx)("p",{className:m().subtitle,children:"Sorteos completados"})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.x8h,{})}),(0,s.jsx)("h3",{children:"Total Sorteos"}),(0,s.jsx)("p",{className:m().bigNumber,children:E.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Todos los sorteos"}),(0,s.jsxs)("div",{className:m().statusBreakdown,children:[(0,s.jsxs)("span",{children:["Pendientes: ",z.length]}),(0,s.jsxs)("span",{children:["Activos: ",E.filter(e=>"active"===e.status).length]}),(0,s.jsxs)("span",{children:["Finalizados: ",E.filter(e=>"finished"===e.status).length]})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.zFh,{})}),(0,s.jsx)("h3",{children:"Productos"}),(0,s.jsx)("p",{className:m().bigNumber,children:C.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Total de productos"}),(0,s.jsx)("div",{className:m().statusBreakdown,children:C.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["Activos: ",C.filter(e=>"active"===e.status).length]}),(0,s.jsxs)("span",{children:["Inactivos: ",C.filter(e=>"inactive"===e.status).length]}),(0,s.jsxs)("span",{children:["Con dep\xf3sito: ",C.filter(e=>e.requiresDeposit).length]})]})})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.KCr,{})}),(0,s.jsx)("h3",{children:"Sorteos"}),(0,s.jsx)("p",{className:m().bigNumber,children:E.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Total de sorteos"}),(0,s.jsx)("div",{className:m().statusBreakdown,children:E.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["Activos: ",E.filter(e=>"active"===e.status).length]}),(0,s.jsxs)("span",{children:["Pausados: ",E.filter(e=>"paused"===e.status).length]}),(0,s.jsxs)("span",{children:["Finalizados: ",E.filter(e=>"finished"===e.status).length]}),(0,s.jsxs)("span",{children:["Tickets vendidos: ",E.reduce((e,t)=>e+t.soldTickets,0).toLocaleString()]})]})})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.E25,{})}),(0,s.jsx)("h3",{children:"Tickets"}),(0,s.jsx)("p",{className:m().bigNumber,children:D.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Total de tickets"}),(0,s.jsx)("div",{className:m().statusBreakdown,children:D.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["Vendidos: ",D.filter(e=>"sold"===e.status).length]}),(0,s.jsxs)("span",{children:["Ganadores: ",D.filter(e=>"winner"===e.status).length]}),(0,s.jsxs)("span",{children:["Reembolsados: ",D.filter(e=>"refunded"===e.status).length]})]})})]}),(0,s.jsxs)("div",{className:m().card,children:[(0,s.jsx)("div",{className:m().cardIcon,children:(0,s.jsx)(i.oQC,{})}),(0,s.jsx)("h3",{children:"Dep\xf3sitos"}),(0,s.jsx)("p",{className:m().bigNumber,children:P.length}),(0,s.jsx)("p",{className:m().subtitle,children:"Total de dep\xf3sitos"}),(0,s.jsx)("div",{className:m().statusBreakdown,children:P.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["Retenidos: ",P.filter(e=>"held"===e.status).length]}),(0,s.jsxs)("span",{children:["Liberados: ",P.filter(e=>"released"===e.status).length]}),(0,s.jsxs)("span",{children:["Monto total: $",P.reduce((e,t)=>e+t.amount,0).toLocaleString()]})]})})]})]})}),"raffles"===B&&(0,s.jsxs)("div",{className:m().tableContainer,children:[(0,s.jsxs)("div",{className:m().tableHeader,children:[(0,s.jsx)("h2",{children:"user"===f.role?"Sorteos Disponibles":"Sorteos"}),"user"!==f.role&&(0,s.jsx)("button",{className:m().createBtn,onClick:()=>{A?ex(e=>({...e,shopId:A.id})):w.length>0&&ex(e=>({...e,shopId:w[0].id})),ed(!0)},children:"Crear Sorteo"})]}),"user"===f.role?0===Z.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No hay sorteos disponibles en este momento"}):(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"20px",marginTop:"20px"},children:Z.map(e=>{var t,a,r,o;let i=e.totalTickets-e.soldTickets,n=e.totalTickets>0?e.soldTickets/e.totalTickets*100:0,d=(null===(t=e.product)||void 0===t?void 0:t.name)||(null===(a=C.find(t=>t.id===e.productId))||void 0===a?void 0:a.name)||"Producto desconocido",l=e.productValue||(null===(r=e.product)||void 0===r?void 0:r.value)||(null===(o=C.find(t=>t.id===e.productId))||void 0===o?void 0:o.value)||0,c=es[e.id]||1,u=c*l,h="active"===e.status&&i>0;return(0,s.jsxs)("div",{style:{border:"1px solid #e0e0e0",borderRadius:"8px",padding:"20px",backgroundColor:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",opacity:"cancelled"===e.status||"finished"===e.status?.8:1},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"10px"},children:[(0,s.jsx)("h3",{style:{marginTop:0,marginBottom:"10px",color:"#333",flex:1},children:d}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"5px",alignItems:"flex-end"},children:[(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:eX(e.status),fontSize:"12px",padding:"4px 8px",borderRadius:"4px",color:"#fff",fontWeight:"bold"},children:{active:"Activo",paused:"Pausado",sold_out:"Agotado",finished:"Finalizado",cancelled:"Cancelado",pending_approval:"Pendiente de Aprobaci\xf3n"}[e.status]||e.status}),"finished"===e.status&&e.winnerTicketId&&(0,s.jsx)("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:$.some(t=>t.raffleId===e.id&&t.id===e.winnerTicketId)?(0,s.jsx)("span",{style:{padding:"2px 6px",backgroundColor:"#4CAF50",color:"#fff",borderRadius:"4px",fontWeight:"bold"},children:"\uD83C\uDFC6 Ganaste!"}):(0,s.jsx)("span",{style:{color:"#999"},children:"Finalizado"})})]})]}),(0,s.jsxs)("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2",margin:"10px 0"},children:["S/. ",l.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsxs)("div",{style:{margin:"15px 0"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",fontSize:"14px"},children:[(0,s.jsx)("span",{children:"Tickets disponibles:"}),(0,s.jsxs)("strong",{style:{color:i>0?"#4CAF50":"#F44336"},children:[i.toLocaleString()," / ",e.totalTickets.toLocaleString()]})]}),(0,s.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e0e0e0",borderRadius:"4px",overflow:"hidden",marginTop:"5px"},children:(0,s.jsx)("div",{style:{width:"".concat(n,"%"),height:"100%",backgroundColor:n>=100?"#4CAF50":"#2196F3",transition:"width 0.3s ease"}})}),(0,s.jsxs)("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:[Math.round(n),"% vendido"]})]}),h&&(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Cantidad de tickets:"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,s.jsx)("button",{onClick:()=>er({...es,[e.id]:Math.max(1,c-1)}),disabled:c<=1,className:m().quantityBtn,children:"-"}),(0,s.jsx)("input",{type:"number",min:"1",max:i,value:c,onChange:t=>{let a=parseInt(t.target.value)||1;er({...es,[e.id]:Math.max(1,Math.min(a,i))})},style:{width:"70px",padding:"8px",border:"2px solid #e0e0e0",borderRadius:"6px",textAlign:"center",fontSize:"14px",fontWeight:"600"}}),(0,s.jsx)("button",{onClick:()=>er({...es,[e.id]:Math.min(i,c+1)}),disabled:c>=i,className:m().quantityBtn,children:"+"})]}),(0,s.jsxs)("p",{style:{fontSize:"14px",marginTop:"10px",fontWeight:"bold"},children:["Total: S/. ",u.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsx)("button",{onClick:()=>eU(e.id),disabled:et===e.id||0===i,className:m().buyTicketsBtn,children:et===e.id?"Procesando...":"Comprar Tickets"})]}),!h&&(0,s.jsxs)("div",{style:{marginTop:"20px",padding:"12px",backgroundColor:"#f5f5f5",borderRadius:"4px",textAlign:"center",color:"#666",fontSize:"14px"},children:["sold_out"===e.status&&"Este sorteo est\xe1 agotado","finished"===e.status&&"Este sorteo ha finalizado","cancelled"===e.status&&"Este sorteo ha sido cancelado","paused"===e.status&&"Este sorteo est\xe1 pausado","pending_approval"===e.status&&"Este sorteo est\xe1 pendiente de aprobaci\xf3n","active"!==e.status&&"sold_out"!==e.status&&"finished"!==e.status&&"cancelled"!==e.status&&"pending_approval"!==e.status&&"paused"!==e.status&&"No disponible para compra"]})]},e.id)})}):0===E.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No hay sorteos creados"}):(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Producto"}),(0,s.jsx)("th",{children:"Valor"}),(0,s.jsx)("th",{children:"Total Tickets"}),(0,s.jsx)("th",{children:"Vendidos"}),(0,s.jsx)("th",{children:"Disponibles"}),(0,s.jsx)("th",{children:"Progreso"}),(0,s.jsx)("th",{children:"Estado"}),(0,s.jsx)("th",{children:"Acciones"}),(0,s.jsx)("th",{children:"Fecha Creaci\xf3n"})]})}),(0,s.jsx)("tbody",{children:E.map(e=>{var t,a,r,o;let n=e.totalTickets>0?e.soldTickets/e.totalTickets*100:0,d=e.totalTickets-e.soldTickets,l=(null===(t=e.product)||void 0===t?void 0:t.name)||(null===(a=C.find(t=>t.id===e.productId))||void 0===a?void 0:a.name)||"Producto desconocido",c=e.productValue||(null===(r=e.product)||void 0===r?void 0:r.value)||(null===(o=C.find(t=>t.id===e.productId))||void 0===o?void 0:o.value)||0;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)("strong",{children:l})}),(0,s.jsxs)("td",{children:["S/. ",c.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsx)("td",{children:e.totalTickets.toLocaleString()}),(0,s.jsx)("td",{children:e.soldTickets.toLocaleString()}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{style:{color:d>0?"#4CAF50":"#F44336",fontWeight:"bold"},children:d.toLocaleString()})}),(0,s.jsx)("td",{children:(0,s.jsxs)("div",{className:m().progressBar,children:[(0,s.jsx)("div",{className:m().progressFill,style:{width:"".concat(n,"%")}}),(0,s.jsxs)("span",{className:m().progressText,children:[Math.round(n),"%"]})]})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:eX(e.status)},children:{draft:"Borrador",pending_approval:"Pendiente de Aprobaci\xf3n",active:"Activo",paused:"Pausado",sold_out:"Agotado",finished:"Finalizado",cancelled:"Cancelado",rejected:"Rechazado"}[e.status]||e.status})}),(0,s.jsx)("td",{children:(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",alignItems:"center"},children:["draft"===e.status&&"shop"===f.role&&(0,s.jsx)("button",{className:m().createBtn,onClick:()=>eO(e.id),disabled:e_===e.id,style:{padding:"6px 12px",fontSize:"12px",background:"linear-gradient(135deg, #4CAF50 0%, #388E3C 100%)",whiteSpace:"nowrap"},title:"Enviar este sorteo a aprobaci\xf3n para que los usuarios puedan comprar tickets",children:e_===e.id?"Enviando...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i._rq,{style:{marginRight:"4px"}}),"Enviar a Aprobaci\xf3n"]})}),"active"===e.status&&"shop"===f.role&&(0,s.jsx)("button",{className:m().cancelBtn,onClick:()=>eL(e.id),disabled:eI===e.id,style:{padding:"6px 12px",fontSize:"12px",backgroundColor:"#FF9800",color:"white",borderColor:"#FF9800",whiteSpace:"nowrap"},children:eI===e.id?"Pausando...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.R4s,{style:{marginRight:"4px"}}),"Pausar"]})}),"paused"===e.status&&"shop"===f.role&&(0,s.jsx)("button",{className:m().submitBtn,onClick:()=>eq(e.id),disabled:eS===e.id,style:{padding:"6px 12px",fontSize:"12px",whiteSpace:"nowrap"},children:eS===e.id?"Reanudando...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.BVE,{style:{marginRight:"4px"}}),"Reanudar"]})}),"pending_approval"===e.status&&"shop"===f.role&&(0,s.jsx)("span",{style:{fontSize:"12px",color:"#FF9800",fontStyle:"italic",whiteSpace:"nowrap"},children:"⏳ Esperando aprobaci\xf3n"})]})}),(0,s.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"})})]},e.id)})})]})]}),"tickets"===B&&(0,s.jsxs)("div",{className:m().tableContainer,children:[(0,s.jsx)("h2",{children:"user"===f.role?"Mis Tickets":"Tickets"}),"user"===f.role?0===$.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No has comprado tickets a\xfan. \xa1Participa en los sorteos disponibles!"}):(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"N\xfamero de Ticket"}),(0,s.jsx)("th",{children:"Producto del Sorteo"}),(0,s.jsx)("th",{children:"Valor del Producto"}),(0,s.jsx)("th",{children:"Estado"}),(0,s.jsx)("th",{children:"Fecha de Compra"})]})}),(0,s.jsx)("tbody",{children:$.map(e=>{var t,a,r,o;let i=E.find(t=>t.id===e.raffleId),n=(null==i?void 0:null===(t=i.product)||void 0===t?void 0:t.name)||(null===(a=C.find(e=>e.id===(null==i?void 0:i.productId)))||void 0===a?void 0:a.name)||"Producto desconocido",d=(null==i?void 0:i.productValue)||(null==i?void 0:null===(r=i.product)||void 0===r?void 0:r.value)||(null===(o=C.find(e=>e.id===(null==i?void 0:i.productId)))||void 0===o?void 0:o.value)||0,l=(null==i?void 0:i.status)==="finished"&&(null==i?void 0:i.winnerTicketId)===e.id,c=(null==i?void 0:i.status)==="finished";return(0,s.jsxs)("tr",{style:{backgroundColor:l?"#e8f5e9":"transparent"},children:[(0,s.jsxs)("td",{children:[(0,s.jsxs)("strong",{children:["#",e.number]}),l&&(0,s.jsx)("span",{style:{marginLeft:"8px",padding:"2px 8px",backgroundColor:"#4CAF50",color:"#fff",borderRadius:"4px",fontSize:"11px",fontWeight:"bold"},children:"\uD83C\uDFC6 GANADOR"})]}),(0,s.jsx)("td",{children:n}),(0,s.jsxs)("td",{children:["S/. ",d.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsx)("td",{children:l?(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#4CAF50",color:"#fff",fontWeight:"bold"},children:"\uD83C\uDFC6 Ganador"}):c?(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#9E9E9E",color:"#fff"},children:"Finalizado"}):(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:eX(e.status)},children:"sold"===e.status?"Comprado":"winner"===e.status?"Ganador":e.status})}),(0,s.jsx)("td",{children:e.purchasedAt?new Date(e.purchasedAt).toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"}):"-"})]},e.id)})})]}):0===D.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No hay tickets creados"}):(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"N\xfamero"}),(0,s.jsx)("th",{children:"Sorteo ID"}),(0,s.jsx)("th",{children:"Estado"})]})}),(0,s.jsx)("tbody",{children:D.slice(0,50).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsxs)("strong",{children:["#",e.number]})}),(0,s.jsxs)("td",{children:[e.raffleId.substring(0,8),"..."]}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:eX(e.status)},children:e.status})})]},e.id))})]}),"user"!==f.role&&D.length>50&&(0,s.jsxs)("p",{className:m().moreItems,children:["... y ",D.length-50," m\xe1s"]})]}),"deposits"===B&&"user"!==f.role&&(0,s.jsxs)("div",{className:m().tableContainer,children:[(0,s.jsx)("h2",{children:"Dep\xf3sitos"}),0===P.length?(0,s.jsx)("p",{className:m().emptyMessage,children:"No hay dep\xf3sitos creados"}):(0,s.jsxs)("table",{className:m().table,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Monto"}),(0,s.jsx)("th",{children:"Sorteo ID"}),(0,s.jsx)("th",{children:"Estado"})]})}),(0,s.jsx)("tbody",{children:P.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsxs)("strong",{children:["$",e.amount.toLocaleString()]})}),(0,s.jsxs)("td",{children:[e.raffleId.substring(0,8),"..."]}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:eX(e.status)},children:e.status})})]},e.id))})]})]}),en&&(0,s.jsx)("div",{className:m().modalOverlay,onClick:eT,children:(0,s.jsxs)("div",{className:m().modal,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:m().modalHeader,children:[(0,s.jsx)("h2",{children:"Crear Nuevo Sorteo"}),(0,s.jsx)("button",{className:m().closeBtn,onClick:eT,children:"\xd7"})]}),(0,s.jsxs)("form",{onSubmit:eP,className:m().form,children:[A?(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Tienda"}),(0,s.jsx)("div",{style:{padding:"10px",backgroundColor:"#f5f5f5",borderRadius:"4px",color:"#666"},children:(0,s.jsx)("strong",{children:A.name})})]}):(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"shopId",children:"Tienda *"}),(0,s.jsxs)("select",{id:"shopId",value:eg.shopId,onChange:e=>ex({...eg,shopId:e.target.value}),required:!0,className:m().input,children:[(0,s.jsx)("option",{value:"",children:"Selecciona una tienda"}),w.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productId",children:"Producto *"}),(0,s.jsxs)("select",{id:"productId",value:eg.productId,onChange:e=>{ex({...eg,productId:e.target.value})},required:!0,className:m().input,children:[(0,s.jsx)("option",{value:"",children:"Selecciona un producto"}),C.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," - S/. ",e.value.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]},e.id))]})]}),eg.productId&&(()=>{let e=C.find(e=>e.id===eg.productId),t=e?Math.floor(2*e.value):0;return(0,s.jsx)("div",{className:m().formGroup,children:(0,s.jsxs)("div",{style:{padding:"12px",backgroundColor:"#e3f2fd",borderRadius:"8px",fontSize:"14px",color:"#1976d2",border:"1px solid #90caf9"},children:[(0,s.jsx)("div",{style:{marginBottom:"8px",fontWeight:"600"},children:"\uD83D\uDCCA Informaci\xf3n del Sorteo"}),e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,s.jsx)("strong",{children:"Producto:"})," ",e.name]}),(0,s.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,s.jsx)("strong",{children:"Valor del producto:"})," S/. ",e.value.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsxs)("div",{style:{marginTop:"8px",padding:"8px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #90caf9"},children:[(0,s.jsx)("strong",{children:"\uD83C\uDFAB Tickets autom\xe1ticos:"})," ",t.toLocaleString()," tickets",(0,s.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["(Valor \xd7 2 = ",e.value.toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})," \xd7 2)"]})]})]})]})})})(),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"specialConditions",children:"Condiciones Especiales"}),(0,s.jsx)("textarea",{id:"specialConditions",value:eg.specialConditions,onChange:e=>ex({...eg,specialConditions:e.target.value}),placeholder:"Ingresa condiciones especiales del sorteo (opcional)",className:m().textarea,rows:4})]}),(0,s.jsxs)("div",{className:m().formActions,children:[(0,s.jsx)("button",{type:"button",onClick:eT,className:m().cancelBtn,children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:eu,className:m().submitBtn,children:eu?"Creando...":"Crear Sorteo"})]})]})]})}),el&&(0,s.jsx)("div",{className:m().modalOverlay,onClick:ez,children:(0,s.jsxs)("div",{className:m().modal,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:m().modalHeader,children:[(0,s.jsx)("h2",{children:"Crear Nuevo Producto"}),(0,s.jsx)("button",{className:m().closeBtn,onClick:ez,children:"\xd7"})]}),(0,s.jsxs)("form",{onSubmit:eH,className:m().form,children:[A&&(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Tienda"}),(0,s.jsx)("div",{style:{padding:"10px",backgroundColor:"#f5f5f5",borderRadius:"4px",color:"#666"},children:(0,s.jsx)("strong",{children:A.name})})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productName",children:"Nombre del Producto *"}),(0,s.jsx)("input",{type:"text",id:"productName",value:ef.name,onChange:e=>ev({...ef,name:e.target.value}),required:!0,className:m().input,placeholder:"Ej: iPhone 15 Pro Max"})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productDescription",children:"Descripci\xf3n *"}),(0,s.jsx)("textarea",{id:"productDescription",value:ef.description,onChange:e=>ev({...ef,description:e.target.value}),required:!0,className:m().textarea,rows:4,placeholder:"Describe el producto en detalle..."})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productValue",children:"Valor del Producto (S/.) *"}),(0,s.jsx)("input",{type:"number",id:"productValue",step:"0.01",min:"0.01",value:ef.value||"",onChange:e=>ev({...ef,value:parseFloat(e.target.value)||0}),required:!0,className:m().input,placeholder:"0.00"})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productCategory",children:"Categor\xeda (opcional)"}),(0,s.jsx)("input",{type:"text",id:"productCategory",value:ef.category,onChange:e=>ev({...ef,category:e.target.value}),className:m().input,placeholder:"Ej: Electr\xf3nica, Ropa, Hogar..."})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productMainImage",children:"Imagen Principal (opcional)"}),(0,s.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,s.jsx)("input",{type:"file",id:"productImageFile",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:eW,className:m().input,style:{marginBottom:"10px"},disabled:eN}),eN&&(0,s.jsx)("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:"Subiendo imagen..."}),ef.mainImage&&!eN&&(0,s.jsx)("div",{style:{marginTop:"10px"},children:(0,s.jsx)("img",{src:ef.mainImage,alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",borderRadius:"4px",border:"1px solid #ddd"}})})]}),(0,s.jsx)("small",{style:{display:"block",marginTop:"5px",color:"#666",fontSize:"12px"},children:"O ingresa una URL de imagen:"}),(0,s.jsx)("input",{type:"url",id:"productMainImage",value:ef.mainImage,onChange:e=>ev({...ef,mainImage:e.target.value}),className:m().input,placeholder:"https://ejemplo.com/imagen.jpg",style:{marginTop:"5px"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("h3",{style:{marginBottom:"10px",fontSize:"16px"},children:"Dimensiones (en cent\xedmetros) *"}),(0,s.jsx)("p",{style:{fontSize:"12px",color:"#666",marginBottom:"15px"},children:"M\xe1ximo permitido: 15cm por cada dimensi\xf3n. Si alguna dimensi\xf3n excede este l\xedmite, se requerir\xe1 un dep\xf3sito de garant\xeda."}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"15px"},children:[(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productHeight",children:"Altura (cm)"}),(0,s.jsx)("input",{type:"number",id:"productHeight",step:"0.1",min:"0.1",max:"15",value:ef.height||"",onChange:e=>eB("height",e.target.value),required:!0,className:m().input})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productWidth",children:"Ancho (cm)"}),(0,s.jsx)("input",{type:"number",id:"productWidth",step:"0.1",min:"0.1",max:"15",value:ef.width||"",onChange:e=>eB("width",e.target.value),required:!0,className:m().input})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{htmlFor:"productDepth",children:"Profundidad (cm)"}),(0,s.jsx)("input",{type:"number",id:"productDepth",step:"0.1",min:"0.1",max:"15",value:ef.depth||"",onChange:e=>eB("depth",e.target.value),required:!0,className:m().input})]})]}),ej.length>0&&(0,s.jsxs)("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#ffebee",borderRadius:"4px",color:"#c62828"},children:[(0,s.jsx)("strong",{children:"Errores en las dimensiones:"}),(0,s.jsx)("ul",{style:{margin:"10px 0 0 20px"},children:ej.map((e,t)=>(0,s.jsx)("li",{children:e},t))})]}),(ef.height>15||ef.width>15||ef.depth>15)&&0===ej.length&&(0,s.jsxs)("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#fff3cd",borderRadius:"4px",color:"#856404"},children:["⚠️ Este producto requiere un dep\xf3sito de garant\xeda porque excede las dimensiones m\xe1ximas permitidas (15\xd715\xd715 cm).",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Dep\xf3sito requerido:"})," S/. ",ef.value.toFixed(2)]}),ef.height>0&&ef.width>0&&ef.depth>0&&ef.height<=15&&ef.width<=15&&ef.depth<=15&&(0,s.jsx)("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#d4edda",borderRadius:"4px",color:"#155724"},children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,s.jsxs)("div",{className:m().formActions,children:[(0,s.jsx)("button",{type:"button",onClick:ez,className:m().cancelBtn,children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:ep,className:m().submitBtn,children:ep?"Creando...":"Crear Producto"})]})]})]})}),V&&q&&"admin"===f.role&&(0,s.jsx)("div",{className:m().modalOverlay,onClick:()=>{G(!1),O(null)},children:(0,s.jsxs)("div",{className:m().modal,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:m().modalHeader,children:[(0,s.jsx)("h2",{children:"Detalles del Sorteo"}),(0,s.jsx)("button",{className:m().closeBtn,onClick:()=>{G(!1),O(null)},children:"\xd7"})]}),(0,s.jsxs)("div",{className:m().form,style:{padding:"24px"},children:[(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Tienda"}),(0,s.jsx)("p",{style:{margin:"8px 0",color:"#333",fontSize:"16px",fontWeight:"600"},children:(null===(e=q.shop)||void 0===e?void 0:e.name)||"N/A"})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Producto"}),(0,s.jsx)("p",{style:{margin:"8px 0",color:"#333",fontSize:"16px",fontWeight:"600"},children:(null===(t=q.product)||void 0===t?void 0:t.name)||"Producto desconocido"})]}),(null===(p=q.product)||void 0===p?void 0:p.description)&&(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Descripci\xf3n"}),(0,s.jsx)("p",{style:{margin:"8px 0",color:"#666",fontSize:"14px"},children:q.product.description})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Valor del Producto"}),(0,s.jsxs)("p",{style:{margin:"8px 0",color:"#333",fontSize:"18px",fontWeight:"600"},children:["S/. ",(q.productValue||(null===(g=q.product)||void 0===g?void 0:g.value)||0).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Total de Tickets"}),(0,s.jsx)("p",{style:{margin:"8px 0",color:"#333",fontSize:"16px"},children:q.totalTickets.toLocaleString()})]}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Requiere Dep\xf3sito"}),(0,s.jsx)("p",{style:{margin:"8px 0"},children:q.requiresDeposit?(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#FF9800"},children:"S\xed"}):(0,s.jsx)("span",{className:m().badge,style:{backgroundColor:"#4CAF50"},children:"No"})})]}),q.specialConditions&&(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Condiciones Especiales"}),(0,s.jsx)("p",{style:{margin:"8px 0",color:"#666",fontSize:"14px"},children:q.specialConditions})]}),(0,s.jsxs)("div",{className:m().formActions,children:[(0,s.jsx)("button",{className:m().cancelBtn,onClick:()=>{G(!1),O(null)},disabled:X===q.id||J===q.id,children:"Cerrar"}),(0,s.jsxs)("button",{className:m().cancelBtn,onClick:()=>U(!0),disabled:X===q.id||J===q.id,style:{backgroundColor:"#F44336",color:"white",borderColor:"#F44336"},children:[(0,s.jsx)(i.$Rx,{style:{marginRight:"6px"}}),"Rechazar"]}),(0,s.jsx)("button",{className:m().submitBtn,onClick:()=>eG(q.id),disabled:X===q.id||J===q.id,children:X===q.id?"Procesando...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i._rq,{style:{marginRight:"6px"}}),"Aprobar"]})})]})]})]})}),M&&q&&"admin"===f.role&&(0,s.jsx)("div",{className:m().modalOverlay,onClick:()=>{U(!1),H("")},children:(0,s.jsxs)("div",{className:m().modal,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:m().modalHeader,children:[(0,s.jsx)("h2",{children:"Rechazar Sorteo"}),(0,s.jsx)("button",{className:m().closeBtn,onClick:()=>{U(!1),H("")},children:"\xd7"})]}),(0,s.jsxs)("div",{className:m().form,style:{padding:"24px"},children:[(0,s.jsx)("p",{style:{color:"#666",marginBottom:"20px",fontSize:"14px"},children:"Por favor, proporciona un motivo para rechazar este sorteo. La tienda podr\xe1 ver este motivo."}),(0,s.jsxs)("div",{className:m().formGroup,children:[(0,s.jsx)("label",{children:"Motivo del Rechazo *"}),(0,s.jsx)("textarea",{className:m().textarea,value:W,onChange:e=>H(e.target.value),placeholder:"Ingresa el motivo del rechazo...",disabled:J===q.id,rows:4})]}),(0,s.jsxs)("div",{className:m().formActions,children:[(0,s.jsx)("button",{className:m().cancelBtn,onClick:()=>{U(!1),H("")},disabled:J===q.id,children:"Cancelar"}),(0,s.jsx)("button",{className:m().submitBtn,onClick:()=>eM(q.id),disabled:J===q.id||!W.trim(),style:{backgroundColor:"#F44336",borderColor:"#F44336"},children:J===q.id?"Procesando...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.$Rx,{style:{marginRight:"6px"}}),"Confirmar Rechazo"]})})]})]})]})})]})]}):(0,s.jsx)("div",{className:m().dashboard,children:(0,s.jsx)("div",{className:m().errorContainer,children:(0,s.jsx)("p",{children:"No autenticado"})})})}},9730:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(7821),r=a(8149),o=a(4542),i={src:"/_next/static/media/logo.4501bff6.png",height:1080,width:1080,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAz0lEQVR42mNgaFnGzAAFZnO3GZkDMYyPkDNtkpWbteVEyqr9/0FYdObmEwxc1bJwhXMOXTgx++D5/5P2nvk7Zd/Zv0uOXf4P5J+AyAb3Gi08eun/z99//i48cunf0uOX//3////vsuNX/jOE9QGti+g3Akr8BwlefPj839XHL8EKFhy5+J8hdiLEPTMOnDsBtOY/yHgg+++qk1f/zzt84QQDHGRMk7Wfv/2Ezuwt/5Vmbv6vNXvrCYbIfqgjp2+Ce7Nx23Gjms1HEd6csoEZAALjd67o7P0OAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},n=a(3616),d=a.n(n);function l(e){let{size:t="medium",showText:a=!0,className:n="",href:l="/"}=e,c=(0,s.jsxs)("div",{className:"".concat(d().logo," ").concat(d()[t]," ").concat(n),children:[(0,s.jsx)(r.default,{src:i,alt:"TIKETEA ONLINE",width:"small"===t?40:"medium"===t?60:80,height:"small"===t?40:"medium"===t?60:80,className:d().logoImage,priority:!0}),a&&(0,s.jsx)("span",{className:d().logoText,children:"TIKETEA ONLINE"})]});return l?(0,s.jsx)(o.default,{href:l,className:d().logoLink,children:c}):c}},6312:function(e,t,a){"use strict";a.d(t,{a:function(){return i}});var s=a(8078),r=a(7197),o=a(5161);function i(){let[e,t]=(0,s.useState)(!1),a=(0,r.t)();return(0,s.useEffect)(()=>{let e=o.Y.onAuthStateChanged(async e=>{if(e){a.setUser(e);try{let e=await o.Y.getCurrentUserToken();e&&a.setToken(e)}catch(e){console.error("Error getting token:",e)}}else a.setUser(null),a.setToken(null);t(!0)});return()=>{e()}},[]),{...a,isHydrated:e}}},3404:function(e,t,a){"use strict";a.d(t,{x:function(){return n}});var s=a(7147),r=a(9190);let o=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("⚠️ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),"https://".concat(e);if(!e.endsWith("/api")){let t=e.endsWith("/")?e.slice(0,-1):e;return"".concat(t,"/api")}return e})();class i{async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,a){return this.client.post(e,t,a)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}constructor(){(0,s._)(this,"client",void 0),this.client=r.Z.create({baseURL:o,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&localStorage.removeItem("token"),Promise.reject(e)})}}let n=new i},6532:function(e,t,a){"use strict";let s;a.d(t,{I8:function(){return l},db:function(){return d}});var r=a(1830),o=a(6534),i=a(1069),n=a(4304);s=0===(0,r.C6)().length?(0,r.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,r.C6)()[0];let d=(0,o.ad)(s);(0,i.cF)(s);let l=(0,n.v0)(s)},5161:function(e,t,a){"use strict";a.d(t,{Y:function(){return d}});var s=a(4304),r=a(6534),o=a(6532),i=a(6289);let n=async e=>{var t,a,s;try{let s=await (0,r.getDoc)((0,r.doc)(o.db,"users",e.uid));if(!s.exists())return{id:e.uid,name:e.displayName||(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"Usuario",email:e.email||"",role:i.i.USER};let n=s.data();return{id:e.uid,name:n.name||e.displayName||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Usuario",email:e.email||"",role:n.role||i.i.USER}}catch(t){return console.error("Error converting Firebase user:",t),{id:e.uid,name:e.displayName||(null===(s=e.email)||void 0===s?void 0:s.split("@")[0])||"Usuario",email:e.email||"",role:i.i.USER}}},d={async register(e){try{let t=(await (0,s.Xb)(o.I8,e.email,e.password)).user;e.name&&await (0,s.ck)(t,{displayName:e.name});let a=await t.getIdToken(),d={name:e.name,email:e.email,role:e.role,createdAt:(0,r.serverTimestamp)(),updatedAt:(0,r.serverTimestamp)()};if(e.role===i.i.SHOP&&e.shopName){let a={userId:t.uid,name:e.shopName,description:"",status:"pending",createdAt:(0,r.serverTimestamp)(),updatedAt:(0,r.serverTimestamp)()},s=await (0,r.ET)((0,r.collection)(o.db,"shops"),a);d.shopId=s.id,await (0,r.pl)((0,r.doc)(o.db,"users",t.uid),d)}else await (0,r.pl)((0,r.doc)(o.db,"users",t.uid),d);return{user:await n(t),token:a}}catch(t){console.error("Error registering user:",t);let e="Error al registrar usuario";throw"auth/email-already-in-use"===t.code?e="Este email ya est\xe1 registrado":"auth/invalid-email"===t.code?e="Email inv\xe1lido":"auth/weak-password"===t.code?e="La contrase\xf1a debe tener al menos 6 caracteres":"auth/operation-not-allowed"===t.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===t.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":t.message&&(e=t.message),Error(e)}},async login(e){try{let t=(await (0,s.e5)(o.I8,e.email,e.password)).user,a=await t.getIdToken();return{user:await n(t),token:a}}catch(t){console.error("Error logging in:",t);let e="Error al iniciar sesi\xf3n";throw"auth/user-not-found"===t.code?e="Usuario no encontrado":"auth/wrong-password"===t.code?e="Contrase\xf1a incorrecta":"auth/invalid-email"===t.code?e="Email inv\xe1lido":"auth/user-disabled"===t.code?e="Usuario deshabilitado":"auth/too-many-requests"===t.code?e="Demasiados intentos. Intenta m\xe1s tarde":"auth/operation-not-allowed"===t.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===t.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":t.message&&(e=t.message),Error(e)}},async logout(){try{await (0,s.w7)(o.I8)}catch(e){throw console.error("Error logging out:",e),e}},async getCurrentUser(){try{let e=o.I8.currentUser;if(!e)return null;return await n(e)}catch(e){return console.error("Error getting current user:",e),null}},async getCurrentUserToken(){try{let e=o.I8.currentUser;if(!e)return null;return await e.getIdToken()}catch(e){return console.error("Error getting token:",e),null}},onAuthStateChanged:e=>(0,s.Aj)(o.I8,async t=>{t?e(await n(t)):e(null)})}},6943:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(3404);let r={async createPayment(e){try{return(await s.x.post("/payments",e)).data}catch(e){throw console.error("Error creating payment:",e),e}},async confirmPayment(e){try{return(await s.x.post("/payments/confirm",e)).data}catch(e){throw console.error("Error confirming payment:",e),e}},async failPayment(e,t){try{return(await s.x.post("/payments/".concat(e,"/fail"),{failureReason:t})).data}catch(e){throw console.error("Error failing payment:",e),e}},async getPaymentById(e){try{return(await s.x.get("/payments/".concat(e))).data}catch(e){throw console.error("Error fetching payment:",e),e}},async getMyPayments(){try{return(await s.x.get("/payments/user/me")).data}catch(e){throw console.error("Error fetching user payments:",e),e}},async getCompletedPaymentsByRaffleId(e){try{return(await s.x.get("/payments/raffle/".concat(e))).data}catch(e){throw console.error("Error fetching raffle payments:",e),e}},async refundPayment(e){try{return(await s.x.post("/payments/".concat(e,"/refund"),{})).data}catch(e){throw console.error("Error refunding payment:",e),e}}}},2379:function(e,t,a){"use strict";a.d(t,{_:function(){return c}});var s,r,o=a(6534),i=a(6532);(s=r||(r={})).ACTIVE="active",s.INACTIVE="inactive",s.ARCHIVED="archived";let n=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,d=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||r.INACTIVE,createdAt:n(t.createdAt),updatedAt:n(t.updatedAt)}},l={async getProductsByShop(e){try{let t=(0,o.collection)(i.db,"products"),a=(0,o.query)(t,(0,o.where)("shopId","==",e),(0,o.where)("status","==",r.ACTIVE));return(await (0,o.getDocs)(a)).docs.map(e=>d(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,o.getDoc)((0,o.doc)(i.db,"products",e));if(!t.exists())throw Error("Product not found");return d(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,o.collection)(i.db,"products"),t=(0,o.query)(e,(0,o.where)("status","==",r.ACTIVE));return(await (0,o.getDocs)(t)).docs.map(e=>d(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,o.collection)(i.db,"products"),a={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:r.ACTIVE,createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()},s=await (0,o.ET)(t,a),n=await (0,o.getDoc)(s);if(!n.exists())throw Error("Error al crear el producto");return d(n)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let a=(0,o.doc)(i.db,"products",e),s={updatedAt:(0,o.serverTimestamp)()};if(void 0!==t.name&&(s.name=t.name),void 0!==t.description&&(s.description=t.description),void 0!==t.value&&(s.value=t.value),void 0!==t.height&&(s.height=t.height),void 0!==t.width&&(s.width=t.width),void 0!==t.depth&&(s.depth=t.depth),void 0!==t.category&&(s.category=t.category),void 0!==t.mainImage&&(s.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,o.getDoc)(a);if(e.exists()){let a=e.data(),r=void 0!==t.height?t.height:a.height,o=void 0!==t.width?t.width:a.width,i=void 0!==t.depth?t.depth:a.depth;s.requiresDeposit=r>15||o>15||i>15}}await (0,o.updateDoc)(a,s);let r=await (0,o.getDoc)(a);if(!r.exists())throw Error("Producto no encontrado");return d(r)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,o.doc)(i.db,"products",e);await (0,o.updateDoc)(t,{status:r.INACTIVE,updatedAt:(0,o.serverTimestamp)()});let a=await (0,o.getDoc)(t);if(!a.exists())throw Error("Producto no encontrado");return d(a)}catch(e){throw console.error("Error deactivating product:",e),e}}},c={getProductsByShop:async e=>l.getProductsByShop(e),getActiveProductsByShop:async e=>l.getActiveProductsByShop(e),getProductById:async e=>l.getProductById(e),getAllProducts:async()=>l.getAllProducts(),createProduct:async e=>l.createProduct(e),updateProduct:async(e,t)=>l.updateProduct(e,t),deactivateProduct:async e=>l.deactivateProduct(e)}},9422:function(e,t,a){"use strict";a.d(t,{m:function(){return c}});var s=a(3404),r=a(6534),o=a(6532),i=a(9283);let n=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,d=e=>{let t=e.data();return{id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||i.R.PENDING,createdAt:n(t.createdAt),updatedAt:n(t.updatedAt)}},l={async getShopById(e){try{let t=await (0,r.getDoc)((0,r.doc)(o.db,"shops",e));if(!t.exists())throw Error("Shop not found");return d(t)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,r.collection)(o.db,"shops"),t=(0,r.query)(e,(0,r.where)("status","==",i.R.VERIFIED));return(await (0,r.getDocs)(t)).docs.map(e=>d(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,r.collection)(o.db,"shops");return(await (0,r.getDocs)(e)).docs.map(e=>d(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},c={getShopById:async e=>l.getShopById(e),getAllShops:async()=>l.getAllShops(),getVerifiedShops:async()=>l.getVerifiedShops(),getMyShop:async()=>(await s.x.get("/shops/my-shop/current")).data,updateShop:async(e,t)=>(await s.x.put("/shops/".concat(e),t)).data,getShopStatistics:async e=>(await s.x.get("/shops/".concat(e,"/statistics"))).data}},9298:function(e,t,a){"use strict";a.d(t,{T:function(){return r}});var s=a(3404);let r={async uploadProductImage(e){let t=new FormData;return t.append("image",e),(await s.x.post("/uploads/products/image",t,{headers:{"Content-Type":"multipart/form-data"}})).data.fileUrl},async deleteImage(e){await s.x.delete("/uploads/products/image/".concat(e))}}},7197:function(e,t,a){"use strict";a.d(t,{t:function(){return i}});var s=a(3020),r=a(4302),o=a(5161);let i=(0,s.Ue)()((0,r.tJ)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:t=>e({user:t,isAuthenticated:!!t}),setToken:t=>{t?localStorage.setItem("token",t):localStorage.removeItem("token"),e({token:t})},setIsLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),logout:async()=>{try{await o.Y.logout()}catch(e){console.error("Error logging out:",e)}finally{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}},refreshToken:async()=>{try{let e=await o.Y.getCurrentUserToken();e&&t().setToken(e)}catch(e){console.error("Error refreshing token:",e)}}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},6289:function(e,t,a){"use strict";var s,r;a.d(t,{i:function(){return s}}),(r=s||(s={})).ADMIN="admin",r.SHOP="shop",r.USER="user"},9283:function(e,t,a){"use strict";var s,r;a.d(t,{R:function(){return s}}),(r=s||(s={})).PENDING="pending",r.VERIFIED="verified",r.BLOCKED="blocked"},2962:function(e){e.exports={dashboard:"dashboard_dashboard__gQFzy",loadingContainer:"dashboard_loadingContainer__DQmdc",errorContainer:"dashboard_errorContainer__2k3e0",header:"dashboard_header__0IQ3E",headerTitle:"dashboard_headerTitle__HIxZh",headerIcon:"dashboard_headerIcon__5FI23",headerContent:"dashboard_headerContent__3oqbj",userSection:"dashboard_userSection__BSeKt",userInfo:"dashboard_userInfo__J_gfr",userAvatar:"dashboard_userAvatar__AphB1",userDetails:"dashboard_userDetails__hitT1",userName:"dashboard_userName__CtC1T",email:"dashboard_email__98kzB",role:"dashboard_role__560J9",logoutBtn:"dashboard_logoutBtn__UgAUz",logoutIcon:"dashboard_logoutIcon__DdWYL",errorBanner:"dashboard_errorBanner__FsIo1",tabsContainer:"dashboard_tabsContainer__IbrIv",tab:"dashboard_tab__nvtkC",activeTab:"dashboard_activeTab__YbTNq",tabIcon:"dashboard_tabIcon__8vIXb",content:"dashboard_content__lgdH3",overviewGrid:"dashboard_overviewGrid__tJR4P",card:"dashboard_card__uY0FF",cardIcon:"dashboard_cardIcon__mzkui",bigNumber:"dashboard_bigNumber__u5eTh",subtitle:"dashboard_subtitle__xP_XA",statusBreakdown:"dashboard_statusBreakdown__vsufj",tableContainer:"dashboard_tableContainer__XIu3f",table:"dashboard_table__qUgyM",badge:"dashboard_badge__3z1pJ",progressBar:"dashboard_progressBar__PzDkJ",progressFill:"dashboard_progressFill__eBY_A",progressText:"dashboard_progressText__zzeEz",emptyMessage:"dashboard_emptyMessage__Iagxl",moreItems:"dashboard_moreItems__rmW6c",tableHeader:"dashboard_tableHeader__n9Xxd",createBtn:"dashboard_createBtn__6OW9J",modalOverlay:"dashboard_modalOverlay__b2eFY",modal:"dashboard_modal__qgAga",modalHeader:"dashboard_modalHeader__E15Ib",closeBtn:"dashboard_closeBtn__FCbJn",form:"dashboard_form__2eBG3",formGroup:"dashboard_formGroup__xr6t0",input:"dashboard_input__5d_PV",textarea:"dashboard_textarea__gVSwe",formActions:"dashboard_formActions__l_SfE",cancelBtn:"dashboard_cancelBtn__sU02m",submitBtn:"dashboard_submitBtn__SO014",buyTicketsBtn:"dashboard_buyTicketsBtn__jp_hU",quantityBtn:"dashboard_quantityBtn__cJA_m"}},3616:function(e){e.exports={logo:"Logo_logo__hia7S",logoLink:"Logo_logoLink__gM3sV",logoImage:"Logo_logoImage__daWgp",logoText:"Logo_logoText___NRG4",small:"Logo_small__digRM",medium:"Logo_medium__HI_Ok",large:"Logo_large__OX_7R",dark:"Logo_dark__vov1N"}}},function(e){e.O(0,[9286,2907,4183,9134,1044,2489,8641,4755,4542,6153,7115,2364,1744],function(){return e(e.s=2449)}),_N_E=e.O()}]);