(()=>{var e={};e.id=2128,e.ids=[2128],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},63519:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>l,routeModule:()=>m,tree:()=>c}),r(4621),r(24198),r(12874);var a=r(27105),s=r(15265),o=r(90157),i=r.n(o),n=r(44665),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);r.d(t,d);let c=["",{children:["panel",{children:["productos",{children:["crear",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4621)),"/Users/axelhernandez/Sorteos/frontend/src/app/panel/productos/crear/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,24198)),"/Users/axelhernandez/Sorteos/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,12874,23)),"next/dist/client/components/not-found-error"]}],l=["/Users/axelhernandez/Sorteos/frontend/src/app/panel/productos/crear/page.tsx"],u="/panel/productos/crear/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/panel/productos/crear/page",pathname:"/panel/productos/crear",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8440:(e,t,r)=>{Promise.resolve().then(r.bind(r,27470))},27470:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(19899),s=r(5507),o=r(76153),i=r(38442),n=r(1260),d=r(79114),c=r(24544),l=r(26028),u=r(84499),p=r(2345),m=r(10195),h=r.n(m);function g(){let e=(0,o.useRouter)(),{user:t,isAuthenticated:m}=(0,i.t)(),[g,x]=(0,s.useState)(null),[f,v]=(0,s.useState)(!1),[y,j]=(0,s.useState)(!0),[b,w]=(0,s.useState)(null),[I,P]=(0,s.useState)({shopId:"",name:"",description:"",value:0,height:0,width:0,depth:0,category:"",mainImage:""}),[N,E]=(0,s.useState)([]),[q,A]=(0,s.useState)(!1),S=async()=>{j(!0);try{if(!t?.id){w("Usuario no autenticado");return}let{collection:e,query:a,where:s,getDocs:o}=await Promise.resolve().then(r.bind(r,82986)),{db:i}=await Promise.resolve().then(r.bind(r,26379)),n=e(i,"shops"),d=a(n,s("userId","==",t.id)),c=await o(d);if(c.empty)w("No se encontr\xf3 tu tienda");else{let e=c.docs[0],r=e.data(),a={id:e.id,userId:r.userId||t.id,name:r.name||"",description:r.description,logo:r.logo,publicEmail:r.publicEmail,phone:r.phone,socialMedia:r.socialMedia,status:r.status||"pending",createdAt:r.createdAt?.toDate()||new Date,updatedAt:r.updatedAt?.toDate()||new Date};x(a),P(e=>({...e,shopId:a.id}))}}catch(e){w(e.message||"Error al cargar la tienda")}finally{j(!1)}},C=(e,t,r)=>{let a=[];return e<=0&&a.push("La altura debe ser mayor a 0"),t<=0&&a.push("El ancho debe ser mayor a 0"),r<=0&&a.push("La profundidad debe ser mayor a 0"),e>15&&a.push("La altura no puede exceder 15cm"),t>15&&a.push("El ancho no puede exceder 15cm"),r>15&&a.push("La profundidad no puede exceder 15cm"),a},D=(e,t)=>{let r=parseFloat(t)||0;P(t=>({...t,[e]:r})),E(C("height"===e?r:I.height,"width"===e?r:I.width,"depth"===e?r:I.depth))},T=async t=>{t.preventDefault(),w(null);let r=C(I.height,I.width,I.depth);if(r.length>0){E(r),w("Por favor corrige los errores en las dimensiones");return}if(!I.name||!I.description||I.value<=0){w("Por favor completa todos los campos requeridos");return}v(!0);try{await d._.createProduct(I),e.push("/panel/productos")}catch(e){w(e.response?.data?.message||"Error al crear el producto")}finally{v(!1)}},B=I.height>15||I.width>15||I.depth>15;return a.jsx(p.i,{requiredRole:n.i.SHOP,children:(0,a.jsxs)("div",{className:h().panelContainer,children:[a.jsx(u.G,{isBlocked:g?.status==="blocked"}),(0,a.jsxs)("main",{className:h().mainContent,children:[y&&a.jsx("div",{className:h().alert,children:"Cargando tienda..."}),b&&!y&&(0,a.jsxs)("div",{className:`${h().alert} ${h().alertError}`,children:[b,a.jsx("button",{onClick:S,className:h().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),g&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(l.N,{shop:g}),(0,a.jsxs)("div",{className:h().raffleDetail,children:[a.jsx("h1",{className:h().raffleDetailTitle,children:"Crear nuevo producto"}),(0,a.jsxs)("form",{onSubmit:T,className:h().raffleForm,children:[(0,a.jsxs)("div",{className:h().raffleFormSection,children:[a.jsx("h2",{className:h().raffleFormSectionTitle,children:"Informaci\xf3n b\xe1sica"}),(0,a.jsxs)("div",{className:h().formGroup,children:[(0,a.jsxs)("label",{className:h().formLabel,children:["Nombre del producto ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("input",{type:"text",value:I.name,onChange:e=>P(t=>({...t,name:e.target.value})),className:h().formInput,required:!0,placeholder:"Ej: iPhone 15 Pro Max"})]}),(0,a.jsxs)("div",{className:h().formGroup,children:[(0,a.jsxs)("label",{className:h().formLabel,children:["Descripci\xf3n ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("textarea",{value:I.description,onChange:e=>P(t=>({...t,description:e.target.value})),className:h().formTextarea,required:!0,rows:4,placeholder:"Describe el producto en detalle..."})]}),(0,a.jsxs)("div",{className:h().formGroup,children:[(0,a.jsxs)("label",{className:h().formLabel,children:["Valor del producto (S/.) ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("input",{type:"number",step:"0.01",min:"0.01",value:I.value||"",onChange:e=>P(t=>({...t,value:parseFloat(e.target.value)||0})),className:h().formInput,required:!0,placeholder:"0.00"})]}),(0,a.jsxs)("div",{className:h().formGroup,children:[a.jsx("label",{className:h().formLabel,children:"Categor\xeda (opcional)"}),a.jsx("input",{type:"text",value:I.category||"",onChange:e=>P(t=>({...t,category:e.target.value})),className:h().formInput,placeholder:"Ej: Electr\xf3nica, Ropa, Hogar..."})]}),(0,a.jsxs)("div",{className:h().formGroup,children:[a.jsx("label",{className:h().formLabel,children:"Imagen Principal (opcional)"}),(0,a.jsxs)("div",{style:{marginBottom:"10px"},children:[a.jsx("input",{type:"file",id:"productImageFile",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",onChange:async e=>{let t=e.target.files?.[0];if(t){if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(t.type)){w("Tipo de archivo no permitido. Solo se permiten im\xe1genes (JPEG, PNG, WEBP, GIF)");return}if(t.size>5242880){w("El archivo es demasiado grande. M\xe1ximo permitido: 5MB");return}w(null),A(!0);try{let e=await c.T.uploadProductImage(t),r=e.startsWith("http")?e:`${"http://localhost:3001/api".replace("/api","")||0}${e}`;P(e=>({...e,mainImage:r}))}catch(e){w(e.response?.data?.message||"Error al subir la imagen")}finally{A(!1)}}},className:h().formInput,style:{marginBottom:"10px"},disabled:q}),q&&a.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:"Subiendo imagen..."}),I.mainImage&&!q&&a.jsx("div",{style:{marginTop:"10px"},children:a.jsx("img",{src:I.mainImage,alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",borderRadius:"4px",border:"1px solid #ddd"}})})]}),a.jsx("small",{style:{display:"block",marginTop:"5px",color:"#666",fontSize:"12px"},children:"O ingresa una URL de imagen:"}),a.jsx("input",{type:"url",value:I.mainImage||"",onChange:e=>P(t=>({...t,mainImage:e.target.value})),className:h().formInput,placeholder:"https://ejemplo.com/imagen.jpg",style:{marginTop:"5px"}})]})]}),(0,a.jsxs)("div",{className:h().raffleFormSection,children:[(0,a.jsxs)("h2",{className:h().raffleFormSectionTitle,children:["Dimensiones (en cent\xedmetros) ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("p",{className:h().formHelpText,children:"M\xe1ximo permitido: 15cm por cada dimensi\xf3n. Si alguna dimensi\xf3n excede este l\xedmite, se requerir\xe1 un dep\xf3sito de garant\xeda."}),(0,a.jsxs)("div",{className:h().dimensionsGrid,children:[(0,a.jsxs)("div",{className:h().formGroup,children:[a.jsx("label",{className:h().formLabel,children:"Altura (cm)"}),a.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:I.height||"",onChange:e=>D("height",e.target.value),className:N.some(e=>e.includes("altura")||e.includes("Alto"))?`${h().formInput} ${h().formInputError}`:h().formInput,required:!0})]}),(0,a.jsxs)("div",{className:h().formGroup,children:[a.jsx("label",{className:h().formLabel,children:"Ancho (cm)"}),a.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:I.width||"",onChange:e=>D("width",e.target.value),className:N.some(e=>e.includes("ancho")||e.includes("Ancho"))?`${h().formInput} ${h().formInputError}`:h().formInput,required:!0})]}),(0,a.jsxs)("div",{className:h().formGroup,children:[a.jsx("label",{className:h().formLabel,children:"Profundidad (cm)"}),a.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:I.depth||"",onChange:e=>D("depth",e.target.value),className:N.some(e=>e.includes("profundidad")||e.includes("Profundidad"))?`${h().formInput} ${h().formInputError}`:h().formInput,required:!0})]})]}),N.length>0&&(0,a.jsxs)("div",{className:h().alert+" "+h().alertError,children:[a.jsx("strong",{children:"Errores en las dimensiones:"}),a.jsx("ul",{style:{margin:"10px 0 0 20px"},children:N.map((e,t)=>a.jsx("li",{children:e},t))})]}),B&&0===N.length&&(0,a.jsxs)("div",{className:h().depositWarning,children:["⚠️ Este producto requiere un dep\xf3sito de garant\xeda porque excede las dimensiones m\xe1ximas permitidas (15\xd715\xd715 cm).",a.jsx("br",{}),a.jsx("strong",{children:"Dep\xf3sito requerido:"})," S/. ",I.value.toFixed(2)]}),!B&&I.height>0&&I.width>0&&I.depth>0&&a.jsx("div",{className:h().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,a.jsxs)("div",{className:h().buttonGroup,children:[a.jsx("button",{type:"submit",className:h().primaryButton,disabled:f,children:f?"Creando producto...":"Crear producto"}),a.jsx("button",{type:"button",className:h().secondaryButton,onClick:()=>e.push("/panel/productos"),children:"Cancelar"})]})]})]})]})]})]})})}},79114:(e,t,r)=>{"use strict";r.d(t,{_:()=>c});var a,s=r(82986),o=r(26379);!function(e){e.ACTIVE="active",e.INACTIVE="inactive",e.ARCHIVED="archived"}(a||(a={}));let i=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,n=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||a.INACTIVE,createdAt:i(t.createdAt),updatedAt:i(t.updatedAt)}},d={async getProductsByShop(e){try{let t=(0,s.collection)(o.db,"products"),r=(0,s.query)(t,(0,s.where)("shopId","==",e),(0,s.where)("status","==",a.ACTIVE));return(await (0,s.getDocs)(r)).docs.map(e=>n(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,s.getDoc)((0,s.doc)(o.db,"products",e));if(!t.exists())throw Error("Product not found");return n(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,s.collection)(o.db,"products"),t=(0,s.query)(e,(0,s.where)("status","==",a.ACTIVE));return(await (0,s.getDocs)(t)).docs.map(e=>n(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,s.collection)(o.db,"products"),r={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:a.ACTIVE,createdAt:(0,s.serverTimestamp)(),updatedAt:(0,s.serverTimestamp)()},i=await (0,s.ET)(t,r),d=await (0,s.getDoc)(i);if(!d.exists())throw Error("Error al crear el producto");return n(d)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let r=(0,s.doc)(o.db,"products",e),a={updatedAt:(0,s.serverTimestamp)()};if(void 0!==t.name&&(a.name=t.name),void 0!==t.description&&(a.description=t.description),void 0!==t.value&&(a.value=t.value),void 0!==t.height&&(a.height=t.height),void 0!==t.width&&(a.width=t.width),void 0!==t.depth&&(a.depth=t.depth),void 0!==t.category&&(a.category=t.category),void 0!==t.mainImage&&(a.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,s.getDoc)(r);if(e.exists()){let r=e.data(),s=void 0!==t.height?t.height:r.height,o=void 0!==t.width?t.width:r.width,i=void 0!==t.depth?t.depth:r.depth;a.requiresDeposit=s>15||o>15||i>15}}await (0,s.updateDoc)(r,a);let i=await (0,s.getDoc)(r);if(!i.exists())throw Error("Producto no encontrado");return n(i)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,s.doc)(o.db,"products",e);await (0,s.updateDoc)(t,{status:a.INACTIVE,updatedAt:(0,s.serverTimestamp)()});let r=await (0,s.getDoc)(t);if(!r.exists())throw Error("Producto no encontrado");return n(r)}catch(e){throw console.error("Error deactivating product:",e),e}}},c={getProductsByShop:async e=>d.getProductsByShop(e),getActiveProductsByShop:async e=>d.getActiveProductsByShop(e),getProductById:async e=>d.getProductById(e),getAllProducts:async()=>d.getAllProducts(),createProduct:async e=>d.createProduct(e),updateProduct:async(e,t)=>d.updateProduct(e,t),deactivateProduct:async e=>d.deactivateProduct(e)}},24544:(e,t,r)=>{"use strict";r.d(t,{T:()=>s});var a=r(10752);let s={async uploadProductImage(e){let t=new FormData;return t.append("image",e),(await a.x.post("/uploads/products/image",t,{headers:{"Content-Type":"multipart/form-data"}})).data.fileUrl},async deleteImage(e){await a.x.delete(`/uploads/products/image/${e}`)}}},4621:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(2772).createProxy)(String.raw`/Users/axelhernandez/Sorteos/frontend/src/app/panel/productos/crear/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3591,8559,3352,4175,9388],()=>r(63519));module.exports=a})();