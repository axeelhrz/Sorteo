(()=>{var e={};e.id=5026,e.ids=[5026],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},52997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>l,routeModule:()=>h,tree:()=>c}),r(39134),r(24198),r(12874);var a=r(27105),s=r(15265),o=r(90157),i=r.n(o),d=r(44665),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);r.d(t,n);let c=["",{children:["panel",{children:["productos",{children:["[id]",{children:["editar",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,39134)),"/Users/axelhernandez/Sorteos/frontend/src/app/panel/productos/[id]/editar/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,24198)),"/Users/axelhernandez/Sorteos/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,12874,23)),"next/dist/client/components/not-found-error"]}],l=["/Users/axelhernandez/Sorteos/frontend/src/app/panel/productos/[id]/editar/page.tsx"],u="/panel/productos/[id]/editar/page",p={require:r,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/panel/productos/[id]/editar/page",pathname:"/panel/productos/[id]/editar",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},26488:(e,t,r)=>{Promise.resolve().then(r.bind(r,28400))},28400:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(19899),s=r(5507),o=r(76153),i=r(38442),d=r(1260),n=r(28848),c=r(79114),l=r(26028),u=r(84499),p=r(2345),h=r(10195),m=r.n(h);function g(){let e=(0,o.useRouter)(),t=(0,o.useParams)().id,{user:r,isAuthenticated:h}=(0,i.t)(),[g,x]=(0,s.useState)(null),[v,f]=(0,s.useState)(null),[y,j]=(0,s.useState)(!1),[w,b]=(0,s.useState)(!0),[N,I]=(0,s.useState)(null),[E,P]=(0,s.useState)({}),[q,S]=(0,s.useState)([]),A=async()=>{b(!0);try{let[e,r]=await Promise.all([n.m.getMyShop(),c._.getProductById(t)]);if(x(e),f(r),r.shopId!==e.id){I("Este producto no pertenece a tu tienda");return}P({name:r.name,description:r.description,value:r.value,height:r.height,width:r.width,depth:r.depth,category:r.category,mainImage:r.mainImage})}catch(e){I(e.response?.data?.message||"Error al cargar los datos")}finally{b(!1)}},D=(e,t,r)=>{let a=[];return e<=0&&a.push("La altura debe ser mayor a 0"),t<=0&&a.push("El ancho debe ser mayor a 0"),r<=0&&a.push("La profundidad debe ser mayor a 0"),e>15&&a.push("La altura no puede exceder 15cm"),t>15&&a.push("El ancho no puede exceder 15cm"),r>15&&a.push("La profundidad no puede exceder 15cm"),a},C=(e,t)=>{let r=parseFloat(t)||0;P(t=>({...t,[e]:r})),S(D("height"===e?r:E.height||v?.height||0,"width"===e?r:E.width||v?.width||0,"depth"===e?r:E.depth||v?.depth||0))},T=async r=>{r.preventDefault(),I(null);let a=D(E.height||v?.height||0,E.width||v?.width||0,E.depth||v?.depth||0);if(a.length>0){S(a),I("Por favor corrige los errores en las dimensiones");return}j(!0);try{await c._.updateProduct(t,E),e.push("/panel/productos")}catch(e){I(e.response?.data?.message||"Error al actualizar el producto")}finally{j(!1)}},G=async()=>{if(confirm("\xbfEst\xe1s seguro de que deseas eliminar este producto? Esta acci\xf3n no se puede deshacer.")){j(!0);try{await c._.deactivateProduct(t),e.push("/panel/productos")}catch(e){I(e.response?.data?.message||"Error al eliminar el producto"),j(!1)}}},B=void 0!==E.height?E.height:v?.height||0,_=void 0!==E.width?E.width:v?.width||0,L=void 0!==E.depth?E.depth:v?.depth||0,R=void 0!==E.value?E.value:v?.value||0,V=B>15||_>15||L>15;return w?a.jsx(p.i,{requiredRole:d.i.SHOP,children:(0,a.jsxs)("div",{className:m().panelContainer,children:[a.jsx(u.G,{}),a.jsx("main",{className:m().mainContent,children:a.jsx("div",{className:m().alert,children:"Cargando datos..."})})]})}):v&&g?a.jsx(p.i,{requiredRole:d.i.SHOP,children:(0,a.jsxs)("div",{className:m().panelContainer,children:[a.jsx(u.G,{isBlocked:g?.status==="blocked"}),(0,a.jsxs)("main",{className:m().mainContent,children:[N&&(0,a.jsxs)("div",{className:`${m().alert} ${m().alertError}`,children:[N,a.jsx("button",{onClick:A,className:m().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),a.jsx(l.N,{shop:g}),(0,a.jsxs)("div",{className:m().raffleDetail,children:[a.jsx("h1",{className:m().raffleDetailTitle,children:"Editar producto"}),(0,a.jsxs)("form",{onSubmit:T,className:m().raffleForm,children:[(0,a.jsxs)("div",{className:m().raffleFormSection,children:[a.jsx("h2",{className:m().raffleFormSectionTitle,children:"Informaci\xf3n b\xe1sica"}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{className:m().formLabel,children:["Nombre del producto ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("input",{type:"text",value:E.name||v.name,onChange:e=>P(t=>({...t,name:e.target.value})),className:m().formInput,required:!0})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{className:m().formLabel,children:["Descripci\xf3n ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("textarea",{value:E.description||v.description,onChange:e=>P(t=>({...t,description:e.target.value})),className:m().formTextarea,required:!0,rows:4})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{className:m().formLabel,children:["Valor del producto (S/.) ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("input",{type:"number",step:"0.01",min:"0.01",value:void 0!==E.value?E.value:v.value,onChange:e=>P(t=>({...t,value:parseFloat(e.target.value)||0})),className:m().formInput,required:!0})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"Categor\xeda (opcional)"}),a.jsx("input",{type:"text",value:void 0!==E.category?E.category:v.category||"",onChange:e=>P(t=>({...t,category:e.target.value})),className:m().formInput})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"URL de imagen principal (opcional)"}),a.jsx("input",{type:"url",value:void 0!==E.mainImage?E.mainImage:v.mainImage||"",onChange:e=>P(t=>({...t,mainImage:e.target.value})),className:m().formInput})]})]}),(0,a.jsxs)("div",{className:m().raffleFormSection,children:[(0,a.jsxs)("h2",{className:m().raffleFormSectionTitle,children:["Dimensiones (en cent\xedmetros) ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx("p",{className:m().formHelpText,children:"M\xe1ximo permitido: 15cm por cada dimensi\xf3n. Si alguna dimensi\xf3n excede este l\xedmite, se requerir\xe1 un dep\xf3sito de garant\xeda."}),(0,a.jsxs)("div",{className:m().dimensionsGrid,children:[(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"Altura (cm)"}),a.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:B,onChange:e=>C("height",e.target.value),className:q.some(e=>e.includes("altura")||e.includes("Alto"))?`${m().formInput} ${m().formInputError}`:m().formInput,required:!0})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"Ancho (cm)"}),a.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:_,onChange:e=>C("width",e.target.value),className:q.some(e=>e.includes("ancho")||e.includes("Ancho"))?`${m().formInput} ${m().formInputError}`:m().formInput,required:!0})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"Profundidad (cm)"}),a.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"15",value:L,onChange:e=>C("depth",e.target.value),className:q.some(e=>e.includes("profundidad")||e.includes("Profundidad"))?`${m().formInput} ${m().formInputError}`:m().formInput,required:!0})]})]}),q.length>0&&(0,a.jsxs)("div",{className:m().alert+" "+m().alertError,children:[a.jsx("strong",{children:"Errores en las dimensiones:"}),a.jsx("ul",{style:{margin:"10px 0 0 20px"},children:q.map((e,t)=>a.jsx("li",{children:e},t))})]}),V&&0===q.length&&(0,a.jsxs)("div",{className:m().depositWarning,children:["⚠️ Este producto requiere un dep\xf3sito de garant\xeda porque excede las dimensiones m\xe1ximas permitidas (15\xd715\xd715 cm).",a.jsx("br",{}),a.jsx("strong",{children:"Dep\xf3sito requerido:"})," S/. ",R.toFixed(2)]}),!V&&B>0&&_>0&&L>0&&a.jsx("div",{className:m().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,a.jsxs)("div",{className:m().raffleFormSection,children:[a.jsx("h2",{className:m().raffleFormSectionTitle,children:"Estado actual"}),(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"Estado"}),a.jsx("div",{className:m().statusBadge,style:{display:"inline-block",marginTop:"10px"},children:v.status})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[a.jsx("label",{className:m().formLabel,children:"Requiere dep\xf3sito"}),a.jsx("div",{style:{marginTop:"10px"},children:v.requiresDeposit?"✓ S\xed":"✗ No"})]})]}),(0,a.jsxs)("div",{className:m().buttonGroup,children:[a.jsx("button",{type:"submit",className:m().primaryButton,disabled:y,children:y?"Guardando cambios...":"Guardar cambios"}),a.jsx("button",{type:"button",className:m().secondaryButton,onClick:()=>e.push("/panel/productos"),children:"Cancelar"}),a.jsx("button",{type:"button",className:m().dangerButton,onClick:G,disabled:y,style:{marginLeft:"auto"},children:"Eliminar producto"})]})]})]})]})]})}):a.jsx(p.i,{requiredRole:d.i.SHOP,children:(0,a.jsxs)("div",{className:m().panelContainer,children:[a.jsx(u.G,{}),a.jsx("main",{className:m().mainContent,children:a.jsx("div",{className:`${m().alert} ${m().alertError}`,children:N||"Producto no encontrado"})})]})})}},79114:(e,t,r)=>{"use strict";r.d(t,{_:()=>c});var a,s=r(82986),o=r(26379);!function(e){e.ACTIVE="active",e.INACTIVE="inactive",e.ARCHIVED="archived"}(a||(a={}));let i=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,d=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||a.INACTIVE,createdAt:i(t.createdAt),updatedAt:i(t.updatedAt)}},n={async getProductsByShop(e){try{let t=(0,s.collection)(o.db,"products"),r=(0,s.query)(t,(0,s.where)("shopId","==",e),(0,s.where)("status","==",a.ACTIVE));return(await (0,s.getDocs)(r)).docs.map(e=>d(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,s.getDoc)((0,s.doc)(o.db,"products",e));if(!t.exists())throw Error("Product not found");return d(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,s.collection)(o.db,"products"),t=(0,s.query)(e,(0,s.where)("status","==",a.ACTIVE));return(await (0,s.getDocs)(t)).docs.map(e=>d(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,s.collection)(o.db,"products"),r={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:a.ACTIVE,createdAt:(0,s.serverTimestamp)(),updatedAt:(0,s.serverTimestamp)()},i=await (0,s.ET)(t,r),n=await (0,s.getDoc)(i);if(!n.exists())throw Error("Error al crear el producto");return d(n)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let r=(0,s.doc)(o.db,"products",e),a={updatedAt:(0,s.serverTimestamp)()};if(void 0!==t.name&&(a.name=t.name),void 0!==t.description&&(a.description=t.description),void 0!==t.value&&(a.value=t.value),void 0!==t.height&&(a.height=t.height),void 0!==t.width&&(a.width=t.width),void 0!==t.depth&&(a.depth=t.depth),void 0!==t.category&&(a.category=t.category),void 0!==t.mainImage&&(a.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,s.getDoc)(r);if(e.exists()){let r=e.data(),s=void 0!==t.height?t.height:r.height,o=void 0!==t.width?t.width:r.width,i=void 0!==t.depth?t.depth:r.depth;a.requiresDeposit=s>15||o>15||i>15}}await (0,s.updateDoc)(r,a);let i=await (0,s.getDoc)(r);if(!i.exists())throw Error("Producto no encontrado");return d(i)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,s.doc)(o.db,"products",e);await (0,s.updateDoc)(t,{status:a.INACTIVE,updatedAt:(0,s.serverTimestamp)()});let r=await (0,s.getDoc)(t);if(!r.exists())throw Error("Producto no encontrado");return d(r)}catch(e){throw console.error("Error deactivating product:",e),e}}},c={getProductsByShop:async e=>n.getProductsByShop(e),getActiveProductsByShop:async e=>n.getActiveProductsByShop(e),getProductById:async e=>n.getProductById(e),getAllProducts:async()=>n.getAllProducts(),createProduct:async e=>n.createProduct(e),updateProduct:async(e,t)=>n.updateProduct(e,t),deactivateProduct:async e=>n.deactivateProduct(e)}},28848:(e,t,r)=>{"use strict";r.d(t,{m:()=>l});var a=r(10752),s=r(82986),o=r(26379),i=r(12576);let d=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,n=e=>{let t=e.data();return{id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||i.R.PENDING,createdAt:d(t.createdAt),updatedAt:d(t.updatedAt)}},c={async getShopById(e){try{let t=await (0,s.getDoc)((0,s.doc)(o.db,"shops",e));if(!t.exists())throw Error("Shop not found");return n(t)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,s.collection)(o.db,"shops"),t=(0,s.query)(e,(0,s.where)("status","==",i.R.VERIFIED));return(await (0,s.getDocs)(t)).docs.map(e=>n(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,s.collection)(o.db,"shops");return(await (0,s.getDocs)(e)).docs.map(e=>n(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},l={getShopById:async e=>c.getShopById(e),getAllShops:async()=>c.getAllShops(),getVerifiedShops:async()=>c.getVerifiedShops(),getMyShop:async()=>(await a.x.get("/shops/my-shop/current")).data,updateShop:async(e,t)=>(await a.x.put(`/shops/${e}`,t)).data,getShopStatistics:async e=>(await a.x.get(`/shops/${e}/statistics`)).data}},12576:(e,t,r)=>{"use strict";var a;r.d(t,{R:()=>a}),function(e){e.PENDING="pending",e.VERIFIED="verified",e.BLOCKED="blocked"}(a||(a={}))},39134:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(2772).createProxy)(String.raw`/Users/axelhernandez/Sorteos/frontend/src/app/panel/productos/[id]/editar/page.tsx#default`)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3591,8559,3352,4175,9388],()=>r(52997));module.exports=a})();