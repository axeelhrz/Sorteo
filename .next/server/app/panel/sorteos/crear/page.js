(()=>{var e={};e.id=9394,e.ids=[9394],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},84998:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>l,routeModule:()=>h,tree:()=>d}),r(96643),r(24198),r(12874);var s=r(27105),a=r(15265),o=r(90157),i=r.n(o),c=r(44665),n={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>c[e]);r.d(t,n);let d=["",{children:["panel",{children:["sorteos",{children:["crear",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,96643)),"/Users/axelhernandez/Sorteos/frontend/src/app/panel/sorteos/crear/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,24198)),"/Users/axelhernandez/Sorteos/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,12874,23)),"next/dist/client/components/not-found-error"]}],l=["/Users/axelhernandez/Sorteos/frontend/src/app/panel/sorteos/crear/page.tsx"],u="/panel/sorteos/crear/page",p={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/panel/sorteos/crear/page",pathname:"/panel/sorteos/crear",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},72019:(e,t,r)=>{Promise.resolve().then(r.bind(r,14876))},14876:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(19899),a=r(5507),o=r(38442),i=r(1260),c=r(28848),n=r(26028),d=r(84499),l=r(76153),u=r(12576),p=r(31);r(79114);var h=r(10195),m=r.n(h);function g({shop:e}){let t=(0,l.useRouter)(),[r,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(null),[n,d]=(0,a.useState)(""),[h,g]=(0,a.useState)(!1),[x,v]=(0,a.useState)(!0),[f,y]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),w=e=>{c(r.find(t=>t.id===e)||null)},S=async r=>{if(r.preventDefault(),y(null),!i){y("Debes seleccionar un producto");return}if(e.status===u.R.BLOCKED){y("Tu tienda est\xe1 bloqueada y no puede crear sorteos");return}g(!0);try{let r=await p.raffleService.createRaffle({shopId:e.id,productId:i.id,specialConditions:n||void 0});N(!0),setTimeout(()=>{t.push(`/panel/sorteos/${r.id}`)},1500)}catch(e){y(e.message||"Error al crear el sorteo")}finally{g(!1)}};if(e.status===u.R.BLOCKED)return s.jsx("div",{className:m().raffleDetail,children:s.jsx("div",{className:m().alert+" "+m().alertError,children:"Tu tienda est\xe1 bloqueada y no puede crear nuevos sorteos. Contacta con soporte para m\xe1s informaci\xf3n."})});if(x)return s.jsx("div",{className:m().alert,children:"Cargando productos..."});if(0===r.length)return s.jsx("div",{className:m().raffleDetail,children:s.jsx("div",{className:m().alert+" "+m().alertWarning,children:"No tienes productos activos. Crea un producto antes de crear un sorteo."})});let E=i?Math.floor(2*Number(i.value)):0;return(0,s.jsxs)("form",{onSubmit:S,className:m().raffleForm,children:[f&&s.jsx("div",{className:`${m().alert} ${m().alertError}`,children:f}),j&&s.jsx("div",{className:`${m().alert} ${m().alertSuccess}`,children:"✓ Sorteo creado exitosamente. Redirigiendo..."}),(0,s.jsxs)("div",{className:m().raffleFormSection,children:[s.jsx("h2",{className:m().raffleFormSectionTitle,children:"1. Selecciona un producto"}),(0,s.jsxs)("div",{className:m().formGroup,children:[s.jsx("label",{className:m().formLabel,children:"Producto"}),(0,s.jsxs)("select",{value:i?.id||"",onChange:e=>w(e.target.value),className:m().formSelect,required:!0,children:[s.jsx("option",{value:"",children:"-- Selecciona un producto --"}),r.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," - S/. ",Number(e.value).toFixed(2)]},e.id))]})]})]}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:m().raffleFormSection,children:[s.jsx("h2",{className:m().raffleFormSectionTitle,children:"2. Informaci\xf3n del producto"}),(0,s.jsxs)("div",{className:m().dimensionsGrid,children:[(0,s.jsxs)("div",{className:m().dimensionInfo,children:[s.jsx("div",{className:m().dimensionLabel,children:"Altura"}),(0,s.jsxs)("div",{className:m().dimensionValue,children:[Number(i.height).toFixed(1)," cm"]})]}),(0,s.jsxs)("div",{className:m().dimensionInfo,children:[s.jsx("div",{className:m().dimensionLabel,children:"Ancho"}),(0,s.jsxs)("div",{className:m().dimensionValue,children:[Number(i.width).toFixed(1)," cm"]})]}),(0,s.jsxs)("div",{className:m().dimensionInfo,children:[s.jsx("div",{className:m().dimensionLabel,children:"Profundidad"}),(0,s.jsxs)("div",{className:m().dimensionValue,children:[Number(i.depth).toFixed(1)," cm"]})]})]}),i.requiresDeposit&&s.jsx("div",{className:m().depositWarning,children:"⚠️ Este producto requiere un dep\xf3sito de garant\xeda. El dep\xf3sito ser\xe1 retenido hasta que se complete el sorteo."}),!i.requiresDeposit&&s.jsx("div",{className:m().ticketCalculation,children:"✓ Este producto no requiere dep\xf3sito de garant\xeda."})]}),(0,s.jsxs)("div",{className:m().raffleFormSection,children:[s.jsx("h2",{className:m().raffleFormSectionTitle,children:"3. C\xe1lculo de tickets"}),(0,s.jsxs)("div",{className:m().ticketCalculation,children:[(0,s.jsxs)("div",{children:["Valor del producto: S/. ",Number(i.value).toFixed(2)]}),s.jsx("div",{children:"F\xf3rmula: Valor \xd7 2 = Total de tickets"}),(0,s.jsxs)("div",{className:m().ticketCalculationValue,children:[E," tickets"]})]})]}),(0,s.jsxs)("div",{className:m().raffleFormSection,children:[s.jsx("h2",{className:m().raffleFormSectionTitle,children:"4. Condiciones especiales (opcional)"}),(0,s.jsxs)("div",{className:m().formGroup,children:[s.jsx("label",{className:m().formLabel,children:"Condiciones especiales del sorteo"}),s.jsx("textarea",{value:n,onChange:e=>d(e.target.value),className:m().formTextarea,placeholder:"Ej: Env\xedo incluido, garant\xeda de 1 a\xf1o, etc."})]})]}),(0,s.jsxs)("div",{className:m().buttonGroup,children:[s.jsx("button",{type:"submit",className:m().primaryButton,disabled:h,children:h?"Creando sorteo...":"Crear sorteo"}),s.jsx("button",{type:"button",className:m().secondaryButton,onClick:()=>t.back(),children:"Cancelar"})]})]})]})}var x=r(2345);function v(){let{user:e,isAuthenticated:t}=(0,o.t)(),[r,l]=(0,a.useState)(null),[u,p]=(0,a.useState)(!0),[h,v]=(0,a.useState)(null),f=async()=>{p(!0),v(null);try{let e=await c.m.getMyShop();l(e)}catch(e){v(e.response?.data?.message||"Error al cargar la tienda")}finally{p(!1)}};return s.jsx(x.i,{requiredRole:i.i.SHOP,children:(0,s.jsxs)("div",{className:m().panelContainer,children:[s.jsx(d.G,{isBlocked:r?.status==="blocked"}),(0,s.jsxs)("main",{className:m().mainContent,children:[u&&s.jsx("div",{className:m().alert,children:"Cargando tienda..."}),h&&(0,s.jsxs)("div",{className:`${m().alert} ${m().alertError}`,children:[h,s.jsx("button",{onClick:f,className:m().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),r&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(n.N,{shop:r}),(0,s.jsxs)("div",{className:m().raffleDetail,children:[s.jsx("h1",{className:m().raffleDetailTitle,children:"Crear nuevo sorteo"}),s.jsx(g,{shop:r})]})]})]})]})})}},79114:(e,t,r)=>{"use strict";r.d(t,{_:()=>d});var s,a=r(82986),o=r(26379);!function(e){e.ACTIVE="active",e.INACTIVE="inactive",e.ARCHIVED="archived"}(s||(s={}));let i=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,c=e=>{let t=e.data();return{id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||s.INACTIVE,createdAt:i(t.createdAt),updatedAt:i(t.updatedAt)}},n={async getProductsByShop(e){try{let t=(0,a.collection)(o.db,"products"),r=(0,a.query)(t,(0,a.where)("shopId","==",e),(0,a.where)("status","==",s.ACTIVE));return(await (0,a.getDocs)(r)).docs.map(e=>c(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching products by shop:",e),e}},async getActiveProductsByShop(e){return this.getProductsByShop(e)},async getProductById(e){try{let t=await (0,a.getDoc)((0,a.doc)(o.db,"products",e));if(!t.exists())throw Error("Product not found");return c(t)}catch(e){throw console.error("Error fetching product:",e),e}},async getAllProducts(){try{let e=(0,a.collection)(o.db,"products"),t=(0,a.query)(e,(0,a.where)("status","==",s.ACTIVE));return(await (0,a.getDocs)(t)).docs.map(e=>c(e)).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}catch(e){throw console.error("Error fetching all products:",e),e}},async createProduct(e){try{let t=(0,a.collection)(o.db,"products"),r={shopId:e.shopId,name:e.name,description:e.description,value:e.value,height:e.height,width:e.width,depth:e.depth,requiresDeposit:e.height>15||e.width>15||e.depth>15,category:e.category||null,mainImage:e.mainImage||null,status:s.ACTIVE,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()},i=await (0,a.ET)(t,r),n=await (0,a.getDoc)(i);if(!n.exists())throw Error("Error al crear el producto");return c(n)}catch(e){throw console.error("Error creating product:",e),e}},async updateProduct(e,t){try{let r=(0,a.doc)(o.db,"products",e),s={updatedAt:(0,a.serverTimestamp)()};if(void 0!==t.name&&(s.name=t.name),void 0!==t.description&&(s.description=t.description),void 0!==t.value&&(s.value=t.value),void 0!==t.height&&(s.height=t.height),void 0!==t.width&&(s.width=t.width),void 0!==t.depth&&(s.depth=t.depth),void 0!==t.category&&(s.category=t.category),void 0!==t.mainImage&&(s.mainImage=t.mainImage),void 0!==t.height||void 0!==t.width||void 0!==t.depth){let e=await (0,a.getDoc)(r);if(e.exists()){let r=e.data(),a=void 0!==t.height?t.height:r.height,o=void 0!==t.width?t.width:r.width,i=void 0!==t.depth?t.depth:r.depth;s.requiresDeposit=a>15||o>15||i>15}}await (0,a.updateDoc)(r,s);let i=await (0,a.getDoc)(r);if(!i.exists())throw Error("Producto no encontrado");return c(i)}catch(e){throw console.error("Error updating product:",e),e}},async deactivateProduct(e){try{let t=(0,a.doc)(o.db,"products",e);await (0,a.updateDoc)(t,{status:s.INACTIVE,updatedAt:(0,a.serverTimestamp)()});let r=await (0,a.getDoc)(t);if(!r.exists())throw Error("Producto no encontrado");return c(r)}catch(e){throw console.error("Error deactivating product:",e),e}}},d={getProductsByShop:async e=>n.getProductsByShop(e),getActiveProductsByShop:async e=>n.getActiveProductsByShop(e),getProductById:async e=>n.getProductById(e),getAllProducts:async()=>n.getAllProducts(),createProduct:async e=>n.createProduct(e),updateProduct:async(e,t)=>n.updateProduct(e,t),deactivateProduct:async e=>n.deactivateProduct(e)}},28848:(e,t,r)=>{"use strict";r.d(t,{m:()=>l});var s=r(10752),a=r(82986),o=r(26379),i=r(12576);let c=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,n=e=>{let t=e.data();return{id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||i.R.PENDING,createdAt:c(t.createdAt),updatedAt:c(t.updatedAt)}},d={async getShopById(e){try{let t=await (0,a.getDoc)((0,a.doc)(o.db,"shops",e));if(!t.exists())throw Error("Shop not found");return n(t)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,a.collection)(o.db,"shops"),t=(0,a.query)(e,(0,a.where)("status","==",i.R.VERIFIED));return(await (0,a.getDocs)(t)).docs.map(e=>n(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,a.collection)(o.db,"shops");return(await (0,a.getDocs)(e)).docs.map(e=>n(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},l={getShopById:async e=>d.getShopById(e),getAllShops:async()=>d.getAllShops(),getVerifiedShops:async()=>d.getVerifiedShops(),getMyShop:async()=>(await s.x.get("/shops/my-shop/current")).data,updateShop:async(e,t)=>(await s.x.put(`/shops/${e}`,t)).data,getShopStatistics:async e=>(await s.x.get(`/shops/${e}/statistics`)).data}},12576:(e,t,r)=>{"use strict";var s;r.d(t,{R:()=>s}),function(e){e.PENDING="pending",e.VERIFIED="verified",e.BLOCKED="blocked"}(s||(s={}))},96643:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2772).createProxy)(String.raw`/Users/axelhernandez/Sorteos/frontend/src/app/panel/sorteos/crear/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3591,8559,3352,4175,9388,31],()=>r(84998));module.exports=s})();