(()=>{var e={};e.id=307,e.ids=[307],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},11817:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),s(53395),s(24198),s(12874);var r=s(27105),a=s(15265),l=s(90157),o=s.n(l),n=s(44665),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);s.d(t,i);let c=["",{children:["panel",{children:["sorteos",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,53395)),"/Users/axelhernandez/Sorteos/frontend/src/app/panel/sorteos/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,24198)),"/Users/axelhernandez/Sorteos/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,12874,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/axelhernandez/Sorteos/frontend/src/app/panel/sorteos/page.tsx"],u="/panel/sorteos/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/panel/sorteos/page",pathname:"/panel/sorteos",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},37725:(e,t,s)=>{Promise.resolve().then(s.bind(s,59189))},59189:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(19899),a=s(5507),l=s(38442),o=s(1260),n=s(28848),i=s(26028),c=s(84499),d=s(54175),u=s(65373),p=s(31),h=s(10195),x=s.n(h),m=s(84837),f=s(87963);function g({shopId:e}){let[t,s]=(0,a.useState)([]),[l,o]=(0,a.useState)(!0),[n,i]=(0,a.useState)(null),[c,h]=(0,a.useState)("all"),g=async()=>{o(!0),i(null);try{let t=await p.raffleService.getRafflesByShop(e);s(t)}catch(e){i(e.response?.data?.message||"Error al cargar los sorteos")}finally{o(!1)}},j="all"===c?t:t.filter(e=>e.status===c),y=async e=>{if(confirm("\xbfEst\xe1s seguro de que deseas cancelar este sorteo?"))try{await p.raffleService.cancelRaffle(e),s(t.map(t=>t.id===e?{...t,status:u.r.CANCELLED}:t))}catch(e){alert(e.response?.data?.message||"Error al cancelar el sorteo")}};return l?r.jsx("div",{className:x().alert,children:"Cargando sorteos..."}):n?(0,r.jsxs)("div",{className:x().alert+" "+x().alertError,children:[n,r.jsx("button",{onClick:g,className:x().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}):0===t.length?r.jsx(f.u,{title:"No tienes sorteos a\xfan",description:"Crea tu primer sorteo para comenzar a vender tickets",icon:"\uD83C\uDFB2",action:{label:"Crear sorteo",onClick:()=>window.location.href="/panel/sorteos/crear"}}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:x().raffleDetailSection,children:[r.jsx("label",{className:x().raffleDetailSectionTitle,children:"Filtrar por estado"}),(0,r.jsxs)("select",{value:c,onChange:e=>h(e.target.value),className:x().formSelect,style:{maxWidth:"300px"},children:[r.jsx("option",{value:"all",children:"Todos los estados"}),r.jsx("option",{value:u.r.DRAFT,children:"Borrador"}),r.jsx("option",{value:u.r.PENDING_APPROVAL,children:"Pendiente de aprobaci\xf3n"}),r.jsx("option",{value:u.r.ACTIVE,children:"Activo"}),r.jsx("option",{value:u.r.SOLD_OUT,children:"Agotado"}),r.jsx("option",{value:u.r.FINISHED,children:"Finalizado"}),r.jsx("option",{value:u.r.CANCELLED,children:"Cancelado"})]})]}),(0,r.jsxs)("table",{className:x().table,children:[r.jsx("thead",{className:x().tableHeader,children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:x().tableHeaderCell,children:"Producto"}),r.jsx("th",{className:x().tableHeaderCell,children:"Estado"}),r.jsx("th",{className:x().tableHeaderCell,children:"Tickets"}),r.jsx("th",{className:x().tableHeaderCell,children:"Creado"}),r.jsx("th",{className:x().tableHeaderCell,children:"Acciones"})]})}),r.jsx("tbody",{children:j.map(e=>(0,r.jsxs)("tr",{className:x().tableRow,children:[r.jsx("td",{className:x().tableCell,children:e.product?.name||"Producto desconocido"}),r.jsx("td",{className:x().tableCell,children:r.jsx(m.O,{status:e.status})}),(0,r.jsxs)("td",{className:x().tableCell,children:[e.soldTickets," / ",e.totalTickets]}),r.jsx("td",{className:x().tableCell,children:new Date(e.createdAt).toLocaleDateString()}),r.jsx("td",{className:x().tableCell,children:(0,r.jsxs)("div",{className:x().cardActions,children:[r.jsx(d.default,{href:`/panel/sorteos/${e.id}`,className:x().cardActionPrimary,children:"Ver"}),(e.status===u.r.DRAFT||e.status===u.r.PENDING_APPROVAL)&&r.jsx("button",{onClick:()=>y(e.id),className:x().cardActionSecondary,children:"Cancelar"})]})})]},e.id))})]})]})}var j=s(2345);function y(){let{user:e,isAuthenticated:t}=(0,l.t)(),[s,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(!0),[h,m]=(0,a.useState)(null),f=async()=>{p(!0),m(null);try{let e=await n.m.getMyShop();d(e)}catch(e){m(e.response?.data?.message||"Error al cargar la tienda")}finally{p(!1)}};return r.jsx(j.i,{requiredRole:o.i.SHOP,children:(0,r.jsxs)("div",{className:x().panelContainer,children:[r.jsx(c.G,{isBlocked:s?.status==="blocked"}),(0,r.jsxs)("main",{className:x().mainContent,children:[u&&r.jsx("div",{className:x().alert,children:"Cargando tienda..."}),h&&(0,r.jsxs)("div",{className:`${x().alert} ${x().alertError}`,children:[h,r.jsx("button",{onClick:f,className:x().primaryButton,style:{marginLeft:"10px"},children:"Reintentar"})]}),s&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(i.N,{shop:s}),(0,r.jsxs)("div",{className:x().raffleDetail,children:[r.jsx("h1",{className:x().raffleDetailTitle,children:"Mis sorteos"}),r.jsx(g,{shopId:s.id})]})]})]})]})})}},87963:(e,t,s)=>{"use strict";s.d(t,{u:()=>o});var r=s(19899),a=s(10195),l=s.n(a);function o({title:e,description:t,icon:s,action:a}){return(0,r.jsxs)("div",{className:l().emptyState,children:[s&&r.jsx("div",{className:l().emptyStateIcon,children:s}),r.jsx("h3",{className:l().emptyStateTitle,children:e}),r.jsx("p",{className:l().emptyStateDescription,children:t}),a&&r.jsx("button",{className:l().primaryButton,onClick:a.onClick,children:a.label})]})}},84837:(e,t,s)=>{"use strict";s.d(t,{O:()=>o});var r=s(19899),a=s(10195),l=s.n(a);function o({status:e}){return r.jsx("span",{className:l().statusBadge,style:{backgroundColor:(e=>{switch(e){case"pending":case"pending_approval":return"#FFA500";case"verified":case"active":return"#4CAF50";case"blocked":case"rejected":case"cancelled":return"#F44336";case"draft":return"#9E9E9E";case"sold_out":return"#2196F3";case"finished":return"#673AB7";default:return"#757575"}})(e)},children:{pending:"Pendiente",pending_approval:"Pendiente de aprobaci\xf3n",verified:"Verificada",blocked:"Bloqueada",active:"Activo",draft:"Borrador",sold_out:"Agotado",finished:"Finalizado",cancelled:"Cancelado",rejected:"Rechazado"}[e]||e})}},28848:(e,t,s)=>{"use strict";s.d(t,{m:()=>d});var r=s(10752),a=s(82986),l=s(26379),o=s(12576);let n=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,i=e=>{let t=e.data();return{id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||o.R.PENDING,createdAt:n(t.createdAt),updatedAt:n(t.updatedAt)}},c={async getShopById(e){try{let t=await (0,a.getDoc)((0,a.doc)(l.db,"shops",e));if(!t.exists())throw Error("Shop not found");return i(t)}catch(e){throw console.error("Error fetching shop:",e),e}},async getVerifiedShops(){try{let e=(0,a.collection)(l.db,"shops"),t=(0,a.query)(e,(0,a.where)("status","==",o.R.VERIFIED));return(await (0,a.getDocs)(t)).docs.map(e=>i(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching verified shops:",e),e}},async getAllShops(){try{let e=(0,a.collection)(l.db,"shops");return(await (0,a.getDocs)(e)).docs.map(e=>i(e)).sort((e,t)=>e.name.localeCompare(t.name))}catch(e){throw console.error("Error fetching all shops:",e),e}}},d={getShopById:async e=>c.getShopById(e),getAllShops:async()=>c.getAllShops(),getVerifiedShops:async()=>c.getVerifiedShops(),getMyShop:async()=>(await r.x.get("/shops/my-shop/current")).data,updateShop:async(e,t)=>(await r.x.put(`/shops/${e}`,t)).data,getShopStatistics:async e=>(await r.x.get(`/shops/${e}/statistics`)).data}},12576:(e,t,s)=>{"use strict";var r;s.d(t,{R:()=>r}),function(e){e.PENDING="pending",e.VERIFIED="verified",e.BLOCKED="blocked"}(r||(r={}))},53395:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(2772).createProxy)(String.raw`/Users/axelhernandez/Sorteos/frontend/src/app/panel/sorteos/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[3591,8559,3352,4175,9388,31],()=>s(11817));module.exports=r})();