(()=>{var e={};e.id=1842,e.ids=[1842],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},6617:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l}),r(57254),r(24198),r(12874);var s=r(27105),a=r(15265),n=r(90157),i=r.n(n),o=r(44665),c={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);r.d(t,c);let l=["",{children:["sorteos",{children:["[id]",{children:["winner",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,57254)),"/Users/axelhernandez/Sorteos/frontend/src/app/sorteos/[id]/winner/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,24198)),"/Users/axelhernandez/Sorteos/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,12874,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/axelhernandez/Sorteos/frontend/src/app/sorteos/[id]/winner/page.tsx"],u="/sorteos/[id]/winner/page",h={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/sorteos/[id]/winner/page",pathname:"/sorteos/[id]/winner",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},57800:(e,t,r)=>{Promise.resolve().then(r.bind(r,81364))},36507:(e,t,r)=>{Promise.resolve().then(r.bind(r,69622))},4104:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,33817,23)),Promise.resolve().then(r.t.bind(r,19323,23)),Promise.resolve().then(r.t.bind(r,52204,23)),Promise.resolve().then(r.t.bind(r,60820,23)),Promise.resolve().then(r.t.bind(r,55915,23)),Promise.resolve().then(r.t.bind(r,81611,23))},69622:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(19899),a=r(5507),n=r(54175),i=r(18154),o=r(76153),c=r(55562);r(83730);var l=r(80760),d=r(65373);r(10752);var u=r(14066),h=r.n(u);function p(){let e=(0,o.useParams)().id,{user:t}=(0,l.a)(),[r,u]=(0,a.useState)(null),[p,m]=(0,a.useState)(!0),[_,g]=(0,a.useState)(null),[w,x]=(0,a.useState)(null),[f,N]=(0,a.useState)([]),[j,b]=(0,a.useState)(!1);return p?s.jsx("main",{className:h().container,children:(0,s.jsxs)("div",{className:h().loadingContainer,children:[s.jsx("div",{className:h().spinner}),s.jsx("p",{children:"Cargando informaci\xf3n del ganador..."})]})}):_||!r?s.jsx("main",{className:h().container,children:(0,s.jsxs)("div",{className:h().errorContainer,children:[s.jsx(c.jRj,{className:h().errorIcon}),s.jsx("h1",{className:h().errorTitle,children:"Sorteo no encontrado"}),s.jsx("p",{className:h().errorDescription,children:"El sorteo que buscas no existe o no est\xe1 disponible en este momento."}),s.jsx(n.default,{href:"/sorteos",children:s.jsx("button",{className:h().backButton,children:"Volver al listado"})})]})}):r.status!==d.r.FINISHED?s.jsx("main",{className:h().container,children:(0,s.jsxs)("div",{className:h().errorContainer,children:[s.jsx(c.TCC,{className:h().errorIcon}),s.jsx("h1",{className:h().errorTitle,children:"Sorteo a\xfan no finalizado"}),s.jsx("p",{className:h().errorDescription,children:"Este sorteo a\xfan no ha finalizado. Vuelve cuando el sorteo est\xe9 completo."}),s.jsx(n.default,{href:`/sorteos/${e}`,children:s.jsx("button",{className:h().backButton,children:"Ver sorteo"})})]})}):r.winnerTicketId?(0,s.jsxs)("main",{className:h().container,children:[s.jsx(n.default,{href:`/sorteos/${e}`,className:h().backLink,children:"â† Volver al sorteo"}),s.jsx("div",{className:h().heroSection,children:s.jsx("div",{className:h().heroContent,children:j?(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:h().winnerIcon,children:s.jsx(c.HR2,{})}),s.jsx("h1",{className:h().heroTitle,children:"\xa1Felicidades! Eres el ganador"}),(0,s.jsxs)("p",{className:h().heroSubtitle,children:["Has ganado el sorteo de ",s.jsx("strong",{children:r.product?.name})]})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:h().winnerIcon,children:s.jsx(c._rq,{})}),s.jsx("h1",{className:h().heroTitle,children:"Sorteo finalizado"}),(0,s.jsxs)("p",{className:h().heroSubtitle,children:["El ganador del sorteo de ",s.jsx("strong",{children:r.product?.name})," ha sido seleccionado"]})]})})}),(0,s.jsxs)("div",{className:h().content,children:[(0,s.jsxs)("div",{className:h().leftColumn,children:[(0,s.jsxs)("div",{className:h().productCard,children:[r.product?.mainImage?s.jsx("div",{className:h().imageContainer,children:s.jsx(i.default,{src:r.product.mainImage,alt:r.product.name,fill:!0,className:h().image,priority:!0})}):s.jsx("div",{className:h().imagePlaceholder,children:s.jsx("span",{children:"Sin imagen disponible"})}),(0,s.jsxs)("div",{className:h().productInfo,children:[s.jsx("h2",{className:h().productName,children:r.product?.name}),s.jsx("p",{className:h().productDescription,children:r.product?.description}),(0,s.jsxs)("div",{className:h().valueBox,children:[s.jsx("span",{className:h().valueLabel,children:"Valor del producto"}),(0,s.jsxs)("span",{className:h().valueAmount,children:["S/ ",Number(r.productValue).toFixed(2)]})]})]})]}),(0,s.jsxs)("div",{className:h().shopCard,children:[s.jsx("h3",{className:h().shopTitle,children:"Tienda"}),(0,s.jsxs)("div",{className:h().shopInfo,children:[r.shop?.logo&&s.jsx(i.default,{src:r.shop.logo,alt:r.shop.name,width:48,height:48,className:h().shopLogo}),(0,s.jsxs)("div",{className:h().shopDetails,children:[s.jsx("h4",{className:h().shopName,children:r.shop?.name}),r.shop?.status==="verified"&&(0,s.jsxs)("span",{className:h().verifiedBadge,children:[s.jsx(c._rq,{className:h().verifiedIcon}),"Tienda verificada"]})]})]}),r.shop?.publicEmail&&(0,s.jsxs)("p",{className:h().shopContact,children:[s.jsx("strong",{children:"Contacto:"})," ",r.shop.publicEmail]}),r.shop?.phone&&(0,s.jsxs)("p",{className:h().shopContact,children:[s.jsx("strong",{children:"Tel\xe9fono:"})," ",r.shop.phone]})]})]}),(0,s.jsxs)("div",{className:h().rightColumn,children:[(0,s.jsxs)("div",{className:`${h().winnerCard} ${j?h().winnerCardHighlight:""}`,children:[s.jsx("div",{className:h().winnerHeader,children:s.jsx("h2",{className:h().winnerTitle,children:j?(0,s.jsxs)(s.Fragment,{children:[s.jsx(c._rq,{className:h().titleIcon}),"Tu ticket ganador"]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(c.HR2,{className:h().titleIcon}),"Ticket ganador"]})})}),(0,s.jsxs)("div",{className:h().winnerTicketDisplay,children:[(0,s.jsxs)("div",{className:h().ticketNumberContainer,children:[s.jsx("span",{className:h().ticketLabel,children:"N\xfamero de ticket"}),(0,s.jsxs)("span",{className:h().ticketNumber,children:["#",w?.number||"N/A"]})]}),w?.user&&(0,s.jsxs)("div",{className:h().winnerUserInfo,children:[s.jsx("p",{className:h().winnerUserLabel,children:"Ganador"}),s.jsx("p",{className:h().winnerUserName,children:w.user.name}),j&&s.jsx("p",{className:h().winnerUserEmail,children:w.user.email})]}),r.raffleExecutedAt&&(0,s.jsxs)("div",{className:h().executionInfo,children:[s.jsx("p",{className:h().executionLabel,children:"Fecha de ejecuci\xf3n"}),s.jsx("p",{className:h().executionDate,children:new Date(r.raffleExecutedAt).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),j&&(0,s.jsxs)("div",{className:h().winnerMessage,children:[(0,s.jsxs)("p",{className:h().winnerMessageText,children:[s.jsx("strong",{children:"\xa1Felicidades!"})," Has sido seleccionado como ganador de este sorteo. La tienda se pondr\xe1 en contacto contigo para coordinar la entrega del premio."]}),r.shop?.publicEmail&&(0,s.jsxs)("p",{className:h().winnerMessageText,children:["Si tienes alguna pregunta, puedes contactar a la tienda en:"," ",s.jsx("a",{href:`mailto:${r.shop.publicEmail}`,className:h().contactLink,children:r.shop.publicEmail})]})]})]}),(0,s.jsxs)("div",{className:h().statsCard,children:[s.jsx("h3",{className:h().statsTitle,children:"Estad\xedsticas del sorteo"}),(0,s.jsxs)("div",{className:h().statsGrid,children:[(0,s.jsxs)("div",{className:h().statItem,children:[s.jsx("span",{className:h().statLabel,children:"Total de tickets"}),s.jsx("span",{className:h().statValue,children:r.totalTickets})]}),(0,s.jsxs)("div",{className:h().statItem,children:[s.jsx("span",{className:h().statLabel,children:"Tickets vendidos"}),s.jsx("span",{className:h().statValue,children:r.soldTickets})]}),(0,s.jsxs)("div",{className:h().statItem,children:[s.jsx("span",{className:h().statLabel,children:"Valor total"}),(0,s.jsxs)("span",{className:h().statValue,children:["S/ ",(Number(r.productValue)*r.soldTickets).toFixed(2)]})]})]})]}),t&&f.length>0&&(0,s.jsxs)("div",{className:h().participationCard,children:[s.jsx("h3",{className:h().participationTitle,children:"Tus participaciones"}),(0,s.jsxs)("p",{className:h().participationText,children:["Participaste con ",s.jsx("strong",{children:f.length})," ticket",f.length>1?"s":"",":"]}),s.jsx("div",{className:h().ticketNumbers,children:f.map(e=>(0,s.jsxs)("span",{className:`${h().ticketNumberBadge} ${e.id===r.winnerTicketId?h().ticketNumberWinner:""}`,children:["#",e.number,e.id===r.winnerTicketId&&s.jsx(c.HR2,{className:h().winnerBadgeIcon})]},e.id))})]})]})]}),(0,s.jsxs)("div",{className:h().ctaSection,children:[s.jsx("h2",{className:h().ctaTitle,children:"\xbfQuieres participar en m\xe1s sorteos?"}),s.jsx("p",{className:h().ctaText,children:"Descubre otros sorteos disponibles y gana incre\xedbles premios"}),s.jsx(n.default,{href:"/sorteos",children:s.jsx("button",{className:h().ctaButton,children:"Ver todos los sorteos"})})]})]}):s.jsx("main",{className:h().container,children:(0,s.jsxs)("div",{className:h().errorContainer,children:[s.jsx(c.bax,{className:h().errorIcon}),s.jsx("h1",{className:h().errorTitle,children:"Ganador no disponible"}),s.jsx("p",{className:h().errorDescription,children:"El ganador de este sorteo a\xfan no ha sido determinado."}),s.jsx(n.default,{href:`/sorteos/${e}`,children:s.jsx("button",{className:h().backButton,children:"Volver al sorteo"})})]})})}},81364:(e,t,r)=>{"use strict";function s(){return null}r.d(t,{default:()=>s}),r(5507),r(82986),r(26379)},80760:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(5507),a=r(38442);function n(){let[e,t]=(0,s.useState)(!1);return{...(0,a.t)(),isHydrated:e}}r(16012)},10752:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});var s=r(20751);let a=(()=>{let e="http://localhost:3001/api";if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.warn("âš ï¸ NEXT_PUBLIC_API_URL no tiene protocolo, usando https://"),`https://${e}`;if(!e.endsWith("/api")){let t=e.endsWith("/")?e.slice(0,-1):e;return`${t}/api`}return e})();class n{client;constructor(){this.client=s.Z.create({baseURL:a,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");console.log("API Request - Token from localStorage:",t),t?(e.headers.Authorization=`Bearer ${t}`,console.log("API Request - Authorization header set:",e.headers.Authorization)):console.log("API Request - No token found"),e.data instanceof FormData&&delete e.headers["Content-Type"]}catch(e){console.error("Error reading token from localStorage:",e)}return e}),this.client.interceptors.response.use(e=>e,e=>(e.response?.status===401&&localStorage.removeItem("token"),Promise.reject(e)))}async register(e){return this.client.post("/auth/register",e)}async login(e){return this.client.post("/auth/login",e)}async getProfile(){return this.client.get("/auth/profile")}async logout(){return this.client.post("/auth/logout")}async get(e,t){return this.client.get(e,t)}async post(e,t,r){return this.client.post(e,t,r)}async put(e,t){return this.client.put(e,t)}async delete(e){return this.client.delete(e)}}let i=new n},26379:(e,t,r)=>{"use strict";let s;r.d(t,{I8:()=>l,db:()=>c});var a=r(3827),n=r(82986),i=r(31027),o=r(80549);s=0===(0,a.C6)().length?(0,a.ZF)({apiKey:"AIzaSyCROuDbFChzWrRSXQ42lih56oLEA1hjne4",authDomain:"sorteo-b8fb0.firebaseapp.com",projectId:"sorteo-b8fb0",storageBucket:"sorteo-b8fb0.firebasestorage.app",messagingSenderId:"58395659334",appId:"1:58395659334:web:58c8f46dab380710eb4e47"}):(0,a.C6)()[0];let c=(0,n.ad)(s);(0,i.cF)(s);let l=(0,o.v0)(s)},16012:(e,t,r)=>{"use strict";r.d(t,{Y:()=>c});var s=r(80549),a=r(82986),n=r(26379),i=r(1260);let o=async e=>{try{let t=await (0,a.getDoc)((0,a.doc)(n.db,"users",e.uid));if(!t.exists())return{id:e.uid,name:e.displayName||e.email?.split("@")[0]||"Usuario",email:e.email||"",role:i.i.USER};let r=t.data();return{id:e.uid,name:r.name||e.displayName||e.email?.split("@")[0]||"Usuario",email:e.email||"",role:r.role||i.i.USER}}catch(t){return console.error("Error converting Firebase user:",t),{id:e.uid,name:e.displayName||e.email?.split("@")[0]||"Usuario",email:e.email||"",role:i.i.USER}}},c={async register(e){try{let t=(await (0,s.Xb)(n.I8,e.email,e.password)).user;e.name&&await (0,s.ck)(t,{displayName:e.name});let r=await t.getIdToken(),c={name:e.name,email:e.email,role:e.role,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()};if(e.role===i.i.SHOP&&e.shopName){let r={userId:t.uid,name:e.shopName,description:"",status:"pending",createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()},s=await (0,a.ET)((0,a.collection)(n.db,"shops"),r);c.shopId=s.id,await (0,a.pl)((0,a.doc)(n.db,"users",t.uid),c)}else await (0,a.pl)((0,a.doc)(n.db,"users",t.uid),c);return{user:await o(t),token:r}}catch(t){console.error("Error registering user:",t);let e="Error al registrar usuario";throw"auth/email-already-in-use"===t.code?e="Este email ya est\xe1 registrado":"auth/invalid-email"===t.code?e="Email inv\xe1lido":"auth/weak-password"===t.code?e="La contrase\xf1a debe tener al menos 6 caracteres":"auth/operation-not-allowed"===t.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===t.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":t.message&&(e=t.message),Error(e)}},async login(e){try{let t=(await (0,s.e5)(n.I8,e.email,e.password)).user,r=await t.getIdToken();return{user:await o(t),token:r}}catch(t){console.error("Error logging in:",t);let e="Error al iniciar sesi\xf3n";throw"auth/user-not-found"===t.code?e="Usuario no encontrado":"auth/wrong-password"===t.code?e="Contrase\xf1a incorrecta":"auth/invalid-email"===t.code?e="Email inv\xe1lido":"auth/user-disabled"===t.code?e="Usuario deshabilitado":"auth/too-many-requests"===t.code?e="Demasiados intentos. Intenta m\xe1s tarde":"auth/operation-not-allowed"===t.code?e="El m\xe9todo de autenticaci\xf3n por email/password no est\xe1 habilitado. Por favor, contacta al administrador.":"auth/network-request-failed"===t.code?e="Error de conexi\xf3n. Verifica tu conexi\xf3n a internet.":t.message&&(e=t.message),Error(e)}},async logout(){try{await (0,s.w7)(n.I8)}catch(e){throw console.error("Error logging out:",e),e}},async getCurrentUser(){try{let e=n.I8.currentUser;if(!e)return null;return await o(e)}catch(e){return console.error("Error getting current user:",e),null}},async getCurrentUserToken(){try{let e=n.I8.currentUser;if(!e)return null;return await e.getIdToken()}catch(e){return console.error("Error getting token:",e),null}},onAuthStateChanged:e=>(0,s.Aj)(n.I8,async t=>{t?e(await o(t)):e(null)})}},45144:(e,t,r)=>{"use strict";r.d(t,{U:()=>c});var s=r(82986),a=r(26379),n=r(65373);let i=e=>e?.toDate?e.toDate():e instanceof Date?e:"string"==typeof e?new Date(e):new Date,o=async e=>{let t=e.data(),r={id:e.id,shopId:t.shopId||"",productId:t.productId||"",productValue:t.productValue||0,totalTickets:t.totalTickets||0,soldTickets:t.soldTickets||0,status:t.status||n.r.DRAFT,requiresDeposit:t.requiresDeposit||!1,winnerTicketId:t.winnerTicketId,specialConditions:t.specialConditions,createdAt:i(t.createdAt),updatedAt:i(t.updatedAt),activatedAt:t.activatedAt?i(t.activatedAt):void 0,raffleExecutedAt:t.raffleExecutedAt?i(t.raffleExecutedAt):void 0};if(t.shopId)try{let e=await (0,s.getDoc)((0,s.doc)(a.db,"shops",t.shopId));if(e.exists()){let t=e.data();r.shop={id:e.id,userId:t.userId||"",name:t.name||"",description:t.description,logo:t.logo,publicEmail:t.publicEmail,phone:t.phone,socialMedia:t.socialMedia,status:t.status||"pending",createdAt:i(t.createdAt),updatedAt:i(t.updatedAt)}}}catch(e){console.error("Error loading shop:",e)}if(t.productId)try{let e=await (0,s.getDoc)((0,s.doc)(a.db,"products",t.productId));if(e.exists()){let t=e.data();r.product={id:e.id,shopId:t.shopId||"",name:t.name||"",description:t.description||"",value:t.value||0,height:t.height||0,width:t.width||0,depth:t.depth||0,requiresDeposit:t.requiresDeposit||!1,category:t.category,mainImage:t.mainImage,status:t.status||"inactive",createdAt:i(t.createdAt),updatedAt:i(t.updatedAt)}}}catch(e){console.error("Error loading product:",e)}return r},c={async getActiveRaffles(e){try{let t;let r=(0,s.collection)(a.db,"raffles");try{let a=(0,s.query)(r,(0,s.where)("status","==",n.r.ACTIVE));if(e?.shopId&&(a=(0,s.query)(a,(0,s.where)("shopId","==",e.shopId))),e?.shopId)t=await (0,s.getDocs)(a);else try{a=e?.sortBy==="newest"?(0,s.query)(a,(0,s.Xo)("createdAt","desc")):e?.sortBy==="closest"?(0,s.query)(a,(0,s.Xo)("soldTickets","desc")):e?.sortBy==="price-asc"?(0,s.query)(a,(0,s.Xo)("productValue","asc")):e?.sortBy==="price-desc"?(0,s.query)(a,(0,s.Xo)("productValue","desc")):(0,s.query)(a,(0,s.Xo)("createdAt","desc")),t=await (0,s.getDocs)(a)}catch(i){console.warn("Error con orderBy, obteniendo sin ordenar:",i),a=e?.shopId?(0,s.query)(r,(0,s.where)("status","==",n.r.ACTIVE),(0,s.where)("shopId","==",e.shopId)):(0,s.query)(r,(0,s.where)("status","==",n.r.ACTIVE)),t=await (0,s.getDocs)(a)}}catch(i){console.warn("Error en consulta con where, obteniendo todos los sorteos:",i);let e=(0,s.query)(r),a=await (0,s.getDocs)(e);t={docs:a.docs.filter(e=>{let t=e.data().status;return t===n.r.ACTIVE||"active"===t})},console.log(`ðŸ“Š Sorteos activos encontrados despu\xe9s de filtrar: ${t.docs.length} de ${a.docs.length} totales`)}let i=[];for(let e of t.docs)try{let t=await o(e);i.push(t)}catch(e){console.error("Error converting raffle doc:",e)}if(console.log(`âœ… Sorteos activos cargados: ${i.length}`),e?.category&&(i=i.filter(t=>t.product?.category===e.category)),e?.minValue!==void 0&&(i=i.filter(t=>t.productValue>=e.minValue)),e?.maxValue!==void 0&&(i=i.filter(t=>t.productValue<=e.maxValue)),e?.search){let t=e.search.toLowerCase();i=i.filter(e=>e.product?.name.toLowerCase().includes(t)||e.product?.description.toLowerCase().includes(t)||e.shop?.name.toLowerCase().includes(t))}(e?.shopId||e?.sortBy)&&(e?.sortBy==="newest"?i.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()):e?.sortBy==="closest"?i.sort((e,t)=>t.soldTickets-e.soldTickets):e?.sortBy==="price-asc"?i.sort((e,t)=>e.productValue-t.productValue):e?.sortBy==="price-desc"&&i.sort((e,t)=>t.productValue-e.productValue));let c=e?.limit||12,l=e?.page||1,d=(l-1)*c,u=i.length;return{data:i.slice(d,d+c),total:u,page:l,limit:c,totalPages:Math.ceil(u/c)}}catch(e){throw console.error("Error fetching active raffles:",e),e}},async getRaffleById(e){try{let t=await (0,s.getDoc)((0,s.doc)(a.db,"raffles",e));if(!t.exists())throw Error("Raffle not found");return await o(t)}catch(e){throw console.error("Error fetching raffle:",e),e}},async getRafflesByShop(e,t){try{let r=(0,s.collection)(a.db,"raffles"),i=(0,s.query)(r,(0,s.where)("shopId","==",e),(0,s.where)("status","==",n.r.ACTIVE)),c=await (0,s.getDocs)(i),l=[];for(let e of c.docs){let t=await o(e);l.push(t)}if(t?.search){let e=t.search.toLowerCase();l=l.filter(t=>t.product?.name.toLowerCase().includes(e)||t.product?.description.toLowerCase().includes(e))}t?.sortBy==="newest"?l.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()):t?.sortBy==="closest"?l.sort((e,t)=>t.soldTickets-e.soldTickets):l.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime());let d=t?.limit||12,u=t?.page||1,h=(u-1)*d,p=l.length;return{data:l.slice(h,h+d),total:p,page:u,limit:d,totalPages:Math.ceil(p/d)}}catch(e){throw console.error("Error fetching shop raffles:",e),e}},async getCategories(){try{let e=(0,s.collection)(a.db,"products"),t=(0,s.query)(e,(0,s.where)("status","==","active")),r=await (0,s.getDocs)(t),n=new Set;return r.docs.forEach(e=>{let t=e.data();t.category&&n.add(t.category)}),Array.from(n).sort()}catch(e){return console.error("Error fetching categories:",e),[]}},async getShopsWithActiveRaffles(){try{let e=(0,s.collection)(a.db,"raffles"),t=(0,s.query)(e,(0,s.where)("status","==",n.r.ACTIVE)),r=await (0,s.getDocs)(t),i=new Set;r.docs.forEach(e=>{let t=e.data();t.shopId&&i.add(t.shopId)});let o=[];for(let e of i)try{let t=await (0,s.getDoc)((0,s.doc)(a.db,"shops",e));if(t.exists()){let e=t.data();o.push({id:t.id,name:e.name||"Tienda sin nombre"})}}catch(t){console.error(`Error loading shop ${e}:`,t)}return o.sort((e,t)=>e.name.localeCompare(t.name))}catch(e){return console.error("Error fetching shops:",e),[]}}}},83730:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=r(45144).U},38442:(e,t,r)=>{"use strict";r.d(t,{t:()=>i});var s=r(24978),a=r(31460),n=r(16012);let i=(0,s.Ue)()((0,a.tJ)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,setUser:t=>e({user:t,isAuthenticated:!!t}),setToken:t=>{t?localStorage.setItem("token",t):localStorage.removeItem("token"),e({token:t})},setIsLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),logout:async()=>{try{await n.Y.logout()}catch(e){console.error("Error logging out:",e)}finally{localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})}},refreshToken:async()=>{try{let e=await n.Y.getCurrentUserToken();e&&t().setToken(e)}catch(e){console.error("Error refreshing token:",e)}}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})}))},1260:(e,t,r)=>{"use strict";var s;r.d(t,{i:()=>s}),function(e){e.ADMIN="admin",e.SHOP="shop",e.USER="user"}(s||(s={}))},65373:(e,t,r)=>{"use strict";var s;r.d(t,{r:()=>s}),function(e){e.DRAFT="draft",e.PENDING_APPROVAL="pending_approval",e.ACTIVE="active",e.PAUSED="paused",e.SOLD_OUT="sold_out",e.FINISHED="finished",e.CANCELLED="cancelled",e.REJECTED="rejected"}(s||(s={}))},14066:e=>{e.exports={container:"winner_container__aQaVY",backLink:"winner_backLink__abg5X",loadingContainer:"winner_loadingContainer__b1L4W",errorContainer:"winner_errorContainer__yE4D3",spinner:"winner_spinner__2nbjO",spin:"winner_spin__LVIIZ",errorIcon:"winner_errorIcon__H2oaO",errorTitle:"winner_errorTitle__8WQf3",errorDescription:"winner_errorDescription__M9IOQ",backButton:"winner_backButton__Dfln5",heroSection:"winner_heroSection__4ehVV",heroContent:"winner_heroContent___H2BO",winnerIcon:"winner_winnerIcon__s2jfR",bounce:"winner_bounce__n0vzE",heroTitle:"winner_heroTitle__G56Lx",heroSubtitle:"winner_heroSubtitle__YiXL9",content:"winner_content__X6RJL",leftColumn:"winner_leftColumn__PQPwv",productCard:"winner_productCard__B2C6C",imageContainer:"winner_imageContainer__iC6Z5",image:"winner_image__0iDAY",imagePlaceholder:"winner_imagePlaceholder__jmGzj",productInfo:"winner_productInfo__vsaLv",productName:"winner_productName__a5blh",productDescription:"winner_productDescription__hK48i",valueBox:"winner_valueBox__8BI_0",valueLabel:"winner_valueLabel__m5HLc",valueAmount:"winner_valueAmount__s_fgz",shopCard:"winner_shopCard__4Nv_o",shopTitle:"winner_shopTitle__kDQ_z",shopInfo:"winner_shopInfo__w9UHk",shopLogo:"winner_shopLogo__ckRNe",shopDetails:"winner_shopDetails__88NQQ",shopName:"winner_shopName__ptfgG",verifiedBadge:"winner_verifiedBadge__iZIME",verifiedIcon:"winner_verifiedIcon__db8uz",shopContact:"winner_shopContact___o4_6",rightColumn:"winner_rightColumn__aIQgT",winnerCard:"winner_winnerCard__Fy0II",winnerCardHighlight:"winner_winnerCardHighlight__kY1UK",winnerHeader:"winner_winnerHeader__n4gtl",winnerTitle:"winner_winnerTitle__wOVIN",titleIcon:"winner_titleIcon__nf_4X",winnerTicketDisplay:"winner_winnerTicketDisplay__xuT8_",ticketNumberContainer:"winner_ticketNumberContainer__T8Vki",ticketLabel:"winner_ticketLabel__PgDQh",ticketNumber:"winner_ticketNumber__ek8_v",winnerUserInfo:"winner_winnerUserInfo__8m7G5",winnerUserLabel:"winner_winnerUserLabel__U09CU",winnerUserName:"winner_winnerUserName__f5QnO",winnerUserEmail:"winner_winnerUserEmail__OgTqs",executionInfo:"winner_executionInfo__OFerq",executionLabel:"winner_executionLabel__dSmox",executionDate:"winner_executionDate__W27bz",winnerMessage:"winner_winnerMessage__fevgo",winnerMessageText:"winner_winnerMessageText__HYtGB",contactLink:"winner_contactLink__1ZlGS",statsCard:"winner_statsCard__ME8gc",statsTitle:"winner_statsTitle__GuEpH",statsGrid:"winner_statsGrid__1GSJd",statItem:"winner_statItem__dVTVe",statLabel:"winner_statLabel__p3fpc",statValue:"winner_statValue__Dj4I2",participationCard:"winner_participationCard__MW5Ay",participationTitle:"winner_participationTitle__2sU5p",participationText:"winner_participationText__bpMQb",ticketNumbers:"winner_ticketNumbers__m8jFH",ticketNumberBadge:"winner_ticketNumberBadge__f6RQd",ticketNumberWinner:"winner_ticketNumberWinner__meRTa",winnerBadgeIcon:"winner_winnerBadgeIcon__N9sJY",ctaSection:"winner_ctaSection__qKXlm",ctaTitle:"winner_ctaTitle__EYs36",ctaText:"winner_ctaText__xcPHk",ctaButton:"winner_ctaButton__YbsLw"}},24198:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i,metadata:()=>n});var s=r(35023);r(91641);let a=(0,r(2772).createProxy)(String.raw`/Users/axelhernandez/Sorteos/frontend/src/components/MakeAdminScript.tsx#default`),n={title:"TIKETEA ONLINE",description:"Plataforma de sorteos online - TIKETEA ONLINE"};function i({children:e}){return s.jsx("html",{lang:"es",children:(0,s.jsxs)("body",{children:[e,s.jsx(a,{})]})})}},57254:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2772).createProxy)(String.raw`/Users/axelhernandez/Sorteos/frontend/src/app/sorteos/[id]/winner/page.tsx#default`)},91641:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3591,8559,3352,4175,5562,8154],()=>r(6617));module.exports=s})();